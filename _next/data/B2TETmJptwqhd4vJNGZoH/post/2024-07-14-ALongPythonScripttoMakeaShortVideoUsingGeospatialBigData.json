{"pageProps":{"post":{"title":"지리 공간 빅 데이터를 활용한 짧은 영상 제작을 위한 긴 Python 스크립트","description":"","date":"2024-07-14 19:43","slug":"2024-07-14-ALongPythonScripttoMakeaShortVideoUsingGeospatialBigData","content":"\n\n\n![이미지](/TIL/assets/img/2024-07-14-ALongPythonScripttoMakeaShortVideoUsingGeospatialBigData_0.png)\n\n# 목차\n\n- 🌟 소개\n- 🔍 설정: 설치 및 라이브러리 임포트\n- ⏳ \"NetCDF\" 파일의 쿼리 및 처리\n- 🗺️ 캘리포니아 지역 및 NDVI 지도 플로팅을 위한 이미지 클리핑\n- 🎥 NDVI 지도를 비디오로 내보내기\n- 📝 결론\n- 📚 참고 자료\n\n## 🌟 소개\n\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n원하는 곳에서 매일 또는 매주 촬영된 위성 이미지를 기반으로 동영상과 애니메이션을 만드는 것을 즐기며 대규모 지리 공간 데이터를 시각화하는 일에 깊은 열정을 갖고 있습니다. 그러나 이 많은 양의 이미지를 처리하는 것은 다운로드, 클리핑, 위성 이미지 표시 등의 단계를 거치기 때문에 시간이 많이 걸립니다. 이 과정에는 API, 코딩, 지리 데이터에 대한 심도 있는 이해, 데이터 시각화에 대한 뛰어난 기술이 필요합니다. 이 이야기는 '위에 언급된 모든' 기술의 조합에 관한 것입니다.\n\n다른 게시물에서 Sentinel-2 및 Sentinel-3 이미지의 시각화에 대해 작성하던 중, 이 중 하나의 위성이 특정 위치 위에서 촬영한 모든 이미지를 모아 애니메이션으로 제시하는 아이디어에 주목했습니다. 오늘은 이 비전을 실현하고 2023년 캘리포니아 위에서 캡처된 Sentinel-3의 NDVI 맵을 탐색해보는 날입니다!\n\n이 이야기에서는 이러한 NDVI 맵을 처리, 시각화하고 애니메이션을 만들기 위해 Google Colab에서 강력한 Python 스크립트를 작성할 것입니다. 여기서는 이미지 다운로드 부분을 다루지 않습니다. 이미 별도의 이야기에서 자세히 다루었기 때문에 해당 링크에서 확인할 수 있습니다:\n\n## 🔍 설정: 설치 및 라이브러리 가져오기\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n첫 번째 단계는 다음 폴더를 생성하는 것입니다: NetCDF, Geotiff, Geotiff_reproj, Geotiff_reproj_clipped, Shapefile, JPEG 및 Animation. 다음과 같이 수행할 수 있습니다:\n\n```js\nimport os\n\n# 폴더 이름 정의\nfolders = ['NetCDF', 'Geotiff', 'Geotiff_reproj', 'Geotiff_reproj_clipped', 'Shapefile', 'JPEG', 'Animation']\n\n# 폴더 생성\nfor folder in folders:\n    if not os.path.exists(folder):\n        os.makedirs(folder)\n\n# 확인 메시지 출력\nprint('폴더가 성공적으로 생성되었습니다!')\n```\n\n<img src=\"/TIL/assets/img/2024-07-14-ALongPythonScripttoMakeaShortVideoUsingGeospatialBigData_1.png\" />\n\nNetCDF 폴더는 Sentinel-3 NDVI의 raw 데이터를 저장합니다. 추가로, Geotiff, Geotiff_reproj, Geotiff_reproj_clipped 폴더는 래스터 파일, 재투영된 래스터 파일 및 래스터 파일 클립을 GeoTIFF 형식으로 저장하기 위해 생성됩니다 (모두 NetCDF 파일에서 변환된 형식). Shapefile 폴더에는 캘리포니아 형태 파일(우리의 관심 영역(AOI)로 Sentinel-3 이미지 클리핑을 위해)이 포함되어 있습니다. JPEG 폴더는 NDVI 맵을 \".jpg\" 형식으로 저장하기 위해 생성되며, Animation 폴더는 최종 비디오를 저장하기 위해 특별히 생성되었습니다.\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n또한, Google Colab에 몇 가지 라이브러리를 설치하고 가져와야 합니다.\n\n```js\npip install pandas rasterio netCDF4 rioxarray\n```\n\n```js\nimport os\nimport re\nimport sys\nimport random\nfrom pathlib import Path\n\nimport requests\nimport json\nimport xml.etree.ElementTree as ET\nimport certifi\n\nimport pandas as pd\nimport numpy as np\n\nimport rasterio\nimport matplotlib.pyplot as plt\nimport matplotlib.image\nfrom rasterio.windows import Window\n\nimport netCDF4 as nc\n\nimport rioxarray\n\nfrom rasterio.control import GroundControlPoint\n```\n\n## ⏳ \"NetCDF\" 파일의 쿼리 및 처리\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n다음 단계는 쿼리를 제출하고 시작 날짜, 종료 날짜 및 AOI를 지정하는 것입니다. NDVI 지도는 토양 표면 온도 수준의 부수 데이터이므로, 여전히 레벨 변수로 \"LST\"를 사용할 수 있습니다. 미국의 다른 주에 대한 애니메이션을 만들고 싶다면, AOI 지점이나 폴리곤을 해당하도록 수정하세요. 또한, 시작 날짜와 종료 날짜로 2023년 5월 1일 및 8월 1일을 고려해보세요. 다음과 같은 줄로 이 작업을 수행할 수 있습니다:\n\n```js\nurl_dataspace = \"https://catalogue.dataspace.copernicus.eu/odata/v1\"\n\n# 필터링\nsatellite = \"SENTINEL-3\"\nlevel= \"LST\"\n\naoi_point =\"POINT(-121.669668 38.372428)\"\n#aoi_polygon = \"POLYGON ((-121.0616 37.6391, -120.966 37.6391, -120.966 37.6987, -121.0616 37.6987, -121.0616 37.6391))\"\n\nstart_date = \"2023-05-01\"\nend_date = \"2023-08-01\"\nstart_date_full =start_date+\"T00:00:00.000Z\"\nend_date_full = end_date +\"T00:00:00.000Z\"\n```\n\n이 정보를 통해 쿼리를 제출할 준비가 되었습니다. 데이터베이스에서 사용 가능한 이미지 목록을 내보내야 하므로, 쿼리 끝에 \"&$top=1000&$expand=Attributes\"를 포함해야 합니다. 이는 데이터베이스에서 이미지 내보내기의 기본 수가 20이며, 2023년에 Sentinel-3가 촬영한 이미지 수가 20을 초과하기 때문에 필요합니다:\n\n```js\nquery = f\"{url_dataspace}/Products?$filter=Collection/Name eq '{satellite}' and Attributes/OData.CSC.StringAttribute/any(att:att/Name eq 'productType' and att/OData.CSC.StringAttribute/Value eq '{level}') and OData.CSC.Intersects(area=geography'SRID=4326;{aoi_point}') and ContentDate/Start gt {start_date_full} and ContentDate/Start lt {end_date_full}&$top=1000&$expand=Attributes\"\nresponse = requests.get(query).json()\nresult = pd.DataFrame.from_dict(response[\"value\"])\n\n# 'Online' 열이 True인 레코드 필터링\nresult = result[result['Online'] == True]\n\n# 처음 10개 결과 출력\nresult.head(10)\n\nresult.to_csv('result_LST.csv', index=False)\n```\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n다음 단계에서는 온라인에서 사용 가능한 이미지 목록을 필터링하여 정오쯤 촬영된 이미지에 특히 주목할 것입니다. 파일의 감지 시간은 UTM을 기준으로 하기 때문에 18:00:00은 태평양 표준시 (캘리포니아 시간) 기준으로 대략 12:00:00 오후에 해당합니다:\n\n```js\nfiltered_df = result[result[\"Name\"].str.split(\"_\").str[8].str.contains(\"T18\") & result[\"Name\"].str.split(\"_\").str[14].str.contains(\"PS2\") & result[\"Name\"].str.split(\"_\").str[16].str.contains(\"NT\")]\n\nfiltered_df = filtered_df.reset_index(drop=True)\n\nprint(filtered_df['Name'])\n```\n\n```js\nfiltered_df.to_csv('result_LST_Filtered.csv', index=False)\n```\n\n필터링된 데이터프레임을 기반으로, 2023년 5월 1일부터 8월 1일까지 캘리포니아 상공에서 촬영된 Sentinel-3의 53장의 이미지가 있습니다.\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n<img src=\"/TIL/assets/img/2024-07-14-ALongPythonScripttoMakeaShortVideoUsingGeospatialBigData_2.png\" />\n\n이미지가 흐릿할 수 있다는 점을 기억하세요. 센티넬-3 이미지를 구름 덮개로 걸러내는 것을 제어할 수 없기 때문입니다.\n\n다음 단계는 필터링된 목록의 제품 ID를 사용하여 NetCDF 파일을 다운로드하는 것을 포함합니다. 이 부분은 이미 다음 포스트의 섹션들(📥 \"NetCDF\" 파일 다운로드 및 🛠️ Geotiff로 변환)에서 설명된 자료의 중복을 피하기 위해 건너뛰었습니다:\n\n## 🗺️ 캘리포니아를 위한 이미지 클리핑과 NDVI 지도 플로팅\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n이 단계를 자세히 설명하기 전에 다음 패키지를 설치하고 로드해주세요:\n\n```js\npip install matplotlib-scalebar\n```\n\n```js\nimport os\nimport matplotlib.pyplot as plt\nfrom matplotlib import colors\nfrom mpl_toolkits.axes_grid1 import make_axes_locatable\nfrom mpl_toolkits.axes_grid1.inset_locator import inset_axes\nfrom matplotlib_scalebar.scalebar import ScaleBar\nfrom matplotlib.offsetbox import OffsetImage, AnnotationBbox\nfrom datetime import datetime\nimport rasterio.plot\n```\n\n이 단계에서는 Geotiff_reproj 폴더에 저장된 53개의 래스터 파일 각각을 읽어올 것입니다. 캘리포니아 쉐이프파일 투영과 래스터 파일 간의 일관성을 확인할 것입니다. 필요한 경우 쉐이프파일을 재투영할 것입니다. 그런 다음, 래스터 파일을 캘리포니아의 경계에 맞게 자릅니다. 해당 플롯을 플로팅하고 JPEG 폴더에 저장할 것입니다. 캘리포니아 쉐이프파일을 다운로드하려면 다음 URL을 방문하여 \"California State Boundry\"를 다운로드하고 Shapefile 폴더에 업로드해주세요:\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n[California Geographic Boundaries](https://data.ca.gov/dataset/ca-geographic-boundaries)\n\n![Image](/TIL/assets/img/2024-07-14-ALongPythonScripttoMakeaShortVideoUsingGeospatialBigData_3.png)\n\nThe following code also requires an image for the north arrow symbol. You can either download one from the internet or, like me, draw it in PowerPoint, save it, and upload it to your main folder.\n\n![Image](/TIL/assets/img/2024-07-14-ALongPythonScripttoMakeaShortVideoUsingGeospatialBigData_4.png)\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n맵에 이 아이콘이 표시되는 것은 완전히 선택 사항입니다. 맵에 북쪽 화살표를 표시하고 싶지 않다면 해당 섹션을 주석 처리할 수 있습니다:\n\n```js\n# 디렉토리 경로 설정\ndirectory = '/content/Geotiff_reproj_clipped/'\n\n\n# 디렉토리 내 모든 파일 목록 가져오기\nfiles = os.listdir(directory)\n\n# NDVI TIF 파일만 포함하는 목록 필터링\nndvi_files = [f for f in files if f.endswith('.tif')]\n\n\n# 색상 한계 설정\nvmin = 0\nvmax = 1\nndvi_norm = colors.Normalize(vmin, vmax)\nndvi_cmap = plt.cm.RdYlGn\nndvi_cmap.set_bad(color='white')\n\n# 각각의 NDVI 파일을 루프하여 플롯하기\nfor ndvi_file in ndvi_files:\n    print(ndvi_file)\n    date_str = ndvi_file.split('_')[0]\n    date_obj = datetime.strptime(date_str, \"%Y%m%d\")\n    formatted_date_str = date_obj.strftime(\"%Y/%-m/%-d\")\n\n    # NDVI 래스터 열기\n    with rasterio.open(f\"/content/Geotiff_reproj_clipped/{ndvi_file}\") as ndvi:\n      # shapefile 읽기\n      california_shapefile = gpd.read_file('/content/Shapefile/CA_State_TIGER2016.shp')\n\n      ndvi_data = ndvi.read(1).astype(float)\n      ndvi_data[ndvi_data<=-1]=np.nan\n      ndvi_crs = ndvi.crs\n      extent = rasterio.plot.plotting_extent(ndvi)\n\n      # shapefile을 래스터의 투영과 일치하도록 재투영\n      california_shapefile = california_shapefile.to_crs(ndvi_crs)\n\n\n    # 플롯 생성\n    fig, ax = plt.subplots(figsize=(10, 6))\n\n    \n    image= rasterio.plot.show(ndvi_data, ax=ax, extent=extent, alpha=1, cmap=ndvi_cmap,norm=ndvi_norm,)\n    im = image.get_images()[0]  # 컬러바에 대한 트릭 (rasterio.plot.show와 호환되지 않음)\n    fig.colorbar(im, ax=ax)\n   \n\n    ax.set_title(formatted_date_str, fontsize=16,fontweight='bold')\n    california_shapefile.boundary.plot(ax=ax, color='k', linewidth=1)\n\n    ax.set_xticklabels([])\n    ax.set_yticklabels([])\n\n    # 북쪽 화살표 추가\n    north_arrow_image = plt.imread('North_sign.png')\n    imagebox = OffsetImage(north_arrow_image, zoom=0.25)\n    ab = AnnotationBbox(imagebox, (0.8, 0.99), xycoords='axes fraction', box_alignment=(0, 1), frameon=False)\n    ax.add_artist(ab)\n\n    # 스케일 바 추가\n    scalebar = ScaleBar(1000, 'm', length_fraction=0.2, location='lower right', font_properties={'size':12})\n    ax.add_artist(scalebar)\n\n    # 맵 주변에 네모 상자 끄기\n    ax.axis('off')\n\n    # 플롯을 JPEG 파일로 저장\n    plt.savefig(os.path.join('/content/JPEG', ndvi_file.split('_')[0] + '.jpg'), dpi=300, bbox_inches='tight')\n\n    # 메모리 해제를 위해 플롯 닫기\n    plt.close(fig)\r\n```\n\n이 단계를 완료하면 \"JPEG\" 폴더에 센싱 날짜를 기준으로 저장된 53개의 NDVI 지도가 있게 될 것입니다:\n\n<img src=\"/TIL/assets/img/2024-07-14-ALongPythonScripttoMakeaShortVideoUsingGeospatialBigData_5.png\" />\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n## 🎥 NDVI 지도를 비디오로 내보내기\n\n3개월 동안 센티넬-3에 의해 촬영된 53개의 NDVI 지도(대략 매 2일마다 1장씩)를 사용하여, 2023년 캘리포니아 지역 전체의 NDVI 패턴과 변화를 보여주는 애니메이션을 만들 수 있습니다. 이 비디오를 생성하려면, 다음 스크립트를 실행하세요:\n\n```js\npip install pillow\n```\n\n```js\nfrom PIL import Image\nimport os\nimport glob\n\n# 'path/to/folder'를 여러분의 jpg 이미지가 저장된 폴더 경로로 교체하세요\nfolder_path = '/content/JPEG'\noutput_gif = os.path.join('/content/Animation', 'NDVI_animation.gif')\n\n# 폴더 내 모든 jpg 파일의 정렬된 목록을 가져옵니다\nfile_list = sorted(glob.glob(os.path.join(folder_path, '*.jpg')))\n\n# 이미지의 원하는 크기를 설정합니다\nwidth, height = 1000, 1000\n\n# 이미지를 읽어서 리스트에 저장합니다\nframes = []\nfor file in file_list:\n    frame = Image.open(file)\n\n    # 이미지 크기 조정\n    frame = frame.resize((width, height), Image.ANTIALIAS)\n\n    # 이미지에 흰색 배경 추가\n    background = Image.new('RGB', frame.size, (255, 255, 255))\n    background.paste(frame)\n    frame = background.convert('RGB')\n\n    # 이미지를 P 모드로 변환하고 전역 색상 테이블을 사용합니다\n    frame = frame.convert('P', palette=Image.ADAPTIVE, colors=256)\n    frames.append(frame)\n\n# 애니메이션 GIF로 프레임을 저장합니다\nif frames:\n    frames[0].save(\n        output_gif,\n        save_all=True,\n        append_images=frames[1:],\n        duration=500,  # 프레임 간 지속 시간(밀리초)을 설정합니다\n        loop=0,  # 루프 횟수를 설정합니다 (0은 무한을 의미합니다)\n        optimize=True,\n    )\nelse:\n    print(\"jpg 파일을 찾을 수 없습니다.\")\n```\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n작업이 완료되면 화면에서 만들어진 지퍼 영상을 다운로드하여 시청할 수 있어요!\n\n![이미지](https://miro.medium.com/v2/resize:fit:1000/1*B8CQ1b8hgqEPrGj33oxrzQ.gif)\n\n구름이 가려져 있기 때문에 지도 내 몇 군데는 흰색 영역으로 표시됩니다. 또한 특정 날짜에 캘리포니아의 모든 영역을 커버하지 않아 일부 이미지가 잘려 나와 있을 수 있습니다. 프레임이 너무 빨리 변경되는 것 같다면, 각 프레임 간의 지속 시간을 조절할 수 있어요. 긴 스크립트를 작성한 후에는 이 아름다운 짧은 애니메이션을 즐기시기 바랍니다.\n\n## 📝 결론\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n요약하자면, 상상력을 데이터 시각화와 코딩을 통해 현실화하는 것은 때로는 꽤 많은 시간을 소요할 수 있습니다. 이 이야기에서는 50초짜리 비디오를 만들기 위해 300줄 이상의 코드를 작성했습니다. 상당한 시간 투자에도 불구하고, 그 노력은 가치가 있다고 믿습니다. 지도의 순차적인 표현은 숨겨진 패턴과 동적 변화를 드러내며 더 많은 탐구를 유도할 수 있습니다. 예를 들어, 이 이야기에서는 6월 이전의 NDVI 변동성 관측과 6월 중순부터 7월까지 안정화된 모습이 우리에게 추가적인 질문을 던지며 더 많은 조사와 답을 발견하도록 동기부여합니다.\n\n## 📚 참고 자료\n\nhttps://documentation.dataspace.copernicus.eu/APIs/OData.html\n\n- 📱 더 많은 상호작용이 있는 콘텐츠를 위해 다른 플랫폼에서 저와 연결하세요! LinkedIn, ResearchGate, Github, 그리고 Twitter.\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n해당 링크를 통해 관련 게시물을 확인할 수 있습니다:","ogImage":{"url":"/TIL/assets/img/2024-07-14-ALongPythonScripttoMakeaShortVideoUsingGeospatialBigData_0.png"},"coverImage":"/TIL/assets/img/2024-07-14-ALongPythonScripttoMakeaShortVideoUsingGeospatialBigData_0.png","tag":["Tech"],"readingTime":15},"content":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n</head>\n<body>\n<p><img src=\"/TIL/assets/img/2024-07-14-ALongPythonScripttoMakeaShortVideoUsingGeospatialBigData_0.png\" alt=\"이미지\"></p>\n<h1>목차</h1>\n<ul>\n<li>🌟 소개</li>\n<li>🔍 설정: 설치 및 라이브러리 임포트</li>\n<li>⏳ \"NetCDF\" 파일의 쿼리 및 처리</li>\n<li>🗺️ 캘리포니아 지역 및 NDVI 지도 플로팅을 위한 이미지 클리핑</li>\n<li>🎥 NDVI 지도를 비디오로 내보내기</li>\n<li>📝 결론</li>\n<li>📚 참고 자료</li>\n</ul>\n<h2>🌟 소개</h2>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>원하는 곳에서 매일 또는 매주 촬영된 위성 이미지를 기반으로 동영상과 애니메이션을 만드는 것을 즐기며 대규모 지리 공간 데이터를 시각화하는 일에 깊은 열정을 갖고 있습니다. 그러나 이 많은 양의 이미지를 처리하는 것은 다운로드, 클리핑, 위성 이미지 표시 등의 단계를 거치기 때문에 시간이 많이 걸립니다. 이 과정에는 API, 코딩, 지리 데이터에 대한 심도 있는 이해, 데이터 시각화에 대한 뛰어난 기술이 필요합니다. 이 이야기는 '위에 언급된 모든' 기술의 조합에 관한 것입니다.</p>\n<p>다른 게시물에서 Sentinel-2 및 Sentinel-3 이미지의 시각화에 대해 작성하던 중, 이 중 하나의 위성이 특정 위치 위에서 촬영한 모든 이미지를 모아 애니메이션으로 제시하는 아이디어에 주목했습니다. 오늘은 이 비전을 실현하고 2023년 캘리포니아 위에서 캡처된 Sentinel-3의 NDVI 맵을 탐색해보는 날입니다!</p>\n<p>이 이야기에서는 이러한 NDVI 맵을 처리, 시각화하고 애니메이션을 만들기 위해 Google Colab에서 강력한 Python 스크립트를 작성할 것입니다. 여기서는 이미지 다운로드 부분을 다루지 않습니다. 이미 별도의 이야기에서 자세히 다루었기 때문에 해당 링크에서 확인할 수 있습니다:</p>\n<h2>🔍 설정: 설치 및 라이브러리 가져오기</h2>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>첫 번째 단계는 다음 폴더를 생성하는 것입니다: NetCDF, Geotiff, Geotiff_reproj, Geotiff_reproj_clipped, Shapefile, JPEG 및 Animation. 다음과 같이 수행할 수 있습니다:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> os\n\n# 폴더 이름 정의\nfolders = [<span class=\"hljs-string\">'NetCDF'</span>, <span class=\"hljs-string\">'Geotiff'</span>, <span class=\"hljs-string\">'Geotiff_reproj'</span>, <span class=\"hljs-string\">'Geotiff_reproj_clipped'</span>, <span class=\"hljs-string\">'Shapefile'</span>, <span class=\"hljs-string\">'JPEG'</span>, <span class=\"hljs-string\">'Animation'</span>]\n\n# 폴더 생성\n<span class=\"hljs-keyword\">for</span> folder <span class=\"hljs-keyword\">in</span> <span class=\"hljs-attr\">folders</span>:\n    <span class=\"hljs-keyword\">if</span> not os.<span class=\"hljs-property\">path</span>.<span class=\"hljs-title function_\">exists</span>(folder):\n        os.<span class=\"hljs-title function_\">makedirs</span>(folder)\n\n# 확인 메시지 출력\n<span class=\"hljs-title function_\">print</span>(<span class=\"hljs-string\">'폴더가 성공적으로 생성되었습니다!'</span>)\n</code></pre>\n<img src=\"/TIL/assets/img/2024-07-14-ALongPythonScripttoMakeaShortVideoUsingGeospatialBigData_1.png\">\n<p>NetCDF 폴더는 Sentinel-3 NDVI의 raw 데이터를 저장합니다. 추가로, Geotiff, Geotiff_reproj, Geotiff_reproj_clipped 폴더는 래스터 파일, 재투영된 래스터 파일 및 래스터 파일 클립을 GeoTIFF 형식으로 저장하기 위해 생성됩니다 (모두 NetCDF 파일에서 변환된 형식). Shapefile 폴더에는 캘리포니아 형태 파일(우리의 관심 영역(AOI)로 Sentinel-3 이미지 클리핑을 위해)이 포함되어 있습니다. JPEG 폴더는 NDVI 맵을 \".jpg\" 형식으로 저장하기 위해 생성되며, Animation 폴더는 최종 비디오를 저장하기 위해 특별히 생성되었습니다.</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>또한, Google Colab에 몇 가지 라이브러리를 설치하고 가져와야 합니다.</p>\n<pre><code class=\"hljs language-js\">pip install pandas rasterio netCDF4 rioxarray\n</code></pre>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> os\n<span class=\"hljs-keyword\">import</span> re\n<span class=\"hljs-keyword\">import</span> sys\n<span class=\"hljs-keyword\">import</span> random\n<span class=\"hljs-keyword\">from</span> pathlib <span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">Path</span>\n\n<span class=\"hljs-keyword\">import</span> requests\n<span class=\"hljs-keyword\">import</span> json\n<span class=\"hljs-keyword\">import</span> xml.<span class=\"hljs-property\">etree</span>.<span class=\"hljs-property\">ElementTree</span> <span class=\"hljs-keyword\">as</span> <span class=\"hljs-variable constant_\">ET</span>\n<span class=\"hljs-keyword\">import</span> certifi\n\n<span class=\"hljs-keyword\">import</span> pandas <span class=\"hljs-keyword\">as</span> pd\n<span class=\"hljs-keyword\">import</span> numpy <span class=\"hljs-keyword\">as</span> np\n\n<span class=\"hljs-keyword\">import</span> rasterio\n<span class=\"hljs-keyword\">import</span> matplotlib.<span class=\"hljs-property\">pyplot</span> <span class=\"hljs-keyword\">as</span> plt\n<span class=\"hljs-keyword\">import</span> matplotlib.<span class=\"hljs-property\">image</span>\n<span class=\"hljs-keyword\">from</span> rasterio.<span class=\"hljs-property\">windows</span> <span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">Window</span>\n\n<span class=\"hljs-keyword\">import</span> netCDF4 <span class=\"hljs-keyword\">as</span> nc\n\n<span class=\"hljs-keyword\">import</span> rioxarray\n\n<span class=\"hljs-keyword\">from</span> rasterio.<span class=\"hljs-property\">control</span> <span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">GroundControlPoint</span>\n</code></pre>\n<h2>⏳ \"NetCDF\" 파일의 쿼리 및 처리</h2>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>다음 단계는 쿼리를 제출하고 시작 날짜, 종료 날짜 및 AOI를 지정하는 것입니다. NDVI 지도는 토양 표면 온도 수준의 부수 데이터이므로, 여전히 레벨 변수로 \"LST\"를 사용할 수 있습니다. 미국의 다른 주에 대한 애니메이션을 만들고 싶다면, AOI 지점이나 폴리곤을 해당하도록 수정하세요. 또한, 시작 날짜와 종료 날짜로 2023년 5월 1일 및 8월 1일을 고려해보세요. 다음과 같은 줄로 이 작업을 수행할 수 있습니다:</p>\n<pre><code class=\"hljs language-js\">url_dataspace = <span class=\"hljs-string\">\"https://catalogue.dataspace.copernicus.eu/odata/v1\"</span>\n\n# 필터링\nsatellite = <span class=\"hljs-string\">\"SENTINEL-3\"</span>\nlevel= <span class=\"hljs-string\">\"LST\"</span>\n\naoi_point =<span class=\"hljs-string\">\"POINT(-121.669668 38.372428)\"</span>\n#aoi_polygon = <span class=\"hljs-string\">\"POLYGON ((-121.0616 37.6391, -120.966 37.6391, -120.966 37.6987, -121.0616 37.6987, -121.0616 37.6391))\"</span>\n\nstart_date = <span class=\"hljs-string\">\"2023-05-01\"</span>\nend_date = <span class=\"hljs-string\">\"2023-08-01\"</span>\nstart_date_full =start_date+<span class=\"hljs-string\">\"T00:00:00.000Z\"</span>\nend_date_full = end_date +<span class=\"hljs-string\">\"T00:00:00.000Z\"</span>\n</code></pre>\n<p>이 정보를 통해 쿼리를 제출할 준비가 되었습니다. 데이터베이스에서 사용 가능한 이미지 목록을 내보내야 하므로, 쿼리 끝에 \"&#x26;$top=1000&#x26;$expand=Attributes\"를 포함해야 합니다. 이는 데이터베이스에서 이미지 내보내기의 기본 수가 20이며, 2023년에 Sentinel-3가 촬영한 이미지 수가 20을 초과하기 때문에 필요합니다:</p>\n<pre><code class=\"hljs language-js\">query = f<span class=\"hljs-string\">\"{url_dataspace}/Products?$filter=Collection/Name eq '{satellite}' and Attributes/OData.CSC.StringAttribute/any(att:att/Name eq 'productType' and att/OData.CSC.StringAttribute/Value eq '{level}') and OData.CSC.Intersects(area=geography'SRID=4326;{aoi_point}') and ContentDate/Start gt {start_date_full} and ContentDate/Start lt {end_date_full}&#x26;$top=1000&#x26;$expand=Attributes\"</span>\nresponse = requests.<span class=\"hljs-title function_\">get</span>(query).<span class=\"hljs-title function_\">json</span>()\nresult = pd.<span class=\"hljs-property\">DataFrame</span>.<span class=\"hljs-title function_\">from_dict</span>(response[<span class=\"hljs-string\">\"value\"</span>])\n\n# <span class=\"hljs-string\">'Online'</span> 열이 <span class=\"hljs-title class_\">True</span>인 레코드 필터링\nresult = result[result[<span class=\"hljs-string\">'Online'</span>] == <span class=\"hljs-title class_\">True</span>]\n\n# 처음 <span class=\"hljs-number\">10</span>개 결과 출력\nresult.<span class=\"hljs-title function_\">head</span>(<span class=\"hljs-number\">10</span>)\n\nresult.<span class=\"hljs-title function_\">to_csv</span>(<span class=\"hljs-string\">'result_LST.csv'</span>, index=<span class=\"hljs-title class_\">False</span>)\n</code></pre>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>다음 단계에서는 온라인에서 사용 가능한 이미지 목록을 필터링하여 정오쯤 촬영된 이미지에 특히 주목할 것입니다. 파일의 감지 시간은 UTM을 기준으로 하기 때문에 18:00:00은 태평양 표준시 (캘리포니아 시간) 기준으로 대략 12:00:00 오후에 해당합니다:</p>\n<pre><code class=\"hljs language-js\">filtered_df = result[result[<span class=\"hljs-string\">\"Name\"</span>].<span class=\"hljs-property\">str</span>.<span class=\"hljs-title function_\">split</span>(<span class=\"hljs-string\">\"_\"</span>).<span class=\"hljs-property\">str</span>[<span class=\"hljs-number\">8</span>].<span class=\"hljs-property\">str</span>.<span class=\"hljs-title function_\">contains</span>(<span class=\"hljs-string\">\"T18\"</span>) &#x26; result[<span class=\"hljs-string\">\"Name\"</span>].<span class=\"hljs-property\">str</span>.<span class=\"hljs-title function_\">split</span>(<span class=\"hljs-string\">\"_\"</span>).<span class=\"hljs-property\">str</span>[<span class=\"hljs-number\">14</span>].<span class=\"hljs-property\">str</span>.<span class=\"hljs-title function_\">contains</span>(<span class=\"hljs-string\">\"PS2\"</span>) &#x26; result[<span class=\"hljs-string\">\"Name\"</span>].<span class=\"hljs-property\">str</span>.<span class=\"hljs-title function_\">split</span>(<span class=\"hljs-string\">\"_\"</span>).<span class=\"hljs-property\">str</span>[<span class=\"hljs-number\">16</span>].<span class=\"hljs-property\">str</span>.<span class=\"hljs-title function_\">contains</span>(<span class=\"hljs-string\">\"NT\"</span>)]\n\nfiltered_df = filtered_df.<span class=\"hljs-title function_\">reset_index</span>(drop=<span class=\"hljs-title class_\">True</span>)\n\n<span class=\"hljs-title function_\">print</span>(filtered_df[<span class=\"hljs-string\">'Name'</span>])\n</code></pre>\n<pre><code class=\"hljs language-js\">filtered_df.<span class=\"hljs-title function_\">to_csv</span>(<span class=\"hljs-string\">'result_LST_Filtered.csv'</span>, index=<span class=\"hljs-title class_\">False</span>)\n</code></pre>\n<p>필터링된 데이터프레임을 기반으로, 2023년 5월 1일부터 8월 1일까지 캘리포니아 상공에서 촬영된 Sentinel-3의 53장의 이미지가 있습니다.</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<img src=\"/TIL/assets/img/2024-07-14-ALongPythonScripttoMakeaShortVideoUsingGeospatialBigData_2.png\">\n<p>이미지가 흐릿할 수 있다는 점을 기억하세요. 센티넬-3 이미지를 구름 덮개로 걸러내는 것을 제어할 수 없기 때문입니다.</p>\n<p>다음 단계는 필터링된 목록의 제품 ID를 사용하여 NetCDF 파일을 다운로드하는 것을 포함합니다. 이 부분은 이미 다음 포스트의 섹션들(📥 \"NetCDF\" 파일 다운로드 및 🛠️ Geotiff로 변환)에서 설명된 자료의 중복을 피하기 위해 건너뛰었습니다:</p>\n<h2>🗺️ 캘리포니아를 위한 이미지 클리핑과 NDVI 지도 플로팅</h2>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>이 단계를 자세히 설명하기 전에 다음 패키지를 설치하고 로드해주세요:</p>\n<pre><code class=\"hljs language-js\">pip install matplotlib-scalebar\n</code></pre>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> os\n<span class=\"hljs-keyword\">import</span> matplotlib.<span class=\"hljs-property\">pyplot</span> <span class=\"hljs-keyword\">as</span> plt\n<span class=\"hljs-keyword\">from</span> matplotlib <span class=\"hljs-keyword\">import</span> colors\n<span class=\"hljs-keyword\">from</span> mpl_toolkits.<span class=\"hljs-property\">axes_grid1</span> <span class=\"hljs-keyword\">import</span> make_axes_locatable\n<span class=\"hljs-keyword\">from</span> mpl_toolkits.<span class=\"hljs-property\">axes_grid1</span>.<span class=\"hljs-property\">inset_locator</span> <span class=\"hljs-keyword\">import</span> inset_axes\n<span class=\"hljs-keyword\">from</span> matplotlib_scalebar.<span class=\"hljs-property\">scalebar</span> <span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">ScaleBar</span>\n<span class=\"hljs-keyword\">from</span> matplotlib.<span class=\"hljs-property\">offsetbox</span> <span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">OffsetImage</span>, <span class=\"hljs-title class_\">AnnotationBbox</span>\n<span class=\"hljs-keyword\">from</span> datetime <span class=\"hljs-keyword\">import</span> datetime\n<span class=\"hljs-keyword\">import</span> rasterio.<span class=\"hljs-property\">plot</span>\n</code></pre>\n<p>이 단계에서는 Geotiff_reproj 폴더에 저장된 53개의 래스터 파일 각각을 읽어올 것입니다. 캘리포니아 쉐이프파일 투영과 래스터 파일 간의 일관성을 확인할 것입니다. 필요한 경우 쉐이프파일을 재투영할 것입니다. 그런 다음, 래스터 파일을 캘리포니아의 경계에 맞게 자릅니다. 해당 플롯을 플로팅하고 JPEG 폴더에 저장할 것입니다. 캘리포니아 쉐이프파일을 다운로드하려면 다음 URL을 방문하여 \"California State Boundry\"를 다운로드하고 Shapefile 폴더에 업로드해주세요:</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p><a href=\"https://data.ca.gov/dataset/ca-geographic-boundaries\" rel=\"nofollow\" target=\"_blank\">California Geographic Boundaries</a></p>\n<p><img src=\"/TIL/assets/img/2024-07-14-ALongPythonScripttoMakeaShortVideoUsingGeospatialBigData_3.png\" alt=\"Image\"></p>\n<p>The following code also requires an image for the north arrow symbol. You can either download one from the internet or, like me, draw it in PowerPoint, save it, and upload it to your main folder.</p>\n<p><img src=\"/TIL/assets/img/2024-07-14-ALongPythonScripttoMakeaShortVideoUsingGeospatialBigData_4.png\" alt=\"Image\"></p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>맵에 이 아이콘이 표시되는 것은 완전히 선택 사항입니다. 맵에 북쪽 화살표를 표시하고 싶지 않다면 해당 섹션을 주석 처리할 수 있습니다:</p>\n<pre><code class=\"hljs language-js\"># 디렉토리 경로 설정\ndirectory = <span class=\"hljs-string\">'/content/Geotiff_reproj_clipped/'</span>\n\n\n# 디렉토리 내 모든 파일 목록 가져오기\nfiles = os.<span class=\"hljs-title function_\">listdir</span>(directory)\n\n# <span class=\"hljs-variable constant_\">NDVI</span> <span class=\"hljs-variable constant_\">TIF</span> 파일만 포함하는 목록 필터링\nndvi_files = [f <span class=\"hljs-keyword\">for</span> f <span class=\"hljs-keyword\">in</span> files <span class=\"hljs-keyword\">if</span> f.<span class=\"hljs-title function_\">endswith</span>(<span class=\"hljs-string\">'.tif'</span>)]\n\n\n# 색상 한계 설정\nvmin = <span class=\"hljs-number\">0</span>\nvmax = <span class=\"hljs-number\">1</span>\nndvi_norm = colors.<span class=\"hljs-title class_\">Normalize</span>(vmin, vmax)\nndvi_cmap = plt.<span class=\"hljs-property\">cm</span>.<span class=\"hljs-property\">RdYlGn</span>\nndvi_cmap.<span class=\"hljs-title function_\">set_bad</span>(color=<span class=\"hljs-string\">'white'</span>)\n\n# 각각의 <span class=\"hljs-variable constant_\">NDVI</span> 파일을 루프하여 플롯하기\n<span class=\"hljs-keyword\">for</span> ndvi_file <span class=\"hljs-keyword\">in</span> <span class=\"hljs-attr\">ndvi_files</span>:\n    <span class=\"hljs-title function_\">print</span>(ndvi_file)\n    date_str = ndvi_file.<span class=\"hljs-title function_\">split</span>(<span class=\"hljs-string\">'_'</span>)[<span class=\"hljs-number\">0</span>]\n    date_obj = datetime.<span class=\"hljs-title function_\">strptime</span>(date_str, <span class=\"hljs-string\">\"%Y%m%d\"</span>)\n    formatted_date_str = date_obj.<span class=\"hljs-title function_\">strftime</span>(<span class=\"hljs-string\">\"%Y/%-m/%-d\"</span>)\n\n    # <span class=\"hljs-variable constant_\">NDVI</span> 래스터 열기\n    <span class=\"hljs-keyword\">with</span> rasterio.<span class=\"hljs-title function_\">open</span>(f<span class=\"hljs-string\">\"/content/Geotiff_reproj_clipped/{ndvi_file}\"</span>) <span class=\"hljs-keyword\">as</span> <span class=\"hljs-attr\">ndvi</span>:\n      # shapefile 읽기\n      california_shapefile = gpd.<span class=\"hljs-title function_\">read_file</span>(<span class=\"hljs-string\">'/content/Shapefile/CA_State_TIGER2016.shp'</span>)\n\n      ndvi_data = ndvi.<span class=\"hljs-title function_\">read</span>(<span class=\"hljs-number\">1</span>).<span class=\"hljs-title function_\">astype</span>(float)\n      ndvi_data[ndvi_data&#x3C;=-<span class=\"hljs-number\">1</span>]=np.<span class=\"hljs-property\">nan</span>\n      ndvi_crs = ndvi.<span class=\"hljs-property\">crs</span>\n      extent = rasterio.<span class=\"hljs-property\">plot</span>.<span class=\"hljs-title function_\">plotting_extent</span>(ndvi)\n\n      # shapefile을 래스터의 투영과 일치하도록 재투영\n      california_shapefile = california_shapefile.<span class=\"hljs-title function_\">to_crs</span>(ndvi_crs)\n\n\n    # 플롯 생성\n    fig, ax = plt.<span class=\"hljs-title function_\">subplots</span>(figsize=(<span class=\"hljs-number\">10</span>, <span class=\"hljs-number\">6</span>))\n\n    \n    image= rasterio.<span class=\"hljs-property\">plot</span>.<span class=\"hljs-title function_\">show</span>(ndvi_data, ax=ax, extent=extent, alpha=<span class=\"hljs-number\">1</span>, cmap=ndvi_cmap,norm=ndvi_norm,)\n    im = image.<span class=\"hljs-title function_\">get_images</span>()[<span class=\"hljs-number\">0</span>]  # 컬러바에 대한 트릭 (rasterio.<span class=\"hljs-property\">plot</span>.<span class=\"hljs-property\">show</span>와 호환되지 않음)\n    fig.<span class=\"hljs-title function_\">colorbar</span>(im, ax=ax)\n   \n\n    ax.<span class=\"hljs-title function_\">set_title</span>(formatted_date_str, fontsize=<span class=\"hljs-number\">16</span>,fontweight=<span class=\"hljs-string\">'bold'</span>)\n    california_shapefile.<span class=\"hljs-property\">boundary</span>.<span class=\"hljs-title function_\">plot</span>(ax=ax, color=<span class=\"hljs-string\">'k'</span>, linewidth=<span class=\"hljs-number\">1</span>)\n\n    ax.<span class=\"hljs-title function_\">set_xticklabels</span>([])\n    ax.<span class=\"hljs-title function_\">set_yticklabels</span>([])\n\n    # 북쪽 화살표 추가\n    north_arrow_image = plt.<span class=\"hljs-title function_\">imread</span>(<span class=\"hljs-string\">'North_sign.png'</span>)\n    imagebox = <span class=\"hljs-title class_\">OffsetImage</span>(north_arrow_image, zoom=<span class=\"hljs-number\">0.25</span>)\n    ab = <span class=\"hljs-title class_\">AnnotationBbox</span>(imagebox, (<span class=\"hljs-number\">0.8</span>, <span class=\"hljs-number\">0.99</span>), xycoords=<span class=\"hljs-string\">'axes fraction'</span>, box_alignment=(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>), frameon=<span class=\"hljs-title class_\">False</span>)\n    ax.<span class=\"hljs-title function_\">add_artist</span>(ab)\n\n    # 스케일 바 추가\n    scalebar = <span class=\"hljs-title class_\">ScaleBar</span>(<span class=\"hljs-number\">1000</span>, <span class=\"hljs-string\">'m'</span>, length_fraction=<span class=\"hljs-number\">0.2</span>, location=<span class=\"hljs-string\">'lower right'</span>, font_properties={<span class=\"hljs-string\">'size'</span>:<span class=\"hljs-number\">12</span>})\n    ax.<span class=\"hljs-title function_\">add_artist</span>(scalebar)\n\n    # 맵 주변에 네모 상자 끄기\n    ax.<span class=\"hljs-title function_\">axis</span>(<span class=\"hljs-string\">'off'</span>)\n\n    # 플롯을 <span class=\"hljs-variable constant_\">JPEG</span> 파일로 저장\n    plt.<span class=\"hljs-title function_\">savefig</span>(os.<span class=\"hljs-property\">path</span>.<span class=\"hljs-title function_\">join</span>(<span class=\"hljs-string\">'/content/JPEG'</span>, ndvi_file.<span class=\"hljs-title function_\">split</span>(<span class=\"hljs-string\">'_'</span>)[<span class=\"hljs-number\">0</span>] + <span class=\"hljs-string\">'.jpg'</span>), dpi=<span class=\"hljs-number\">300</span>, bbox_inches=<span class=\"hljs-string\">'tight'</span>)\n\n    # 메모리 해제를 위해 플롯 닫기\n    plt.<span class=\"hljs-title function_\">close</span>(fig)\n</code></pre>\n<p>이 단계를 완료하면 \"JPEG\" 폴더에 센싱 날짜를 기준으로 저장된 53개의 NDVI 지도가 있게 될 것입니다:</p>\n<img src=\"/TIL/assets/img/2024-07-14-ALongPythonScripttoMakeaShortVideoUsingGeospatialBigData_5.png\">\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<h2>🎥 NDVI 지도를 비디오로 내보내기</h2>\n<p>3개월 동안 센티넬-3에 의해 촬영된 53개의 NDVI 지도(대략 매 2일마다 1장씩)를 사용하여, 2023년 캘리포니아 지역 전체의 NDVI 패턴과 변화를 보여주는 애니메이션을 만들 수 있습니다. 이 비디오를 생성하려면, 다음 스크립트를 실행하세요:</p>\n<pre><code class=\"hljs language-js\">pip install pillow\n</code></pre>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">from</span> <span class=\"hljs-variable constant_\">PIL</span> <span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">Image</span>\n<span class=\"hljs-keyword\">import</span> os\n<span class=\"hljs-keyword\">import</span> glob\n\n# <span class=\"hljs-string\">'path/to/folder'</span>를 여러분의 jpg 이미지가 저장된 폴더 경로로 교체하세요\nfolder_path = <span class=\"hljs-string\">'/content/JPEG'</span>\noutput_gif = os.<span class=\"hljs-property\">path</span>.<span class=\"hljs-title function_\">join</span>(<span class=\"hljs-string\">'/content/Animation'</span>, <span class=\"hljs-string\">'NDVI_animation.gif'</span>)\n\n# 폴더 내 모든 jpg 파일의 정렬된 목록을 가져옵니다\nfile_list = <span class=\"hljs-title function_\">sorted</span>(glob.<span class=\"hljs-title function_\">glob</span>(os.<span class=\"hljs-property\">path</span>.<span class=\"hljs-title function_\">join</span>(folder_path, <span class=\"hljs-string\">'*.jpg'</span>)))\n\n# 이미지의 원하는 크기를 설정합니다\nwidth, height = <span class=\"hljs-number\">1000</span>, <span class=\"hljs-number\">1000</span>\n\n# 이미지를 읽어서 리스트에 저장합니다\nframes = []\n<span class=\"hljs-keyword\">for</span> file <span class=\"hljs-keyword\">in</span> <span class=\"hljs-attr\">file_list</span>:\n    frame = <span class=\"hljs-title class_\">Image</span>.<span class=\"hljs-title function_\">open</span>(file)\n\n    # 이미지 크기 조정\n    frame = frame.<span class=\"hljs-title function_\">resize</span>((width, height), <span class=\"hljs-title class_\">Image</span>.<span class=\"hljs-property\">ANTIALIAS</span>)\n\n    # 이미지에 흰색 배경 추가\n    background = <span class=\"hljs-title class_\">Image</span>.<span class=\"hljs-title function_\">new</span>(<span class=\"hljs-string\">'RGB'</span>, frame.<span class=\"hljs-property\">size</span>, (<span class=\"hljs-number\">255</span>, <span class=\"hljs-number\">255</span>, <span class=\"hljs-number\">255</span>))\n    background.<span class=\"hljs-title function_\">paste</span>(frame)\n    frame = background.<span class=\"hljs-title function_\">convert</span>(<span class=\"hljs-string\">'RGB'</span>)\n\n    # 이미지를 P 모드로 변환하고 전역 색상 테이블을 사용합니다\n    frame = frame.<span class=\"hljs-title function_\">convert</span>(<span class=\"hljs-string\">'P'</span>, palette=<span class=\"hljs-title class_\">Image</span>.<span class=\"hljs-property\">ADAPTIVE</span>, colors=<span class=\"hljs-number\">256</span>)\n    frames.<span class=\"hljs-title function_\">append</span>(frame)\n\n# 애니메이션 <span class=\"hljs-variable constant_\">GIF</span>로 프레임을 저장합니다\n<span class=\"hljs-keyword\">if</span> <span class=\"hljs-attr\">frames</span>:\n    frames[<span class=\"hljs-number\">0</span>].<span class=\"hljs-title function_\">save</span>(\n        output_gif,\n        save_all=<span class=\"hljs-title class_\">True</span>,\n        append_images=frames[<span class=\"hljs-number\">1</span>:],\n        duration=<span class=\"hljs-number\">500</span>,  # 프레임 간 지속 시간(밀리초)을 설정합니다\n        loop=<span class=\"hljs-number\">0</span>,  # 루프 횟수를 설정합니다 (<span class=\"hljs-number\">0</span>은 무한을 의미합니다)\n        optimize=<span class=\"hljs-title class_\">True</span>,\n    )\n<span class=\"hljs-attr\">else</span>:\n    <span class=\"hljs-title function_\">print</span>(<span class=\"hljs-string\">\"jpg 파일을 찾을 수 없습니다.\"</span>)\n</code></pre>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>작업이 완료되면 화면에서 만들어진 지퍼 영상을 다운로드하여 시청할 수 있어요!</p>\n<p><img src=\"https://miro.medium.com/v2/resize:fit:1000/1*B8CQ1b8hgqEPrGj33oxrzQ.gif\" alt=\"이미지\"></p>\n<p>구름이 가려져 있기 때문에 지도 내 몇 군데는 흰색 영역으로 표시됩니다. 또한 특정 날짜에 캘리포니아의 모든 영역을 커버하지 않아 일부 이미지가 잘려 나와 있을 수 있습니다. 프레임이 너무 빨리 변경되는 것 같다면, 각 프레임 간의 지속 시간을 조절할 수 있어요. 긴 스크립트를 작성한 후에는 이 아름다운 짧은 애니메이션을 즐기시기 바랍니다.</p>\n<h2>📝 결론</h2>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>요약하자면, 상상력을 데이터 시각화와 코딩을 통해 현실화하는 것은 때로는 꽤 많은 시간을 소요할 수 있습니다. 이 이야기에서는 50초짜리 비디오를 만들기 위해 300줄 이상의 코드를 작성했습니다. 상당한 시간 투자에도 불구하고, 그 노력은 가치가 있다고 믿습니다. 지도의 순차적인 표현은 숨겨진 패턴과 동적 변화를 드러내며 더 많은 탐구를 유도할 수 있습니다. 예를 들어, 이 이야기에서는 6월 이전의 NDVI 변동성 관측과 6월 중순부터 7월까지 안정화된 모습이 우리에게 추가적인 질문을 던지며 더 많은 조사와 답을 발견하도록 동기부여합니다.</p>\n<h2>📚 참고 자료</h2>\n<p><a href=\"https://documentation.dataspace.copernicus.eu/APIs/OData.html\" rel=\"nofollow\" target=\"_blank\">https://documentation.dataspace.copernicus.eu/APIs/OData.html</a></p>\n<ul>\n<li>📱 더 많은 상호작용이 있는 콘텐츠를 위해 다른 플랫폼에서 저와 연결하세요! LinkedIn, ResearchGate, Github, 그리고 Twitter.</li>\n</ul>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>해당 링크를 통해 관련 게시물을 확인할 수 있습니다:</p>\n</body>\n</html>\n"},"__N_SSG":true}