{"pageProps":{"post":{"title":"ê³µê°„ ë³´ê°„ì„ ìœ„í•œ 3ê°€ì§€ ì¸ê¸° ìˆëŠ” ë°©ë²•","description":"","date":"2024-07-09 19:17","slug":"2024-07-09-3PopularMethodsforSpatialInterpolation","content":"\n## ì²˜ìŒë¶€í„°, Pythonì—ì„œ\n\n<img src=\"/TIL/assets/img/2024-07-09-3PopularMethodsforSpatialInterpolation_0.png\" />\n\në³´ê°„ë²•ì€ ë°ì´í„° ê³¼í•™ì ë¿ë§Œ ì•„ë‹ˆë¼ ë‹¤ì–‘í•œ ë¶„ì•¼ì˜ ì‚¬ëŒë“¤ì— ì˜í•´ ì‚¬ìš©ë˜ëŠ” ë§¤ìš° ì¼ë°˜ì ì¸ ìˆ˜í•™ì  ê°œë…ì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì§€ë¦¬ ê³µê°„ ë°ì´í„°ë¥¼ ë‹¤ë£° ë•Œ, ë³´ê°„ì€ ì¢…ì¢… í¬ì†Œí•œ ê´€ì¸¡ì¹˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ëŒ€í‘œì ì¸ ê·¸ë¦¬ë“œë¥¼ ë§Œë“¤ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ë” ë³µì¡í•´ì§‘ë‹ˆë‹¤.\n\nì§€ë¦¬ ê³µê°„ ë¶€ë¶„ì— ë“¤ì–´ê°€ê¸° ì „ì—, ì„ í˜• ë³´ê°„ì— ëŒ€í•´ ê°„ë‹¨íˆ ë˜ì§šì–´ ë´…ì‹œë‹¤.\n\n<!-- TIL ìˆ˜í‰ -->\n\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\në””ìì¸ì„ ë³´ì—¬ë“œë¦¬ê¸° ìœ„í•´ ì¼ë°˜ ë‹¤í•­ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•  ê²ƒì…ë‹ˆë‹¤:\n\n```js\ndef F(x):\n  return -2*x**3+x**2+2.1\n\nx = np.arange(-5,5, 0.1)\ny = F(x)\n```\n\n<img src=\"/TIL/assets/img/2024-07-09-3PopularMethodsforSpatialInterpolation_1.png\" />\n\nì´ì œ [-4.2, 0, 2.5]ì—ì„œ ëª‡ ê°œì˜ ì ì„ ë¬´ì‘ìœ„ë¡œ ìƒ˜í”Œë§í•˜ê³  ì´ë¥¼ ì—°ê²°í•´ ë³´ê² ìŠµë‹ˆë‹¤:\n\n<!-- TIL ìˆ˜í‰ -->\n\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n![ì´ë¯¸ì§€](/TIL/assets/img/2024-07-09-3PopularMethodsforSpatialInterpolation_2.png)\n\nì´ê²ƒì€ ì„ í˜• ë³´ê°„ë²•ì´ë¼ê³  ë¶ˆë¦½ë‹ˆë‹¤. ê° êµ¬ê°„ì—ì„œ ì§ì„ ìœ¼ë¡œ í•¨ìˆ˜ë¥¼ ê·¼ì‚¬í•˜ê³  ìˆìœ¼ë©°, ì´ì œ 3ê°œì˜ ì ì—ì„œ í•¨ìˆ˜ì˜ ê°’ì„ ì•Œê³  ìˆì„ ë•Œ [-4.2;2.5] êµ¬ê°„ ë‚´ì˜ ê°’ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\në†’ì€ ì •í™•ë„ë¥¼ ê°€ì§„ ë§ì€ ë‹¤ë¥¸ ë°©ë²•ë“¤ì´ ìˆì§€ë§Œ, ê·¸ ë’¤ì— ìˆëŠ” ì•„ì´ë””ì–´ëŠ” ë™ì¼í•©ë‹ˆë‹¤: ì ì–´ë„ ë‘ ê°œì˜ ì•Œë ¤ì§„ ì  ì‚¬ì´ì—ì„œ í•¨ìˆ˜ ê°’ì„ ì°¾ëŠ” ê²ƒì…ë‹ˆë‹¤.\n\nì´ì œ ì§€ë¦¬ ê³µê°„ ë¶€ë¶„ìœ¼ë¡œ ë„˜ì–´ê°ˆ ì‹œê°„ì…ë‹ˆë‹¤. ì´ ììŠµì„œì—ì„œëŠ” NOAAì—ì„œ ì œê³µí•œ ìŠ¤ìœ„ìŠ¤ ì „ì—­ì˜ ê¸°ìƒ ì¸¡ì •ì†Œì—ì„œ ì¸¡ì •ëœ ì¼ì¼ í‰ê·  ëŒ€ê¸° ì˜¨ë„ì˜ ê³µê°„ ë³´ê°„ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì´ ëª©í‘œì…ë‹ˆë‹¤. ê¸°ëŒ€ë˜ëŠ” ê²°ê³¼ëŠ” 0.1Â° í•´ìƒë„ì˜ ì˜¨ë„ ê·¸ë¦¬ë“œì…ë‹ˆë‹¤.\n\n<!-- TIL ìˆ˜í‰ -->\n\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\në¨¼ì €, ìŠ¤ìœ„ìŠ¤ì˜ í–‰ì • ê²½ê³„ë¥¼ ì–»ì–´ì™€ì„œ geopandasë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹œê°í™”í•´ì•¼ í•©ë‹ˆë‹¤:\n\n```python\nimport geopandas as gpd\n\nshape = gpd.read_file('gadm41_CHE_0.shp')\nshape.plot()\n```\n\n<img src=\"/TIL/assets/img/2024-07-09-3PopularMethodsforSpatialInterpolation_3.png\" />\n\nì •ë§ ëŒ€ë‹¨í•´ìš”! ìŠ¤ìœ„ìŠ¤ì¸ ê²ƒ ê°™ë„¤ìš” =)\n\n<!-- TIL ìˆ˜í‰ -->\n\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nì´ì œ ì˜¨ë„ ê´€ì¸¡ì¹˜ë¥¼ ê·¸ë˜í”„ë¡œ í‘œì‹œí•˜ê³  êµ­ê°€ ëª¨ì–‘ê³¼ ê²¹ì³ë³´ê² ìŠµë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ ì •ê¸°ì ì¸ íŒë‹¤ ë°ì´í„°í”„ë ˆì„ìœ¼ë¡œ ê¸°ìƒ ë°ì´í„°ë¥¼ ë¡œë“œí•œ ë‹¤ìŒ ì…°ì´í”„ë¦¬ í¬ì¸íŠ¸ë¡œ ë³€í™˜í•œ ì§€ë¦¬ ë°ì´í„°í”„ë ˆì„ìœ¼ë¡œ ë³€í™˜í•˜ê² ìŠµë‹ˆë‹¤:\n\n```python\nimport pandas as pd\nfrom shapely.geometry import Point\n\ndf = pd.read_csv('3639866.csv')\n\npoints = list()\nfor i in range(len(df)):\n  point = Point(df.loc[i, 'LONGITUDE'], df.loc[i, 'LATITUDE'])\n  points.append(point)\n\ngdf = gpd.GeoDataFrame(geometry=points).set_crs(shape.crs)\n```\n\nê·¸ë ‡ê²Œ í•˜ë©´ matplotlibì„ ì‚¬ìš©í•˜ì—¬ ë‘ ë°ì´í„°í”„ë ˆì„ì„ ì‰½ê²Œ ê²¹ì³ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n```python\nfig, ax = plt.subplots(figsize=(16,9))\nshape.plot(ax=ax, color='black')\ngdf.plot(ax=ax, color='r', markersize=85)\nplt.show()\n```\n\n<!-- TIL ìˆ˜í‰ -->\n\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n![ê·¸ë¦¬ë“œ ë° ì§€ë„ ì˜¤ë²„ë ˆì´ë¥¼ ì‹œê°í™”í•˜ê¸° ìœ„í•´ ë‹¤ìŒì„ ìˆ˜í–‰í•˜ê² ìŠµë‹ˆë‹¤:](/TIL/assets/img/2024-07-09-3PopularMethodsforSpatialInterpolation_4.png)\n\n```js\nimport matplotlib.ticker as mticker\nimport cartopy.crs as ccrs\nfrom cartopy.mpl.gridliner import LONGITUDE_FORMATTER, LATITUDE_FORMATTER\n\nLAT, LON = np.arange(45.75, 48, 0.1), np.arange(6, 10.81, 0.1)\n\nfig, ax = plt.subplots(subplot_kw=dict(projection=ccrs.PlateCarree()), figsize=(16, 9))\nshape.plot(ax=ax, color='grey')\ngdf.plot(ax=ax, color='r', markersize=85)\n\ngl = ax.gridlines(draw_labels=True,linewidth=2, color='black', alpha=0.5, linestyle='--')\ngl.xlocator = mticker.FixedLocator(LON)\ngl.ylocator = mticker.FixedLocator(LAT)\ngl.xformatter = LONGITUDE_FORMATTER\ngl.yformatter = LATITUDE_FORMATTER\nplt.show()\n```\n\n![ê²°ê³¼ ì´ë¯¸ì§€](/TIL/assets/img/2024-07-09-3PopularMethodsforSpatialInterpolation_5.png)\n\n<!-- TIL ìˆ˜í‰ -->\n\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nìœ„ ê·¸ë¦¼ì— ë‚˜íƒ€ë‚œ ì •ê·œ ê·¸ë¦¬ë“œì— ëŒ€í•´ ë³´ê°„ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì´ ëª©í‘œì…ë‹ˆë‹¤. ì´ ê·¸ë¦¬ë“œì—ëŠ” 8ê°œì˜ ì˜¨ë„ ê´€ì¸¡ì¹˜ê°€ ìˆìŠµë‹ˆë‹¤.\n\n# I. ìµœê·¼ì ‘ ì´ì›ƒ (NN)\n\nê°€ì¥ ì§ê´€ì ì´ê³  ê°„ë‹¨í•œ ë°©ë²• ì¤‘ í•˜ë‚˜ì¸ Nearest Neighbor (NN)ì— ëŒ€í•´ ì´ì•¼ê¸°í•˜ê² ìŠµë‹ˆë‹¤. ì´ë¦„ì—ì„œ ì•Œ ìˆ˜ ìˆë“¯ì´, ì´ ì•Œê³ ë¦¬ì¦˜ì€ ê° ê·¸ë¦¬ë“œ ë…¸ë“œì— ê°€ì¥ ê°€ê¹Œìš´ ê´€ì¸¡ì¹˜ì˜ ê°’ì„ í• ë‹¹í•©ë‹ˆë‹¤.\n\nì´ë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•´ í•„ìš”í•œ í•¨ìˆ˜ëŠ” ë‘ ê°€ì§€ë¿ì…ë‹ˆë‹¤. ì²« ë²ˆì§¸ í•¨ìˆ˜ëŠ” ìœ í´ë¦¬ë“œ í•¨ìˆ˜ì´ë©°, ë‹¤ìŒ ê³µì‹ì„ ì‚¬ìš©í•˜ì—¬ ë‘ ì  ì‚¬ì´ì˜ ê±°ë¦¬ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤:\n\n<!-- TIL ìˆ˜í‰ -->\n\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n![Image](/TIL/assets/img/2024-07-09-3PopularMethodsforSpatialInterpolation_6.png)\n\në‘ ë²ˆì§¸ëŠ” NN ë©”ì†Œë“œ ìì²´ì…ë‹ˆë‹¤. ê´€ì¸¡ê°’ì„ ì €ì¥í•  ë¹ˆ ë°°ì—´ì„ ë§Œë“  í›„, ëª¨ë“  ìœ„ë„ì™€ ê²½ë„ë¥¼ ë°˜ë³µí•˜ë©´ì„œ ê° í¬ì¸íŠ¸ì—ì„œ í˜„ì¬ ê·¸ë¦¬ë“œ ë…¸ë“œê¹Œì§€ì˜ ê±°ë¦¬ë¥¼ ê³„ì‚°í•˜ê³  ê·¸ ê·¸ë¦¬ë“œ ë…¸ë“œì— ê°€ì¥ ê°€ê¹Œìš´ ê´€ì¸¡ê°’ì„ í• ë‹¹í•©ë‹ˆë‹¤.\n\n```js\ndef ìœ í´ë¦¬ë“œ(x1, x2, y1, y2):\n  return ((x1-x2)**2 + (y1-y2)**2) ** 0.5\n\ndef NN(data, LAT, LON):\n  array = np.empty((LAT.shape[0], LON.shape[0]))\n\n  for i, lat in enumerate(LAT):\n    for j, lon in enumerate(LON):\n      idx = data.apply(lambda row: ìœ í´ë¦¬ë“œ(row.LONGITUDE, lon, row.LATITUDE, lat), axis=1).argmin()\n      array[i, j] = data.loc[idx, 'TAVG']\n  return array\n```\n\nì „ì²´ ì•„ì´ë””ì–´ëŠ” ì´ í•œ ì¤„ì— ìˆìŠµë‹ˆë‹¤.\n\n<!-- TIL ìˆ˜í‰ -->\n\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```python\nidx = data.apply(lambda row: Euclidean(row.LONGITUDE, lon, row.LATITUDE, lat), axis=1).argmin()\n```\n\në³€ìˆ˜ dataëŠ” ê° í–‰ì´ í•˜ë‚˜ì˜ ê¸°ìƒ ì¥ë¹„ ì‚¬ì´íŠ¸ë¥¼ ë‚˜íƒ€ë‚´ëŠ” íŒë‹¤ ë°ì´í„°í”„ë ˆì„ì…ë‹ˆë‹¤. ë”°ë¼ì„œ for ë£¨í”„ì—ì„œ ê±°ë¦¬ë¥¼ ê³„ì‚°í•˜ê³  ìµœì†Œ ê±°ë¦¬ë¥¼ ê°€ì§„ ì‚¬ì´íŠ¸ì˜ ì¸ë±ìŠ¤ë¥¼ ì°¾ìŠµë‹ˆë‹¤.\n\nì´ì œ ì•Œê³ ë¦¬ì¦˜ì„ ì‹¤í–‰í•˜ê³  ê²°ê³¼ë¥¼ xarray ë°ì´í„°ì…‹ìœ¼ë¡œ ë˜í•‘í•´ ë´…ì‹œë‹¤:\n\n```python\nt2m = NN(df, LAT, LON)\nds = xr.Dataset(\n    {'TAVG': (['lat', 'lon'], t2m)},\n    coords={'lat': LAT, 'lon': LON})\n```\n\n<!-- TIL ìˆ˜í‰ -->\n\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nì´ì œ ê²°ê³¼ë¥¼ í”Œë¡œíŒ…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:\n\n![](/TIL/assets/img/2024-07-09-3PopularMethodsforSpatialInterpolation_7.png)\n\në³´ê¸° ì¢‹ì§€ë§Œ, regionmask ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ìŠ¤ìœ„ìŠ¤ ë§¤ìŠ¤í¬ë¥¼ ë§Œë“¤ì–´ í”Œë¡¯ì„ ë” ë³´ê¸° ì¢‹ê²Œ ë³€ê²½í•´ ë³´ê² ìŠµë‹ˆë‹¤:\n\n```js\nshape['new_column'] = 0\nsw = shape.dissolve(by='new_column')['geometry']\nrg = regionmask.mask_3D_geopandas(sw, lon_or_obj=ds.lon, lat=ds.lat)\n\nfig, ax = plt.subplots(subplot_kw=dict(projection=ccrs.PlateCarree()), figsize=(16, 9))\n#shape.plot(ax=ax, color='black')\nds.where(rg).TAVG.plot(ax=ax, alpha=0.6)\ngdf.plot(ax=ax, color='r', markersize=85)\nax.gridlines(draw_labels=True, linewidth=2, color='black', alpha=0.5, linestyle='--')\nplt.show()\n```\n\n<!-- TIL ìˆ˜í‰ -->\n\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n<img src=\"/TIL/assets/img/2024-07-09-3PopularMethodsforSpatialInterpolation_8.png\" />\n\në³´ì‹œë‹¤ì‹œí”¼ ì´ ë°©ë²•ì€ ë²”ì£¼í˜• ë°ì´í„°ì—ë§Œ ì ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìš°ë¦¬ê°€ ë‹¤ë£¨ëŠ” ê²ƒì€ ì˜¨ë„ë¡œ, ì´ëŠ” ì—°ì† ë³€ìˆ˜ë¡œ ì–´ë–¤ ë²”ìœ„ ì•ˆì—ì„œ ì–´ë–¤ ê°’ì´ë“  ê°€ì§ˆ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì´ ë³´ê°„ì€ í˜¼ë™ìŠ¤ëŸ¬ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í˜„ì‹¤ì—ì„œëŠ” í•­ìƒ ê·¸ë¼ë°ì´ì…˜ê³¼ ë¬´ì‘ìœ„ì„±ì´ ìˆìŠµë‹ˆë‹¤.\n\nê·¸ë˜ì„œ ì¢€ ë” ê³ ê¸‰ ì•Œê³ ë¦¬ì¦˜ì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.\n\n# II. ì—­ ê±°ë¦¬ ê°€ì¤‘ ì´ë™ë²• (IDW)\n\n<!-- TIL ìˆ˜í‰ -->\n\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nê¸°ë³¸ì ìœ¼ë¡œ ì—­ ê±°ë¦¬ ê°€ì¤‘ì¹˜(IDW)ëŠ” NNì˜ í–¥ìƒëœ ë²„ì „ì…ë‹ˆë‹¤:\n\n```js\ndef IDW(data, LAT, LON, betta=2):\n  array = np.empty((LAT.shape[0], LON.shape[0]))\n\n  for i, lat in enumerate(LAT):\n    for j, lon in enumerate(LON):\n      weights = data.apply(lambda row: Euclidean(row.LONGITUDE, lon, row.LATITUDE, lat)**(-betta), axis=1)\n      z = sum(weights*data.TAVG)/weights.sum()\n      array[i,j] = z\n  return array\n```\n\nê°€ê¹Œìš´ ì•Œë ¤ì§„ ì ì˜ ê°’ì„ í• ë‹¹í•˜ëŠ” ëŒ€ì‹ , ì—¬ê¸°ì„œëŠ” ê°€ì¤‘ì¹˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤. ê·¸ë¥¼ ìœ„í•´ ì•ì„œ ì–¸ê¸‰í•œ ìœ í´ë¦¬ë“œ ê±°ë¦¬ê°€ ì‚¬ìš©ë˜ì§€ë§Œ, ì´ë²ˆì—ëŠ” ê° ê±°ë¦¬ë¥¼ -Î² ìŠ¹ìœ¼ë¡œ ì œê³±í•©ë‹ˆë‹¤ (Î²ëŠ” ì„ì˜ì˜ ê°’ì…ë‹ˆë‹¤). ì´ëŸ¬í•œ ê°€ì¤‘ì¹˜ëŠ” ê° ì§€ë©´ ì ì´ íŠ¹ì • ê²©ì ë…¸ë“œì— ë¯¸ì¹˜ëŠ” ê¸°ì—¬ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ê±°ë¦¬ê°€ ë©€ìˆ˜ë¡ ì´ ì ì´ ë…¸ë“œ ê°’ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì´ ì ì–´ì§‘ë‹ˆë‹¤.\n\nê°€ì¤‘ì¹˜ë¥¼ ì–»ì€ í›„ ê°€ì¤‘ í‰ê· ì„ ê³„ì‚°í•©ë‹ˆë‹¤.\n\n<!-- TIL ìˆ˜í‰ -->\n\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n![image](/TIL/assets/img/2024-07-09-3PopularMethodsforSpatialInterpolation_9.png)\n\n![image](/TIL/assets/img/2024-07-09-3PopularMethodsforSpatialInterpolation_10.png)\n\nLetâ€™s plot it:\n\n![image](/TIL/assets/img/2024-07-09-3PopularMethodsforSpatialInterpolation_11.png)\n\n<!-- TIL ìˆ˜í‰ -->\n\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\në³´ì‹œëŠ” ëŒ€ë¡œ, ì§€ê¸ˆ ê²°ê³¼ê°€ í›¨ì”¬ í˜„ì‹¤ì ì´ê³  ë¶€ë“œëŸ½ìŠµë‹ˆë‹¤!\n\n## III. í¬ë¦¬ì§•\n\nì˜¤ëŠ˜ì˜ ë§ˆì§€ë§‰ ë©”ì„œë“œëŠ” í¬ë¦¬ì§•ì…ë‹ˆë‹¤. ì´ ì„¸ ê°€ì§€ ë°©ë²• ì¤‘ì—ì„œ ê°€ì¥ ë³µì¡í•œ ë°©ë²• ì¤‘ í•˜ë‚˜ì´ë©°, ìš°ë¦¬ëŠ” ê°„ë‹¨íˆ ì•Œì•„ë³¼ ê²ƒì…ë‹ˆë‹¤. ì˜ì‹ì ì´ê³  íš¨ê³¼ì ìœ¼ë¡œ ì‚¬ìš©í•˜ê³  ì‹¶ë‹¤ë©´ ë¬¸í—Œì„ ì‚´í´ë³¼ ê²ƒì„ ê³ ë ¤í•´ë³´ì„¸ìš”!\n\nê·¸ëŸ¬ë¯€ë¡œ ì´ ë°©ë²•ì˜ ì£¼ìš” ì•„ì´ë””ì–´ëŠ” ë°”ë¦¬ì˜¤ê·¸ë¨(ë˜ëŠ” ì„¸ë¯¸ë°”ë¦¬ì˜¤ê·¸ë¨)ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ë³¸ì§ˆì ìœ¼ë¡œ ë°”ë¦¬ì˜¤ê·¸ë¨ì€ ì–´ë–¤ ë§¤ê°œë³€ìˆ˜ì˜ ë³€ì´ê°€ ê±°ë¦¬ì™€ ë°©í–¥ì— ë”°ë¼ ì–´ë–»ê²Œ ë³€í•˜ëŠ”ì§€ë¥¼ ì¸¡ì •í•©ë‹ˆë‹¤. ì´ê²ƒì´ ë°”ë¡œ ìš°ë¦¬ê°€ ê³µê¸° ì˜¨ë„ë¥¼ ë‹¤ë£° ë•Œ í•„ìš”í•œ ë¶€ë¶„ì…ë‹ˆë‹¤.\n\n<!-- TIL ìˆ˜í‰ -->\n\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\ní¬ë¦¬ì§• ì•Œê³ ë¦¬ì¦˜ì„ êµ¬í˜„í•˜ë ¤ë©´ ë‘ ê°€ì§€ ìœ í˜•ì˜ ë³€ì´ë¡œê·¸ë¨ì´ í•„ìš”í•©ë‹ˆë‹¤: ì‹¤í—˜ì  ë³€ì´ë¡œê·¸ë¨ê³¼ ì´ë¡ ì  ë³€ì´ë¡œê·¸ë¨ì…ë‹ˆë‹¤.\n\nì²« ë²ˆì§¸ëŠ” ì •ë§ ì‰½ê²Œ ê³„ì‚°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°ë§ˆ Î³ë¡œ ì •ì˜ë©ë‹ˆë‹¤:\n\n\\[ \\gamma(h) = \\frac{1}{2N(h)}\\sum\\_{i=1}^{N(h)}[z(x_i) - z(x_i + h)]^2 \\]\n\nì—¬ê¸°ì„œ,\n\n- \\( h \\)ëŠ” ë‘ ì  ì‚¬ì´ì˜ ì§€ë¦¬ì  ê±°ë¦¬,\n- \\(z\\)ëŠ” ì˜¨ë„ í•¨ìˆ˜ì…ë‹ˆë‹¤.\n\nê°„ë‹¨íˆ ë§í•´ ì´ê²ƒì€ ì•Œë ¤ì§„ ì ì—ì„œ ì˜¨ë„ ì°¨ì´ì˜ í‰ê· ì…ë‹ˆë‹¤.\n\n<!-- TIL ìˆ˜í‰ -->\n\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nì´ë¡ ì  ë³€ì´ê·¸ë¨ì€ ë‹¤ì†Œ ë³µì¡í•©ë‹ˆë‹¤. ë¨¼ì €, ê·¸ëŸ°ê²ƒì´ ë§ì´ ìˆìŠµë‹ˆë‹¤:\n\n![Variogram](/TIL/assets/img/2024-07-09-3PopularMethodsforSpatialInterpolation_13.png)\n\nì—¬ê¸°ì„œ pëŠ” ë¶€ë¶„ ì¬, dëŠ” ê±°ë¦¬(hë¥¼ ì‚¬ìš©í–ˆì—ˆì£ ), nì€ ê·¹ì†Œê°’, rì€ ë²”ìœ„ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.\n\nCDT ì½œë¡¬ë¹„ì•„ì—ì„œ ì´ëŸ¬í•œ ë§¤ê°œë³€ìˆ˜ì— ëŒ€í•œ ì •ë§ ì¢‹ì€ ì‹œê°ì  ì„¤ëª…ì„ ì°¾ì•˜ì–´ìš”. ì €ëŠ” ê·¸ë“¤ì˜ ìë£Œì—ì„œ Î³ì™€ ê±°ë¦¬ ì‚¬ì´ì˜ ê´€ê³„ë¥¼ ì„¤ëª…í•˜ëŠ” ì´ë¯¸ì§€ë¥¼ ì±„íƒí–ˆìŠµë‹ˆë‹¤. ì´ì œëŠ” sill, partial sill, nugget ë° rangeê°€ ë¬´ì—‡ì¸ì§€ ëª…í™•í•´ ë³´ì…ë‹ˆë‹¤.\n\n<!-- TIL ìˆ˜í‰ -->\n\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n![Spatial Interpolation Method](/TIL/assets/img/2024-07-09-3PopularMethodsforSpatialInterpolation_14.png)\n\nì•Œê³ ë¦¬ì¦˜ì˜ ì „ì²´ ì•„ì´ë””ì–´ëŠ” ì´ë¡ ì  ë³€ì´ê·¸ë¨ì˜ ë§¤ê°œë³€ìˆ˜ë¥¼ ì¡°ì •í•˜ì—¬ ì‹¤í—˜ì ì¸ ê²ƒì— ë§ê²Œ ë§ì¶”ê³ , ê·¸ê²ƒì„ ì‚¬ìš©í•˜ì—¬ ë…¸ë“œì˜ ê°’ì„ ì˜ˆì¸¡í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.\n\nì´ ë°©ë²•ì„ êµ¬í˜„í•˜ë ¤ë©´ ëª‡ ê°€ì§€ ì¶”ê°€ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í•„ìš”í•˜ë©° OrdinaryKrigingì´ë¼ëŠ” í´ë˜ìŠ¤ë¥¼ ìƒì„±í•´ì•¼í•©ë‹ˆë‹¤.\n\n```python\nfrom scipy.linalg import solve\nfrom itertools import product\nfrom sklearn.metrics import mean_squared_error as MSE\n\nclass OrdinaryKriging:\n    def __init__(self, lats, lons, values):\n        self.lats = lats\n        self.lons= lons\n        self.values = values\n\n        self.nugget_values = [0, 1, 2, 3, 4]\n        self.sill_values = [1, 2, 3, 4, 5]\n        self.range_values = [1, 2, 3, 4, 5]\n\n        # ëª¨ìˆ˜ ê°’ì„ ë§ì¶”ê¸° ìœ„í•œ ëª¨ë“  ì¡°í•© ìƒì„±\n        self.parameter_combinations = list(product(self.nugget_values, self.sill_values, self.range_values))\n        self.optimal_pars = None\n\n    def theoretical_variogram(self, h, nugget, sill, r):\n        return nugget + (sill-nugget) * (1-np.exp(-3*h/r))\n\n    def Euclidean(self, X, Y):\n        all_dists, point_dists = [], []\n        for x,y in zip(X, Y):\n          k = 0\n          for k in range(len(X)):\n            h = np.linalg.norm(np.array([x, y]) - np.array([X[k], Y[k]))\n            point_dists.append(h)\n          all_dists.append(point_dists)\n          point_dists = []\n        return all_dists\n\n    def gamma(self):\n        distances = self.Euclidean(self.lats, self.lons)\n        differences = np.abs(self.values.reshape(-1,1) - self.values)\n        variogram_values = []\n        for h in np.unique(distances):\n            values_at_h = differences[(distances == h)]\n            variogram_values.append(np.mean(values_at_h**2))\n        return variogram_values, np.unique(distances)\n\n    def fit(self):\n        experimental_variogram, distances = self.gamma()\n        fit_metrics = []\n        for nugget, sill, range_ in self.parameter_combinations:\n            theoretical_variogram_values = self.theoretical_variogram(distances, nugget, sill, range_)\n            fit_metric = MSE(experimental_variogram, theoretical_variogram_values)\n            fit_metrics.append((nugget, sill, range_, fit_metric))\n\n        self.optimal_pars = min(fit_metrics, key=lambda x: x[3])[:3]\n\n    def predict(self, point):\n        points = np.array([(x,y) for x,y in zip(self.lats, self.lons)])\n        distances = np.linalg.norm(points - point, axis=1)\n        pars = list(self.optimal_pars)\n        pars.insert(0, distances)\n        weights = self.theoretical_variogram(*pars)\n        weights /= np.sum(weights)\n        return np.dot(weights, self.values)\n\nkriging = OrdinaryKriging(df.LATITUDE.values, df.LONGITUDE.values, df.TAVG.values)\n\nkriging.fit()\n```\n\n<!-- TIL ìˆ˜í‰ -->\n\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nì´ì œ ê° í•¨ìˆ˜ë¥¼ ë”°ë¡œ ì‚´í´ë´…ì‹œë‹¤.\n**init** í•¨ìˆ˜ëŠ” ì¢Œí‘œì™€ ê°’ì˜ ì´ˆê¸°í™” ì™¸ì— nugget, sill, rangeì˜ ê°€ëŠ¥í•œ ê°’ìœ¼ë¡œ êµ¬ì„±ëœ ì„¸ ê°œì˜ ë¦¬ìŠ¤íŠ¸ë¥¼ í¬í•¨í•©ë‹ˆë‹¤. ëª¨ë“  ê°€ëŠ¥í•œ ì¡°í•©ìœ¼ë¡œ ì„ì–´ì„œ parameter_combinations ë³€ìˆ˜ì— ì €ì¥ë©ë‹ˆë‹¤. ìš°ë¦¬ëŠ” ë‚˜ì¤‘ì— ìµœì  ê°’ì„ ì°¾ì„ ë•Œ í•„ìš”í•  ê²ƒì…ë‹ˆë‹¤.\n\n```python\ndef __init__(self, lats, lons, values):\n        self.lats = lats\n        self.lons= lons\n        self.values = values\n\n        self.nugget_values = [0, 1, 2, 3, 4]\n        self.sill_values = [1, 2, 3, 4, 5]\n        self.range_values = [1, 2, 3, 4, 5]\n\n        # ë§ì¶”ê¸° ìœ„í•œ ëª¨ë“  íŒŒë¼ë¯¸í„° ê°’ ì¡°í•© ìƒì„±\n        self.parameter_combinations = list(product(self.nugget_values, self.sill_values, self.range_values))\n        self.optimal_pars = None\n```\n\në‘ ë²ˆì§¸ í•¨ìˆ˜ì¸ theoretical_variogramì€ ì´ì „ì— ì–¸ê¸‰ëœ ê³µì‹ ì¤‘ í•˜ë‚˜ë¥¼ íŒŒì´ì¬ìœ¼ë¡œ êµ¬í˜„í•œ ê²ƒì— ë¶ˆê³¼í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” ì§€ìˆ˜ í•¨ìˆ˜ì…ë‹ˆë‹¤ (í•˜ì§€ë§Œ ë‹¤ë¥¸ í•¨ìˆ˜ì— ëŒ€í•œ ì½”ë“œë¥¼ ì‘ì„±í•˜ì—¬ ê²°ê³¼ë¥¼ ë¹„êµí•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤):\n\n```python\ndef theoretical_variogram(self, h, nugget, sill, r):\n return nugget + (sill-nugget) * (1-np.exp(-3*h/r))\n```\n\n<!-- TIL ìˆ˜í‰ -->\n\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nì„¸ ë²ˆì§¸ í´ë˜ìŠ¤ ë©”ì„œë“œëŠ” ìœ í´ë¦¬ë””ì•ˆì…ë‹ˆë‹¤. ì´ê²ƒì€ NNê³¼ IDWë¥¼ ìœ„í•´ ë§Œë“  í•¨ìˆ˜ì˜ ë³€ê²½ëœ ë²„ì „ì…ë‹ˆë‹¤. ì´ë²ˆì—ëŠ” ì ê³¼ ëª¨ë“  ë‹¤ë¥¸ ì  ì‚¬ì´ì˜ ê±°ë¦¬ë¥¼ ë‚˜íƒ€ë‚´ëŠ” (n,n) í–‰ë ¬ì„ ë°˜í™˜í•©ë‹ˆë‹¤ (ê° í–‰ì—ì„œ í•˜ë‚˜ì˜ ê°’ì€ 0ì´ë©°, ì ê³¼ ê·¸ ìì‹  ì‚¬ì´ì˜ ê±°ë¦¬ëŠ” 0ì…ë‹ˆë‹¤).\n\n```js\ndef Euclidean(self, X, Y):\n        all_dists, point_dists = [], []\n        for x, y in zip(X, Y):\n          k = 0\n          for k in range(len(X)):\n            h = np.linalg.norm(np.array([x, y]) - np.array([X[k], Y[k]))\n            point_dists.append(h)\n          all_dists.append(point_dists)\n          point_dists = []\n        return all_dists\n```\n\në„¤ ë²ˆì§¸ í•¨ìˆ˜ëŠ” fittingì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” ì‹¤í—˜ì  ë³€ë¦¬ì˜¤ê·¸ë¨ ê°’ê³¼ ìœ í´ë¦¬ë””ì•ˆ ê±°ë¦¬ë¥¼ ì–»ìŠµë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ sill, range ë° nuggetì˜ ì¡°í•©ì„ ë°˜ë³µí•˜ë©´ì„œ ì´ë¡ ì  ë³€ë¦¬ì˜¤ê·¸ë¨ ê°’ê³¼ ì‹¤í—˜ì  ê°’ ì‚¬ì´ì˜ í‰ê·  ì œê³± ì˜¤ì°¨(Mean Squared Error, MSE) ì¶”ì •ì„ ê³„ì‚°í•©ë‹ˆë‹¤ (ë‹¤ë¥¸ ë©”íŠ¸ë¦­ì„ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤). ê·¸ëŸ° ë‹¤ìŒ ìµœì ì˜ ë§¤ê°œë³€ìˆ˜ë¥¼ í´ë˜ìŠ¤ ë³€ìˆ˜ optimal_parsì— ì €ì¥í•©ë‹ˆë‹¤.\n\n```js\ndef fit(self):\n        experimental_variogram, distances = self.gamma()\n        fit_metrics = []\n        for nugget, sill, range_ in self.parameter_combinations:\n            theoretical_variogram_values = self.theoretical_variogram(distances, nugget, sill, range_)\n            fit_metric = MSE(experimental_variogram, theoretical_variogram_values)\n            fit_metrics.append((nugget, sill, range_, fit_metric))\n\n        self.optimal_pars = min(fit_metrics, key=lambda x: x[3])[:3]\n```\n\n<!-- TIL ìˆ˜í‰ -->\n\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\në§ˆì§€ë§‰ìœ¼ë¡œ ê°€ì¥ ì¤‘ìš”í•œ í•¨ìˆ˜ëŠ” ì˜ˆì¸¡ì…ë‹ˆë‹¤. ì…ë ¥ìœ¼ë¡œ ì  (lat;lon)ì„ ë°›ì•„ì„œ í•´ë‹¹ ì ê³¼ ë‹¤ë¥¸ ì•Œë ¤ì§„ ê°’ë“¤ ì‚¬ì´ì˜ ê±°ë¦¬ë¥¼ ì¶”ì •í•©ë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ, ì•ì„œ ì–»ì€ ìµœì  íŒŒë¼ë¯¸í„°ë¥¼ ì „ë‹¬í•˜ì—¬ ì´ë¡ ì  ë³€ì´ê·¸ë¨ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê³  ê°€ì¤‘ì¹˜ë¥¼ ì¶œë ¥ê°’ìœ¼ë¡œ ë°›ìŠµë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ ê°€ì¤‘ í‰ê· ì„ ê³„ì‚°í•˜ê³  ë°˜í™˜í•©ë‹ˆë‹¤.\n\n```js\ndef predict(self, point):\n        points = np.array([(x,y) for x,y in zip(self.lats, self.lons)])\n        distances = np.linalg.norm(points - point, axis=1)\n        pars = list(self.optimal_pars)\n        pars.insert(0, distances)\n        weights = self.theoretical_variogram(*pars)\n        weights /= np.sum(weights)\n        return np.dot(weights, self.values)\n```\n\nì´ì œ ëª¨ë“  ì˜ˆì¸¡ê°’ì„ ìˆ˜ì§‘í•˜ê³  ì§€ë„ë¥¼ ì‹œê°í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:\n\n```js\nrow, grid = [], []\nfor lat in LAT:\n  for lon in LON:\n    row.append(kriging.predict(np.array([lat, lon])))\n  grid.append(row)\n  row=[]\n\nds = xr.Dataset(\n    {'TAVG': (['lat', 'lon'], grid)},\n    coords={'lat': LAT, 'lon': LON})\n\nfig, ax = plt.subplots(subplot_kw=dict(projection=ccrs.PlateCarree()), figsize=(16, 9))\nds.where(rg).TAVG.plot(ax=ax, alpha=0.6)\ngdf.plot(ax=ax, color='r', markersize=85)\nax.gridlines(draw_labels=True,linewidth=2, color='black', alpha=0.5, linestyle='--')\nplt.show()\n```\n\n<!-- TIL ìˆ˜í‰ -->\n\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n![image](/TIL/assets/img/2024-07-09-3PopularMethodsforSpatialInterpolation_15.png)\n\nìœ„ì™€ ê°™ì´ ê²°ê³¼ê°€ IDWì—ì„œ ì–»ì€ ê²ƒê³¼ëŠ” ê½¤ ë‹¤ë¥´ë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì–´ìš”. í¬ë¦¬ê¹…ì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ ë§¤ê°œë³€ìˆ˜ëŠ” ì„ íƒí•œ ì´ë¡ ì  ë³€ì´ê·¸ë¨ ì¢…ë¥˜ì¸ë°, ì´ëŠ” ì‚¬ì‹¤ ìƒ ì˜ˆì¸¡ëœ ê°’ê³¼ ê±°ë¦¬ ê°„ì˜ ê´€ê³„ë¥¼ ì •ì˜í•©ë‹ˆë‹¤. ì½”ë“œë¥¼ ì‚¬ìš©í•˜ê¸° ê·€ì°®ìœ¼ì‹œê±°ë‚˜ ì§ì ‘ ì‘ì„±í•˜ê³  ì‹¶ì§€ ì•Šë‹¤ë©´ ë§ì€ ë³€ì´ê·¸ë¨ ëª¨ë¸ì˜ êµ¬í˜„ì„ ê°–ê³  ìˆëŠ” PyKrige ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚´í´ë³´ì„¸ìš”.\n\nì´ ê¸€ì´ ìœ ìµí•˜ê³  í†µì°°ë ¥ì„ ì¤¬ìœ¼ë©´ ì¢‹ê² ì–´ìš”!\n\n<!-- TIL ìˆ˜í‰ -->\n\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nì €ì˜ Mediumì— ì˜¬ë¦° ëª¨ë“  ê²Œì‹œë¬¼ì€ ë¬´ë£Œë¡œ ê³µê°œë˜ì–´ ìˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ì—¬ê¸°ì„œ ì œë¥¼ íŒ”ë¡œìš°í•´ ì£¼ì‹¤ ê²½ìš° ì •ë§ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤!\n\nì°¸ê³ ë¡œ, ì €ëŠ” (ì§€ë¦¬)ë°ì´í„° ê³¼í•™, ê¸°ê³„í•™ìŠµ/ì¸ê³µì§€ëŠ¥, ê·¸ë¦¬ê³  ê¸°í›„ ë³€í™”ì— ëŒ€í•´ ì—´ì •ì ìœ¼ë¡œ ê³µë¶€í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë§Œì•½ í•¨ê»˜ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ê³  ì‹¶ë‹¤ë©´ LinkedInì—ì„œ ì—°ë½ ì£¼ì„¸ìš”.\n\nğŸ›°ï¸ë” ë§ì€ ì†Œì‹ì„ ìœ„í•´ íŒ”ë¡œìš° í•´ì£¼ì„¸ìš”ğŸ›°ï¸\n","ogImage":{"url":"/assets/img/2024-07-09-3PopularMethodsforSpatialInterpolation_0.png"},"coverImage":"/TIL/assets/img/2024-07-09-3PopularMethodsforSpatialInterpolation_0.png","tag":["Tech"],"readingTime":19},"content":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n</head>\n<body>\n<h2>ì²˜ìŒë¶€í„°, Pythonì—ì„œ</h2>\n<img src=\"/TIL/assets/img/2024-07-09-3PopularMethodsforSpatialInterpolation_0.png\">\n<p>ë³´ê°„ë²•ì€ ë°ì´í„° ê³¼í•™ì ë¿ë§Œ ì•„ë‹ˆë¼ ë‹¤ì–‘í•œ ë¶„ì•¼ì˜ ì‚¬ëŒë“¤ì— ì˜í•´ ì‚¬ìš©ë˜ëŠ” ë§¤ìš° ì¼ë°˜ì ì¸ ìˆ˜í•™ì  ê°œë…ì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì§€ë¦¬ ê³µê°„ ë°ì´í„°ë¥¼ ë‹¤ë£° ë•Œ, ë³´ê°„ì€ ì¢…ì¢… í¬ì†Œí•œ ê´€ì¸¡ì¹˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ëŒ€í‘œì ì¸ ê·¸ë¦¬ë“œë¥¼ ë§Œë“¤ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ë” ë³µì¡í•´ì§‘ë‹ˆë‹¤.</p>\n<p>ì§€ë¦¬ ê³µê°„ ë¶€ë¶„ì— ë“¤ì–´ê°€ê¸° ì „ì—, ì„ í˜• ë³´ê°„ì— ëŒ€í•´ ê°„ë‹¨íˆ ë˜ì§šì–´ ë´…ì‹œë‹¤.</p>\n<!-- TIL ìˆ˜í‰ -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>ë””ìì¸ì„ ë³´ì—¬ë“œë¦¬ê¸° ìœ„í•´ ì¼ë°˜ ë‹¤í•­ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•  ê²ƒì…ë‹ˆë‹¤:</p>\n<pre><code class=\"hljs language-js\">def <span class=\"hljs-title function_\">F</span>(x):\n  <span class=\"hljs-keyword\">return</span> -<span class=\"hljs-number\">2</span>*x**<span class=\"hljs-number\">3</span>+x**<span class=\"hljs-number\">2</span>+<span class=\"hljs-number\">2.1</span>\n\nx = np.<span class=\"hljs-title function_\">arange</span>(-<span class=\"hljs-number\">5</span>,<span class=\"hljs-number\">5</span>, <span class=\"hljs-number\">0.1</span>)\ny = <span class=\"hljs-title function_\">F</span>(x)\n</code></pre>\n<img src=\"/TIL/assets/img/2024-07-09-3PopularMethodsforSpatialInterpolation_1.png\">\n<p>ì´ì œ [-4.2, 0, 2.5]ì—ì„œ ëª‡ ê°œì˜ ì ì„ ë¬´ì‘ìœ„ë¡œ ìƒ˜í”Œë§í•˜ê³  ì´ë¥¼ ì—°ê²°í•´ ë³´ê² ìŠµë‹ˆë‹¤:</p>\n<!-- TIL ìˆ˜í‰ -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p><img src=\"/TIL/assets/img/2024-07-09-3PopularMethodsforSpatialInterpolation_2.png\" alt=\"ì´ë¯¸ì§€\"></p>\n<p>ì´ê²ƒì€ ì„ í˜• ë³´ê°„ë²•ì´ë¼ê³  ë¶ˆë¦½ë‹ˆë‹¤. ê° êµ¬ê°„ì—ì„œ ì§ì„ ìœ¼ë¡œ í•¨ìˆ˜ë¥¼ ê·¼ì‚¬í•˜ê³  ìˆìœ¼ë©°, ì´ì œ 3ê°œì˜ ì ì—ì„œ í•¨ìˆ˜ì˜ ê°’ì„ ì•Œê³  ìˆì„ ë•Œ [-4.2;2.5] êµ¬ê°„ ë‚´ì˜ ê°’ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p>ë†’ì€ ì •í™•ë„ë¥¼ ê°€ì§„ ë§ì€ ë‹¤ë¥¸ ë°©ë²•ë“¤ì´ ìˆì§€ë§Œ, ê·¸ ë’¤ì— ìˆëŠ” ì•„ì´ë””ì–´ëŠ” ë™ì¼í•©ë‹ˆë‹¤: ì ì–´ë„ ë‘ ê°œì˜ ì•Œë ¤ì§„ ì  ì‚¬ì´ì—ì„œ í•¨ìˆ˜ ê°’ì„ ì°¾ëŠ” ê²ƒì…ë‹ˆë‹¤.</p>\n<p>ì´ì œ ì§€ë¦¬ ê³µê°„ ë¶€ë¶„ìœ¼ë¡œ ë„˜ì–´ê°ˆ ì‹œê°„ì…ë‹ˆë‹¤. ì´ ììŠµì„œì—ì„œëŠ” NOAAì—ì„œ ì œê³µí•œ ìŠ¤ìœ„ìŠ¤ ì „ì—­ì˜ ê¸°ìƒ ì¸¡ì •ì†Œì—ì„œ ì¸¡ì •ëœ ì¼ì¼ í‰ê·  ëŒ€ê¸° ì˜¨ë„ì˜ ê³µê°„ ë³´ê°„ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì´ ëª©í‘œì…ë‹ˆë‹¤. ê¸°ëŒ€ë˜ëŠ” ê²°ê³¼ëŠ” 0.1Â° í•´ìƒë„ì˜ ì˜¨ë„ ê·¸ë¦¬ë“œì…ë‹ˆë‹¤.</p>\n<!-- TIL ìˆ˜í‰ -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>ë¨¼ì €, ìŠ¤ìœ„ìŠ¤ì˜ í–‰ì • ê²½ê³„ë¥¼ ì–»ì–´ì™€ì„œ geopandasë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹œê°í™”í•´ì•¼ í•©ë‹ˆë‹¤:</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> geopandas <span class=\"hljs-keyword\">as</span> gpd\n\nshape = gpd.read_file(<span class=\"hljs-string\">'gadm41_CHE_0.shp'</span>)\nshape.plot()\n</code></pre>\n<img src=\"/TIL/assets/img/2024-07-09-3PopularMethodsforSpatialInterpolation_3.png\">\n<p>ì •ë§ ëŒ€ë‹¨í•´ìš”! ìŠ¤ìœ„ìŠ¤ì¸ ê²ƒ ê°™ë„¤ìš” =)</p>\n<!-- TIL ìˆ˜í‰ -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>ì´ì œ ì˜¨ë„ ê´€ì¸¡ì¹˜ë¥¼ ê·¸ë˜í”„ë¡œ í‘œì‹œí•˜ê³  êµ­ê°€ ëª¨ì–‘ê³¼ ê²¹ì³ë³´ê² ìŠµë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ ì •ê¸°ì ì¸ íŒë‹¤ ë°ì´í„°í”„ë ˆì„ìœ¼ë¡œ ê¸°ìƒ ë°ì´í„°ë¥¼ ë¡œë“œí•œ ë‹¤ìŒ ì…°ì´í”„ë¦¬ í¬ì¸íŠ¸ë¡œ ë³€í™˜í•œ ì§€ë¦¬ ë°ì´í„°í”„ë ˆì„ìœ¼ë¡œ ë³€í™˜í•˜ê² ìŠµë‹ˆë‹¤:</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> pandas <span class=\"hljs-keyword\">as</span> pd\n<span class=\"hljs-keyword\">from</span> shapely.geometry <span class=\"hljs-keyword\">import</span> Point\n\ndf = pd.read_csv(<span class=\"hljs-string\">'3639866.csv'</span>)\n\npoints = <span class=\"hljs-built_in\">list</span>()\n<span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-built_in\">len</span>(df)):\n  point = Point(df.loc[i, <span class=\"hljs-string\">'LONGITUDE'</span>], df.loc[i, <span class=\"hljs-string\">'LATITUDE'</span>])\n  points.append(point)\n\ngdf = gpd.GeoDataFrame(geometry=points).set_crs(shape.crs)\n</code></pre>\n<p>ê·¸ë ‡ê²Œ í•˜ë©´ matplotlibì„ ì‚¬ìš©í•˜ì—¬ ë‘ ë°ì´í„°í”„ë ˆì„ì„ ì‰½ê²Œ ê²¹ì³ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<pre><code class=\"hljs language-python\">fig, ax = plt.subplots(figsize=(<span class=\"hljs-number\">16</span>,<span class=\"hljs-number\">9</span>))\nshape.plot(ax=ax, color=<span class=\"hljs-string\">'black'</span>)\ngdf.plot(ax=ax, color=<span class=\"hljs-string\">'r'</span>, markersize=<span class=\"hljs-number\">85</span>)\nplt.show()\n</code></pre>\n<!-- TIL ìˆ˜í‰ -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p><img src=\"/TIL/assets/img/2024-07-09-3PopularMethodsforSpatialInterpolation_4.png\" alt=\"ê·¸ë¦¬ë“œ ë° ì§€ë„ ì˜¤ë²„ë ˆì´ë¥¼ ì‹œê°í™”í•˜ê¸° ìœ„í•´ ë‹¤ìŒì„ ìˆ˜í–‰í•˜ê² ìŠµë‹ˆë‹¤:\"></p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> matplotlib.<span class=\"hljs-property\">ticker</span> <span class=\"hljs-keyword\">as</span> mticker\n<span class=\"hljs-keyword\">import</span> cartopy.<span class=\"hljs-property\">crs</span> <span class=\"hljs-keyword\">as</span> ccrs\n<span class=\"hljs-keyword\">from</span> cartopy.<span class=\"hljs-property\">mpl</span>.<span class=\"hljs-property\">gridliner</span> <span class=\"hljs-keyword\">import</span> <span class=\"hljs-variable constant_\">LONGITUDE_FORMATTER</span>, <span class=\"hljs-variable constant_\">LATITUDE_FORMATTER</span>\n\n<span class=\"hljs-variable constant_\">LAT</span>, <span class=\"hljs-variable constant_\">LON</span> = np.<span class=\"hljs-title function_\">arange</span>(<span class=\"hljs-number\">45.75</span>, <span class=\"hljs-number\">48</span>, <span class=\"hljs-number\">0.1</span>), np.<span class=\"hljs-title function_\">arange</span>(<span class=\"hljs-number\">6</span>, <span class=\"hljs-number\">10.81</span>, <span class=\"hljs-number\">0.1</span>)\n\nfig, ax = plt.<span class=\"hljs-title function_\">subplots</span>(subplot_kw=<span class=\"hljs-title function_\">dict</span>(projection=ccrs.<span class=\"hljs-title class_\">PlateCarree</span>()), figsize=(<span class=\"hljs-number\">16</span>, <span class=\"hljs-number\">9</span>))\nshape.<span class=\"hljs-title function_\">plot</span>(ax=ax, color=<span class=\"hljs-string\">'grey'</span>)\ngdf.<span class=\"hljs-title function_\">plot</span>(ax=ax, color=<span class=\"hljs-string\">'r'</span>, markersize=<span class=\"hljs-number\">85</span>)\n\ngl = ax.<span class=\"hljs-title function_\">gridlines</span>(draw_labels=<span class=\"hljs-title class_\">True</span>,linewidth=<span class=\"hljs-number\">2</span>, color=<span class=\"hljs-string\">'black'</span>, alpha=<span class=\"hljs-number\">0.5</span>, linestyle=<span class=\"hljs-string\">'--'</span>)\ngl.<span class=\"hljs-property\">xlocator</span> = mticker.<span class=\"hljs-title class_\">FixedLocator</span>(<span class=\"hljs-variable constant_\">LON</span>)\ngl.<span class=\"hljs-property\">ylocator</span> = mticker.<span class=\"hljs-title class_\">FixedLocator</span>(<span class=\"hljs-variable constant_\">LAT</span>)\ngl.<span class=\"hljs-property\">xformatter</span> = <span class=\"hljs-variable constant_\">LONGITUDE_FORMATTER</span>\ngl.<span class=\"hljs-property\">yformatter</span> = <span class=\"hljs-variable constant_\">LATITUDE_FORMATTER</span>\nplt.<span class=\"hljs-title function_\">show</span>()\n</code></pre>\n<p><img src=\"/TIL/assets/img/2024-07-09-3PopularMethodsforSpatialInterpolation_5.png\" alt=\"ê²°ê³¼ ì´ë¯¸ì§€\"></p>\n<!-- TIL ìˆ˜í‰ -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>ìœ„ ê·¸ë¦¼ì— ë‚˜íƒ€ë‚œ ì •ê·œ ê·¸ë¦¬ë“œì— ëŒ€í•´ ë³´ê°„ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì´ ëª©í‘œì…ë‹ˆë‹¤. ì´ ê·¸ë¦¬ë“œì—ëŠ” 8ê°œì˜ ì˜¨ë„ ê´€ì¸¡ì¹˜ê°€ ìˆìŠµë‹ˆë‹¤.</p>\n<h1>I. ìµœê·¼ì ‘ ì´ì›ƒ (NN)</h1>\n<p>ê°€ì¥ ì§ê´€ì ì´ê³  ê°„ë‹¨í•œ ë°©ë²• ì¤‘ í•˜ë‚˜ì¸ Nearest Neighbor (NN)ì— ëŒ€í•´ ì´ì•¼ê¸°í•˜ê² ìŠµë‹ˆë‹¤. ì´ë¦„ì—ì„œ ì•Œ ìˆ˜ ìˆë“¯ì´, ì´ ì•Œê³ ë¦¬ì¦˜ì€ ê° ê·¸ë¦¬ë“œ ë…¸ë“œì— ê°€ì¥ ê°€ê¹Œìš´ ê´€ì¸¡ì¹˜ì˜ ê°’ì„ í• ë‹¹í•©ë‹ˆë‹¤.</p>\n<p>ì´ë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•´ í•„ìš”í•œ í•¨ìˆ˜ëŠ” ë‘ ê°€ì§€ë¿ì…ë‹ˆë‹¤. ì²« ë²ˆì§¸ í•¨ìˆ˜ëŠ” ìœ í´ë¦¬ë“œ í•¨ìˆ˜ì´ë©°, ë‹¤ìŒ ê³µì‹ì„ ì‚¬ìš©í•˜ì—¬ ë‘ ì  ì‚¬ì´ì˜ ê±°ë¦¬ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤:</p>\n<!-- TIL ìˆ˜í‰ -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p><img src=\"/TIL/assets/img/2024-07-09-3PopularMethodsforSpatialInterpolation_6.png\" alt=\"Image\"></p>\n<p>ë‘ ë²ˆì§¸ëŠ” NN ë©”ì†Œë“œ ìì²´ì…ë‹ˆë‹¤. ê´€ì¸¡ê°’ì„ ì €ì¥í•  ë¹ˆ ë°°ì—´ì„ ë§Œë“  í›„, ëª¨ë“  ìœ„ë„ì™€ ê²½ë„ë¥¼ ë°˜ë³µí•˜ë©´ì„œ ê° í¬ì¸íŠ¸ì—ì„œ í˜„ì¬ ê·¸ë¦¬ë“œ ë…¸ë“œê¹Œì§€ì˜ ê±°ë¦¬ë¥¼ ê³„ì‚°í•˜ê³  ê·¸ ê·¸ë¦¬ë“œ ë…¸ë“œì— ê°€ì¥ ê°€ê¹Œìš´ ê´€ì¸¡ê°’ì„ í• ë‹¹í•©ë‹ˆë‹¤.</p>\n<pre><code class=\"hljs language-js\">def ìœ í´ë¦¬ë“œ(x1, x2, y1, y2):\n  <span class=\"hljs-keyword\">return</span> ((x1-x2)**<span class=\"hljs-number\">2</span> + (y1-y2)**<span class=\"hljs-number\">2</span>) ** <span class=\"hljs-number\">0.5</span>\n\ndef <span class=\"hljs-title function_\">NN</span>(data, <span class=\"hljs-variable constant_\">LAT</span>, <span class=\"hljs-variable constant_\">LON</span>):\n  array = np.<span class=\"hljs-title function_\">empty</span>((<span class=\"hljs-variable constant_\">LAT</span>.<span class=\"hljs-property\">shape</span>[<span class=\"hljs-number\">0</span>], <span class=\"hljs-variable constant_\">LON</span>.<span class=\"hljs-property\">shape</span>[<span class=\"hljs-number\">0</span>]))\n\n  <span class=\"hljs-keyword\">for</span> i, lat <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">enumerate</span>(<span class=\"hljs-variable constant_\">LAT</span>):\n    <span class=\"hljs-keyword\">for</span> j, lon <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">enumerate</span>(<span class=\"hljs-variable constant_\">LON</span>):\n      idx = data.<span class=\"hljs-title function_\">apply</span>(lambda <span class=\"hljs-attr\">row</span>: ìœ í´ë¦¬ë“œ(row.<span class=\"hljs-property\">LONGITUDE</span>, lon, row.<span class=\"hljs-property\">LATITUDE</span>, lat), axis=<span class=\"hljs-number\">1</span>).<span class=\"hljs-title function_\">argmin</span>()\n      array[i, j] = data.<span class=\"hljs-property\">loc</span>[idx, <span class=\"hljs-string\">'TAVG'</span>]\n  <span class=\"hljs-keyword\">return</span> array\n</code></pre>\n<p>ì „ì²´ ì•„ì´ë””ì–´ëŠ” ì´ í•œ ì¤„ì— ìˆìŠµë‹ˆë‹¤.</p>\n<!-- TIL ìˆ˜í‰ -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-python\">idx = data.apply(<span class=\"hljs-keyword\">lambda</span> row: Euclidean(row.LONGITUDE, lon, row.LATITUDE, lat), axis=<span class=\"hljs-number\">1</span>).argmin()\n</code></pre>\n<p>ë³€ìˆ˜ dataëŠ” ê° í–‰ì´ í•˜ë‚˜ì˜ ê¸°ìƒ ì¥ë¹„ ì‚¬ì´íŠ¸ë¥¼ ë‚˜íƒ€ë‚´ëŠ” íŒë‹¤ ë°ì´í„°í”„ë ˆì„ì…ë‹ˆë‹¤. ë”°ë¼ì„œ for ë£¨í”„ì—ì„œ ê±°ë¦¬ë¥¼ ê³„ì‚°í•˜ê³  ìµœì†Œ ê±°ë¦¬ë¥¼ ê°€ì§„ ì‚¬ì´íŠ¸ì˜ ì¸ë±ìŠ¤ë¥¼ ì°¾ìŠµë‹ˆë‹¤.</p>\n<p>ì´ì œ ì•Œê³ ë¦¬ì¦˜ì„ ì‹¤í–‰í•˜ê³  ê²°ê³¼ë¥¼ xarray ë°ì´í„°ì…‹ìœ¼ë¡œ ë˜í•‘í•´ ë´…ì‹œë‹¤:</p>\n<pre><code class=\"hljs language-python\">t2m = NN(df, LAT, LON)\nds = xr.Dataset(\n    {<span class=\"hljs-string\">'TAVG'</span>: ([<span class=\"hljs-string\">'lat'</span>, <span class=\"hljs-string\">'lon'</span>], t2m)},\n    coords={<span class=\"hljs-string\">'lat'</span>: LAT, <span class=\"hljs-string\">'lon'</span>: LON})\n</code></pre>\n<!-- TIL ìˆ˜í‰ -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>ì´ì œ ê²°ê³¼ë¥¼ í”Œë¡œíŒ…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>\n<p><img src=\"/TIL/assets/img/2024-07-09-3PopularMethodsforSpatialInterpolation_7.png\" alt=\"\"></p>\n<p>ë³´ê¸° ì¢‹ì§€ë§Œ, regionmask ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ìŠ¤ìœ„ìŠ¤ ë§¤ìŠ¤í¬ë¥¼ ë§Œë“¤ì–´ í”Œë¡¯ì„ ë” ë³´ê¸° ì¢‹ê²Œ ë³€ê²½í•´ ë³´ê² ìŠµë‹ˆë‹¤:</p>\n<pre><code class=\"hljs language-js\">shape[<span class=\"hljs-string\">'new_column'</span>] = <span class=\"hljs-number\">0</span>\nsw = shape.<span class=\"hljs-title function_\">dissolve</span>(by=<span class=\"hljs-string\">'new_column'</span>)[<span class=\"hljs-string\">'geometry'</span>]\nrg = regionmask.<span class=\"hljs-title function_\">mask_3D_geopandas</span>(sw, lon_or_obj=ds.<span class=\"hljs-property\">lon</span>, lat=ds.<span class=\"hljs-property\">lat</span>)\n\nfig, ax = plt.<span class=\"hljs-title function_\">subplots</span>(subplot_kw=<span class=\"hljs-title function_\">dict</span>(projection=ccrs.<span class=\"hljs-title class_\">PlateCarree</span>()), figsize=(<span class=\"hljs-number\">16</span>, <span class=\"hljs-number\">9</span>))\n#shape.<span class=\"hljs-title function_\">plot</span>(ax=ax, color=<span class=\"hljs-string\">'black'</span>)\nds.<span class=\"hljs-title function_\">where</span>(rg).<span class=\"hljs-property\">TAVG</span>.<span class=\"hljs-title function_\">plot</span>(ax=ax, alpha=<span class=\"hljs-number\">0.6</span>)\ngdf.<span class=\"hljs-title function_\">plot</span>(ax=ax, color=<span class=\"hljs-string\">'r'</span>, markersize=<span class=\"hljs-number\">85</span>)\nax.<span class=\"hljs-title function_\">gridlines</span>(draw_labels=<span class=\"hljs-title class_\">True</span>, linewidth=<span class=\"hljs-number\">2</span>, color=<span class=\"hljs-string\">'black'</span>, alpha=<span class=\"hljs-number\">0.5</span>, linestyle=<span class=\"hljs-string\">'--'</span>)\nplt.<span class=\"hljs-title function_\">show</span>()\n</code></pre>\n<!-- TIL ìˆ˜í‰ -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<img src=\"/TIL/assets/img/2024-07-09-3PopularMethodsforSpatialInterpolation_8.png\">\n<p>ë³´ì‹œë‹¤ì‹œí”¼ ì´ ë°©ë²•ì€ ë²”ì£¼í˜• ë°ì´í„°ì—ë§Œ ì ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìš°ë¦¬ê°€ ë‹¤ë£¨ëŠ” ê²ƒì€ ì˜¨ë„ë¡œ, ì´ëŠ” ì—°ì† ë³€ìˆ˜ë¡œ ì–´ë–¤ ë²”ìœ„ ì•ˆì—ì„œ ì–´ë–¤ ê°’ì´ë“  ê°€ì§ˆ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì´ ë³´ê°„ì€ í˜¼ë™ìŠ¤ëŸ¬ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í˜„ì‹¤ì—ì„œëŠ” í•­ìƒ ê·¸ë¼ë°ì´ì…˜ê³¼ ë¬´ì‘ìœ„ì„±ì´ ìˆìŠµë‹ˆë‹¤.</p>\n<p>ê·¸ë˜ì„œ ì¢€ ë” ê³ ê¸‰ ì•Œê³ ë¦¬ì¦˜ì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.</p>\n<h1>II. ì—­ ê±°ë¦¬ ê°€ì¤‘ ì´ë™ë²• (IDW)</h1>\n<!-- TIL ìˆ˜í‰ -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>ê¸°ë³¸ì ìœ¼ë¡œ ì—­ ê±°ë¦¬ ê°€ì¤‘ì¹˜(IDW)ëŠ” NNì˜ í–¥ìƒëœ ë²„ì „ì…ë‹ˆë‹¤:</p>\n<pre><code class=\"hljs language-js\">def <span class=\"hljs-title function_\">IDW</span>(data, <span class=\"hljs-variable constant_\">LAT</span>, <span class=\"hljs-variable constant_\">LON</span>, betta=<span class=\"hljs-number\">2</span>):\n  array = np.<span class=\"hljs-title function_\">empty</span>((<span class=\"hljs-variable constant_\">LAT</span>.<span class=\"hljs-property\">shape</span>[<span class=\"hljs-number\">0</span>], <span class=\"hljs-variable constant_\">LON</span>.<span class=\"hljs-property\">shape</span>[<span class=\"hljs-number\">0</span>]))\n\n  <span class=\"hljs-keyword\">for</span> i, lat <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">enumerate</span>(<span class=\"hljs-variable constant_\">LAT</span>):\n    <span class=\"hljs-keyword\">for</span> j, lon <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">enumerate</span>(<span class=\"hljs-variable constant_\">LON</span>):\n      weights = data.<span class=\"hljs-title function_\">apply</span>(lambda <span class=\"hljs-attr\">row</span>: <span class=\"hljs-title class_\">Euclidean</span>(row.<span class=\"hljs-property\">LONGITUDE</span>, lon, row.<span class=\"hljs-property\">LATITUDE</span>, lat)**(-betta), axis=<span class=\"hljs-number\">1</span>)\n      z = <span class=\"hljs-title function_\">sum</span>(weights*data.<span class=\"hljs-property\">TAVG</span>)/weights.<span class=\"hljs-title function_\">sum</span>()\n      array[i,j] = z\n  <span class=\"hljs-keyword\">return</span> array\n</code></pre>\n<p>ê°€ê¹Œìš´ ì•Œë ¤ì§„ ì ì˜ ê°’ì„ í• ë‹¹í•˜ëŠ” ëŒ€ì‹ , ì—¬ê¸°ì„œëŠ” ê°€ì¤‘ì¹˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤. ê·¸ë¥¼ ìœ„í•´ ì•ì„œ ì–¸ê¸‰í•œ ìœ í´ë¦¬ë“œ ê±°ë¦¬ê°€ ì‚¬ìš©ë˜ì§€ë§Œ, ì´ë²ˆì—ëŠ” ê° ê±°ë¦¬ë¥¼ -Î² ìŠ¹ìœ¼ë¡œ ì œê³±í•©ë‹ˆë‹¤ (Î²ëŠ” ì„ì˜ì˜ ê°’ì…ë‹ˆë‹¤). ì´ëŸ¬í•œ ê°€ì¤‘ì¹˜ëŠ” ê° ì§€ë©´ ì ì´ íŠ¹ì • ê²©ì ë…¸ë“œì— ë¯¸ì¹˜ëŠ” ê¸°ì—¬ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ê±°ë¦¬ê°€ ë©€ìˆ˜ë¡ ì´ ì ì´ ë…¸ë“œ ê°’ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì´ ì ì–´ì§‘ë‹ˆë‹¤.</p>\n<p>ê°€ì¤‘ì¹˜ë¥¼ ì–»ì€ í›„ ê°€ì¤‘ í‰ê· ì„ ê³„ì‚°í•©ë‹ˆë‹¤.</p>\n<!-- TIL ìˆ˜í‰ -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p><img src=\"/TIL/assets/img/2024-07-09-3PopularMethodsforSpatialInterpolation_9.png\" alt=\"image\"></p>\n<p><img src=\"/TIL/assets/img/2024-07-09-3PopularMethodsforSpatialInterpolation_10.png\" alt=\"image\"></p>\n<p>Letâ€™s plot it:</p>\n<p><img src=\"/TIL/assets/img/2024-07-09-3PopularMethodsforSpatialInterpolation_11.png\" alt=\"image\"></p>\n<!-- TIL ìˆ˜í‰ -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>ë³´ì‹œëŠ” ëŒ€ë¡œ, ì§€ê¸ˆ ê²°ê³¼ê°€ í›¨ì”¬ í˜„ì‹¤ì ì´ê³  ë¶€ë“œëŸ½ìŠµë‹ˆë‹¤!</p>\n<h2>III. í¬ë¦¬ì§•</h2>\n<p>ì˜¤ëŠ˜ì˜ ë§ˆì§€ë§‰ ë©”ì„œë“œëŠ” í¬ë¦¬ì§•ì…ë‹ˆë‹¤. ì´ ì„¸ ê°€ì§€ ë°©ë²• ì¤‘ì—ì„œ ê°€ì¥ ë³µì¡í•œ ë°©ë²• ì¤‘ í•˜ë‚˜ì´ë©°, ìš°ë¦¬ëŠ” ê°„ë‹¨íˆ ì•Œì•„ë³¼ ê²ƒì…ë‹ˆë‹¤. ì˜ì‹ì ì´ê³  íš¨ê³¼ì ìœ¼ë¡œ ì‚¬ìš©í•˜ê³  ì‹¶ë‹¤ë©´ ë¬¸í—Œì„ ì‚´í´ë³¼ ê²ƒì„ ê³ ë ¤í•´ë³´ì„¸ìš”!</p>\n<p>ê·¸ëŸ¬ë¯€ë¡œ ì´ ë°©ë²•ì˜ ì£¼ìš” ì•„ì´ë””ì–´ëŠ” ë°”ë¦¬ì˜¤ê·¸ë¨(ë˜ëŠ” ì„¸ë¯¸ë°”ë¦¬ì˜¤ê·¸ë¨)ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ë³¸ì§ˆì ìœ¼ë¡œ ë°”ë¦¬ì˜¤ê·¸ë¨ì€ ì–´ë–¤ ë§¤ê°œë³€ìˆ˜ì˜ ë³€ì´ê°€ ê±°ë¦¬ì™€ ë°©í–¥ì— ë”°ë¼ ì–´ë–»ê²Œ ë³€í•˜ëŠ”ì§€ë¥¼ ì¸¡ì •í•©ë‹ˆë‹¤. ì´ê²ƒì´ ë°”ë¡œ ìš°ë¦¬ê°€ ê³µê¸° ì˜¨ë„ë¥¼ ë‹¤ë£° ë•Œ í•„ìš”í•œ ë¶€ë¶„ì…ë‹ˆë‹¤.</p>\n<!-- TIL ìˆ˜í‰ -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>í¬ë¦¬ì§• ì•Œê³ ë¦¬ì¦˜ì„ êµ¬í˜„í•˜ë ¤ë©´ ë‘ ê°€ì§€ ìœ í˜•ì˜ ë³€ì´ë¡œê·¸ë¨ì´ í•„ìš”í•©ë‹ˆë‹¤: ì‹¤í—˜ì  ë³€ì´ë¡œê·¸ë¨ê³¼ ì´ë¡ ì  ë³€ì´ë¡œê·¸ë¨ì…ë‹ˆë‹¤.</p>\n<p>ì²« ë²ˆì§¸ëŠ” ì •ë§ ì‰½ê²Œ ê³„ì‚°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°ë§ˆ Î³ë¡œ ì •ì˜ë©ë‹ˆë‹¤:</p>\n<p>[ \\gamma(h) = \\frac{1}{2N(h)}\\sum_{i=1}^{N(h)}[z(x_i) - z(x_i + h)]^2 ]</p>\n<p>ì—¬ê¸°ì„œ,</p>\n<ul>\n<li>( h )ëŠ” ë‘ ì  ì‚¬ì´ì˜ ì§€ë¦¬ì  ê±°ë¦¬,</li>\n<li>(z)ëŠ” ì˜¨ë„ í•¨ìˆ˜ì…ë‹ˆë‹¤.</li>\n</ul>\n<p>ê°„ë‹¨íˆ ë§í•´ ì´ê²ƒì€ ì•Œë ¤ì§„ ì ì—ì„œ ì˜¨ë„ ì°¨ì´ì˜ í‰ê· ì…ë‹ˆë‹¤.</p>\n<!-- TIL ìˆ˜í‰ -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>ì´ë¡ ì  ë³€ì´ê·¸ë¨ì€ ë‹¤ì†Œ ë³µì¡í•©ë‹ˆë‹¤. ë¨¼ì €, ê·¸ëŸ°ê²ƒì´ ë§ì´ ìˆìŠµë‹ˆë‹¤:</p>\n<p><img src=\"/TIL/assets/img/2024-07-09-3PopularMethodsforSpatialInterpolation_13.png\" alt=\"Variogram\"></p>\n<p>ì—¬ê¸°ì„œ pëŠ” ë¶€ë¶„ ì¬, dëŠ” ê±°ë¦¬(hë¥¼ ì‚¬ìš©í–ˆì—ˆì£ ), nì€ ê·¹ì†Œê°’, rì€ ë²”ìœ„ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.</p>\n<p>CDT ì½œë¡¬ë¹„ì•„ì—ì„œ ì´ëŸ¬í•œ ë§¤ê°œë³€ìˆ˜ì— ëŒ€í•œ ì •ë§ ì¢‹ì€ ì‹œê°ì  ì„¤ëª…ì„ ì°¾ì•˜ì–´ìš”. ì €ëŠ” ê·¸ë“¤ì˜ ìë£Œì—ì„œ Î³ì™€ ê±°ë¦¬ ì‚¬ì´ì˜ ê´€ê³„ë¥¼ ì„¤ëª…í•˜ëŠ” ì´ë¯¸ì§€ë¥¼ ì±„íƒí–ˆìŠµë‹ˆë‹¤. ì´ì œëŠ” sill, partial sill, nugget ë° rangeê°€ ë¬´ì—‡ì¸ì§€ ëª…í™•í•´ ë³´ì…ë‹ˆë‹¤.</p>\n<!-- TIL ìˆ˜í‰ -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p><img src=\"/TIL/assets/img/2024-07-09-3PopularMethodsforSpatialInterpolation_14.png\" alt=\"Spatial Interpolation Method\"></p>\n<p>ì•Œê³ ë¦¬ì¦˜ì˜ ì „ì²´ ì•„ì´ë””ì–´ëŠ” ì´ë¡ ì  ë³€ì´ê·¸ë¨ì˜ ë§¤ê°œë³€ìˆ˜ë¥¼ ì¡°ì •í•˜ì—¬ ì‹¤í—˜ì ì¸ ê²ƒì— ë§ê²Œ ë§ì¶”ê³ , ê·¸ê²ƒì„ ì‚¬ìš©í•˜ì—¬ ë…¸ë“œì˜ ê°’ì„ ì˜ˆì¸¡í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.</p>\n<p>ì´ ë°©ë²•ì„ êµ¬í˜„í•˜ë ¤ë©´ ëª‡ ê°€ì§€ ì¶”ê°€ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í•„ìš”í•˜ë©° OrdinaryKrigingì´ë¼ëŠ” í´ë˜ìŠ¤ë¥¼ ìƒì„±í•´ì•¼í•©ë‹ˆë‹¤.</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">from</span> scipy.linalg <span class=\"hljs-keyword\">import</span> solve\n<span class=\"hljs-keyword\">from</span> itertools <span class=\"hljs-keyword\">import</span> product\n<span class=\"hljs-keyword\">from</span> sklearn.metrics <span class=\"hljs-keyword\">import</span> mean_squared_error <span class=\"hljs-keyword\">as</span> MSE\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">OrdinaryKriging</span>:\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__init__</span>(<span class=\"hljs-params\">self, lats, lons, values</span>):\n        self.lats = lats\n        self.lons= lons\n        self.values = values\n\n        self.nugget_values = [<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>]\n        self.sill_values = [<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">5</span>]\n        self.range_values = [<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">5</span>]\n\n        <span class=\"hljs-comment\"># ëª¨ìˆ˜ ê°’ì„ ë§ì¶”ê¸° ìœ„í•œ ëª¨ë“  ì¡°í•© ìƒì„±</span>\n        self.parameter_combinations = <span class=\"hljs-built_in\">list</span>(product(self.nugget_values, self.sill_values, self.range_values))\n        self.optimal_pars = <span class=\"hljs-literal\">None</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">theoretical_variogram</span>(<span class=\"hljs-params\">self, h, nugget, sill, r</span>):\n        <span class=\"hljs-keyword\">return</span> nugget + (sill-nugget) * (<span class=\"hljs-number\">1</span>-np.exp(-<span class=\"hljs-number\">3</span>*h/r))\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">Euclidean</span>(<span class=\"hljs-params\">self, X, Y</span>):\n        all_dists, point_dists = [], []\n        <span class=\"hljs-keyword\">for</span> x,y <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">zip</span>(X, Y):\n          k = <span class=\"hljs-number\">0</span>\n          <span class=\"hljs-keyword\">for</span> k <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-built_in\">len</span>(X)):\n            h = np.linalg.norm(np.array([x, y]) - np.array([X[k], Y[k]))\n            point_dists.append(h)\n          all_dists.append(point_dists)\n          point_dists = []\n        <span class=\"hljs-keyword\">return</span> all_dists\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">gamma</span>(<span class=\"hljs-params\">self</span>):\n        distances = self.Euclidean(self.lats, self.lons)\n        differences = np.<span class=\"hljs-built_in\">abs</span>(self.values.reshape(-<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>) - self.values)\n        variogram_values = []\n        <span class=\"hljs-keyword\">for</span> h <span class=\"hljs-keyword\">in</span> np.unique(distances):\n            values_at_h = differences[(distances == h)]\n            variogram_values.append(np.mean(values_at_h**<span class=\"hljs-number\">2</span>))\n        <span class=\"hljs-keyword\">return</span> variogram_values, np.unique(distances)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">fit</span>(<span class=\"hljs-params\">self</span>):\n        experimental_variogram, distances = self.gamma()\n        fit_metrics = []\n        <span class=\"hljs-keyword\">for</span> nugget, sill, range_ <span class=\"hljs-keyword\">in</span> self.parameter_combinations:\n            theoretical_variogram_values = self.theoretical_variogram(distances, nugget, sill, range_)\n            fit_metric = MSE(experimental_variogram, theoretical_variogram_values)\n            fit_metrics.append((nugget, sill, range_, fit_metric))\n\n        self.optimal_pars = <span class=\"hljs-built_in\">min</span>(fit_metrics, key=<span class=\"hljs-keyword\">lambda</span> x: x[<span class=\"hljs-number\">3</span>])[:<span class=\"hljs-number\">3</span>]\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">predict</span>(<span class=\"hljs-params\">self, point</span>):\n        points = np.array([(x,y) <span class=\"hljs-keyword\">for</span> x,y <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">zip</span>(self.lats, self.lons)])\n        distances = np.linalg.norm(points - point, axis=<span class=\"hljs-number\">1</span>)\n        pars = <span class=\"hljs-built_in\">list</span>(self.optimal_pars)\n        pars.insert(<span class=\"hljs-number\">0</span>, distances)\n        weights = self.theoretical_variogram(*pars)\n        weights /= np.<span class=\"hljs-built_in\">sum</span>(weights)\n        <span class=\"hljs-keyword\">return</span> np.dot(weights, self.values)\n\nkriging = OrdinaryKriging(df.LATITUDE.values, df.LONGITUDE.values, df.TAVG.values)\n\nkriging.fit()\n</code></pre>\n<!-- TIL ìˆ˜í‰ -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>ì´ì œ ê° í•¨ìˆ˜ë¥¼ ë”°ë¡œ ì‚´í´ë´…ì‹œë‹¤.\n<strong>init</strong> í•¨ìˆ˜ëŠ” ì¢Œí‘œì™€ ê°’ì˜ ì´ˆê¸°í™” ì™¸ì— nugget, sill, rangeì˜ ê°€ëŠ¥í•œ ê°’ìœ¼ë¡œ êµ¬ì„±ëœ ì„¸ ê°œì˜ ë¦¬ìŠ¤íŠ¸ë¥¼ í¬í•¨í•©ë‹ˆë‹¤. ëª¨ë“  ê°€ëŠ¥í•œ ì¡°í•©ìœ¼ë¡œ ì„ì–´ì„œ parameter_combinations ë³€ìˆ˜ì— ì €ì¥ë©ë‹ˆë‹¤. ìš°ë¦¬ëŠ” ë‚˜ì¤‘ì— ìµœì  ê°’ì„ ì°¾ì„ ë•Œ í•„ìš”í•  ê²ƒì…ë‹ˆë‹¤.</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__init__</span>(<span class=\"hljs-params\">self, lats, lons, values</span>):\n        self.lats = lats\n        self.lons= lons\n        self.values = values\n\n        self.nugget_values = [<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>]\n        self.sill_values = [<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">5</span>]\n        self.range_values = [<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">5</span>]\n\n        <span class=\"hljs-comment\"># ë§ì¶”ê¸° ìœ„í•œ ëª¨ë“  íŒŒë¼ë¯¸í„° ê°’ ì¡°í•© ìƒì„±</span>\n        self.parameter_combinations = <span class=\"hljs-built_in\">list</span>(product(self.nugget_values, self.sill_values, self.range_values))\n        self.optimal_pars = <span class=\"hljs-literal\">None</span>\n</code></pre>\n<p>ë‘ ë²ˆì§¸ í•¨ìˆ˜ì¸ theoretical_variogramì€ ì´ì „ì— ì–¸ê¸‰ëœ ê³µì‹ ì¤‘ í•˜ë‚˜ë¥¼ íŒŒì´ì¬ìœ¼ë¡œ êµ¬í˜„í•œ ê²ƒì— ë¶ˆê³¼í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” ì§€ìˆ˜ í•¨ìˆ˜ì…ë‹ˆë‹¤ (í•˜ì§€ë§Œ ë‹¤ë¥¸ í•¨ìˆ˜ì— ëŒ€í•œ ì½”ë“œë¥¼ ì‘ì„±í•˜ì—¬ ê²°ê³¼ë¥¼ ë¹„êµí•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤):</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">theoretical_variogram</span>(<span class=\"hljs-params\">self, h, nugget, sill, r</span>):\n <span class=\"hljs-keyword\">return</span> nugget + (sill-nugget) * (<span class=\"hljs-number\">1</span>-np.exp(-<span class=\"hljs-number\">3</span>*h/r))\n</code></pre>\n<!-- TIL ìˆ˜í‰ -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>ì„¸ ë²ˆì§¸ í´ë˜ìŠ¤ ë©”ì„œë“œëŠ” ìœ í´ë¦¬ë””ì•ˆì…ë‹ˆë‹¤. ì´ê²ƒì€ NNê³¼ IDWë¥¼ ìœ„í•´ ë§Œë“  í•¨ìˆ˜ì˜ ë³€ê²½ëœ ë²„ì „ì…ë‹ˆë‹¤. ì´ë²ˆì—ëŠ” ì ê³¼ ëª¨ë“  ë‹¤ë¥¸ ì  ì‚¬ì´ì˜ ê±°ë¦¬ë¥¼ ë‚˜íƒ€ë‚´ëŠ” (n,n) í–‰ë ¬ì„ ë°˜í™˜í•©ë‹ˆë‹¤ (ê° í–‰ì—ì„œ í•˜ë‚˜ì˜ ê°’ì€ 0ì´ë©°, ì ê³¼ ê·¸ ìì‹  ì‚¬ì´ì˜ ê±°ë¦¬ëŠ” 0ì…ë‹ˆë‹¤).</p>\n<pre><code class=\"hljs language-js\">def <span class=\"hljs-title class_\">Euclidean</span>(self, X, Y):\n        all_dists, point_dists = [], []\n        <span class=\"hljs-keyword\">for</span> x, y <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">zip</span>(X, Y):\n          k = <span class=\"hljs-number\">0</span>\n          <span class=\"hljs-keyword\">for</span> k <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">range</span>(<span class=\"hljs-title function_\">len</span>(X)):\n            h = np.<span class=\"hljs-property\">linalg</span>.<span class=\"hljs-title function_\">norm</span>(np.<span class=\"hljs-title function_\">array</span>([x, y]) - np.<span class=\"hljs-title function_\">array</span>([X[k], Y[k]))\n            point_dists.<span class=\"hljs-title function_\">append</span>(h)\n          all_dists.<span class=\"hljs-title function_\">append</span>(point_dists)\n          point_dists = []\n        <span class=\"hljs-keyword\">return</span> all_dists\n</code></pre>\n<p>ë„¤ ë²ˆì§¸ í•¨ìˆ˜ëŠ” fittingì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” ì‹¤í—˜ì  ë³€ë¦¬ì˜¤ê·¸ë¨ ê°’ê³¼ ìœ í´ë¦¬ë””ì•ˆ ê±°ë¦¬ë¥¼ ì–»ìŠµë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ sill, range ë° nuggetì˜ ì¡°í•©ì„ ë°˜ë³µí•˜ë©´ì„œ ì´ë¡ ì  ë³€ë¦¬ì˜¤ê·¸ë¨ ê°’ê³¼ ì‹¤í—˜ì  ê°’ ì‚¬ì´ì˜ í‰ê·  ì œê³± ì˜¤ì°¨(Mean Squared Error, MSE) ì¶”ì •ì„ ê³„ì‚°í•©ë‹ˆë‹¤ (ë‹¤ë¥¸ ë©”íŠ¸ë¦­ì„ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤). ê·¸ëŸ° ë‹¤ìŒ ìµœì ì˜ ë§¤ê°œë³€ìˆ˜ë¥¼ í´ë˜ìŠ¤ ë³€ìˆ˜ optimal_parsì— ì €ì¥í•©ë‹ˆë‹¤.</p>\n<pre><code class=\"hljs language-js\">def <span class=\"hljs-title function_\">fit</span>(self):\n        experimental_variogram, distances = self.<span class=\"hljs-title function_\">gamma</span>()\n        fit_metrics = []\n        <span class=\"hljs-keyword\">for</span> nugget, sill, range_ <span class=\"hljs-keyword\">in</span> self.<span class=\"hljs-property\">parameter_combinations</span>:\n            theoretical_variogram_values = self.<span class=\"hljs-title function_\">theoretical_variogram</span>(distances, nugget, sill, range_)\n            fit_metric = <span class=\"hljs-title function_\">MSE</span>(experimental_variogram, theoretical_variogram_values)\n            fit_metrics.<span class=\"hljs-title function_\">append</span>((nugget, sill, range_, fit_metric))\n\n        self.<span class=\"hljs-property\">optimal_pars</span> = <span class=\"hljs-title function_\">min</span>(fit_metrics, key=lambda <span class=\"hljs-attr\">x</span>: x[<span class=\"hljs-number\">3</span>])[:<span class=\"hljs-number\">3</span>]\n</code></pre>\n<!-- TIL ìˆ˜í‰ -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>ë§ˆì§€ë§‰ìœ¼ë¡œ ê°€ì¥ ì¤‘ìš”í•œ í•¨ìˆ˜ëŠ” ì˜ˆì¸¡ì…ë‹ˆë‹¤. ì…ë ¥ìœ¼ë¡œ ì  (lat;lon)ì„ ë°›ì•„ì„œ í•´ë‹¹ ì ê³¼ ë‹¤ë¥¸ ì•Œë ¤ì§„ ê°’ë“¤ ì‚¬ì´ì˜ ê±°ë¦¬ë¥¼ ì¶”ì •í•©ë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ, ì•ì„œ ì–»ì€ ìµœì  íŒŒë¼ë¯¸í„°ë¥¼ ì „ë‹¬í•˜ì—¬ ì´ë¡ ì  ë³€ì´ê·¸ë¨ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê³  ê°€ì¤‘ì¹˜ë¥¼ ì¶œë ¥ê°’ìœ¼ë¡œ ë°›ìŠµë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ ê°€ì¤‘ í‰ê· ì„ ê³„ì‚°í•˜ê³  ë°˜í™˜í•©ë‹ˆë‹¤.</p>\n<pre><code class=\"hljs language-js\">def <span class=\"hljs-title function_\">predict</span>(self, point):\n        points = np.<span class=\"hljs-title function_\">array</span>([(x,y) <span class=\"hljs-keyword\">for</span> x,y <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">zip</span>(self.<span class=\"hljs-property\">lats</span>, self.<span class=\"hljs-property\">lons</span>)])\n        distances = np.<span class=\"hljs-property\">linalg</span>.<span class=\"hljs-title function_\">norm</span>(points - point, axis=<span class=\"hljs-number\">1</span>)\n        pars = <span class=\"hljs-title function_\">list</span>(self.<span class=\"hljs-property\">optimal_pars</span>)\n        pars.<span class=\"hljs-title function_\">insert</span>(<span class=\"hljs-number\">0</span>, distances)\n        weights = self.<span class=\"hljs-title function_\">theoretical_variogram</span>(*pars)\n        weights /= np.<span class=\"hljs-title function_\">sum</span>(weights)\n        <span class=\"hljs-keyword\">return</span> np.<span class=\"hljs-title function_\">dot</span>(weights, self.<span class=\"hljs-property\">values</span>)\n</code></pre>\n<p>ì´ì œ ëª¨ë“  ì˜ˆì¸¡ê°’ì„ ìˆ˜ì§‘í•˜ê³  ì§€ë„ë¥¼ ì‹œê°í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>\n<pre><code class=\"hljs language-js\">row, grid = [], []\n<span class=\"hljs-keyword\">for</span> lat <span class=\"hljs-keyword\">in</span> <span class=\"hljs-attr\">LAT</span>:\n  <span class=\"hljs-keyword\">for</span> lon <span class=\"hljs-keyword\">in</span> <span class=\"hljs-attr\">LON</span>:\n    row.<span class=\"hljs-title function_\">append</span>(kriging.<span class=\"hljs-title function_\">predict</span>(np.<span class=\"hljs-title function_\">array</span>([lat, lon])))\n  grid.<span class=\"hljs-title function_\">append</span>(row)\n  row=[]\n\nds = xr.<span class=\"hljs-title class_\">Dataset</span>(\n    {<span class=\"hljs-string\">'TAVG'</span>: ([<span class=\"hljs-string\">'lat'</span>, <span class=\"hljs-string\">'lon'</span>], grid)},\n    coords={<span class=\"hljs-string\">'lat'</span>: <span class=\"hljs-variable constant_\">LAT</span>, <span class=\"hljs-string\">'lon'</span>: <span class=\"hljs-variable constant_\">LON</span>})\n\nfig, ax = plt.<span class=\"hljs-title function_\">subplots</span>(subplot_kw=<span class=\"hljs-title function_\">dict</span>(projection=ccrs.<span class=\"hljs-title class_\">PlateCarree</span>()), figsize=(<span class=\"hljs-number\">16</span>, <span class=\"hljs-number\">9</span>))\nds.<span class=\"hljs-title function_\">where</span>(rg).<span class=\"hljs-property\">TAVG</span>.<span class=\"hljs-title function_\">plot</span>(ax=ax, alpha=<span class=\"hljs-number\">0.6</span>)\ngdf.<span class=\"hljs-title function_\">plot</span>(ax=ax, color=<span class=\"hljs-string\">'r'</span>, markersize=<span class=\"hljs-number\">85</span>)\nax.<span class=\"hljs-title function_\">gridlines</span>(draw_labels=<span class=\"hljs-title class_\">True</span>,linewidth=<span class=\"hljs-number\">2</span>, color=<span class=\"hljs-string\">'black'</span>, alpha=<span class=\"hljs-number\">0.5</span>, linestyle=<span class=\"hljs-string\">'--'</span>)\nplt.<span class=\"hljs-title function_\">show</span>()\n</code></pre>\n<!-- TIL ìˆ˜í‰ -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p><img src=\"/TIL/assets/img/2024-07-09-3PopularMethodsforSpatialInterpolation_15.png\" alt=\"image\"></p>\n<p>ìœ„ì™€ ê°™ì´ ê²°ê³¼ê°€ IDWì—ì„œ ì–»ì€ ê²ƒê³¼ëŠ” ê½¤ ë‹¤ë¥´ë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì–´ìš”. í¬ë¦¬ê¹…ì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ ë§¤ê°œë³€ìˆ˜ëŠ” ì„ íƒí•œ ì´ë¡ ì  ë³€ì´ê·¸ë¨ ì¢…ë¥˜ì¸ë°, ì´ëŠ” ì‚¬ì‹¤ ìƒ ì˜ˆì¸¡ëœ ê°’ê³¼ ê±°ë¦¬ ê°„ì˜ ê´€ê³„ë¥¼ ì •ì˜í•©ë‹ˆë‹¤. ì½”ë“œë¥¼ ì‚¬ìš©í•˜ê¸° ê·€ì°®ìœ¼ì‹œê±°ë‚˜ ì§ì ‘ ì‘ì„±í•˜ê³  ì‹¶ì§€ ì•Šë‹¤ë©´ ë§ì€ ë³€ì´ê·¸ë¨ ëª¨ë¸ì˜ êµ¬í˜„ì„ ê°–ê³  ìˆëŠ” PyKrige ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚´í´ë³´ì„¸ìš”.</p>\n<p>ì´ ê¸€ì´ ìœ ìµí•˜ê³  í†µì°°ë ¥ì„ ì¤¬ìœ¼ë©´ ì¢‹ê² ì–´ìš”!</p>\n<!-- TIL ìˆ˜í‰ -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>ì €ì˜ Mediumì— ì˜¬ë¦° ëª¨ë“  ê²Œì‹œë¬¼ì€ ë¬´ë£Œë¡œ ê³µê°œë˜ì–´ ìˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ì—¬ê¸°ì„œ ì œë¥¼ íŒ”ë¡œìš°í•´ ì£¼ì‹¤ ê²½ìš° ì •ë§ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤!</p>\n<p>ì°¸ê³ ë¡œ, ì €ëŠ” (ì§€ë¦¬)ë°ì´í„° ê³¼í•™, ê¸°ê³„í•™ìŠµ/ì¸ê³µì§€ëŠ¥, ê·¸ë¦¬ê³  ê¸°í›„ ë³€í™”ì— ëŒ€í•´ ì—´ì •ì ìœ¼ë¡œ ê³µë¶€í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë§Œì•½ í•¨ê»˜ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ê³  ì‹¶ë‹¤ë©´ LinkedInì—ì„œ ì—°ë½ ì£¼ì„¸ìš”.</p>\n<p>ğŸ›°ï¸ë” ë§ì€ ì†Œì‹ì„ ìœ„í•´ íŒ”ë¡œìš° í•´ì£¼ì„¸ìš”ğŸ›°ï¸</p>\n</body>\n</html>\n"},"__N_SSG":true}