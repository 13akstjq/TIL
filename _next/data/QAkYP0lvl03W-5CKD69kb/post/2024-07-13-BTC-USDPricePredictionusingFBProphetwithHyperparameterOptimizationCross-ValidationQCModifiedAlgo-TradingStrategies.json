{"pageProps":{"post":{"title":"FB Prophet과 하이퍼파라미터 최적화를 사용한 BTC-USD 가격 예측, 교차 검증 QC, 수정된 알고리즘 거래 전략","description":"","date":"2024-07-13 19:54","slug":"2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies","content":"\n\n<img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_0.png\" />\n\n- 본 글은 이전 연구를 이어가며, Python에서 Facebook의 Prophet을 활용한 BTC-USD 가격 예측에 대한 자세한 프레임워크를 개발하는 것을 목표로 합니다 [1–5] (참고 문헌).\n- 현재의 비교 분석은 시간 시리즈 교차 검증 QC를 기반으로 한 히스토리컬 데이터를 사용하여 예측 오차를 측정하는 HPO 또는 모델 튜닝에 대해 자세히 살펴봅니다.\n- 시뮬레이션된 BTC 예측에 추가되어, FB Prophet을 사용하여 크립토 알고트레이딩 전략을 최적화하는 방법에 대해 Buy & Hold 기준과 비교하여 설명합니다. 자세한 내용은 여기에서 확인하세요.\n\n## 비즈니스 케이스\n\n- 적절한 암호화폐 예측은 크립토 트레이더들에게 큰 이익을 가져다줄 수 있으며 효과적인 리스크 관리를 제공할 수 있습니다.\n- 최근 BTC는 많은 가격 예측의 주제가 되었습니다.\n- CoinCodex: BTC의 역사적인 가격 변동과 BTC 하프 사이클을 기반으로, BTC가 상한 가격 대상에 도달한다면 2025년까지 201.59%의 이익을 올릴 수 있습니다. 한편, BTC의 가격은 내년에 $173,833까지 상승할 것으로 예측됩니다.\n- 하지만 비트코인 가격이 2030년까지 1백만 달러에 도달할까요?\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n## FB Prophet에 대해\n\n- FB Prophet은 추세/계절성 모델링과 베이지안 추론에 기초한 시계열 데이터 예측 절차입니다.\n- 강한 계절 효과가 있는 시계열에 가장 적합하며, 누락 된 데이터, 이상치 및 추세 변동에 견고합니다.\n- 예측 모델은 다음과 같은 4가지 구성 요소로 구성됩니다: 추세(장기간 동안의 변화), 계절성(주기적 또는 단기 변화), 휴일 및 특정 비즈니스에만 해당되는 조건부 변경 사항.\n- 새로운 사용자에게 특히 흥미롭습니다. 모델의 하이퍼파라미터를 자동으로 찾아내는 능력과 쉬운 사용성으로 유명합니다.\n- 추가적인 회귀 변수, 곱셈 계절성, 비일일 데이터, 불확실성 측정 및 진단이 포함됩니다.\n\n이 라이브러리를 사용하여 BTC-USD 가격 예측의 구체적 내용을 살펴봅시다.\n\n## 주요 설치 방법\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n- pip은 저희가 선호하는 설치 프로그램입니다. Python 3.4부터 Python 이진 설치 프로그램에 기본적으로 포함되어 있습니다.\n- Jupyter Notebook을 실행하고 필수 Python 라이브러리를 설치합니다.\n\n```python\n!pip install statsmodels, math, yfinance, prophet, plotly,matplotlib, itertools\n```\n\n## Imports & Settings\n\n- 코드를 성공적으로 실행할 수 있도록 필요한 라이브러리 및 종속성이 제대로 설치되어 있는지 확인하세요.\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\nimport pandas as pd\nimport plotly.express as px\nimport requests\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom math import floor\nfrom termcolor import colored as cl\nimport yfinance as yf\nimport datetime\nfrom datetime import date, timedelta\n\n# Prophet 라이브러리 불러오기\nfrom prophet import Prophet\n\nplt.rcParams['figure.figsize'] = (12, 6)\nplt.style.use('fivethirtyeight')\n\nimport os\nos.chdir('작업경로')    # 작업 디렉토리 설정\nos.getcwd()\n```\n\n## 주식 데이터 입력\n\n- 730일의 BTC-USD 이력 데이터 입력\n\n```js\ntoday = date.today()\n\nd1 = today.strftime(\"%Y-%m-%d\")\nend_date = d1\nd2 = date.today() - timedelta(days=730)\nd2 = d2.strftime(\"%Y-%m-%d\")\nstart_date = d2\n\ndata = yf.download('BTC-USD', \n                      start=start_date, \n                      end=end_date, \n                      progress=False)\ndata[\"Date\"] = data.index\ndata = data[[\"Date\", \"Open\", \"High\", \"Low\", \"Close\", \"Adj Close\", \"Volume\"]]\ndata.reset_index(drop=True, inplace=True)\ndata.tail()\n\n|   Date    |    Open    |    High    |   Low    |   Close    |  Adj Close  |   Volume      |\n|----------|------------|------------|---------|------------|-------------|--------------|\n|2024-07-02| 62,844.41  | 63,203.36  | 61,752.75|   62,029.02 |  62,029.02  |  20151616992  |\n|2024-07-03| 62,034.33  | 62,187.70  | 59,419.39|   60,173.92 |  60,173.92  |  29756701685  |\n|2024-07-04| 60,147.14  | 60,399.68  | 56,777.80|   56,977.70 |  56,977.70  |  41149609230  |\n|2024-07-05| 57,022.81  | 57,497.15  | 53,717.38|   56,662.38 |  56,662.38  |  55417544033  |\n|2024-07-06| 56,659.07  | 58,472.55  | 56,038.96|   58,303.54 |  58,303.54  |  20610320577  |\n```   \n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n- 종가 그래프 그리기\n\n```js\nplt.plot(data['Date'], data['Close'])\nplt.xlabel('날짜')\nplt.ylabel('종가(USD)')\nplt.title('BTC-USD 종가')\n```\n\n![BTC-USD Close Price](/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_1.png)\n\n## 데이터 준비\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n- Box Cox 변환을 사용하여 비정규적인 종속 변수인 Close 가격을 정규분포 형태로 변환합니다.\n\n```js\n### Box Cox 변환\nfrom statsmodels.base.transform import BoxCox\n\nbc = BoxCox()\ndata[\"Close\"], lmbda = bc.transform_boxcox(data[\"Close\"])\n```\n\n- Prophet에 입력 데이터 만들기\n\n```js\ndata1 = data[[\"Date\", \"Close\"]]\ndata1.columns = [\"ds\", \"y\"]\n\ndata1.tail()\n\n    ds          y\n725 2024-07-02 42.381398\n726 2024-07-03 42.086488\n727 2024-07-04 41.560999\n728 2024-07-05 41.507898\n729 2024-07-06 41.781750\n```\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n- Prophet에 입력해야 하는 것은 항상 ds와 y 두 개의 열이 있는 데이터프레임입니다. ds (날짜) 열은 Pandas에서 예상하는 형식이어야 합니다. 날짜의 경우 YYYY-MM-DD이고, 타임스탬프의 경우 YYYY-MM-DD HH:MM:SS입니다. y 열은 숫자이어야 하며, 예측하려는 측정 값을 나타냅니다.\n\n## Max Cap과 5% 표준편차를 사용한 Prophet\n\n- 매년 곱셈 계절성과 로지스틱 성장이 있는 모델 매개변수 목록을 생성합니다.\n\n```js\nmodel_param = {\n    \"daily_seasonality\": False,\n    \"weekly_seasonality\": False,\n    \"yearly_seasonality\": True,\n    \"seasonality_mode\": \"multiplicative\",\n    \"growth\": \"logistic\"\n}\n```\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n- 기본적으로 Prophet은 가법 계절성 모델을 적합시키며, 계절성의 영향이 예측을 얻기 위해 추세에 더해집니다. 위 모델에서 계절성은 Prophet이 가정한 것처럼 일정한 가법적 요소가 아니라 추세와 함께 증가하는 다중 계절성입니다.\n- 기본적으로 Prophet은 예측을 위해 선형 모델을 사용합니다. 성장을 예측할 때 일반적으로 일정한 최대 달성 가능 지점이 있습니다: 총 시장 규모 등. 이를 운반 용량이라고하며, 예측은 이 지점에서 포화되어야 합니다. Prophet은 지정된 운반 용량을 갖춘 로지스틱 성장 트렌드 모델을 사용하여 예측을 수행할 수 있습니다.\n- 모델 실행\n\n```js\nmodel = Prophet(**model_param)\n```\n\n- 로지스틱 성장을 사용하기 때문에 예측에 대한 상한선 또는 상한 값을 설정합니다. 상한값은 가격의 최대값에 표준편차의 5%를 더하는 것입니다.\n\n```js\ndata1['cap'] = data1[\"y\"].max() + data1[\"y\"].std() * 0.05\n```\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n- 모델을 맞추는 중\n\n```js\nmodel.fit(data1)\n```\n\n- 위의 캡을 사용하여 샘플 내부 및 1년 장기 예측 생성\n\n```js\nfuture= model.make_future_dataframe(periods=365)\n\nfuture['cap'] = data1['cap'].max()\n\nforecast= model.predict(future)\n```\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n- 중요한 구성 요소를 사용하여 (ds-y) 도메인 예측을 플로팅합니다.\n\n```js\nmodel.plot(forecast,figsize=(14, 8))\n```\n\n![BTC-USD 가격 예측](/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_2.png)\n\n```js\nmodel.plot_components(forecast,figsize=(16, 10));\n```\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n이전에 사용하던 table tag를 Markdown 형식으로 변경해보세요.\n\n## Prophet with Monthly/Quarterly Seasonality & US Holidays\n\n- Prophet를 월별/분기별 계절성 및 미국 공휴일과 함께 실행 중\n\n```js\nmodel = Prophet(**model_param)\n\nmodel.add_seasonality(name=\"monthly\", period=30, fourier_order=10)\nmodel.add_seasonality(name=\"quarterly\", period=92.25, fourier_order=10)\n\nmodel.add_country_holidays(\"US\")\n\nmodel.fit(data1)\n\n# 미래 데이터프레임 생성\nfuture = model.make_future_dataframe(periods=365)\nfuture['cap'] = data1['cap'].max()\n\nforecast = model.predict(future)\n\nfrom prophet.plot import plot\n\nplot(model, forecast, figsize=(14, 8))\n```\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\nfrom prophet.plot import plot_components\n\nplot_components(model, forecast, figsize=(10, 12))\n```\n\n위의 코드 블록은 Prophet 모델을 사용하여 예측한 데이터의 구성요소를 시각화하는 부분입니다. 코드를 실행하여 예측 결과를 확인해보세요! 🚀\n\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n- 원래 가격을 얻기 위해 역 Box-Cox 변환을 수행합니다\n\n```js\nforecast[\"yhat\"]=bc.untransform_boxcox(x=forecast[\"yhat\"], lmbda=lmbda)\nforecast[\"yhat_lower\"]=bc.untransform_boxcox(x=forecast[\"yhat_lower\"], lmbda=lmbda)\nforecast[\"yhat_upper\"]=bc.untransform_boxcox(x=forecast[\"yhat_upper\"], lmbda=lmbda)\nforecast.plot(x=\"ds\", y=[\"yhat_lower\", \"yhat\", \"yhat_upper\"])\n```\n\n![BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_7](/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_7.png)\n\n- 수동으로 선택한 cutoff를 사용하여 예측 성능의 몇 가지 유용한 통계를 계산합니다\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\nfrom prophet.diagnostics import cross_validation, performance_metrics\nfrom prophet.plot import plot_cross_validation_metric\ndf_cv = cross_validation(model, initial=\"600 days\", period=\"30 days\", horizon=\"90 days\")\ncutoffs = pd.to_datetime(['2022-09-01', '2023-05-01', '2024-03-01'])\ndf_cv2 = cross_validation(model, cutoffs=cutoffs, horizon='90 days')\nfig = plot_cross_validation_metric(df_cv2, metric='rmse')\n```\n\n<img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_8.png\" />\n\n- 성능 메트릭 요약 정보 출력\n\n```js\ndf_p = performance_metrics(df_cv2)\ndf_p.head()\n\n    horizon mse      rmse       mae       mape     mdape   smape coverage\n0 9 days 3805.462369 61.688430 29.520999 0.893692 0.118312 0.355870 0.0\n1 10 days 5382.793620 73.367524 37.768231 1.140719 0.168333 0.425770 0.0\n2 11 days 6754.735216 82.187196 45.409934 1.368028 0.286148 0.491224 0.0\n3 12 days 7678.053041 87.624500 51.465541 1.551664 0.352840 0.546114 0.0\n4 13 days 8071.329465 89.840578 55.027843 1.658574 0.426625 0.584601 0.0\n```\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n- MAPE 그래프 그리기\n\n```js\nfig = plot_cross_validation_metric(df_cv2, metric='mape')\n```\n\n<img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_9.png\" />\n\n- MAE 그래프 그리기\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\nfig = plot_cross_validation_metric(df_cv2, metric='mae')\n```\n\n![BTC-USD Price Prediction using FB Prophet with Hyperparameter Optimization Cross-Validation QC Modified Algorithm Trading Strategies](/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_10.png)\n\n## Hyperparameter Optimization (HPO)\n\n- Running HPO by adding monthly/quarterly seasonality and US holidays\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\nrmses = list()\n\n# 각 조합을 순회합니다.\nfor params in all_params:\n    m = Prophet(**params)\n    \n    m = m.add_seasonality(name='monthly', period=30, fourier_order=5)\n    m = m.add_seasonality(name='quarterly', period=92.25, fourier_order=10)\n\n    m.add_country_holidays(country_name='US')\n    \n    m.fit(data1)\n    \n    df_cv = cross_validation(m, initial='500 days', period='180 days', horizon='90 days')\n    \n    df_p = performance_metrics(df_cv, rolling_window=1)\n    \n    rmses.append(df_p['rmse'].values[0])\n    \n# 최적의 매개변수를 찾습니다.\nbest_params = all_params[np.argmin(rmses)]\n    \nprint(\"\\n최적의 매개변수는:\", best_params)\n```\n\n- 최적화된 모델을 피팅하고 해당하는 예측 생성\n\n```js\nmodel_param1 = {\n    'daily_seasonality': False,\n    'weekly_seasonality': False,\n    'yearly_seasonality': True,\n    'seasonality_mode': 'multiplicative',\n    'growth': 'logistic',\n    'seasonality_prior_scale': 0.1,\n    'changepoint_prior_scale': 0.01\n}\n\nmodel1 = Prophet(**model_param1)\n\nmodel1.add_country_holidays('US')\n\nmodel1.fit(data1)\n\n# 향후 데이터 프레임 생성\nfuture = model1.make_future_dataframe(periods=365)\nfuture['cap'] = data1['cap'].max()\n\nforecast = model1.predict(future)\n```\n\n- 원래 가격을 얻기 위해 역 Box-Cox 변환을 적용합니다.\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n js\nforecast[\"yhat\"]=bc.untransform_boxcox(x=forecast[\"yhat\"], lmbda=lmbda)\nforecast[\"yhat_lower\"]=bc.untransform_boxcox(x=forecast[\"yhat_lower\"], lmbda=lmbda)\nforecast[\"yhat_upper\"]=bc.untransform_boxcox(x=forecast[\"yhat_upper\"], lmbda=lmbda)\nforecast.plot(x=\"ds\", y=[\"yhat_lower\", \"yhat\", \"yhat_upper\"])\n\n\n<img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_11.png\" />\n\n- 수동 cutoff로 교차 검증 QC 실행 중\n\n```js\ncutoffs = pd.to_datetime(['2022-09-01', '2023-05-01', '2024-03-01'])\ndf_cv2 = cross_validation(model1, cutoffs=cutoffs, horizon='90 days')\nfig = plot_cross_validation_metric(df_cv2, metric='rmse')\n``` \n\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n\n![image](/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_12.png)\n\n\n```js\nfig = plot_cross_validation_metric(df_cv2, metric='mape')\n```\n\n![image](/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_13.png)\n\n```js\nfig = plot_cross_validation_metric(df_cv2, metric='mae')\n``` \n\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n\n![BTC-USD Price Prediction](/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_14.png)\n\n## 2020년부터 2024년까지 BTC-USD 역사적 데이터 준비\n\n- 박스-콕스(Box-Cox) 변환을 하지 않고 2020년 01월 01일부터 2024년 07월 07일까지의 BTC-USD 역사적 데이터를 준비합니다.\n\n```js\nimport pandas as pd\nimport numpy as np\nfrom prophet import Prophet\nimport matplotlib.pyplot as plt\nfrom functools import reduce\n\n%matplotlib inline\nimport warnings\nwarnings.filterwarnings('ignore')\n\npd.options.display.float_format = \"{:,.2f}\".format\n\nimport yfinance as yf\n\nticker = 'BTC-USD'\nstart_date = '2020-01-01'\n\nstock_price = yf.download(ticker, start=start_date)\nstock_price[\"날짜\"] = stock_price.index\nstock_price.tail()\n\n           Open      High      Low       Close    Adj Close   Volume      날짜\nDate       \n2024-07-03 62,034.33 62,187.70 59,419.39 60,173.92 60,173.92 29756701685 2024-07-03\n2024-07-04 60,147.14 60,399.68 56,777.80 56,977.70 56,977.70 41149609230 2024-07-04\n2024-07-05 57,022.81 57,497.15 53,717.38 56,662.38 56,662.38 55417544033 2024-07-05\n2024-07-06 56,659.07 58,472.55 56,038.96 58,303.54 58,303.54 20610320577 2024-07-06\n2024-07-07 58,239.43 58,367.18 56,644.89 57,198.04 57,198.04 19585976320 2024-07-07\n\nstock_price = stock_price[['날짜','Adj Close']]\n\nstock_price.columns = ['ds', 'y']\nstock_price.tail()\n\n           ds          y\nDate  \n2024-07-03 2024-07-03 60,173.92\n2024-07-04 2024-07-04 56,977.70\n2024-07-05 2024-07-05 56,662.38\n2024-07-06 2024-07-06 58,303.54\n2024-07-07 2024-07-07 57,198.04\n```\n\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n- 기본 Prophet 모델을 적합시키고 2027년 7월 7일까지의 예측을 생성합니다.\n\n```js\nmodel = Prophet()\nmodel.fit(stock_price)\nfuture = model.make_future_dataframe(1095, freq='d')\n\nfuture_boolean = future['ds'].map(lambda x : True if x.weekday() in range(0, 5) else False)\nfuture = future[future_boolean] \n\nfuture.tail()\nds\n2738 2027-07-01\n2739 2027-07-02\n2742 2027-07-05\n2743 2027-07-06\n2744 2027-07-07\n\nforecast = model.predict(future)\n#forecast.tail()\n\nmodel.plot(forecast);\r\n```\n\n![BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_15](/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_15.png)\n\n- 주요 구성 요소를 플롯합니다.\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n\nmodel.plot_components(forecast);\n\n\n![Forecast Plot](/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_16.png)\n\n- 원래 가격과 예측을 신뢰 구간과 함께 그래픽으로 표시합니다.\n\n```python\nstock_price_forecast = forecast[['ds', 'yhat', 'yhat_lower', 'yhat_upper']]\ndf = pd.merge(stock_price, stock_price_forecast, on='ds', how='right')\ndf.set_index('ds').plot(figsize=(16,8), color=['royalblue', \"#34495e\", \"#e74c3c\", \"#e74c3c\"], grid=True);\n```\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n\n![image](/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_17.png)\n\n- Date 열을 3 부분(연/월/일)으로 분할하고 Prophet 모델을 fitting합니다.\n\n```python\nstock_price['dayname'] = stock_price['ds'].dt.day_name()\nstock_price['month'] = stock_price['ds'].dt.month\nstock_price['year'] = stock_price['ds'].dt.year\nstock_price['month/year'] = stock_price['month'].map(str) + '/' + stock_price['year'].map(str) \n\nstock_price = pd.merge(stock_price, \n                       stock_price['month/year'].drop_duplicates().reset_index(drop=True).reset_index(),\n                       on='month/year',\n                       how='left')\n\nstock_price = stock_price.rename(columns={'index':'month/year_index'})\n\nloop_list = stock_price['month/year'].unique().tolist()\nmax_num = len(loop_list) - 1\nforecast_frames = []\n\nfor num, item in enumerate(loop_list):\n\n    if  num == max_num:\n        pass\n    else:\n        df = stock_price.set_index('ds')[\n             stock_price[stock_price['month/year'] == loop_list[0]]['ds'].min():\\\n             stock_price[stock_price['month/year'] == item]['ds'].max()]\n        \n        df = df.reset_index()[['ds', 'y']]\n        \n        model = Prophet()\n        model.fit(df)\n        \n        future = stock_price[stock_price['month/year_index'] == (num + 1)][['ds']]\n\n        forecast = model.predict(future)\n        forecast_frames.append(forecast)\n```\n\n- In-sample forecast와 원래 가격을 비교하는 그래프 그리기\n\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```python\n주가 예측 = reduce(lambda top, bottom: pd.concat([top, bottom], sort=False), 예측_프레임)\n주가 예측 = 주가 예측[['일자', '예측값', '예측값_하한', '예측값_상한']]\n\n데이터프레임 = pd.merge(주가[['일자','실제가격', '월/연도_인덱스']], 주가 예측, on='일자')\n데이터프레임['변동률'] = 데이터프레임['실제가격'].pct_change()\n데이터프레임.set_index('일자')[['실제가격', '예측값', '예측값_하한', '예측값_상한']].plot(figsize=(16,8), color=['royalblue', \"#34495e\", \"#e74c3c\", \"#e74c3c\"], grid=True)\n```\n\n![이미지](/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_18.png)\n\n- 교차 검증 수행 중\n\n```python\nfrom prophet.diagnostics import performance_metrics\n성능_메트릭스 = performance_metrics(df_cv)\n성능_메트릭스.head()\n\n  horizon  mse          rmse      mae     mape mdape smape coverage\n0 37 일    40,821,715.40 6,389.19 4,890.31 0.18 0.12 0.22 0.55\n1 38 일    41,109,990.95 6,411.71 4,913.96 0.18 0.12 0.22 0.55\n2 39 일    41,311,288.83 6,427.39 4,922.43 0.19 0.12 0.22 0.55\n3 40 일    41,641,137.72 6,452.99 4,943.99 0.19 0.12 0.22 0.55\n4 41 일    42,299,834.63 6,503.83 5,003.53 0.19 0.12 0.23 0.54\n\nfrom prophet.plot import plot_cross_validation_metric\n그래프 = plot_cross_validation_metric(df_cv, metric='rmse')\n```\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n\n![Plotting MAPE](/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_19.png)\n\n- MAPE 플로팅\n\n```js\nfig = plot_cross_validation_metric(df_cv, metric='mape')\n```\n\n![MAPE Plot](/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_20.png)\n\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n- MAE 그래프 플로팅하기\n\n```js\nfig = plot_cross_validation_metric(df_cv, metric='mae')\n```\n\n![MAE Plot](/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_21.png)\n\n- 그리드 검색 하이퍼파라미터 최적화 구현 및 MAE를 사용하여 모델 평가하기\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\n# 하이퍼파라미터 그리드 정의\nfrom sklearn.metrics import mean_absolute_error\nparam_grid = {\n    'seasonality_mode': ['additive', 'multiplicative'],\n    'changepoint_prior_scale': [0.01, 0.1, 1, 10],\n    'seasonality_prior_scale': [0.01, 0.1, 1, 10],\n}\n\n# 모델을 평가하기 위한 도우미 함수\ndef evaluate_model(model, metric_func):\n    df_cv = cross_validation(model, initial='1125 days', period='180 days', horizon='365 days')\n    return metric_func(df_cv['y'], df_cv['yhat'])\n\n# 그리드 서치\nbest_params = {}\nbest_score = float('inf')\n\nfor mode in param_grid['seasonality_mode']:\n    for cps in param_grid['changepoint_prior_scale']:\n        for sps in param_grid['seasonality_prior_scale']:\n            # 현재 하이퍼파라미터를 사용하여 모델 생성\n            m = Prophet(seasonality_mode=mode, changepoint_prior_scale=cps, seasonality_prior_scale=sps)\n            m.fit(stock_price)\n\n            # 평가 지표로 평가 모델(Mean Absolute Error 사용)\n            score = evaluate_model(m, mean_absolute_error)\n\n            # 필요 시 최적의 매개변수 업데이트\n            if score < best_score:\n                best_score = score\n                best_params = {\n                    'seasonality_mode': mode,\n                    'changepoint_prior_scale': cps,\n                    'seasonality_prior_scale': sps\n                }\n\nprint(best_params)\n\n{'seasonality_mode': 'additive', 'changepoint_prior_scale': 0.1, 'seasonality_prior_scale': 10}\n\nprint(best_score)\n8675.430008099349\n```\n\n- 최적화된 모델을 적합하고 1년 예측 생성\n\n```js\n# 최적의 매개변수로 모델 생성\nm_best = Prophet(seasonality_mode='additive', changepoint_prior_scale=0.1, seasonality_prior_scale=10)\nm_best.fit(stock_price)\n\n# 365일을 포함한 예측을 위한 데이터프레임\nfuture_best = m_best.make_future_dataframe(periods=365)\nforecast_best = m_best.predict(future_best)\n\n# 예측 데이터와 함께 그래프 그리기\nfig1 = m.plot(forecast_best)\nax = fig1.gca()\nax.set_title(\"BTC-USD 주가 예측\", size=25)\nax.set_xlabel(\"날짜\", size=15)\nax.set_ylabel(\"가격\", size=15)\n```\n\n![BTC-USD Stock Price Forecast](/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_22.png)\n\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n- scikit-learn과 Prophet 지표를 사용하여 교차 검증 QC 수행 중\n\n```js\n# 교차 검증 실행\nfrom sklearn.metrics import mean_squared_error\ndf_cv = cross_validation(m_best, initial='1125 days', period='180 days', horizon='365 days')\n\n# 성능 지표 계산\ndf_metrics = performance_metrics(df_cv)\n\n# MAE, MSE 및 RMSE 계산\nmae = mean_absolute_error(df_cv['y'], df_cv['yhat'])\nmse = mean_squared_error(df_cv['y'], df_cv['yhat'])\nrmse = np.sqrt(mse)\n\nprint(f'평균 절대 오차: {mae:.2f}')\nprint(f'평균 제곱 오차: {mse:.2f}')\nprint(f'제곱근 평균 제곱 오차: {rmse:.2f}')\n\n평균 절대 오차: 8675.43\n평균 제곱 오차: 107375840.73\n제곱근 평균 제곱 오차: 10362.23\n\nfrom prophet.plot import plot_cross_validation_metric\ndf_cv = cross_validation(m_best, initial='1125 days', period='180 days', horizon='365 days')\nfig = plot_cross_validation_metric(df_cv, metric='rmse')\r\n```\n\n<img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_23.png\" />\n\n- MAPE 플로팅하기\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```python\nfig = plot_cross_validation_metric(df_cv, metric='mape')\n```\n\n![image](/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_24.png)\n\n- MAE 그리기\n\n```python\nfig = plot_cross_validation_metric(df_cv, metric='mae')\n```\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n<img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_25.png\" />\n\n- In-Sample 및 Out-of-Sample 1년 Prophet 예측과 신뢰 구간을 동시에 플로팅합니다 (원래 스케일)\n\n```js\nloop_list = stock_price['month/year'].unique().tolist()\nmax_num = len(loop_list) - 1\nforecast_frames = []\n\nfor num, item in enumerate(loop_list):\n\n    if num == max_num:\n        pass\n    else:\n        df = stock_price.set_index('ds')[\n             stock_price[stock_price['month/year'] == loop_list[0]]['ds'].min():\\\n             stock_price[stock_price['month/year'] == item]['ds'].max()]\n        \n        df = df.reset_index()[['ds', 'y']]\n        \n        future = stock_price[stock_price['month/year_index'] == (num + 1)][['ds']]\n\n        forecast = m_best.predict(future)\n        forecast_frames.append(forecast)\n\nstock_price_forecast1 = reduce(lambda top, bottom: pd.concat([top, bottom], sort=False), forecast_frames)\nstock_price_forecast1 = stock_price_forecast1[['ds', 'yhat', 'yhat_lower', 'yhat_upper']]\n\ndf1 = pd.merge(stock_price[['ds','y', 'month/year_index']], stock_price_forecast1, on='ds')\ndf1['Percent Change'] = df1['y'].pct_change()\ndf1.set_index('ds')[['y', 'yhat', 'yhat_lower', 'yhat_upper']].plot(figsize=(16,8), color=['royalblue', \"#34495e\", \"#e74c3c\", \"#e74c3c\"], grid=True)\n```\n\n<img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_26.png\" />\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n## 수정된 암호화폐 알고리즘 트레이딩 전략\n\n- 다음과 같이 Prophet를 기반으로 한 암호화폐 알고리즘 트레이딩 전략을 수정합시다.\n\n```js\n#트레이딩 알고리즘\ndf=df1.copy()\ndf['Hold'] = (df['Percent Change'] + 1).cumprod()\ndf['Prophet'] = ((df['yhat'].shift(-1) > df['yhat']).shift(1) * (df['Percent Change']) + 1).cumprod()\ndf['Prophet Thresh'] = ((df['y'] < df['yhat_upper']).shift(1) * (df['Percent Change']) + 1).cumprod()\ndf['Seasonality'] = ((~df['ds'].dt.month.isin([8,9])).shift(1) * (df['Percent Change']) + 1).cumprod()\n\n(df.dropna().set_index('ds')[['Hold', 'Prophet', 'Prophet Thresh','Seasonality']] * 1000).plot(figsize=(16,8), grid=True)\n\nprint(f\"Hold = {df['Hold'].iloc[-1]*1000:,.0f}\")\nprint(f\"Prophet = {df['Prophet'].iloc[-1]*1000:,.0f}\")\nprint(f\"Prophet Thresh = {df['Prophet Thresh'].iloc[-1]*1000:,.0f}\")\nprint(f\"Seasonality = {df['Seasonality'].iloc[-1]*1000:,.0f}\")\n\nHold = 6,090\nProphet = 87,595\nProphet Thresh = 18,681\nSeasonality = 7,172\n```\n\n![이미지](/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_27.png)\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n- 여기에서 Prophet Thresh df['y']` df['yhat_lower'] 를 조건 df['y']` df['yhat_upper'] 로 바꿔 더 높은 예상 수익을 얻을 수 있었습니다.\n- 위의 Prophet 임계값을 최적화해 봅시다.\n\n```js\nperformance = {}\n\nfor x in np.linspace(.9,.99,10):\n    y = ((df['y'] < df['yhat_upper']*x).shift(1)* (df['퍼센트 변화']) + 1).cumprod()\n    performance[x] = y\n    \nbest_yhat = pd.DataFrame(performance).max().idxmax()\npd.DataFrame(performance).plot(figsize=(16,8), grid=True);\nf'최적의 Yhat = {best_yhat:,.2f}'\n\n'최적의 Yhat = 0.92'\n```\n\n![이미지](/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_28.png)\n\n- Best Yhat = 0.92로 백테스트 실행중\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\r\ndf['Optimized Prophet Thresh'] = ((df['y'] < df['yhat_upper'] * best_yhat).shift(1) * \r\n                                  (df['Percent Change']) + 1).cumprod()\r\n\r\n(df.dropna().set_index('ds')[['Hold', 'Prophet', 'Prophet Thresh', \r\n                              'Seasonality', 'Optimized Prophet Thresh']] * 1000).plot(figsize=(16,8), grid=True)\r\n\r\nprint(f\"Hold = {df['Hold'].iloc[-1]*1000:,.0f}\")\r\nprint(f\"Prophet = {df['Prophet'].iloc[-1]*1000:,.0f}\")\r\nprint(f\"Prophet Thresh = {df['Prophet Thresh'].iloc[-1]*1000:,.0f}\")\r\nprint(f\"Seasonality = {df['Seasonality'].iloc[-1]*1000:,.0f}\")\r\nprint(f\"Optimized Prophet Thresh = {df['Optimized Prophet Thresh'].iloc[-1]*1000:,.0f}\")\r\n\r\nHold = 6,090\r\nProphet = 87,595\r\nProphet Thresh = 18,681\r\nSeasonality = 7,172\r\nOptimized Prophet Thresh = 36,769\r\n```\r\n\r\n<img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_29.png\" />\r\n\r\n- 요약:\r\n    - ROI(Prophet)/ROI(Optimized Prophet Thresh) 약 2.4배\r\n    - ROI(Prophet)/ROI(Hold) 약 14.0배\r\n    - ROI(Optimized Prophet Thresh)/ROI(Prophet Thresh) 약 2.0배\r\n    - ROI(Prophet Thresh)/ROI(Seasonality) 약 2.5배\r\n    - ROI(Seasonality)/ROI(Hold) 약 1.0배\r\n\r\n## 프로핏 플롯리 시각화와 변경 지점들\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n- Prophet Plotly 시각화 옵션을 살펴봅시다.\n\n```js\nmydf=stock_price[['ds','y']]\nmm = Prophet()\nmm.fit(mydf)\nfuture = mm.make_future_dataframe(periods=365)\nforecast = mm.predict(future)\nfrom prophet.plot import plot_plotly\n\nplot_plotly(mm, forecast)\n```\n\n![Prophet Plotly Visualization](/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_30.png)\n\n- Plotly를 사용하여 Prophet 예측값과 변화점을 시각화합니다.\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\nfrom prophet.plot import plot_plotly\n\nplot_plotly(mm, forecast, changepoints=True)\n```\n\n![BTC-USD Price Prediction](/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_31.png)\n\n## 결론\n\n- 이 포스트에서는 Prophet (Facebook의 시계열 예측 라이브러리)를 사용하여 BTC-USD 가격을 예측하는 방법을 분석했습니다.\n- Yahoo Finance Python을 사용하여 2 개의 데이터 세트를 다운로드했습니다: (1) 2024-07-06까지 730 일 동안; (2) 2020-01-01부터 2024-07-07까지.\n- 데이터 세트 1을 사용하여 Box-Cox 변환과 미국의 휴일을 고려한 HPO를 테스트했습니다.\n- 데이터 세트 2를 다운로드하여 Prophet HPO 예측을 3 부분(연도, 월, 일)으로 분할 한 후 루프를 통해 다중 계절성 처리의 가치를 보여주었습니다.\n- Prophet 교차 검증 기능에 대한 자세한 내용을 탐구하여 두 데이터 세트에 대한 RMSE, MAPE 및 MAE와 같은 여러 주요 지표를 비교했습니다.\n- 데이터 세트 2: 최종 인샘플 Prophet 오류 지표는 다음과 같습니다.\n\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\nMean Absolute Error: 8675.43\nMean Squared Error: 107375840.73\nRoot Mean Squared Error: 10362.23\n```\n\n- 데이터 집합 2: 350일 주기의 외부 샘플 Prophet HPO 오류 메트릭\n\n```js\nMAPE 약 0.2-0.4, (MAE, RMSE) 약 10k-15k\n```\n\n- Plotly를 사용하여 Prophet 예측 시점의 변화를 그래픽으로 표현하는 가치를 설명했습니다.\n- 마지막으로, 데이터 집합 2를 사용하여 여러 유용한 Prophet 기반 백테스팅 암호화 알고리즘 트레이딩 전략을 Hold 벤치마크에 대해 탐색했습니다.\n- 백테스팅 결과는 ROI(Prophet)/ROI(Hold) 약 14.0임을 보여주었습니다.\n- 테스트 결과, Prophet 추세가 외부 데이터 없이도 정확히 추정될 수 있음을 확인했습니다. 시계열이 강력한 계절적 사업주기를 따른다는 것을 고려할 때, Prophet가 상당히 잘 작동한다는 것을 발견했습니다.\n- Prophet의 다른 통계 모델 및 기계 학습보다 중요한 장점 중 하나는 해석 가능성입니다. Prophet은 시간 기능을 따로 만들 필요가 없기 때문에 빠르게 좋은 기준을 제공합니다.\n- 전반적으로, 시계열이 비즈니스 주기를 따라간다면 Prophet를 기준 모델로 사용할 가치가 있다는 결론을 내립니다 (참고 자료 참조).\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n## 참고 자료\n\n- Facebook Prophet를 사용한 주식 가격 예측\n- Prophet 진단\n- Facebook Prophet 시작하기\n- Facebook Prophet로 시계열 예측\n- FB Prophet를 사용한 BTC 가격 예측\n\n## 연락처\n\n- 웹사이트\n- GitHub\n- Facebook\n- X/Twitter\n- Pinterest\n- Mastodon\n- Tumblr\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n## 고지사항\n\n- 다음 고지는 본 글의 정보가 교육 목적으로만 제공되었음을 명확히하며, 재정 또는 투자 자문으로 간주되어서는 안 된다는 것을 명시합니다.\n- 제공된 정보는 귀하 개인의 재정 상황, 목표 또는 리스크 허용도를 고려하지 않습니다.\n- 귀하가 취하는 투자 결정이나 조치는 전적으로 귀하의 책임입니다.\n- 재정 목표, 리스크 허용도 및 투자 기간에 따라 어떠한 투자의 적합성을 독립적으로 평가해야 합니다.\n- 특정 요구 사항에 맞는 맞춤 가이드 제공이 가능한 자격을 갖춘 재무 전문가의 조언을 구하는 것이 권장됩니다.\n- 제공된 도구, 데이터, 콘텐츠, 정보는 맞춤화되지 않았으며 어떤 개인의 투자 요구 사항에 부합하도록 제공된 것이 아니므로 정보 및 교육 목적만을 위해 제공됩니다.\n\n## 자료\n\nhttps://www.kaggle.com/code/alexkaggle95/stock-prices-forecast-plotly-prophet 나쁨\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nhttps://www.kaggle.com/code/ghazanfarali/stock-price-analysis-and-forecasting 페이지를 방문해 보세요! 해당 페이지에는 주식 가격 분석 및 예측과 관련된 정보가 있습니다. 좋은 정보를 얻을 수 있을 거예요!","ogImage":{"url":"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_0.png"},"coverImage":"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_0.png","tag":["Tech"],"readingTime":39},"content":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n</head>\n<body>\n<img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_0.png\">\n<ul>\n<li>본 글은 이전 연구를 이어가며, Python에서 Facebook의 Prophet을 활용한 BTC-USD 가격 예측에 대한 자세한 프레임워크를 개발하는 것을 목표로 합니다 [1–5] (참고 문헌).</li>\n<li>현재의 비교 분석은 시간 시리즈 교차 검증 QC를 기반으로 한 히스토리컬 데이터를 사용하여 예측 오차를 측정하는 HPO 또는 모델 튜닝에 대해 자세히 살펴봅니다.</li>\n<li>시뮬레이션된 BTC 예측에 추가되어, FB Prophet을 사용하여 크립토 알고트레이딩 전략을 최적화하는 방법에 대해 Buy &#x26; Hold 기준과 비교하여 설명합니다. 자세한 내용은 여기에서 확인하세요.</li>\n</ul>\n<h2>비즈니스 케이스</h2>\n<ul>\n<li>적절한 암호화폐 예측은 크립토 트레이더들에게 큰 이익을 가져다줄 수 있으며 효과적인 리스크 관리를 제공할 수 있습니다.</li>\n<li>최근 BTC는 많은 가격 예측의 주제가 되었습니다.</li>\n<li>CoinCodex: BTC의 역사적인 가격 변동과 BTC 하프 사이클을 기반으로, BTC가 상한 가격 대상에 도달한다면 2025년까지 201.59%의 이익을 올릴 수 있습니다. 한편, BTC의 가격은 내년에 $173,833까지 상승할 것으로 예측됩니다.</li>\n<li>하지만 비트코인 가격이 2030년까지 1백만 달러에 도달할까요?</li>\n</ul>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<h2>FB Prophet에 대해</h2>\n<ul>\n<li>FB Prophet은 추세/계절성 모델링과 베이지안 추론에 기초한 시계열 데이터 예측 절차입니다.</li>\n<li>강한 계절 효과가 있는 시계열에 가장 적합하며, 누락 된 데이터, 이상치 및 추세 변동에 견고합니다.</li>\n<li>예측 모델은 다음과 같은 4가지 구성 요소로 구성됩니다: 추세(장기간 동안의 변화), 계절성(주기적 또는 단기 변화), 휴일 및 특정 비즈니스에만 해당되는 조건부 변경 사항.</li>\n<li>새로운 사용자에게 특히 흥미롭습니다. 모델의 하이퍼파라미터를 자동으로 찾아내는 능력과 쉬운 사용성으로 유명합니다.</li>\n<li>추가적인 회귀 변수, 곱셈 계절성, 비일일 데이터, 불확실성 측정 및 진단이 포함됩니다.</li>\n</ul>\n<p>이 라이브러리를 사용하여 BTC-USD 가격 예측의 구체적 내용을 살펴봅시다.</p>\n<h2>주요 설치 방법</h2>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<ul>\n<li>pip은 저희가 선호하는 설치 프로그램입니다. Python 3.4부터 Python 이진 설치 프로그램에 기본적으로 포함되어 있습니다.</li>\n<li>Jupyter Notebook을 실행하고 필수 Python 라이브러리를 설치합니다.</li>\n</ul>\n<pre><code class=\"hljs language-python\">!pip install statsmodels, math, yfinance, prophet, plotly,matplotlib, itertools\n</code></pre>\n<h2>Imports &#x26; Settings</h2>\n<ul>\n<li>코드를 성공적으로 실행할 수 있도록 필요한 라이브러리 및 종속성이 제대로 설치되어 있는지 확인하세요.</li>\n</ul>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> pandas <span class=\"hljs-keyword\">as</span> pd\n<span class=\"hljs-keyword\">import</span> plotly.<span class=\"hljs-property\">express</span> <span class=\"hljs-keyword\">as</span> px\n<span class=\"hljs-keyword\">import</span> requests\n<span class=\"hljs-keyword\">import</span> numpy <span class=\"hljs-keyword\">as</span> np\n<span class=\"hljs-keyword\">import</span> matplotlib.<span class=\"hljs-property\">pyplot</span> <span class=\"hljs-keyword\">as</span> plt\n<span class=\"hljs-keyword\">from</span> math <span class=\"hljs-keyword\">import</span> floor\n<span class=\"hljs-keyword\">from</span> termcolor <span class=\"hljs-keyword\">import</span> colored <span class=\"hljs-keyword\">as</span> cl\n<span class=\"hljs-keyword\">import</span> yfinance <span class=\"hljs-keyword\">as</span> yf\n<span class=\"hljs-keyword\">import</span> datetime\n<span class=\"hljs-keyword\">from</span> datetime <span class=\"hljs-keyword\">import</span> date, timedelta\n\n# <span class=\"hljs-title class_\">Prophet</span> 라이브러리 불러오기\n<span class=\"hljs-keyword\">from</span> prophet <span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">Prophet</span>\n\nplt.<span class=\"hljs-property\">rcParams</span>[<span class=\"hljs-string\">'figure.figsize'</span>] = (<span class=\"hljs-number\">12</span>, <span class=\"hljs-number\">6</span>)\nplt.<span class=\"hljs-property\">style</span>.<span class=\"hljs-title function_\">use</span>(<span class=\"hljs-string\">'fivethirtyeight'</span>)\n\n<span class=\"hljs-keyword\">import</span> os\nos.<span class=\"hljs-title function_\">chdir</span>(<span class=\"hljs-string\">'작업경로'</span>)    # 작업 디렉토리 설정\nos.<span class=\"hljs-title function_\">getcwd</span>()\n</code></pre>\n<h2>주식 데이터 입력</h2>\n<ul>\n<li>730일의 BTC-USD 이력 데이터 입력</li>\n</ul>\n<pre><code class=\"hljs language-js\">today = date.<span class=\"hljs-title function_\">today</span>()\n\nd1 = today.<span class=\"hljs-title function_\">strftime</span>(<span class=\"hljs-string\">\"%Y-%m-%d\"</span>)\nend_date = d1\nd2 = date.<span class=\"hljs-title function_\">today</span>() - <span class=\"hljs-title function_\">timedelta</span>(days=<span class=\"hljs-number\">730</span>)\nd2 = d2.<span class=\"hljs-title function_\">strftime</span>(<span class=\"hljs-string\">\"%Y-%m-%d\"</span>)\nstart_date = d2\n\ndata = yf.<span class=\"hljs-title function_\">download</span>(<span class=\"hljs-string\">'BTC-USD'</span>, \n                      start=start_date, \n                      end=end_date, \n                      progress=<span class=\"hljs-title class_\">False</span>)\ndata[<span class=\"hljs-string\">\"Date\"</span>] = data.<span class=\"hljs-property\">index</span>\ndata = data[[<span class=\"hljs-string\">\"Date\"</span>, <span class=\"hljs-string\">\"Open\"</span>, <span class=\"hljs-string\">\"High\"</span>, <span class=\"hljs-string\">\"Low\"</span>, <span class=\"hljs-string\">\"Close\"</span>, <span class=\"hljs-string\">\"Adj Close\"</span>, <span class=\"hljs-string\">\"Volume\"</span>]]\ndata.<span class=\"hljs-title function_\">reset_index</span>(drop=<span class=\"hljs-title class_\">True</span>, inplace=<span class=\"hljs-title class_\">True</span>)\ndata.<span class=\"hljs-title function_\">tail</span>()\n\n|   <span class=\"hljs-title class_\">Date</span>    |    <span class=\"hljs-title class_\">Open</span>    |    <span class=\"hljs-title class_\">High</span>    |   <span class=\"hljs-title class_\">Low</span>    |   <span class=\"hljs-title class_\">Close</span>    |  <span class=\"hljs-title class_\">Adj</span> <span class=\"hljs-title class_\">Close</span>  |   <span class=\"hljs-title class_\">Volume</span>      |\n|----------|------------|------------|---------|------------|-------------|--------------|\n|<span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">02</span>| <span class=\"hljs-number\">62</span>,<span class=\"hljs-number\">844.41</span>  | <span class=\"hljs-number\">63</span>,<span class=\"hljs-number\">203.36</span>  | <span class=\"hljs-number\">61</span>,<span class=\"hljs-number\">752.75</span>|   <span class=\"hljs-number\">62</span>,<span class=\"hljs-number\">029.02</span> |  <span class=\"hljs-number\">62</span>,<span class=\"hljs-number\">029.02</span>  |  <span class=\"hljs-number\">20151616992</span>  |\n|<span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">03</span>| <span class=\"hljs-number\">62</span>,<span class=\"hljs-number\">034</span><span class=\"hljs-number\">.33</span>  | <span class=\"hljs-number\">62</span>,<span class=\"hljs-number\">187.70</span>  | <span class=\"hljs-number\">59</span>,<span class=\"hljs-number\">419.39</span>|   <span class=\"hljs-number\">60</span>,<span class=\"hljs-number\">173.92</span> |  <span class=\"hljs-number\">60</span>,<span class=\"hljs-number\">173.92</span>  |  <span class=\"hljs-number\">29756701685</span>  |\n|<span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">04</span>| <span class=\"hljs-number\">60</span>,<span class=\"hljs-number\">147.14</span>  | <span class=\"hljs-number\">60</span>,<span class=\"hljs-number\">399.68</span>  | <span class=\"hljs-number\">56</span>,<span class=\"hljs-number\">777.80</span>|   <span class=\"hljs-number\">56</span>,<span class=\"hljs-number\">977.70</span> |  <span class=\"hljs-number\">56</span>,<span class=\"hljs-number\">977.70</span>  |  <span class=\"hljs-number\">41149609230</span>  |\n|<span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">05</span>| <span class=\"hljs-number\">57</span>,<span class=\"hljs-number\">022</span><span class=\"hljs-number\">.81</span>  | <span class=\"hljs-number\">57</span>,<span class=\"hljs-number\">497.15</span>  | <span class=\"hljs-number\">53</span>,<span class=\"hljs-number\">717.38</span>|   <span class=\"hljs-number\">56</span>,<span class=\"hljs-number\">662.38</span> |  <span class=\"hljs-number\">56</span>,<span class=\"hljs-number\">662.38</span>  |  <span class=\"hljs-number\">55417544033</span>  |\n|<span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">06</span>| <span class=\"hljs-number\">56</span>,<span class=\"hljs-number\">659.07</span>  | <span class=\"hljs-number\">58</span>,<span class=\"hljs-number\">472.55</span>  | <span class=\"hljs-number\">56</span>,<span class=\"hljs-number\">038.96</span>|   <span class=\"hljs-number\">58</span>,<span class=\"hljs-number\">303.54</span> |  <span class=\"hljs-number\">58</span>,<span class=\"hljs-number\">303.54</span>  |  <span class=\"hljs-number\">20610320577</span>  |\n</code></pre>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<ul>\n<li>종가 그래프 그리기</li>\n</ul>\n<pre><code class=\"hljs language-js\">plt.<span class=\"hljs-title function_\">plot</span>(data[<span class=\"hljs-string\">'Date'</span>], data[<span class=\"hljs-string\">'Close'</span>])\nplt.<span class=\"hljs-title function_\">xlabel</span>(<span class=\"hljs-string\">'날짜'</span>)\nplt.<span class=\"hljs-title function_\">ylabel</span>(<span class=\"hljs-string\">'종가(USD)'</span>)\nplt.<span class=\"hljs-title function_\">title</span>(<span class=\"hljs-string\">'BTC-USD 종가'</span>)\n</code></pre>\n<p><img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_1.png\" alt=\"BTC-USD Close Price\"></p>\n<h2>데이터 준비</h2>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<ul>\n<li>Box Cox 변환을 사용하여 비정규적인 종속 변수인 Close 가격을 정규분포 형태로 변환합니다.</li>\n</ul>\n<pre><code class=\"hljs language-js\">### <span class=\"hljs-title class_\">Box</span> <span class=\"hljs-title class_\">Cox</span> 변환\n<span class=\"hljs-keyword\">from</span> statsmodels.<span class=\"hljs-property\">base</span>.<span class=\"hljs-property\">transform</span> <span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">BoxCox</span>\n\nbc = <span class=\"hljs-title class_\">BoxCox</span>()\ndata[<span class=\"hljs-string\">\"Close\"</span>], lmbda = bc.<span class=\"hljs-title function_\">transform_boxcox</span>(data[<span class=\"hljs-string\">\"Close\"</span>])\n</code></pre>\n<ul>\n<li>Prophet에 입력 데이터 만들기</li>\n</ul>\n<pre><code class=\"hljs language-js\">data1 = data[[<span class=\"hljs-string\">\"Date\"</span>, <span class=\"hljs-string\">\"Close\"</span>]]\ndata1.<span class=\"hljs-property\">columns</span> = [<span class=\"hljs-string\">\"ds\"</span>, <span class=\"hljs-string\">\"y\"</span>]\n\ndata1.<span class=\"hljs-title function_\">tail</span>()\n\n    ds          y\n<span class=\"hljs-number\">725</span> <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">02</span> <span class=\"hljs-number\">42.381398</span>\n<span class=\"hljs-number\">726</span> <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">03</span> <span class=\"hljs-number\">42.086488</span>\n<span class=\"hljs-number\">727</span> <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">04</span> <span class=\"hljs-number\">41.560999</span>\n<span class=\"hljs-number\">728</span> <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">05</span> <span class=\"hljs-number\">41.507898</span>\n<span class=\"hljs-number\">729</span> <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">06</span> <span class=\"hljs-number\">41.781750</span>\n</code></pre>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<ul>\n<li>Prophet에 입력해야 하는 것은 항상 ds와 y 두 개의 열이 있는 데이터프레임입니다. ds (날짜) 열은 Pandas에서 예상하는 형식이어야 합니다. 날짜의 경우 YYYY-MM-DD이고, 타임스탬프의 경우 YYYY-MM-DD HH:MM:SS입니다. y 열은 숫자이어야 하며, 예측하려는 측정 값을 나타냅니다.</li>\n</ul>\n<h2>Max Cap과 5% 표준편차를 사용한 Prophet</h2>\n<ul>\n<li>매년 곱셈 계절성과 로지스틱 성장이 있는 모델 매개변수 목록을 생성합니다.</li>\n</ul>\n<pre><code class=\"hljs language-js\">model_param = {\n    <span class=\"hljs-string\">\"daily_seasonality\"</span>: <span class=\"hljs-title class_\">False</span>,\n    <span class=\"hljs-string\">\"weekly_seasonality\"</span>: <span class=\"hljs-title class_\">False</span>,\n    <span class=\"hljs-string\">\"yearly_seasonality\"</span>: <span class=\"hljs-title class_\">True</span>,\n    <span class=\"hljs-string\">\"seasonality_mode\"</span>: <span class=\"hljs-string\">\"multiplicative\"</span>,\n    <span class=\"hljs-string\">\"growth\"</span>: <span class=\"hljs-string\">\"logistic\"</span>\n}\n</code></pre>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<ul>\n<li>기본적으로 Prophet은 가법 계절성 모델을 적합시키며, 계절성의 영향이 예측을 얻기 위해 추세에 더해집니다. 위 모델에서 계절성은 Prophet이 가정한 것처럼 일정한 가법적 요소가 아니라 추세와 함께 증가하는 다중 계절성입니다.</li>\n<li>기본적으로 Prophet은 예측을 위해 선형 모델을 사용합니다. 성장을 예측할 때 일반적으로 일정한 최대 달성 가능 지점이 있습니다: 총 시장 규모 등. 이를 운반 용량이라고하며, 예측은 이 지점에서 포화되어야 합니다. Prophet은 지정된 운반 용량을 갖춘 로지스틱 성장 트렌드 모델을 사용하여 예측을 수행할 수 있습니다.</li>\n<li>모델 실행</li>\n</ul>\n<pre><code class=\"hljs language-js\">model = <span class=\"hljs-title class_\">Prophet</span>(**model_param)\n</code></pre>\n<ul>\n<li>로지스틱 성장을 사용하기 때문에 예측에 대한 상한선 또는 상한 값을 설정합니다. 상한값은 가격의 최대값에 표준편차의 5%를 더하는 것입니다.</li>\n</ul>\n<pre><code class=\"hljs language-js\">data1[<span class=\"hljs-string\">'cap'</span>] = data1[<span class=\"hljs-string\">\"y\"</span>].<span class=\"hljs-title function_\">max</span>() + data1[<span class=\"hljs-string\">\"y\"</span>].<span class=\"hljs-title function_\">std</span>() * <span class=\"hljs-number\">0.05</span>\n</code></pre>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<ul>\n<li>모델을 맞추는 중</li>\n</ul>\n<pre><code class=\"hljs language-js\">model.<span class=\"hljs-title function_\">fit</span>(data1)\n</code></pre>\n<ul>\n<li>위의 캡을 사용하여 샘플 내부 및 1년 장기 예측 생성</li>\n</ul>\n<pre><code class=\"hljs language-js\">future= model.<span class=\"hljs-title function_\">make_future_dataframe</span>(periods=<span class=\"hljs-number\">365</span>)\n\nfuture[<span class=\"hljs-string\">'cap'</span>] = data1[<span class=\"hljs-string\">'cap'</span>].<span class=\"hljs-title function_\">max</span>()\n\nforecast= model.<span class=\"hljs-title function_\">predict</span>(future)\n</code></pre>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<ul>\n<li>중요한 구성 요소를 사용하여 (ds-y) 도메인 예측을 플로팅합니다.</li>\n</ul>\n<pre><code class=\"hljs language-js\">model.<span class=\"hljs-title function_\">plot</span>(forecast,figsize=(<span class=\"hljs-number\">14</span>, <span class=\"hljs-number\">8</span>))\n</code></pre>\n<p><img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_2.png\" alt=\"BTC-USD 가격 예측\"></p>\n<pre><code class=\"hljs language-js\">model.<span class=\"hljs-title function_\">plot_components</span>(forecast,figsize=(<span class=\"hljs-number\">16</span>, <span class=\"hljs-number\">10</span>));\n</code></pre>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>이전에 사용하던 table tag를 Markdown 형식으로 변경해보세요.</p>\n<h2>Prophet with Monthly/Quarterly Seasonality &#x26; US Holidays</h2>\n<ul>\n<li>Prophet를 월별/분기별 계절성 및 미국 공휴일과 함께 실행 중</li>\n</ul>\n<pre><code class=\"hljs language-js\">model = <span class=\"hljs-title class_\">Prophet</span>(**model_param)\n\nmodel.<span class=\"hljs-title function_\">add_seasonality</span>(name=<span class=\"hljs-string\">\"monthly\"</span>, period=<span class=\"hljs-number\">30</span>, fourier_order=<span class=\"hljs-number\">10</span>)\nmodel.<span class=\"hljs-title function_\">add_seasonality</span>(name=<span class=\"hljs-string\">\"quarterly\"</span>, period=<span class=\"hljs-number\">92.25</span>, fourier_order=<span class=\"hljs-number\">10</span>)\n\nmodel.<span class=\"hljs-title function_\">add_country_holidays</span>(<span class=\"hljs-string\">\"US\"</span>)\n\nmodel.<span class=\"hljs-title function_\">fit</span>(data1)\n\n# 미래 데이터프레임 생성\nfuture = model.<span class=\"hljs-title function_\">make_future_dataframe</span>(periods=<span class=\"hljs-number\">365</span>)\nfuture[<span class=\"hljs-string\">'cap'</span>] = data1[<span class=\"hljs-string\">'cap'</span>].<span class=\"hljs-title function_\">max</span>()\n\nforecast = model.<span class=\"hljs-title function_\">predict</span>(future)\n\n<span class=\"hljs-keyword\">from</span> prophet.<span class=\"hljs-property\">plot</span> <span class=\"hljs-keyword\">import</span> plot\n\n<span class=\"hljs-title function_\">plot</span>(model, forecast, figsize=(<span class=\"hljs-number\">14</span>, <span class=\"hljs-number\">8</span>))\n</code></pre>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">from</span> prophet.<span class=\"hljs-property\">plot</span> <span class=\"hljs-keyword\">import</span> plot_components\n\n<span class=\"hljs-title function_\">plot_components</span>(model, forecast, figsize=(<span class=\"hljs-number\">10</span>, <span class=\"hljs-number\">12</span>))\n</code></pre>\n<p>위의 코드 블록은 Prophet 모델을 사용하여 예측한 데이터의 구성요소를 시각화하는 부분입니다. 코드를 실행하여 예측 결과를 확인해보세요! 🚀</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<ul>\n<li>원래 가격을 얻기 위해 역 Box-Cox 변환을 수행합니다</li>\n</ul>\n<pre><code class=\"hljs language-js\">forecast[<span class=\"hljs-string\">\"yhat\"</span>]=bc.<span class=\"hljs-title function_\">untransform_boxcox</span>(x=forecast[<span class=\"hljs-string\">\"yhat\"</span>], lmbda=lmbda)\nforecast[<span class=\"hljs-string\">\"yhat_lower\"</span>]=bc.<span class=\"hljs-title function_\">untransform_boxcox</span>(x=forecast[<span class=\"hljs-string\">\"yhat_lower\"</span>], lmbda=lmbda)\nforecast[<span class=\"hljs-string\">\"yhat_upper\"</span>]=bc.<span class=\"hljs-title function_\">untransform_boxcox</span>(x=forecast[<span class=\"hljs-string\">\"yhat_upper\"</span>], lmbda=lmbda)\nforecast.<span class=\"hljs-title function_\">plot</span>(x=<span class=\"hljs-string\">\"ds\"</span>, y=[<span class=\"hljs-string\">\"yhat_lower\"</span>, <span class=\"hljs-string\">\"yhat\"</span>, <span class=\"hljs-string\">\"yhat_upper\"</span>])\n</code></pre>\n<p><img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_7.png\" alt=\"BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_7\"></p>\n<ul>\n<li>수동으로 선택한 cutoff를 사용하여 예측 성능의 몇 가지 유용한 통계를 계산합니다</li>\n</ul>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">from</span> prophet.<span class=\"hljs-property\">diagnostics</span> <span class=\"hljs-keyword\">import</span> cross_validation, performance_metrics\n<span class=\"hljs-keyword\">from</span> prophet.<span class=\"hljs-property\">plot</span> <span class=\"hljs-keyword\">import</span> plot_cross_validation_metric\ndf_cv = <span class=\"hljs-title function_\">cross_validation</span>(model, initial=<span class=\"hljs-string\">\"600 days\"</span>, period=<span class=\"hljs-string\">\"30 days\"</span>, horizon=<span class=\"hljs-string\">\"90 days\"</span>)\ncutoffs = pd.<span class=\"hljs-title function_\">to_datetime</span>([<span class=\"hljs-string\">'2022-09-01'</span>, <span class=\"hljs-string\">'2023-05-01'</span>, <span class=\"hljs-string\">'2024-03-01'</span>])\ndf_cv2 = <span class=\"hljs-title function_\">cross_validation</span>(model, cutoffs=cutoffs, horizon=<span class=\"hljs-string\">'90 days'</span>)\nfig = <span class=\"hljs-title function_\">plot_cross_validation_metric</span>(df_cv2, metric=<span class=\"hljs-string\">'rmse'</span>)\n</code></pre>\n<img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_8.png\">\n<ul>\n<li>성능 메트릭 요약 정보 출력</li>\n</ul>\n<pre><code class=\"hljs language-js\">df_p = <span class=\"hljs-title function_\">performance_metrics</span>(df_cv2)\ndf_p.<span class=\"hljs-title function_\">head</span>()\n\n    horizon mse      rmse       mae       mape     mdape   smape coverage\n<span class=\"hljs-number\">0</span> <span class=\"hljs-number\">9</span> days <span class=\"hljs-number\">3805.462369</span> <span class=\"hljs-number\">61.688430</span> <span class=\"hljs-number\">29.520999</span> <span class=\"hljs-number\">0.893692</span> <span class=\"hljs-number\">0.118312</span> <span class=\"hljs-number\">0.355870</span> <span class=\"hljs-number\">0.0</span>\n<span class=\"hljs-number\">1</span> <span class=\"hljs-number\">10</span> days <span class=\"hljs-number\">5382.793620</span> <span class=\"hljs-number\">73.367524</span> <span class=\"hljs-number\">37.768231</span> <span class=\"hljs-number\">1.140719</span> <span class=\"hljs-number\">0.168333</span> <span class=\"hljs-number\">0.425770</span> <span class=\"hljs-number\">0.0</span>\n<span class=\"hljs-number\">2</span> <span class=\"hljs-number\">11</span> days <span class=\"hljs-number\">6754.735216</span> <span class=\"hljs-number\">82.187196</span> <span class=\"hljs-number\">45.409934</span> <span class=\"hljs-number\">1.368028</span> <span class=\"hljs-number\">0.286148</span> <span class=\"hljs-number\">0.491224</span> <span class=\"hljs-number\">0.0</span>\n<span class=\"hljs-number\">3</span> <span class=\"hljs-number\">12</span> days <span class=\"hljs-number\">7678.053041</span> <span class=\"hljs-number\">87.624500</span> <span class=\"hljs-number\">51.465541</span> <span class=\"hljs-number\">1.551664</span> <span class=\"hljs-number\">0.352840</span> <span class=\"hljs-number\">0.546114</span> <span class=\"hljs-number\">0.0</span>\n<span class=\"hljs-number\">4</span> <span class=\"hljs-number\">13</span> days <span class=\"hljs-number\">8071.329465</span> <span class=\"hljs-number\">89.840578</span> <span class=\"hljs-number\">55.027843</span> <span class=\"hljs-number\">1.658574</span> <span class=\"hljs-number\">0.426625</span> <span class=\"hljs-number\">0.584601</span> <span class=\"hljs-number\">0.0</span>\n</code></pre>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<ul>\n<li>MAPE 그래프 그리기</li>\n</ul>\n<pre><code class=\"hljs language-js\">fig = <span class=\"hljs-title function_\">plot_cross_validation_metric</span>(df_cv2, metric=<span class=\"hljs-string\">'mape'</span>)\n</code></pre>\n<img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_9.png\">\n<ul>\n<li>MAE 그래프 그리기</li>\n</ul>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-js\">fig = <span class=\"hljs-title function_\">plot_cross_validation_metric</span>(df_cv2, metric=<span class=\"hljs-string\">'mae'</span>)\n</code></pre>\n<p><img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_10.png\" alt=\"BTC-USD Price Prediction using FB Prophet with Hyperparameter Optimization Cross-Validation QC Modified Algorithm Trading Strategies\"></p>\n<h2>Hyperparameter Optimization (HPO)</h2>\n<ul>\n<li>Running HPO by adding monthly/quarterly seasonality and US holidays</li>\n</ul>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-js\">rmses = <span class=\"hljs-title function_\">list</span>()\n\n# 각 조합을 순회합니다.\n<span class=\"hljs-keyword\">for</span> params <span class=\"hljs-keyword\">in</span> <span class=\"hljs-attr\">all_params</span>:\n    m = <span class=\"hljs-title class_\">Prophet</span>(**params)\n    \n    m = m.<span class=\"hljs-title function_\">add_seasonality</span>(name=<span class=\"hljs-string\">'monthly'</span>, period=<span class=\"hljs-number\">30</span>, fourier_order=<span class=\"hljs-number\">5</span>)\n    m = m.<span class=\"hljs-title function_\">add_seasonality</span>(name=<span class=\"hljs-string\">'quarterly'</span>, period=<span class=\"hljs-number\">92.25</span>, fourier_order=<span class=\"hljs-number\">10</span>)\n\n    m.<span class=\"hljs-title function_\">add_country_holidays</span>(country_name=<span class=\"hljs-string\">'US'</span>)\n    \n    m.<span class=\"hljs-title function_\">fit</span>(data1)\n    \n    df_cv = <span class=\"hljs-title function_\">cross_validation</span>(m, initial=<span class=\"hljs-string\">'500 days'</span>, period=<span class=\"hljs-string\">'180 days'</span>, horizon=<span class=\"hljs-string\">'90 days'</span>)\n    \n    df_p = <span class=\"hljs-title function_\">performance_metrics</span>(df_cv, rolling_window=<span class=\"hljs-number\">1</span>)\n    \n    rmses.<span class=\"hljs-title function_\">append</span>(df_p[<span class=\"hljs-string\">'rmse'</span>].<span class=\"hljs-property\">values</span>[<span class=\"hljs-number\">0</span>])\n    \n# 최적의 매개변수를 찾습니다.\nbest_params = all_params[np.<span class=\"hljs-title function_\">argmin</span>(rmses)]\n    \n<span class=\"hljs-title function_\">print</span>(<span class=\"hljs-string\">\"\\n최적의 매개변수는:\"</span>, best_params)\n</code></pre>\n<ul>\n<li>최적화된 모델을 피팅하고 해당하는 예측 생성</li>\n</ul>\n<pre><code class=\"hljs language-js\">model_param1 = {\n    <span class=\"hljs-string\">'daily_seasonality'</span>: <span class=\"hljs-title class_\">False</span>,\n    <span class=\"hljs-string\">'weekly_seasonality'</span>: <span class=\"hljs-title class_\">False</span>,\n    <span class=\"hljs-string\">'yearly_seasonality'</span>: <span class=\"hljs-title class_\">True</span>,\n    <span class=\"hljs-string\">'seasonality_mode'</span>: <span class=\"hljs-string\">'multiplicative'</span>,\n    <span class=\"hljs-string\">'growth'</span>: <span class=\"hljs-string\">'logistic'</span>,\n    <span class=\"hljs-string\">'seasonality_prior_scale'</span>: <span class=\"hljs-number\">0.1</span>,\n    <span class=\"hljs-string\">'changepoint_prior_scale'</span>: <span class=\"hljs-number\">0.01</span>\n}\n\nmodel1 = <span class=\"hljs-title class_\">Prophet</span>(**model_param1)\n\nmodel1.<span class=\"hljs-title function_\">add_country_holidays</span>(<span class=\"hljs-string\">'US'</span>)\n\nmodel1.<span class=\"hljs-title function_\">fit</span>(data1)\n\n# 향후 데이터 프레임 생성\nfuture = model1.<span class=\"hljs-title function_\">make_future_dataframe</span>(periods=<span class=\"hljs-number\">365</span>)\nfuture[<span class=\"hljs-string\">'cap'</span>] = data1[<span class=\"hljs-string\">'cap'</span>].<span class=\"hljs-title function_\">max</span>()\n\nforecast = model1.<span class=\"hljs-title function_\">predict</span>(future)\n</code></pre>\n<ul>\n<li>원래 가격을 얻기 위해 역 Box-Cox 변환을 적용합니다.</li>\n</ul>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>js\nforecast[\"yhat\"]=bc.untransform_boxcox(x=forecast[\"yhat\"], lmbda=lmbda)\nforecast[\"yhat_lower\"]=bc.untransform_boxcox(x=forecast[\"yhat_lower\"], lmbda=lmbda)\nforecast[\"yhat_upper\"]=bc.untransform_boxcox(x=forecast[\"yhat_upper\"], lmbda=lmbda)\nforecast.plot(x=\"ds\", y=[\"yhat_lower\", \"yhat\", \"yhat_upper\"])</p>\n<img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_11.png\">\n<ul>\n<li>수동 cutoff로 교차 검증 QC 실행 중</li>\n</ul>\n<pre><code class=\"hljs language-js\">cutoffs = pd.<span class=\"hljs-title function_\">to_datetime</span>([<span class=\"hljs-string\">'2022-09-01'</span>, <span class=\"hljs-string\">'2023-05-01'</span>, <span class=\"hljs-string\">'2024-03-01'</span>])\ndf_cv2 = <span class=\"hljs-title function_\">cross_validation</span>(model1, cutoffs=cutoffs, horizon=<span class=\"hljs-string\">'90 days'</span>)\nfig = <span class=\"hljs-title function_\">plot_cross_validation_metric</span>(df_cv2, metric=<span class=\"hljs-string\">'rmse'</span>)\n</code></pre>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p><img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_12.png\" alt=\"image\"></p>\n<pre><code class=\"hljs language-js\">fig = <span class=\"hljs-title function_\">plot_cross_validation_metric</span>(df_cv2, metric=<span class=\"hljs-string\">'mape'</span>)\n</code></pre>\n<p><img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_13.png\" alt=\"image\"></p>\n<pre><code class=\"hljs language-js\">fig = <span class=\"hljs-title function_\">plot_cross_validation_metric</span>(df_cv2, metric=<span class=\"hljs-string\">'mae'</span>)\n</code></pre>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p><img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_14.png\" alt=\"BTC-USD Price Prediction\"></p>\n<h2>2020년부터 2024년까지 BTC-USD 역사적 데이터 준비</h2>\n<ul>\n<li>박스-콕스(Box-Cox) 변환을 하지 않고 2020년 01월 01일부터 2024년 07월 07일까지의 BTC-USD 역사적 데이터를 준비합니다.</li>\n</ul>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> pandas <span class=\"hljs-keyword\">as</span> pd\n<span class=\"hljs-keyword\">import</span> numpy <span class=\"hljs-keyword\">as</span> np\n<span class=\"hljs-keyword\">from</span> prophet <span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">Prophet</span>\n<span class=\"hljs-keyword\">import</span> matplotlib.<span class=\"hljs-property\">pyplot</span> <span class=\"hljs-keyword\">as</span> plt\n<span class=\"hljs-keyword\">from</span> functools <span class=\"hljs-keyword\">import</span> reduce\n\n%matplotlib inline\n<span class=\"hljs-keyword\">import</span> warnings\nwarnings.<span class=\"hljs-title function_\">filterwarnings</span>(<span class=\"hljs-string\">'ignore'</span>)\n\npd.<span class=\"hljs-property\">options</span>.<span class=\"hljs-property\">display</span>.<span class=\"hljs-property\">float_format</span> = <span class=\"hljs-string\">\"{:,.2f}\"</span>.<span class=\"hljs-property\">format</span>\n\n<span class=\"hljs-keyword\">import</span> yfinance <span class=\"hljs-keyword\">as</span> yf\n\nticker = <span class=\"hljs-string\">'BTC-USD'</span>\nstart_date = <span class=\"hljs-string\">'2020-01-01'</span>\n\nstock_price = yf.<span class=\"hljs-title function_\">download</span>(ticker, start=start_date)\nstock_price[<span class=\"hljs-string\">\"날짜\"</span>] = stock_price.<span class=\"hljs-property\">index</span>\nstock_price.<span class=\"hljs-title function_\">tail</span>()\n\n           <span class=\"hljs-title class_\">Open</span>      <span class=\"hljs-title class_\">High</span>      <span class=\"hljs-title class_\">Low</span>       <span class=\"hljs-title class_\">Close</span>    <span class=\"hljs-title class_\">Adj</span> <span class=\"hljs-title class_\">Close</span>   <span class=\"hljs-title class_\">Volume</span>      날짜\n<span class=\"hljs-title class_\">Date</span>       \n<span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">03</span> <span class=\"hljs-number\">62</span>,<span class=\"hljs-number\">034</span><span class=\"hljs-number\">.33</span> <span class=\"hljs-number\">62</span>,<span class=\"hljs-number\">187.70</span> <span class=\"hljs-number\">59</span>,<span class=\"hljs-number\">419.39</span> <span class=\"hljs-number\">60</span>,<span class=\"hljs-number\">173.92</span> <span class=\"hljs-number\">60</span>,<span class=\"hljs-number\">173.92</span> <span class=\"hljs-number\">29756701685</span> <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">03</span>\n<span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">04</span> <span class=\"hljs-number\">60</span>,<span class=\"hljs-number\">147.14</span> <span class=\"hljs-number\">60</span>,<span class=\"hljs-number\">399.68</span> <span class=\"hljs-number\">56</span>,<span class=\"hljs-number\">777.80</span> <span class=\"hljs-number\">56</span>,<span class=\"hljs-number\">977.70</span> <span class=\"hljs-number\">56</span>,<span class=\"hljs-number\">977.70</span> <span class=\"hljs-number\">41149609230</span> <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">04</span>\n<span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">05</span> <span class=\"hljs-number\">57</span>,<span class=\"hljs-number\">022</span><span class=\"hljs-number\">.81</span> <span class=\"hljs-number\">57</span>,<span class=\"hljs-number\">497.15</span> <span class=\"hljs-number\">53</span>,<span class=\"hljs-number\">717.38</span> <span class=\"hljs-number\">56</span>,<span class=\"hljs-number\">662.38</span> <span class=\"hljs-number\">56</span>,<span class=\"hljs-number\">662.38</span> <span class=\"hljs-number\">55417544033</span> <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">05</span>\n<span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">06</span> <span class=\"hljs-number\">56</span>,<span class=\"hljs-number\">659.07</span> <span class=\"hljs-number\">58</span>,<span class=\"hljs-number\">472.55</span> <span class=\"hljs-number\">56</span>,<span class=\"hljs-number\">038.96</span> <span class=\"hljs-number\">58</span>,<span class=\"hljs-number\">303.54</span> <span class=\"hljs-number\">58</span>,<span class=\"hljs-number\">303.54</span> <span class=\"hljs-number\">20610320577</span> <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">06</span>\n<span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">07</span> <span class=\"hljs-number\">58</span>,<span class=\"hljs-number\">239.43</span> <span class=\"hljs-number\">58</span>,<span class=\"hljs-number\">367.18</span> <span class=\"hljs-number\">56</span>,<span class=\"hljs-number\">644.89</span> <span class=\"hljs-number\">57</span>,<span class=\"hljs-number\">198.04</span> <span class=\"hljs-number\">57</span>,<span class=\"hljs-number\">198.04</span> <span class=\"hljs-number\">19585976320</span> <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">07</span>\n\nstock_price = stock_price[[<span class=\"hljs-string\">'날짜'</span>,<span class=\"hljs-string\">'Adj Close'</span>]]\n\nstock_price.<span class=\"hljs-property\">columns</span> = [<span class=\"hljs-string\">'ds'</span>, <span class=\"hljs-string\">'y'</span>]\nstock_price.<span class=\"hljs-title function_\">tail</span>()\n\n           ds          y\n<span class=\"hljs-title class_\">Date</span>  \n<span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">03</span> <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">03</span> <span class=\"hljs-number\">60</span>,<span class=\"hljs-number\">173.92</span>\n<span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">04</span> <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">04</span> <span class=\"hljs-number\">56</span>,<span class=\"hljs-number\">977.70</span>\n<span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">05</span> <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">05</span> <span class=\"hljs-number\">56</span>,<span class=\"hljs-number\">662.38</span>\n<span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">06</span> <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">06</span> <span class=\"hljs-number\">58</span>,<span class=\"hljs-number\">303.54</span>\n<span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">07</span> <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">07</span> <span class=\"hljs-number\">57</span>,<span class=\"hljs-number\">198.04</span>\n</code></pre>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<ul>\n<li>기본 Prophet 모델을 적합시키고 2027년 7월 7일까지의 예측을 생성합니다.</li>\n</ul>\n<pre><code class=\"hljs language-js\">model = <span class=\"hljs-title class_\">Prophet</span>()\nmodel.<span class=\"hljs-title function_\">fit</span>(stock_price)\nfuture = model.<span class=\"hljs-title function_\">make_future_dataframe</span>(<span class=\"hljs-number\">1095</span>, freq=<span class=\"hljs-string\">'d'</span>)\n\nfuture_boolean = future[<span class=\"hljs-string\">'ds'</span>].<span class=\"hljs-title function_\">map</span>(lambda x : <span class=\"hljs-title class_\">True</span> <span class=\"hljs-keyword\">if</span> x.<span class=\"hljs-title function_\">weekday</span>() <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">range</span>(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">5</span>) <span class=\"hljs-keyword\">else</span> <span class=\"hljs-title class_\">False</span>)\nfuture = future[future_boolean] \n\nfuture.<span class=\"hljs-title function_\">tail</span>()\nds\n<span class=\"hljs-number\">2738</span> <span class=\"hljs-number\">2027</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">01</span>\n<span class=\"hljs-number\">2739</span> <span class=\"hljs-number\">2027</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">02</span>\n<span class=\"hljs-number\">2742</span> <span class=\"hljs-number\">2027</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">05</span>\n<span class=\"hljs-number\">2743</span> <span class=\"hljs-number\">2027</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">06</span>\n<span class=\"hljs-number\">2744</span> <span class=\"hljs-number\">2027</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">07</span>\n\nforecast = model.<span class=\"hljs-title function_\">predict</span>(future)\n#forecast.<span class=\"hljs-title function_\">tail</span>()\n\nmodel.<span class=\"hljs-title function_\">plot</span>(forecast);\n</code></pre>\n<p><img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_15.png\" alt=\"BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_15\"></p>\n<ul>\n<li>주요 구성 요소를 플롯합니다.</li>\n</ul>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>model.plot_components(forecast);</p>\n<p><img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_16.png\" alt=\"Forecast Plot\"></p>\n<ul>\n<li>원래 가격과 예측을 신뢰 구간과 함께 그래픽으로 표시합니다.</li>\n</ul>\n<pre><code class=\"hljs language-python\">stock_price_forecast = forecast[[<span class=\"hljs-string\">'ds'</span>, <span class=\"hljs-string\">'yhat'</span>, <span class=\"hljs-string\">'yhat_lower'</span>, <span class=\"hljs-string\">'yhat_upper'</span>]]\ndf = pd.merge(stock_price, stock_price_forecast, on=<span class=\"hljs-string\">'ds'</span>, how=<span class=\"hljs-string\">'right'</span>)\ndf.set_index(<span class=\"hljs-string\">'ds'</span>).plot(figsize=(<span class=\"hljs-number\">16</span>,<span class=\"hljs-number\">8</span>), color=[<span class=\"hljs-string\">'royalblue'</span>, <span class=\"hljs-string\">\"#34495e\"</span>, <span class=\"hljs-string\">\"#e74c3c\"</span>, <span class=\"hljs-string\">\"#e74c3c\"</span>], grid=<span class=\"hljs-literal\">True</span>);\n</code></pre>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p><img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_17.png\" alt=\"image\"></p>\n<ul>\n<li>Date 열을 3 부분(연/월/일)으로 분할하고 Prophet 모델을 fitting합니다.</li>\n</ul>\n<pre><code class=\"hljs language-python\">stock_price[<span class=\"hljs-string\">'dayname'</span>] = stock_price[<span class=\"hljs-string\">'ds'</span>].dt.day_name()\nstock_price[<span class=\"hljs-string\">'month'</span>] = stock_price[<span class=\"hljs-string\">'ds'</span>].dt.month\nstock_price[<span class=\"hljs-string\">'year'</span>] = stock_price[<span class=\"hljs-string\">'ds'</span>].dt.year\nstock_price[<span class=\"hljs-string\">'month/year'</span>] = stock_price[<span class=\"hljs-string\">'month'</span>].<span class=\"hljs-built_in\">map</span>(<span class=\"hljs-built_in\">str</span>) + <span class=\"hljs-string\">'/'</span> + stock_price[<span class=\"hljs-string\">'year'</span>].<span class=\"hljs-built_in\">map</span>(<span class=\"hljs-built_in\">str</span>) \n\nstock_price = pd.merge(stock_price, \n                       stock_price[<span class=\"hljs-string\">'month/year'</span>].drop_duplicates().reset_index(drop=<span class=\"hljs-literal\">True</span>).reset_index(),\n                       on=<span class=\"hljs-string\">'month/year'</span>,\n                       how=<span class=\"hljs-string\">'left'</span>)\n\nstock_price = stock_price.rename(columns={<span class=\"hljs-string\">'index'</span>:<span class=\"hljs-string\">'month/year_index'</span>})\n\nloop_list = stock_price[<span class=\"hljs-string\">'month/year'</span>].unique().tolist()\nmax_num = <span class=\"hljs-built_in\">len</span>(loop_list) - <span class=\"hljs-number\">1</span>\nforecast_frames = []\n\n<span class=\"hljs-keyword\">for</span> num, item <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">enumerate</span>(loop_list):\n\n    <span class=\"hljs-keyword\">if</span>  num == max_num:\n        <span class=\"hljs-keyword\">pass</span>\n    <span class=\"hljs-keyword\">else</span>:\n        df = stock_price.set_index(<span class=\"hljs-string\">'ds'</span>)[\n             stock_price[stock_price[<span class=\"hljs-string\">'month/year'</span>] == loop_list[<span class=\"hljs-number\">0</span>]][<span class=\"hljs-string\">'ds'</span>].<span class=\"hljs-built_in\">min</span>():\\\n             stock_price[stock_price[<span class=\"hljs-string\">'month/year'</span>] == item][<span class=\"hljs-string\">'ds'</span>].<span class=\"hljs-built_in\">max</span>()]\n        \n        df = df.reset_index()[[<span class=\"hljs-string\">'ds'</span>, <span class=\"hljs-string\">'y'</span>]]\n        \n        model = Prophet()\n        model.fit(df)\n        \n        future = stock_price[stock_price[<span class=\"hljs-string\">'month/year_index'</span>] == (num + <span class=\"hljs-number\">1</span>)][[<span class=\"hljs-string\">'ds'</span>]]\n\n        forecast = model.predict(future)\n        forecast_frames.append(forecast)\n</code></pre>\n<ul>\n<li>In-sample forecast와 원래 가격을 비교하는 그래프 그리기</li>\n</ul>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-python\">주가 예측 = reduce(<span class=\"hljs-keyword\">lambda</span> top, bottom: pd.concat([top, bottom], sort=<span class=\"hljs-literal\">False</span>), 예측_프레임)\n주가 예측 = 주가 예측[[<span class=\"hljs-string\">'일자'</span>, <span class=\"hljs-string\">'예측값'</span>, <span class=\"hljs-string\">'예측값_하한'</span>, <span class=\"hljs-string\">'예측값_상한'</span>]]\n\n데이터프레임 = pd.merge(주가[[<span class=\"hljs-string\">'일자'</span>,<span class=\"hljs-string\">'실제가격'</span>, <span class=\"hljs-string\">'월/연도_인덱스'</span>]], 주가 예측, on=<span class=\"hljs-string\">'일자'</span>)\n데이터프레임[<span class=\"hljs-string\">'변동률'</span>] = 데이터프레임[<span class=\"hljs-string\">'실제가격'</span>].pct_change()\n데이터프레임.set_index(<span class=\"hljs-string\">'일자'</span>)[[<span class=\"hljs-string\">'실제가격'</span>, <span class=\"hljs-string\">'예측값'</span>, <span class=\"hljs-string\">'예측값_하한'</span>, <span class=\"hljs-string\">'예측값_상한'</span>]].plot(figsize=(<span class=\"hljs-number\">16</span>,<span class=\"hljs-number\">8</span>), color=[<span class=\"hljs-string\">'royalblue'</span>, <span class=\"hljs-string\">\"#34495e\"</span>, <span class=\"hljs-string\">\"#e74c3c\"</span>, <span class=\"hljs-string\">\"#e74c3c\"</span>], grid=<span class=\"hljs-literal\">True</span>)\n</code></pre>\n<p><img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_18.png\" alt=\"이미지\"></p>\n<ul>\n<li>교차 검증 수행 중</li>\n</ul>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">from</span> prophet.diagnostics <span class=\"hljs-keyword\">import</span> performance_metrics\n성능_메트릭스 = performance_metrics(df_cv)\n성능_메트릭스.head()\n\n  horizon  mse          rmse      mae     mape mdape smape coverage\n<span class=\"hljs-number\">0</span> <span class=\"hljs-number\">37</span> 일    <span class=\"hljs-number\">40</span>,<span class=\"hljs-number\">821</span>,<span class=\"hljs-number\">715.40</span> <span class=\"hljs-number\">6</span>,<span class=\"hljs-number\">389.19</span> <span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">890.31</span> <span class=\"hljs-number\">0.18</span> <span class=\"hljs-number\">0.12</span> <span class=\"hljs-number\">0.22</span> <span class=\"hljs-number\">0.55</span>\n<span class=\"hljs-number\">1</span> <span class=\"hljs-number\">38</span> 일    <span class=\"hljs-number\">41</span>,<span class=\"hljs-number\">109</span>,<span class=\"hljs-number\">990.95</span> <span class=\"hljs-number\">6</span>,<span class=\"hljs-number\">411.71</span> <span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">913.96</span> <span class=\"hljs-number\">0.18</span> <span class=\"hljs-number\">0.12</span> <span class=\"hljs-number\">0.22</span> <span class=\"hljs-number\">0.55</span>\n<span class=\"hljs-number\">2</span> <span class=\"hljs-number\">39</span> 일    <span class=\"hljs-number\">41</span>,<span class=\"hljs-number\">311</span>,<span class=\"hljs-number\">288.83</span> <span class=\"hljs-number\">6</span>,<span class=\"hljs-number\">427.39</span> <span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">922.43</span> <span class=\"hljs-number\">0.19</span> <span class=\"hljs-number\">0.12</span> <span class=\"hljs-number\">0.22</span> <span class=\"hljs-number\">0.55</span>\n<span class=\"hljs-number\">3</span> <span class=\"hljs-number\">40</span> 일    <span class=\"hljs-number\">41</span>,<span class=\"hljs-number\">641</span>,<span class=\"hljs-number\">137.72</span> <span class=\"hljs-number\">6</span>,<span class=\"hljs-number\">452.99</span> <span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">943.99</span> <span class=\"hljs-number\">0.19</span> <span class=\"hljs-number\">0.12</span> <span class=\"hljs-number\">0.22</span> <span class=\"hljs-number\">0.55</span>\n<span class=\"hljs-number\">4</span> <span class=\"hljs-number\">41</span> 일    <span class=\"hljs-number\">42</span>,<span class=\"hljs-number\">299</span>,<span class=\"hljs-number\">834.63</span> <span class=\"hljs-number\">6</span>,<span class=\"hljs-number\">503.83</span> <span class=\"hljs-number\">5</span>,<span class=\"hljs-number\">003.53</span> <span class=\"hljs-number\">0.19</span> <span class=\"hljs-number\">0.12</span> <span class=\"hljs-number\">0.23</span> <span class=\"hljs-number\">0.54</span>\n\n<span class=\"hljs-keyword\">from</span> prophet.plot <span class=\"hljs-keyword\">import</span> plot_cross_validation_metric\n그래프 = plot_cross_validation_metric(df_cv, metric=<span class=\"hljs-string\">'rmse'</span>)\n</code></pre>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p><img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_19.png\" alt=\"Plotting MAPE\"></p>\n<ul>\n<li>MAPE 플로팅</li>\n</ul>\n<pre><code class=\"hljs language-js\">fig = <span class=\"hljs-title function_\">plot_cross_validation_metric</span>(df_cv, metric=<span class=\"hljs-string\">'mape'</span>)\n</code></pre>\n<p><img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_20.png\" alt=\"MAPE Plot\"></p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<ul>\n<li>MAE 그래프 플로팅하기</li>\n</ul>\n<pre><code class=\"hljs language-js\">fig = <span class=\"hljs-title function_\">plot_cross_validation_metric</span>(df_cv, metric=<span class=\"hljs-string\">'mae'</span>)\n</code></pre>\n<p><img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_21.png\" alt=\"MAE Plot\"></p>\n<ul>\n<li>그리드 검색 하이퍼파라미터 최적화 구현 및 MAE를 사용하여 모델 평가하기</li>\n</ul>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-js\"># 하이퍼파라미터 그리드 정의\n<span class=\"hljs-keyword\">from</span> sklearn.<span class=\"hljs-property\">metrics</span> <span class=\"hljs-keyword\">import</span> mean_absolute_error\nparam_grid = {\n    <span class=\"hljs-string\">'seasonality_mode'</span>: [<span class=\"hljs-string\">'additive'</span>, <span class=\"hljs-string\">'multiplicative'</span>],\n    <span class=\"hljs-string\">'changepoint_prior_scale'</span>: [<span class=\"hljs-number\">0.01</span>, <span class=\"hljs-number\">0.1</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">10</span>],\n    <span class=\"hljs-string\">'seasonality_prior_scale'</span>: [<span class=\"hljs-number\">0.01</span>, <span class=\"hljs-number\">0.1</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">10</span>],\n}\n\n# 모델을 평가하기 위한 도우미 함수\ndef evaluate_model(model, metric_func):\n    df_cv = <span class=\"hljs-title function_\">cross_validation</span>(model, initial=<span class=\"hljs-string\">'1125 days'</span>, period=<span class=\"hljs-string\">'180 days'</span>, horizon=<span class=\"hljs-string\">'365 days'</span>)\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title function_\">metric_func</span>(df_cv[<span class=\"hljs-string\">'y'</span>], df_cv[<span class=\"hljs-string\">'yhat'</span>])\n\n# 그리드 서치\nbest_params = {}\nbest_score = <span class=\"hljs-title function_\">float</span>(<span class=\"hljs-string\">'inf'</span>)\n\n<span class=\"hljs-keyword\">for</span> mode <span class=\"hljs-keyword\">in</span> param_grid[<span class=\"hljs-string\">'seasonality_mode'</span>]:\n    <span class=\"hljs-keyword\">for</span> cps <span class=\"hljs-keyword\">in</span> param_grid[<span class=\"hljs-string\">'changepoint_prior_scale'</span>]:\n        <span class=\"hljs-keyword\">for</span> sps <span class=\"hljs-keyword\">in</span> param_grid[<span class=\"hljs-string\">'seasonality_prior_scale'</span>]:\n            # 현재 하이퍼파라미터를 사용하여 모델 생성\n            m = <span class=\"hljs-title class_\">Prophet</span>(seasonality_mode=mode, changepoint_prior_scale=cps, seasonality_prior_scale=sps)\n            m.<span class=\"hljs-title function_\">fit</span>(stock_price)\n\n            # 평가 지표로 평가 모델(<span class=\"hljs-title class_\">Mean</span> <span class=\"hljs-title class_\">Absolute</span> <span class=\"hljs-title class_\">Error</span> 사용)\n            score = evaluate_model(m, mean_absolute_error)\n\n            # 필요 시 최적의 매개변수 업데이트\n            <span class=\"hljs-keyword\">if</span> score &#x3C; <span class=\"hljs-attr\">best_score</span>:\n                best_score = score\n                best_params = {\n                    <span class=\"hljs-string\">'seasonality_mode'</span>: mode,\n                    <span class=\"hljs-string\">'changepoint_prior_scale'</span>: cps,\n                    <span class=\"hljs-string\">'seasonality_prior_scale'</span>: sps\n                }\n\n<span class=\"hljs-title function_\">print</span>(<span class=\"hljs-params\">best_params</span>)\n\n{<span class=\"hljs-string\">'seasonality_mode'</span>: <span class=\"hljs-string\">'additive'</span>, <span class=\"hljs-string\">'changepoint_prior_scale'</span>: <span class=\"hljs-number\">0.1</span>, <span class=\"hljs-string\">'seasonality_prior_scale'</span>: <span class=\"hljs-number\">10</span>}\n\n<span class=\"hljs-title function_\">print</span>(best_score)\n<span class=\"hljs-number\">8675.430008099349</span>\n</code></pre>\n<ul>\n<li>최적화된 모델을 적합하고 1년 예측 생성</li>\n</ul>\n<pre><code class=\"hljs language-js\"># 최적의 매개변수로 모델 생성\nm_best = <span class=\"hljs-title class_\">Prophet</span>(seasonality_mode=<span class=\"hljs-string\">'additive'</span>, changepoint_prior_scale=<span class=\"hljs-number\">0.1</span>, seasonality_prior_scale=<span class=\"hljs-number\">10</span>)\nm_best.<span class=\"hljs-title function_\">fit</span>(stock_price)\n\n# <span class=\"hljs-number\">365</span>일을 포함한 예측을 위한 데이터프레임\nfuture_best = m_best.<span class=\"hljs-title function_\">make_future_dataframe</span>(periods=<span class=\"hljs-number\">365</span>)\nforecast_best = m_best.<span class=\"hljs-title function_\">predict</span>(future_best)\n\n# 예측 데이터와 함께 그래프 그리기\nfig1 = m.<span class=\"hljs-title function_\">plot</span>(forecast_best)\nax = fig1.<span class=\"hljs-title function_\">gca</span>()\nax.<span class=\"hljs-title function_\">set_title</span>(<span class=\"hljs-string\">\"BTC-USD 주가 예측\"</span>, size=<span class=\"hljs-number\">25</span>)\nax.<span class=\"hljs-title function_\">set_xlabel</span>(<span class=\"hljs-string\">\"날짜\"</span>, size=<span class=\"hljs-number\">15</span>)\nax.<span class=\"hljs-title function_\">set_ylabel</span>(<span class=\"hljs-string\">\"가격\"</span>, size=<span class=\"hljs-number\">15</span>)\n</code></pre>\n<p><img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_22.png\" alt=\"BTC-USD Stock Price Forecast\"></p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<ul>\n<li>scikit-learn과 Prophet 지표를 사용하여 교차 검증 QC 수행 중</li>\n</ul>\n<pre><code class=\"hljs language-js\"># 교차 검증 실행\n<span class=\"hljs-keyword\">from</span> sklearn.<span class=\"hljs-property\">metrics</span> <span class=\"hljs-keyword\">import</span> mean_squared_error\ndf_cv = <span class=\"hljs-title function_\">cross_validation</span>(m_best, initial=<span class=\"hljs-string\">'1125 days'</span>, period=<span class=\"hljs-string\">'180 days'</span>, horizon=<span class=\"hljs-string\">'365 days'</span>)\n\n# 성능 지표 계산\ndf_metrics = <span class=\"hljs-title function_\">performance_metrics</span>(df_cv)\n\n# <span class=\"hljs-variable constant_\">MAE</span>, <span class=\"hljs-variable constant_\">MSE</span> 및 <span class=\"hljs-variable constant_\">RMSE</span> 계산\nmae = <span class=\"hljs-title function_\">mean_absolute_error</span>(df_cv[<span class=\"hljs-string\">'y'</span>], df_cv[<span class=\"hljs-string\">'yhat'</span>])\nmse = <span class=\"hljs-title function_\">mean_squared_error</span>(df_cv[<span class=\"hljs-string\">'y'</span>], df_cv[<span class=\"hljs-string\">'yhat'</span>])\nrmse = np.<span class=\"hljs-title function_\">sqrt</span>(mse)\n\n<span class=\"hljs-title function_\">print</span>(f<span class=\"hljs-string\">'평균 절대 오차: {mae:.2f}'</span>)\n<span class=\"hljs-title function_\">print</span>(f<span class=\"hljs-string\">'평균 제곱 오차: {mse:.2f}'</span>)\n<span class=\"hljs-title function_\">print</span>(f<span class=\"hljs-string\">'제곱근 평균 제곱 오차: {rmse:.2f}'</span>)\n\n평균 절대 오차: <span class=\"hljs-number\">8675.43</span>\n평균 제곱 오차: <span class=\"hljs-number\">107375840.73</span>\n제곱근 평균 제곱 오차: <span class=\"hljs-number\">10362.23</span>\n\n<span class=\"hljs-keyword\">from</span> prophet.<span class=\"hljs-property\">plot</span> <span class=\"hljs-keyword\">import</span> plot_cross_validation_metric\ndf_cv = <span class=\"hljs-title function_\">cross_validation</span>(m_best, initial=<span class=\"hljs-string\">'1125 days'</span>, period=<span class=\"hljs-string\">'180 days'</span>, horizon=<span class=\"hljs-string\">'365 days'</span>)\nfig = <span class=\"hljs-title function_\">plot_cross_validation_metric</span>(df_cv, metric=<span class=\"hljs-string\">'rmse'</span>)\n</code></pre>\n<img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_23.png\">\n<ul>\n<li>MAPE 플로팅하기</li>\n</ul>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-python\">fig = plot_cross_validation_metric(df_cv, metric=<span class=\"hljs-string\">'mape'</span>)\n</code></pre>\n<p><img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_24.png\" alt=\"image\"></p>\n<ul>\n<li>MAE 그리기</li>\n</ul>\n<pre><code class=\"hljs language-python\">fig = plot_cross_validation_metric(df_cv, metric=<span class=\"hljs-string\">'mae'</span>)\n</code></pre>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_25.png\">\n<ul>\n<li>In-Sample 및 Out-of-Sample 1년 Prophet 예측과 신뢰 구간을 동시에 플로팅합니다 (원래 스케일)</li>\n</ul>\n<pre><code class=\"hljs language-js\">loop_list = stock_price[<span class=\"hljs-string\">'month/year'</span>].<span class=\"hljs-title function_\">unique</span>().<span class=\"hljs-title function_\">tolist</span>()\nmax_num = <span class=\"hljs-title function_\">len</span>(loop_list) - <span class=\"hljs-number\">1</span>\nforecast_frames = []\n\n<span class=\"hljs-keyword\">for</span> num, item <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">enumerate</span>(loop_list):\n\n    <span class=\"hljs-keyword\">if</span> num == <span class=\"hljs-attr\">max_num</span>:\n        pass\n    <span class=\"hljs-attr\">else</span>:\n        df = stock_price.<span class=\"hljs-title function_\">set_index</span>(<span class=\"hljs-string\">'ds'</span>)[\n             stock_price[stock_price[<span class=\"hljs-string\">'month/year'</span>] == loop_list[<span class=\"hljs-number\">0</span>]][<span class=\"hljs-string\">'ds'</span>].<span class=\"hljs-title function_\">min</span>():\\\n             stock_price[stock_price[<span class=\"hljs-string\">'month/year'</span>] == item][<span class=\"hljs-string\">'ds'</span>].<span class=\"hljs-title function_\">max</span>()]\n        \n        df = df.<span class=\"hljs-title function_\">reset_index</span>()[[<span class=\"hljs-string\">'ds'</span>, <span class=\"hljs-string\">'y'</span>]]\n        \n        future = stock_price[stock_price[<span class=\"hljs-string\">'month/year_index'</span>] == (num + <span class=\"hljs-number\">1</span>)][[<span class=\"hljs-string\">'ds'</span>]]\n\n        forecast = m_best.<span class=\"hljs-title function_\">predict</span>(future)\n        forecast_frames.<span class=\"hljs-title function_\">append</span>(forecast)\n\nstock_price_forecast1 = <span class=\"hljs-title function_\">reduce</span>(lambda top, <span class=\"hljs-attr\">bottom</span>: pd.<span class=\"hljs-title function_\">concat</span>([top, bottom], sort=<span class=\"hljs-title class_\">False</span>), forecast_frames)\nstock_price_forecast1 = stock_price_forecast1[[<span class=\"hljs-string\">'ds'</span>, <span class=\"hljs-string\">'yhat'</span>, <span class=\"hljs-string\">'yhat_lower'</span>, <span class=\"hljs-string\">'yhat_upper'</span>]]\n\ndf1 = pd.<span class=\"hljs-title function_\">merge</span>(stock_price[[<span class=\"hljs-string\">'ds'</span>,<span class=\"hljs-string\">'y'</span>, <span class=\"hljs-string\">'month/year_index'</span>]], stock_price_forecast1, on=<span class=\"hljs-string\">'ds'</span>)\ndf1[<span class=\"hljs-string\">'Percent Change'</span>] = df1[<span class=\"hljs-string\">'y'</span>].<span class=\"hljs-title function_\">pct_change</span>()\ndf1.<span class=\"hljs-title function_\">set_index</span>(<span class=\"hljs-string\">'ds'</span>)[[<span class=\"hljs-string\">'y'</span>, <span class=\"hljs-string\">'yhat'</span>, <span class=\"hljs-string\">'yhat_lower'</span>, <span class=\"hljs-string\">'yhat_upper'</span>]].<span class=\"hljs-title function_\">plot</span>(figsize=(<span class=\"hljs-number\">16</span>,<span class=\"hljs-number\">8</span>), color=[<span class=\"hljs-string\">'royalblue'</span>, <span class=\"hljs-string\">\"#34495e\"</span>, <span class=\"hljs-string\">\"#e74c3c\"</span>, <span class=\"hljs-string\">\"#e74c3c\"</span>], grid=<span class=\"hljs-title class_\">True</span>)\n</code></pre>\n<img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_26.png\">\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<h2>수정된 암호화폐 알고리즘 트레이딩 전략</h2>\n<ul>\n<li>다음과 같이 Prophet를 기반으로 한 암호화폐 알고리즘 트레이딩 전략을 수정합시다.</li>\n</ul>\n<pre><code class=\"hljs language-js\">#트레이딩 알고리즘\ndf=df1.<span class=\"hljs-title function_\">copy</span>()\ndf[<span class=\"hljs-string\">'Hold'</span>] = (df[<span class=\"hljs-string\">'Percent Change'</span>] + <span class=\"hljs-number\">1</span>).<span class=\"hljs-title function_\">cumprod</span>()\ndf[<span class=\"hljs-string\">'Prophet'</span>] = ((df[<span class=\"hljs-string\">'yhat'</span>].<span class=\"hljs-title function_\">shift</span>(-<span class=\"hljs-number\">1</span>) > df[<span class=\"hljs-string\">'yhat'</span>]).<span class=\"hljs-title function_\">shift</span>(<span class=\"hljs-number\">1</span>) * (df[<span class=\"hljs-string\">'Percent Change'</span>]) + <span class=\"hljs-number\">1</span>).<span class=\"hljs-title function_\">cumprod</span>()\ndf[<span class=\"hljs-string\">'Prophet Thresh'</span>] = ((df[<span class=\"hljs-string\">'y'</span>] &#x3C; df[<span class=\"hljs-string\">'yhat_upper'</span>]).<span class=\"hljs-title function_\">shift</span>(<span class=\"hljs-number\">1</span>) * (df[<span class=\"hljs-string\">'Percent Change'</span>]) + <span class=\"hljs-number\">1</span>).<span class=\"hljs-title function_\">cumprod</span>()\ndf[<span class=\"hljs-string\">'Seasonality'</span>] = ((~df[<span class=\"hljs-string\">'ds'</span>].<span class=\"hljs-property\">dt</span>.<span class=\"hljs-property\">month</span>.<span class=\"hljs-title function_\">isin</span>([<span class=\"hljs-number\">8</span>,<span class=\"hljs-number\">9</span>])).<span class=\"hljs-title function_\">shift</span>(<span class=\"hljs-number\">1</span>) * (df[<span class=\"hljs-string\">'Percent Change'</span>]) + <span class=\"hljs-number\">1</span>).<span class=\"hljs-title function_\">cumprod</span>()\n\n(df.<span class=\"hljs-title function_\">dropna</span>().<span class=\"hljs-title function_\">set_index</span>(<span class=\"hljs-string\">'ds'</span>)[[<span class=\"hljs-string\">'Hold'</span>, <span class=\"hljs-string\">'Prophet'</span>, <span class=\"hljs-string\">'Prophet Thresh'</span>,<span class=\"hljs-string\">'Seasonality'</span>]] * <span class=\"hljs-number\">1000</span>).<span class=\"hljs-title function_\">plot</span>(figsize=(<span class=\"hljs-number\">16</span>,<span class=\"hljs-number\">8</span>), grid=<span class=\"hljs-title class_\">True</span>)\n\n<span class=\"hljs-title function_\">print</span>(f<span class=\"hljs-string\">\"Hold = {df['Hold'].iloc[-1]*1000:,.0f}\"</span>)\n<span class=\"hljs-title function_\">print</span>(f<span class=\"hljs-string\">\"Prophet = {df['Prophet'].iloc[-1]*1000:,.0f}\"</span>)\n<span class=\"hljs-title function_\">print</span>(f<span class=\"hljs-string\">\"Prophet Thresh = {df['Prophet Thresh'].iloc[-1]*1000:,.0f}\"</span>)\n<span class=\"hljs-title function_\">print</span>(f<span class=\"hljs-string\">\"Seasonality = {df['Seasonality'].iloc[-1]*1000:,.0f}\"</span>)\n\n<span class=\"hljs-title class_\">Hold</span> = <span class=\"hljs-number\">6</span>,<span class=\"hljs-number\">090</span>\n<span class=\"hljs-title class_\">Prophet</span> = <span class=\"hljs-number\">87</span>,<span class=\"hljs-number\">595</span>\n<span class=\"hljs-title class_\">Prophet</span> <span class=\"hljs-title class_\">Thresh</span> = <span class=\"hljs-number\">18</span>,<span class=\"hljs-number\">681</span>\n<span class=\"hljs-title class_\">Seasonality</span> = <span class=\"hljs-number\">7</span>,<span class=\"hljs-number\">172</span>\n</code></pre>\n<p><img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_27.png\" alt=\"이미지\"></p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<ul>\n<li>여기에서 Prophet Thresh df['y']<code> df['yhat_lower'] 를 조건 df['y']</code> df['yhat_upper'] 로 바꿔 더 높은 예상 수익을 얻을 수 있었습니다.</li>\n<li>위의 Prophet 임계값을 최적화해 봅시다.</li>\n</ul>\n<pre><code class=\"hljs language-js\">performance = {}\n\n<span class=\"hljs-keyword\">for</span> x <span class=\"hljs-keyword\">in</span> np.<span class=\"hljs-title function_\">linspace</span>(<span class=\"hljs-number\">.9</span>,<span class=\"hljs-number\">.99</span>,<span class=\"hljs-number\">10</span>):\n    y = ((df[<span class=\"hljs-string\">'y'</span>] &#x3C; df[<span class=\"hljs-string\">'yhat_upper'</span>]*x).<span class=\"hljs-title function_\">shift</span>(<span class=\"hljs-number\">1</span>)* (df[<span class=\"hljs-string\">'퍼센트 변화'</span>]) + <span class=\"hljs-number\">1</span>).<span class=\"hljs-title function_\">cumprod</span>()\n    performance[x] = y\n    \nbest_yhat = pd.<span class=\"hljs-title class_\">DataFrame</span>(performance).<span class=\"hljs-title function_\">max</span>().<span class=\"hljs-title function_\">idxmax</span>()\npd.<span class=\"hljs-title class_\">DataFrame</span>(performance).<span class=\"hljs-title function_\">plot</span>(figsize=(<span class=\"hljs-number\">16</span>,<span class=\"hljs-number\">8</span>), grid=<span class=\"hljs-title class_\">True</span>);\nf<span class=\"hljs-string\">'최적의 Yhat = {best_yhat:,.2f}'</span>\n\n<span class=\"hljs-string\">'최적의 Yhat = 0.92'</span>\n</code></pre>\n<p><img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_28.png\" alt=\"이미지\"></p>\n<ul>\n<li>Best Yhat = 0.92로 백테스트 실행중</li>\n</ul>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-js\">df[<span class=\"hljs-string\">'Optimized Prophet Thresh'</span>] = ((df[<span class=\"hljs-string\">'y'</span>] &#x3C; df[<span class=\"hljs-string\">'yhat_upper'</span>] * best_yhat).<span class=\"hljs-title function_\">shift</span>(<span class=\"hljs-number\">1</span>) * \r\n                                  (df[<span class=\"hljs-string\">'Percent Change'</span>]) + <span class=\"hljs-number\">1</span>).<span class=\"hljs-title function_\">cumprod</span>()\r\n\r\n(df.<span class=\"hljs-title function_\">dropna</span>().<span class=\"hljs-title function_\">set_index</span>(<span class=\"hljs-string\">'ds'</span>)[[<span class=\"hljs-string\">'Hold'</span>, <span class=\"hljs-string\">'Prophet'</span>, <span class=\"hljs-string\">'Prophet Thresh'</span>, \r\n                              <span class=\"hljs-string\">'Seasonality'</span>, <span class=\"hljs-string\">'Optimized Prophet Thresh'</span>]] * <span class=\"hljs-number\">1000</span>).<span class=\"hljs-title function_\">plot</span>(figsize=(<span class=\"hljs-number\">16</span>,<span class=\"hljs-number\">8</span>), grid=<span class=\"hljs-title class_\">True</span>)\r\n\r\n<span class=\"hljs-title function_\">print</span>(f<span class=\"hljs-string\">\"Hold = {df['Hold'].iloc[-1]*1000:,.0f}\"</span>)\r\n<span class=\"hljs-title function_\">print</span>(f<span class=\"hljs-string\">\"Prophet = {df['Prophet'].iloc[-1]*1000:,.0f}\"</span>)\r\n<span class=\"hljs-title function_\">print</span>(f<span class=\"hljs-string\">\"Prophet Thresh = {df['Prophet Thresh'].iloc[-1]*1000:,.0f}\"</span>)\r\n<span class=\"hljs-title function_\">print</span>(f<span class=\"hljs-string\">\"Seasonality = {df['Seasonality'].iloc[-1]*1000:,.0f}\"</span>)\r\n<span class=\"hljs-title function_\">print</span>(f<span class=\"hljs-string\">\"Optimized Prophet Thresh = {df['Optimized Prophet Thresh'].iloc[-1]*1000:,.0f}\"</span>)\r\n\r\n<span class=\"hljs-title class_\">Hold</span> = <span class=\"hljs-number\">6</span>,<span class=\"hljs-number\">090</span>\r\n<span class=\"hljs-title class_\">Prophet</span> = <span class=\"hljs-number\">87</span>,<span class=\"hljs-number\">595</span>\r\n<span class=\"hljs-title class_\">Prophet</span> <span class=\"hljs-title class_\">Thresh</span> = <span class=\"hljs-number\">18</span>,<span class=\"hljs-number\">681</span>\r\n<span class=\"hljs-title class_\">Seasonality</span> = <span class=\"hljs-number\">7</span>,<span class=\"hljs-number\">172</span>\r\n<span class=\"hljs-title class_\">Optimized</span> <span class=\"hljs-title class_\">Prophet</span> <span class=\"hljs-title class_\">Thresh</span> = <span class=\"hljs-number\">36</span>,<span class=\"hljs-number\">769</span>\n</code></pre>\n<img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_29.png\">\n<ul>\n<li>요약:\n<ul>\n<li>ROI(Prophet)/ROI(Optimized Prophet Thresh) 약 2.4배</li>\n<li>ROI(Prophet)/ROI(Hold) 약 14.0배</li>\n<li>ROI(Optimized Prophet Thresh)/ROI(Prophet Thresh) 약 2.0배</li>\n<li>ROI(Prophet Thresh)/ROI(Seasonality) 약 2.5배</li>\n<li>ROI(Seasonality)/ROI(Hold) 약 1.0배</li>\n</ul>\n</li>\n</ul>\n<h2>프로핏 플롯리 시각화와 변경 지점들</h2>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<ul>\n<li>Prophet Plotly 시각화 옵션을 살펴봅시다.</li>\n</ul>\n<pre><code class=\"hljs language-js\">mydf=stock_price[[<span class=\"hljs-string\">'ds'</span>,<span class=\"hljs-string\">'y'</span>]]\nmm = <span class=\"hljs-title class_\">Prophet</span>()\nmm.<span class=\"hljs-title function_\">fit</span>(mydf)\nfuture = mm.<span class=\"hljs-title function_\">make_future_dataframe</span>(periods=<span class=\"hljs-number\">365</span>)\nforecast = mm.<span class=\"hljs-title function_\">predict</span>(future)\n<span class=\"hljs-keyword\">from</span> prophet.<span class=\"hljs-property\">plot</span> <span class=\"hljs-keyword\">import</span> plot_plotly\n\n<span class=\"hljs-title function_\">plot_plotly</span>(mm, forecast)\n</code></pre>\n<p><img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_30.png\" alt=\"Prophet Plotly Visualization\"></p>\n<ul>\n<li>Plotly를 사용하여 Prophet 예측값과 변화점을 시각화합니다.</li>\n</ul>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">from</span> prophet.<span class=\"hljs-property\">plot</span> <span class=\"hljs-keyword\">import</span> plot_plotly\n\n<span class=\"hljs-title function_\">plot_plotly</span>(mm, forecast, changepoints=<span class=\"hljs-title class_\">True</span>)\n</code></pre>\n<p><img src=\"/TIL/assets/img/2024-07-13-BTC-USDPricePredictionusingFBProphetwithHyperparameterOptimizationCross-ValidationQCModifiedAlgo-TradingStrategies_31.png\" alt=\"BTC-USD Price Prediction\"></p>\n<h2>결론</h2>\n<ul>\n<li>이 포스트에서는 Prophet (Facebook의 시계열 예측 라이브러리)를 사용하여 BTC-USD 가격을 예측하는 방법을 분석했습니다.</li>\n<li>Yahoo Finance Python을 사용하여 2 개의 데이터 세트를 다운로드했습니다: (1) 2024-07-06까지 730 일 동안; (2) 2020-01-01부터 2024-07-07까지.</li>\n<li>데이터 세트 1을 사용하여 Box-Cox 변환과 미국의 휴일을 고려한 HPO를 테스트했습니다.</li>\n<li>데이터 세트 2를 다운로드하여 Prophet HPO 예측을 3 부분(연도, 월, 일)으로 분할 한 후 루프를 통해 다중 계절성 처리의 가치를 보여주었습니다.</li>\n<li>Prophet 교차 검증 기능에 대한 자세한 내용을 탐구하여 두 데이터 세트에 대한 RMSE, MAPE 및 MAE와 같은 여러 주요 지표를 비교했습니다.</li>\n<li>데이터 세트 2: 최종 인샘플 Prophet 오류 지표는 다음과 같습니다.</li>\n</ul>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-title class_\">Mean</span> <span class=\"hljs-title class_\">Absolute</span> <span class=\"hljs-title class_\">Error</span>: <span class=\"hljs-number\">8675.43</span>\n<span class=\"hljs-title class_\">Mean</span> <span class=\"hljs-title class_\">Squared</span> <span class=\"hljs-title class_\">Error</span>: <span class=\"hljs-number\">107375840.73</span>\n<span class=\"hljs-title class_\">Root</span> <span class=\"hljs-title class_\">Mean</span> <span class=\"hljs-title class_\">Squared</span> <span class=\"hljs-title class_\">Error</span>: <span class=\"hljs-number\">10362.23</span>\n</code></pre>\n<ul>\n<li>데이터 집합 2: 350일 주기의 외부 샘플 Prophet HPO 오류 메트릭</li>\n</ul>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-variable constant_\">MAPE</span> 약 <span class=\"hljs-number\">0.2</span>-<span class=\"hljs-number\">0.4</span>, (<span class=\"hljs-variable constant_\">MAE</span>, <span class=\"hljs-variable constant_\">RMSE</span>) 약 10k-15k\n</code></pre>\n<ul>\n<li>Plotly를 사용하여 Prophet 예측 시점의 변화를 그래픽으로 표현하는 가치를 설명했습니다.</li>\n<li>마지막으로, 데이터 집합 2를 사용하여 여러 유용한 Prophet 기반 백테스팅 암호화 알고리즘 트레이딩 전략을 Hold 벤치마크에 대해 탐색했습니다.</li>\n<li>백테스팅 결과는 ROI(Prophet)/ROI(Hold) 약 14.0임을 보여주었습니다.</li>\n<li>테스트 결과, Prophet 추세가 외부 데이터 없이도 정확히 추정될 수 있음을 확인했습니다. 시계열이 강력한 계절적 사업주기를 따른다는 것을 고려할 때, Prophet가 상당히 잘 작동한다는 것을 발견했습니다.</li>\n<li>Prophet의 다른 통계 모델 및 기계 학습보다 중요한 장점 중 하나는 해석 가능성입니다. Prophet은 시간 기능을 따로 만들 필요가 없기 때문에 빠르게 좋은 기준을 제공합니다.</li>\n<li>전반적으로, 시계열이 비즈니스 주기를 따라간다면 Prophet를 기준 모델로 사용할 가치가 있다는 결론을 내립니다 (참고 자료 참조).</li>\n</ul>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<h2>참고 자료</h2>\n<ul>\n<li>Facebook Prophet를 사용한 주식 가격 예측</li>\n<li>Prophet 진단</li>\n<li>Facebook Prophet 시작하기</li>\n<li>Facebook Prophet로 시계열 예측</li>\n<li>FB Prophet를 사용한 BTC 가격 예측</li>\n</ul>\n<h2>연락처</h2>\n<ul>\n<li>웹사이트</li>\n<li>GitHub</li>\n<li>Facebook</li>\n<li>X/Twitter</li>\n<li>Pinterest</li>\n<li>Mastodon</li>\n<li>Tumblr</li>\n</ul>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<h2>고지사항</h2>\n<ul>\n<li>다음 고지는 본 글의 정보가 교육 목적으로만 제공되었음을 명확히하며, 재정 또는 투자 자문으로 간주되어서는 안 된다는 것을 명시합니다.</li>\n<li>제공된 정보는 귀하 개인의 재정 상황, 목표 또는 리스크 허용도를 고려하지 않습니다.</li>\n<li>귀하가 취하는 투자 결정이나 조치는 전적으로 귀하의 책임입니다.</li>\n<li>재정 목표, 리스크 허용도 및 투자 기간에 따라 어떠한 투자의 적합성을 독립적으로 평가해야 합니다.</li>\n<li>특정 요구 사항에 맞는 맞춤 가이드 제공이 가능한 자격을 갖춘 재무 전문가의 조언을 구하는 것이 권장됩니다.</li>\n<li>제공된 도구, 데이터, 콘텐츠, 정보는 맞춤화되지 않았으며 어떤 개인의 투자 요구 사항에 부합하도록 제공된 것이 아니므로 정보 및 교육 목적만을 위해 제공됩니다.</li>\n</ul>\n<h2>자료</h2>\n<p><a href=\"https://www.kaggle.com/code/alexkaggle95/stock-prices-forecast-plotly-prophet\" rel=\"nofollow\" target=\"_blank\">https://www.kaggle.com/code/alexkaggle95/stock-prices-forecast-plotly-prophet</a> 나쁨</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p><a href=\"https://www.kaggle.com/code/ghazanfarali/stock-price-analysis-and-forecasting\" rel=\"nofollow\" target=\"_blank\">https://www.kaggle.com/code/ghazanfarali/stock-price-analysis-and-forecasting</a> 페이지를 방문해 보세요! 해당 페이지에는 주식 가격 분석 및 예측과 관련된 정보가 있습니다. 좋은 정보를 얻을 수 있을 거예요!</p>\n</body>\n</html>\n"},"__N_SSG":true}