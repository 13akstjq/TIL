{"pageProps":{"post":{"title":"파이썬으로 GenAI 사용하기 LLM과 에이전트 비교","description":"","date":"2024-07-12 19:31","slug":"2024-07-12-GenAIwithPythonLLMvsAgents","content":"\n\n\n![2024-07-12-GenAIwithPythonLLMvsAgents_0.png](/TIL/assets/img/2024-07-12-GenAIwithPythonLLMvsAgents_0.png)\n\n이 글에서는 제너레이티브 인공지능(GenAI) 최첨단 기술인 에이전트를 로컬에서 구축하는 방법을 소개하겠습니다. 일반 LLM과의 차이를 설명하면서요.\n\n![2024-07-12-GenAIwithPythonLLMvsAgents_1.png](/TIL/assets/img/2024-07-12-GenAIwithPythonLLMvsAgents_1.png)\n\n일반적으로, 지능형 에이전트는 환경을 인식할 수 있는 충분한 이해력으로 행동하는 존재로, 특정 목표를 달성하기 위해 자율적으로 행동하고 지식을 습득하며(사람과 같이) 개선합니다.\n\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n기술 분야에서 AI 에이전트는 작업을 수행하고 결정을 내리며 다른 개체와 통신하는 자율 프로그램입니다. 보통, 에이전트에게는 작업을 완료하는 동안 사용할 수 있는 도구 세트가 제공됩니다. 이 개념은 보상을 극대화하기 위해 정의된 일련의 작업 중에서 선택하는 강화 학습을 확장한 것입니다.\n\n대형 언어 모델(LLM)은 에이전트가 아닙니다. LLM은 단어 임베딩과 트랜스포머 아키텍처를 활용하여 고급 자연어 처리를 수행하는 신경망입니다. 인간 언어에 대한 막대한 이해력을 갖고 있지만, 지식 범위를 넘어서는 행동은 수행하지 않습니다.\n\nGenAI에서 에이전트는 순차적 추론을 처리하기 위해 설계된 AI 시스템으로, LLM의 일반 지식이 충분하지 않은 경우 외부 도구(예: 데이터베이스 쿼리, 웹 검색)를 실행할 수 있습니다. 간단히 말해, 일반적인 AI 챗봇은 답변할 수 없는 경우 무작위 텍스트를 생성하지만, 에이전트는 공백을 채우고 구체적인 응답을 제공하기 위해 도구를 활성화합니다.\n\n에이전트가 수행할 수 있는 가장 일반적인 작업은:\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n- 대화 - 일반적인 지식 베이스와 대화하는 것을 의미합니다\n- RAG - 문서와 대화하는 것을 의미합니다\n- 쿼리(즉, SQL 생성) - 데이터베이스와 대화하는 것을 의미합니다\n- 웹 검색 - 인터넷 전체와 대화하는 것을 의미합니다\n\n그러나 가장 매혹적인 측면은 코딩이 가능하다면 어떤 것이든 도구가 될 수 있다는 것입니다. 따라서 에이전트의 기능과 응용 프로그램은 무한합니다.\n\n이 튜토리얼에서는 여러 개의 에이전트를 만들 것입니다. 다른 유사한 경우에 쉽게 적용할 수 있는 유용한 Python 코드를 제시하고 각 코드 라인에 대해 설명이 담긴 주석을 달아 이 예시를 복제할 수 있도록 안내하겠습니다(아래의 전체 코드 링크 참조).\n\n특히 다음을 다룰 것입니다:\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n- 설정: LangChain + CrewAI + DuckDuckGo.\n- LLM: LLM을 사용하여 데이터를 읽고 시각 작업을 수행합니다.\n- Agent: 단일 Agent으로 동일한 작업 수행.\n- 여러 에이전트: 여럿이 팀을 이루어 동일한 작업 수행.\n\n## 설정\n\n현재, 가장 똑똑한 클로즈드 소스 인공지능(AI) Agents로는 OpenAI의 ChatGPT, Anthropic의 Claude, 그리고 Google의 Gemini가 있습니다. 오픈 소스 쪽에는 많은 초기 단계 라이브러리가 있지만, 시장 리더는 아직 없는 것으로 보입니다(이 주제는 정말 정선 기술이기 때문입니다). 주요 라이브러리는 다음과 같습니다:\n\n- LangChain — 거의 모든 LLM 기능을 포함하는 매쉬업 프레임워크입니다. Agent가 낮은 수준에서 코딩되어야 하는 경우(즉, 어떻게 메모리를 사용할지 결정해야 하는 경우), LangGraph 모듈을 추천드립니다.\n- CrewAI — \"크루\"로 함께 작업할 수 있는 여러 에이전트를 만들기 위해 특별히 설계된 라이브러리입니다.\n- AutoGen — Microsoft에서 개발한 로우코드(거의 노코드) 인터페이스 AutoGen Studio가 함께 제공되는 라이브러리입니다.\n- AnythingLLM — 가장 일반적인 작업을 수행할 수 있는 전혀 노코드 플랫폼입니다.\n- HuggingFace — 첫 번째 LLM 라이브러리이자 모델 저장소입니다.\n- LlamaIndex — Meta의 LLM 라이브러리와 새로운 에이전트 모듈 LLamaAgents가 포함되어 있습니다.\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nLangChain (LLM을 위한)과 CrewAI (에이전트를 위한)의 조합이 매우 사용자 친화적이고 효과적이라고 생각해요.\n\n우선, LLM과 에이전트 사이의 차이를 이해해야 해요. 좋은 예를 보여드릴게요. LLM이 \"간단\"하지만 구체적인 질문에 어떻게 답변하는지 보여줄게요. 언어 모델 실행에 대해선 Ollama 모듈과 Phi3 모델을 사용하는 것을 선호해요. 설정 방법은 이 글을 참고할 수 있어요.\n\n```js\n!pip install langchain #0.1.20\n!pip install langchain-community #0.0.38\n\nfrom langchain_community.llms import Ollama \n\nllm = Ollama(model=\"phi3\")\nres = llm.invoke(input=[\"What day is today?\"]).split(\"\\n\")[0]\nprint(res)\n```\n\n![이미지](/TIL/assets/img/2024-07-12-GenAIwithPythonLLMvsAgents_2.png)\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n당연히 언어 모델은 오늘의 날짜를 알 수 없습니다. 답을 얻는 한 가지 방법은 인터넷에서 검색하는 것입니다. Python에서는 유명한 비공개 브라우저 DuckDuckGo를 사용하여 쉽게 할 수 있습니다.\n\n```python\n!pip install duckduckgo-search #6.1.7\n\nfrom langchain.tools import DuckDuckGoSearchResults \n\nDuckDuckGoSearchResults().run(\"오늘은 무슨 요일인가요?\")\n```\n\n<img src=\"/TIL/assets/img/2024-07-12-GenAIwithPythonLLMvsAgents_3.png\" />\n\n... 또는 메타데이터 없이 텍스트만 원하면요.\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\nfrom langchain_community.tools import DuckDuckGoSearchRun\n\nDuckDuckGoSearchRun().run(\"What day is today?\")\n```\n\n<img src=\"/TIL/assets/img/2024-07-12-GenAIwithPythonLLMvsAgents_4.png\" />\n\n이제 첫 번째 에이전트를 만들어봅시다. LLM에게 우리가 방금 한 것처럼 웹을 탐색할 수 있는 기능을 제공하여. 그러면 인공지능은:\n\n- LLM 지식으로는 해당 질문에 대답할 수 없다는 것을 이해해야 합니다.\n- 추가 정보를 얻기 위해 도구를 사용해야 합니다.\n- 결과를 LLM을 통해 처리하고 답변을 생성해야 합니다.\n\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n말씀드렸듯이, 어떤 것이든 Tool 객체가 될 수 있으며 CrewAI 라이브러리를 사용하여 함수에 데코레이터를 간단히 추가할 수 있습니다.\n\n```js\n!pip install \"crewai[tools]\" #0.4.0\n\nfrom crewai_tools import tool \n\n@tool\ndef tool_browser(q: str) -> str:\n    \"\"\"DuckDuckGo 브라우저\"\"\"\n    return DuckDuckGoSearchRun().run(q)\n```\n\n에이전트 객체를 만들기 위해서는 목표(작업의 간단한 설명)와 배경 이야기(작업에 대한 자세한 설명)를 정의하여 일부 프롬프트 엔지니어링을 해야 합니다. 도구 및 LLM도 지정해야 합니다.\n\n```js\n!pip install crewai #0.35.0\n\nimport crewai\n\nagent = crewai.Agent(\n            role=\"Calendar\", \n            goal=\"오늘의 요일을 확인하세요\",\n            backstory=\"당신은 달력 도우미입니다. 날짜에 관한 정보를 알려줍니다.\",\n            tools=[tool_browser], \n            llm=llm,\n            allow_delegation=False, verbose=False)\n```\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n그럼, 다시 한 번 목표를 지정하여 Task 객체를 생성해야 합니다.\n\n```js\ntask = crewai.Task(description=\"오늘은 무슨 요일인지 알아내기\",\n                   agent=agent,\n                   expected_output=\"오늘 날짜\")\n```\n\n마지막으로, 이 경우에는 Agent가 한 명뿐인 Crew를 실행해야 합니다.\n\n```js\ncrew = crewai.Crew(agents=[agent], tasks=[task], verbose=False)\nres = crew.kickoff()\nprint(res)\n```\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n![GenAIwithPythonLLMvsAgents_5](/TIL/assets/img/2024-07-12-GenAIwithPythonLLMvsAgents_5.png)\n\n보시다시피, 에이전트는 LLM이 대답하지 못한 질문에 대답할 수 있어요. 개요를 파악하셨으니, 다음 단계로 넘어가볼까요?\n\n## LLM\n\n이 수영복 브랜드(White Water Atelier)에서는 AI를 활용한 소셜 미디어 전략을 만들어 달라고 했어요... 에이전트에게 딱 맞는 사례죠. 특히, 인스타그램 포스트 작성 프로세스를 자동화할 거에요.\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n먼저, 데이터(이미지)를 읽어봅시다:\n\n```js\nfrom matplotlib import image, pyplot\nimport os\n\npath = 'data/'\nfolder = [x for x in os.listdir(path) if x.endswith(('.png','.jpg','.jpeg'))]\n\nfig, ax = pyplot.subplots(nrows=1, ncols=len(folder), sharex=False, sharey=False, figsize=(4*len(folder),10))\nfor n,file in enumerate(folder):\n    ax[n].imshow(image.imread(path+file))\n    ax[n].set(title=file)\n```\n\n<img src=\"/TIL/assets/img/2024-07-12-GenAIwithPythonLLMvsAgents_6.png\" />\n\nLLM에게 게시물을 생성하도록 요청하려면(사진 하나를 선택하고 캡션을 작성하도록 하기 위해서), 이미지는 모델이 처리할 수 있도록 문자열로 인코딩되어야 합니다.\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\r\nimport base64\n\ndef encode_image(path):\n    with open(path, \"rb\") as file:\n        return base64.b64encode(file.read()).decode('utf-8')\n\nlst_imgs = [encode_image(path+i) for i in folder]\r\n```\n\n적절한 비전 LLM을 사용할 것입니다. Microsoft의 LLaVa는 GPU 없이도 작동할 수 있는 효율적인 선택입니다 (여기에서 시도해보세요).\n\n```js\r\nprompt = '''먼저 인스타그램에서 어떤 사진이 좋아요를 더 많이 받을지 결정해야 합니다. 그리고 선택한 이미지에 기반하여 변환율을 극대화할 캡션을 작성해야 합니다.'''\n\nvision_llm = Ollama(model=\"llava\")\n\nres = vision_llm.invoke(input=[prompt], images=lst_imgs)\nprint(res)\r\n```\n\n<img src=\"/TIL/assets/img/2024-07-12-GenAIwithPythonLLMvsAgents_7.png\" />\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n꽤 잘했어요. LLM이 두 가지 작업을 완료했고 좋은 설명도 추가했어요. 하지만 캡션이 해시태그가 빠져있어 조금 오래된 것 같아요.\n\n## 에이전트\n\n이전 예제와 마찬가지로, 특정 검색 도구가 제공된 에이전트에게 동일한 작업을 넘길 거에요.\n\n```js\n@tool(\"instagram\")\ndef tool_instagram(q: str) -> str:\n    '''Instagram 검색'''\n    return DuckDuckGoSearchRun().run(f\"site:instagram.com {q}\")\n```\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n과거 에이전트와의 윯 한 가붕, 이번에는 입력 데아터를 전달할 때입니다. 특히, 이미지를 설명하기 위해 비전 LLM을 활용하고 텍스트를 입력으로 사용할 것입네다.\n\n```js\nvision_llm = Ollama(model=\"llava\")\n\ndes = \"\"\nfor n,img in enumerate(lst_imgs):\n    res = vision_llm.invoke(input=[\"이미지를 정확하게 설명하세요\"], images=[img])\n    des = des.strip() + \"\\n\\n\" + f\"이미지{n+1}: \"+res.replace('\\n',' ')\n\nprint(des)\n```\n\n![이미지](/TIL/assets/img/2024-07-12-GenAIwithPythonLLMvsAgents_8.png)\n\nCrewAI에서는 에이전트 실행 시 입력을 제공해야 하며, 'inputs'를 이용하여 프롬프트에서 참조할 수 있습니다.\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\nprompt = '''먼저 {images}에서 어떤 이미지가 인스타그램에서 좋아요를 더 많이 받을지 결정해야 합니다. 해당 이미지를 선택한 이유를 설명한 후, 해당 이미지를 기반으로 전환율을 극대화할 캡션을 작성해야 합니다. 현재 계절, 오늘의 날짜, 이번 달의 특별한 이벤트, 트렌드 있는 해시태그 및 이모티콘을 고려하여 완벽한 캡션을 만들어보세요.'''\n\n## Agent\nagent = crewai.Agent(\n            role=\"인플루언서\", \n            goal=prompt,\n            backstory=\"모든 게시물의 전환율을 극대화하는 인플루언서입니다.\",\n            tools=[tool_instagram], \n            llm=llm,\n            allow_delegation=False, verbose=True)\n\n## Task\ntask = crewai.Task(description=prompt, agent=agent,\n                   expected_output='''인스타그램 게시물을 위한 최고의 사진과 캡션''')\n\n## Crew\ncrew = crewai.Crew(agents=[agent], tasks=[task], verbose=True)\nres = crew.kickoff(inputs={\"images\":des})\nprint(\"Res:\", res)\r\n```\n\n로그를 분석하기 위해 verbose=True로 설정했습니다. 에이전트는 요청을 처리하면서 필요한 도구인… \n\n![이미지](/TIL/assets/img/2024-07-12-GenAIwithPythonLLMvsAgents_9.png)\n\n…을 사용해 작업을 시작합니다. 요청 결과를 검토하는 것으로 계속됩니다.\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n<img src=\"/TIL/assets/img/2024-07-12-GenAIwithPythonLLMvsAgents_10.png\" />\n\n... 그러고 나면 최종 답변이 나옵니다.\n\n<img src=\"/TIL/assets/img/2024-07-12-GenAIwithPythonLLMvsAgents_11.png\" />\n\n그래서 Agents는 LLM과 같은 이미지를 선택하고 더 나은 캡션을 생성했습니다.\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n## 다중 에이전트\n\n성능을 극대화하기 위해 각 에이전트에게 단일 작업을 할당하는 것이 일반적입니다. 따라서 작업을 두 부분(이미지 선택 및 캡션 생성)으로 분할하고 전체 프로세스를 자동화하기 위해 여러 에이전트로 구성된 팀을 만들겠습니다:\n\n- 사진작가 — 입력 설명을 기반으로 최적의 이미지를 선택하는 작업을 맡습니다 (웹에서 검색 가능)\n- 소셜 미디어 매니저 — 사진작가의 결과를 기반으로 최적의 캡션을 작성하는 작업을 맡습니다 (웹에서 검색 가능)\n- 매니저 — 전체 프로세스를 담당하는 작업을 맡습니다. 요청을 이해하고 다른 에이전트에 일을 할당하며 최종 결과가 올바른지 확인해야 합니다 (최종 검증을 위해 사람에게 요청 가능).\n\n각 작업이 실행되는 동안 출력을 확인하기 위해 콜백 함수를 추가하는 것이 유용할 수 있습니다 (이를 Task 객체에 추가해야 함).\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\ndef callback_function(output):\n    print(f\"작업 완료: {output.raw_output}\")\n```\n\n처음 두 명의 에이전트는 이전에 코딩한 것과 유사합니다. 그러나 이번에는 각 에이전트가 특정한 하나의 작업만 수행하므로 프롬프트 지침에 더 자세히 설명하겠습니다.\n\n```js\n######################## 1-사진작가 #########################\nprompt = '''{images} 중에서 인스타그램에서 더 많은 좋아요를 받을 사진을 선택하세요.'''\n\n## 에이전트\n에이전트_사진작가 = crewai.Agent(\n    role=\"사진작가\",\n    goal=prompt,\n    backstory='''사진작가로써, 인스타그램에서 더 많은 좋아요를 받을 사진을 이해해야 합니다.\n     게시물로 더 많은 사람들이 상호작용하도록 하고, 전환율을 극대화해야 합니다.\n     현재 계절, 오늘 날짜, 이번 달의 특별한 이벤트에 대해 조사해보세요.\n     ''',\n    tools=[tool_browser, tool_instagram], \n    llm=llm,\n    allow_delegation=False, verbose=False)\n\n## 작업\n작업_사진작가 = crewai.Task(\n    description=prompt,\n    agent=에이전트_사진작가,\n    callback=callback_function,\n    expected_output='''선택한 이미지 및 왜 그것이 가장 좋다고 생각하는지 설명''')\n\n\n######################## 2-소셜 미디어 매니저 ##################\nprompt = '''이미지를 기반으로 인스타그램 게시물의 전환율을 극대화할 캡션을 작성하세요.'''\n\n## 에이전트\n에이전트_소셜 = crewai.Agent(\n    role=\"소셜 미디어 매니저\",\n    goal=prompt,\n    backstory='''소셜 미디어 매니저로서, 사진작가의 결과물을 기반으로 짧은 캡션을 생성해야 합니다.\n     인스타그램에서 더 많은 좋아요를 받고, 게시물로 더 많은 사람들이 상호작용하며 전환율을 극대화해야 합니다. \n     트렌디한 주제, 해시태그 및 이모지 등에 대해 조사해보세요. \n     ''',\n    tools=[tool_browser, tool_instagram], \n    llm=llm,\n    allow_delegation=False,\n    verbose=False)\n\n## 작업\n작업_소셜 = crewai.Task(\n    description=prompt,\n    agent=에이전트_소셜,\n    expected_output='''인스타그램 게시물을 위한 짧은 캡션''')\r\n```\n\n다음 에이전트는 최종 출력물을 감시하고 인간의 검증을 요청해야 합니다. 따라서 프롬프트 설명에서 매우 정확해야 하며 에이전트 객체에서 allow_delegation=True 및 작업 객체에서 human_input=True 매개변수를 사용해야 합니다.\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\n######################## 3-다른 에이전트들의 매니저 #############\nprompt = '''게시물 생성 프로세스를 감독하고, 게시물 좋아요를 극대화하는 최고의 사진을 선택하고, 게시물의 전환율을 극대화하는 최고의 캡션을 작성합니다.'''\n\n## Agent\nagent_manager = crewai.Agent(\n    role=\"다른 에이전트들의 매니저\",\n    goal=prompt,\n    backstory='''프로세스의 매니저로서, 완벽한 인스타그램 게시물을 만들기 위해 모든 단계를 따릅니다:\n     1- 사진작가와 함께 더 많은 인스타그램 좋아요를 받을 사진을 선택합니다.\n     2- 이미지를 기반으로 인스타그램에서 전환율을 극대화할 게시물 캡션을 작성합니다.\n     프로세스의 끝에는 반드시 인간의 최종 승인을 요청해야 합니다. 인간 입력 도구를 사용하세요.\n     ''',\n    llm=llm,\n    allow_delegation=True, verbose=True)\n\n## Task\ntask_manager = crewai.Task(\n    description=prompt, agent=agent_manager,\n    human_input=True,\n    expected_output='''최상의 이미지와 짧은 캡션, 기본적으로 전체 인스타그램 게시물''')\r\n```\n\n마지막으로, 모든 것을 Crew 객체에 넣을 수 있습니다. 이번에는 하나의 에이전트만 프로젝트 전체를 담당해야 한다는 것을 지정할 수 있습니다. 순차 프로세스는 작업이 선형적으로 진행되어 한 작업이 다음 작업을 따르는 것을 보장하며, 계층적 프로세스는 효율적인 작업 위임 및 실행을 위해 전통적인 조직적 계층 구조를 모방합니다.\n\n```js\ncrew = crewai.Crew(agents=[agent_photograper, agent_social], \n                   tasks=[task_photograper, task_social, task_manager], \n                   process=crewai.Process.hierarchical,\n                   manager_agent=agent_manager,\n                   verbose=True)\n\nres = crew.kickoff(inputs={\"images\":des})\r\n```\n\n<img src=\"/TIL/assets/img/2024-07-12-GenAIwithPythonLLMvsAgents_12.png\" />\n\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n로그에서 확인할 수 있듯이, 매니저가 요청을 처리하고 첫 번째 작업을 첫 번째 에이전트에게 위임했습니다. 첫 번째 결과는 완벽합니다. AI가 최근 소셜 미디어 트렌드와 인스타그램 알고리즘 논리를 분석했습니다.\n\n![첫 번째 결과](/TIL/assets/img/2024-07-12-GenAIwithPythonLLMvsAgents_13.png)\n\n그러나 두 번째 결과는 약간 납득하기 어렵습니다. 에이전트가 제품에 대한 \"할인\"을 언급했습니다. 요금 및 판매와 같은 주제는 지시에 포함되어 있지 않으며 인간 감독자가 승인해야 합니다 (human_input 매개변수 덕분에).\n\n![두 번째 결과](https://miro.medium.com/v2/resize:fit:1064/1*Ogf4BPBBKolftQIQXd-EQg.gif)\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nGitHub에서 전체 코드를 확인할 수 있어요.\n\n## 결론\n\n본 글은 다양한 작업을 수행할 수 있는 에이전트를 구축하는 방법을 보여주는 튜토리얼이었습니다. LLM, LangChain 및 CrewAI를 사용하여 다양한 유형의 데이터를 처리할 수 있는 AI 팀을 만들었습니다. 에이전트는 매우 유연하므로 어떤 용도에도 사용자 정의할 수 있도록 프로세스를 가능한 일반적으로 설명했어요.\n\n즐겁게 읽으셨기를 바랍니다! 궁금한 점이나 피드백이 있으시다면 언제든지 연락해 주시거나 흥미로운 프로젝트를 공유해 주세요.","ogImage":{"url":"/TIL/assets/img/2024-07-12-GenAIwithPythonLLMvsAgents_0.png"},"coverImage":"/TIL/assets/img/2024-07-12-GenAIwithPythonLLMvsAgents_0.png","tag":["Tech"],"readingTime":18},"content":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n</head>\n<body>\n<p><img src=\"/TIL/assets/img/2024-07-12-GenAIwithPythonLLMvsAgents_0.png\" alt=\"2024-07-12-GenAIwithPythonLLMvsAgents_0.png\"></p>\n<p>이 글에서는 제너레이티브 인공지능(GenAI) 최첨단 기술인 에이전트를 로컬에서 구축하는 방법을 소개하겠습니다. 일반 LLM과의 차이를 설명하면서요.</p>\n<p><img src=\"/TIL/assets/img/2024-07-12-GenAIwithPythonLLMvsAgents_1.png\" alt=\"2024-07-12-GenAIwithPythonLLMvsAgents_1.png\"></p>\n<p>일반적으로, 지능형 에이전트는 환경을 인식할 수 있는 충분한 이해력으로 행동하는 존재로, 특정 목표를 달성하기 위해 자율적으로 행동하고 지식을 습득하며(사람과 같이) 개선합니다.</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>기술 분야에서 AI 에이전트는 작업을 수행하고 결정을 내리며 다른 개체와 통신하는 자율 프로그램입니다. 보통, 에이전트에게는 작업을 완료하는 동안 사용할 수 있는 도구 세트가 제공됩니다. 이 개념은 보상을 극대화하기 위해 정의된 일련의 작업 중에서 선택하는 강화 학습을 확장한 것입니다.</p>\n<p>대형 언어 모델(LLM)은 에이전트가 아닙니다. LLM은 단어 임베딩과 트랜스포머 아키텍처를 활용하여 고급 자연어 처리를 수행하는 신경망입니다. 인간 언어에 대한 막대한 이해력을 갖고 있지만, 지식 범위를 넘어서는 행동은 수행하지 않습니다.</p>\n<p>GenAI에서 에이전트는 순차적 추론을 처리하기 위해 설계된 AI 시스템으로, LLM의 일반 지식이 충분하지 않은 경우 외부 도구(예: 데이터베이스 쿼리, 웹 검색)를 실행할 수 있습니다. 간단히 말해, 일반적인 AI 챗봇은 답변할 수 없는 경우 무작위 텍스트를 생성하지만, 에이전트는 공백을 채우고 구체적인 응답을 제공하기 위해 도구를 활성화합니다.</p>\n<p>에이전트가 수행할 수 있는 가장 일반적인 작업은:</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<ul>\n<li>대화 - 일반적인 지식 베이스와 대화하는 것을 의미합니다</li>\n<li>RAG - 문서와 대화하는 것을 의미합니다</li>\n<li>쿼리(즉, SQL 생성) - 데이터베이스와 대화하는 것을 의미합니다</li>\n<li>웹 검색 - 인터넷 전체와 대화하는 것을 의미합니다</li>\n</ul>\n<p>그러나 가장 매혹적인 측면은 코딩이 가능하다면 어떤 것이든 도구가 될 수 있다는 것입니다. 따라서 에이전트의 기능과 응용 프로그램은 무한합니다.</p>\n<p>이 튜토리얼에서는 여러 개의 에이전트를 만들 것입니다. 다른 유사한 경우에 쉽게 적용할 수 있는 유용한 Python 코드를 제시하고 각 코드 라인에 대해 설명이 담긴 주석을 달아 이 예시를 복제할 수 있도록 안내하겠습니다(아래의 전체 코드 링크 참조).</p>\n<p>특히 다음을 다룰 것입니다:</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<ul>\n<li>설정: LangChain + CrewAI + DuckDuckGo.</li>\n<li>LLM: LLM을 사용하여 데이터를 읽고 시각 작업을 수행합니다.</li>\n<li>Agent: 단일 Agent으로 동일한 작업 수행.</li>\n<li>여러 에이전트: 여럿이 팀을 이루어 동일한 작업 수행.</li>\n</ul>\n<h2>설정</h2>\n<p>현재, 가장 똑똑한 클로즈드 소스 인공지능(AI) Agents로는 OpenAI의 ChatGPT, Anthropic의 Claude, 그리고 Google의 Gemini가 있습니다. 오픈 소스 쪽에는 많은 초기 단계 라이브러리가 있지만, 시장 리더는 아직 없는 것으로 보입니다(이 주제는 정말 정선 기술이기 때문입니다). 주요 라이브러리는 다음과 같습니다:</p>\n<ul>\n<li>LangChain — 거의 모든 LLM 기능을 포함하는 매쉬업 프레임워크입니다. Agent가 낮은 수준에서 코딩되어야 하는 경우(즉, 어떻게 메모리를 사용할지 결정해야 하는 경우), LangGraph 모듈을 추천드립니다.</li>\n<li>CrewAI — \"크루\"로 함께 작업할 수 있는 여러 에이전트를 만들기 위해 특별히 설계된 라이브러리입니다.</li>\n<li>AutoGen — Microsoft에서 개발한 로우코드(거의 노코드) 인터페이스 AutoGen Studio가 함께 제공되는 라이브러리입니다.</li>\n<li>AnythingLLM — 가장 일반적인 작업을 수행할 수 있는 전혀 노코드 플랫폼입니다.</li>\n<li>HuggingFace — 첫 번째 LLM 라이브러리이자 모델 저장소입니다.</li>\n<li>LlamaIndex — Meta의 LLM 라이브러리와 새로운 에이전트 모듈 LLamaAgents가 포함되어 있습니다.</li>\n</ul>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>LangChain (LLM을 위한)과 CrewAI (에이전트를 위한)의 조합이 매우 사용자 친화적이고 효과적이라고 생각해요.</p>\n<p>우선, LLM과 에이전트 사이의 차이를 이해해야 해요. 좋은 예를 보여드릴게요. LLM이 \"간단\"하지만 구체적인 질문에 어떻게 답변하는지 보여줄게요. 언어 모델 실행에 대해선 Ollama 모듈과 Phi3 모델을 사용하는 것을 선호해요. 설정 방법은 이 글을 참고할 수 있어요.</p>\n<pre><code class=\"hljs language-js\">!pip install langchain #<span class=\"hljs-number\">0.1</span><span class=\"hljs-number\">.20</span>\n!pip install langchain-community #<span class=\"hljs-number\">0.0</span><span class=\"hljs-number\">.38</span>\n\n<span class=\"hljs-keyword\">from</span> langchain_community.<span class=\"hljs-property\">llms</span> <span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">Ollama</span> \n\nllm = <span class=\"hljs-title class_\">Ollama</span>(model=<span class=\"hljs-string\">\"phi3\"</span>)\nres = llm.<span class=\"hljs-title function_\">invoke</span>(input=[<span class=\"hljs-string\">\"What day is today?\"</span>]).<span class=\"hljs-title function_\">split</span>(<span class=\"hljs-string\">\"\\n\"</span>)[<span class=\"hljs-number\">0</span>]\n<span class=\"hljs-title function_\">print</span>(res)\n</code></pre>\n<p><img src=\"/TIL/assets/img/2024-07-12-GenAIwithPythonLLMvsAgents_2.png\" alt=\"이미지\"></p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>당연히 언어 모델은 오늘의 날짜를 알 수 없습니다. 답을 얻는 한 가지 방법은 인터넷에서 검색하는 것입니다. Python에서는 유명한 비공개 브라우저 DuckDuckGo를 사용하여 쉽게 할 수 있습니다.</p>\n<pre><code class=\"hljs language-python\">!pip install duckduckgo-search <span class=\"hljs-comment\">#6.1.7</span>\n\n<span class=\"hljs-keyword\">from</span> langchain.tools <span class=\"hljs-keyword\">import</span> DuckDuckGoSearchResults \n\nDuckDuckGoSearchResults().run(<span class=\"hljs-string\">\"오늘은 무슨 요일인가요?\"</span>)\n</code></pre>\n<img src=\"/TIL/assets/img/2024-07-12-GenAIwithPythonLLMvsAgents_3.png\">\n<p>... 또는 메타데이터 없이 텍스트만 원하면요.</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">from</span> langchain_community.<span class=\"hljs-property\">tools</span> <span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">DuckDuckGoSearchRun</span>\n\n<span class=\"hljs-title class_\">DuckDuckGoSearchRun</span>().<span class=\"hljs-title function_\">run</span>(<span class=\"hljs-string\">\"What day is today?\"</span>)\n</code></pre>\n<img src=\"/TIL/assets/img/2024-07-12-GenAIwithPythonLLMvsAgents_4.png\">\n<p>이제 첫 번째 에이전트를 만들어봅시다. LLM에게 우리가 방금 한 것처럼 웹을 탐색할 수 있는 기능을 제공하여. 그러면 인공지능은:</p>\n<ul>\n<li>LLM 지식으로는 해당 질문에 대답할 수 없다는 것을 이해해야 합니다.</li>\n<li>추가 정보를 얻기 위해 도구를 사용해야 합니다.</li>\n<li>결과를 LLM을 통해 처리하고 답변을 생성해야 합니다.</li>\n</ul>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>말씀드렸듯이, 어떤 것이든 Tool 객체가 될 수 있으며 CrewAI 라이브러리를 사용하여 함수에 데코레이터를 간단히 추가할 수 있습니다.</p>\n<pre><code class=\"hljs language-js\">!pip install <span class=\"hljs-string\">\"crewai[tools]\"</span> #<span class=\"hljs-number\">0.4</span><span class=\"hljs-number\">.0</span>\n\n<span class=\"hljs-keyword\">from</span> crewai_tools <span class=\"hljs-keyword\">import</span> tool \n\n@tool\ndef <span class=\"hljs-title function_\">tool_browser</span>(<span class=\"hljs-attr\">q</span>: str) -> <span class=\"hljs-attr\">str</span>:\n    <span class=\"hljs-string\">\"\"</span><span class=\"hljs-string\">\"DuckDuckGo 브라우저\"</span><span class=\"hljs-string\">\"\"</span>\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">DuckDuckGoSearchRun</span>().<span class=\"hljs-title function_\">run</span>(q)\n</code></pre>\n<p>에이전트 객체를 만들기 위해서는 목표(작업의 간단한 설명)와 배경 이야기(작업에 대한 자세한 설명)를 정의하여 일부 프롬프트 엔지니어링을 해야 합니다. 도구 및 LLM도 지정해야 합니다.</p>\n<pre><code class=\"hljs language-js\">!pip install crewai #<span class=\"hljs-number\">0.35</span><span class=\"hljs-number\">.0</span>\n\n<span class=\"hljs-keyword\">import</span> crewai\n\nagent = crewai.<span class=\"hljs-title class_\">Agent</span>(\n            role=<span class=\"hljs-string\">\"Calendar\"</span>, \n            goal=<span class=\"hljs-string\">\"오늘의 요일을 확인하세요\"</span>,\n            backstory=<span class=\"hljs-string\">\"당신은 달력 도우미입니다. 날짜에 관한 정보를 알려줍니다.\"</span>,\n            tools=[tool_browser], \n            llm=llm,\n            allow_delegation=<span class=\"hljs-title class_\">False</span>, verbose=<span class=\"hljs-title class_\">False</span>)\n</code></pre>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>그럼, 다시 한 번 목표를 지정하여 Task 객체를 생성해야 합니다.</p>\n<pre><code class=\"hljs language-js\">task = crewai.<span class=\"hljs-title class_\">Task</span>(description=<span class=\"hljs-string\">\"오늘은 무슨 요일인지 알아내기\"</span>,\n                   agent=agent,\n                   expected_output=<span class=\"hljs-string\">\"오늘 날짜\"</span>)\n</code></pre>\n<p>마지막으로, 이 경우에는 Agent가 한 명뿐인 Crew를 실행해야 합니다.</p>\n<pre><code class=\"hljs language-js\">crew = crewai.<span class=\"hljs-title class_\">Crew</span>(agents=[agent], tasks=[task], verbose=<span class=\"hljs-title class_\">False</span>)\nres = crew.<span class=\"hljs-title function_\">kickoff</span>()\n<span class=\"hljs-title function_\">print</span>(res)\n</code></pre>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p><img src=\"/TIL/assets/img/2024-07-12-GenAIwithPythonLLMvsAgents_5.png\" alt=\"GenAIwithPythonLLMvsAgents_5\"></p>\n<p>보시다시피, 에이전트는 LLM이 대답하지 못한 질문에 대답할 수 있어요. 개요를 파악하셨으니, 다음 단계로 넘어가볼까요?</p>\n<h2>LLM</h2>\n<p>이 수영복 브랜드(White Water Atelier)에서는 AI를 활용한 소셜 미디어 전략을 만들어 달라고 했어요... 에이전트에게 딱 맞는 사례죠. 특히, 인스타그램 포스트 작성 프로세스를 자동화할 거에요.</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>먼저, 데이터(이미지)를 읽어봅시다:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">from</span> matplotlib <span class=\"hljs-keyword\">import</span> image, pyplot\n<span class=\"hljs-keyword\">import</span> os\n\npath = <span class=\"hljs-string\">'data/'</span>\nfolder = [x <span class=\"hljs-keyword\">for</span> x <span class=\"hljs-keyword\">in</span> os.<span class=\"hljs-title function_\">listdir</span>(path) <span class=\"hljs-keyword\">if</span> x.<span class=\"hljs-title function_\">endswith</span>((<span class=\"hljs-string\">'.png'</span>,<span class=\"hljs-string\">'.jpg'</span>,<span class=\"hljs-string\">'.jpeg'</span>))]\n\nfig, ax = pyplot.<span class=\"hljs-title function_\">subplots</span>(nrows=<span class=\"hljs-number\">1</span>, ncols=<span class=\"hljs-title function_\">len</span>(folder), sharex=<span class=\"hljs-title class_\">False</span>, sharey=<span class=\"hljs-title class_\">False</span>, figsize=(<span class=\"hljs-number\">4</span>*<span class=\"hljs-title function_\">len</span>(folder),<span class=\"hljs-number\">10</span>))\n<span class=\"hljs-keyword\">for</span> n,file <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">enumerate</span>(folder):\n    ax[n].<span class=\"hljs-title function_\">imshow</span>(image.<span class=\"hljs-title function_\">imread</span>(path+file))\n    ax[n].<span class=\"hljs-title function_\">set</span>(title=file)\n</code></pre>\n<img src=\"/TIL/assets/img/2024-07-12-GenAIwithPythonLLMvsAgents_6.png\">\n<p>LLM에게 게시물을 생성하도록 요청하려면(사진 하나를 선택하고 캡션을 작성하도록 하기 위해서), 이미지는 모델이 처리할 수 있도록 문자열로 인코딩되어야 합니다.</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> base64\n\ndef <span class=\"hljs-title function_\">encode_image</span>(path):\n    <span class=\"hljs-keyword\">with</span> <span class=\"hljs-title function_\">open</span>(path, <span class=\"hljs-string\">\"rb\"</span>) <span class=\"hljs-keyword\">as</span> <span class=\"hljs-attr\">file</span>:\n        <span class=\"hljs-keyword\">return</span> base64.<span class=\"hljs-title function_\">b64encode</span>(file.<span class=\"hljs-title function_\">read</span>()).<span class=\"hljs-title function_\">decode</span>(<span class=\"hljs-string\">'utf-8'</span>)\n\nlst_imgs = [<span class=\"hljs-title function_\">encode_image</span>(path+i) <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> folder]\n</code></pre>\n<p>적절한 비전 LLM을 사용할 것입니다. Microsoft의 LLaVa는 GPU 없이도 작동할 수 있는 효율적인 선택입니다 (여기에서 시도해보세요).</p>\n<pre><code class=\"hljs language-js\">prompt = <span class=\"hljs-string\">''</span><span class=\"hljs-string\">'먼저 인스타그램에서 어떤 사진이 좋아요를 더 많이 받을지 결정해야 합니다. 그리고 선택한 이미지에 기반하여 변환율을 극대화할 캡션을 작성해야 합니다.'</span><span class=\"hljs-string\">''</span>\n\nvision_llm = <span class=\"hljs-title class_\">Ollama</span>(model=<span class=\"hljs-string\">\"llava\"</span>)\n\nres = vision_llm.<span class=\"hljs-title function_\">invoke</span>(input=[prompt], images=lst_imgs)\n<span class=\"hljs-title function_\">print</span>(res)\n</code></pre>\n<img src=\"/TIL/assets/img/2024-07-12-GenAIwithPythonLLMvsAgents_7.png\">\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>꽤 잘했어요. LLM이 두 가지 작업을 완료했고 좋은 설명도 추가했어요. 하지만 캡션이 해시태그가 빠져있어 조금 오래된 것 같아요.</p>\n<h2>에이전트</h2>\n<p>이전 예제와 마찬가지로, 특정 검색 도구가 제공된 에이전트에게 동일한 작업을 넘길 거에요.</p>\n<pre><code class=\"hljs language-js\">@<span class=\"hljs-title function_\">tool</span>(<span class=\"hljs-string\">\"instagram\"</span>)\ndef <span class=\"hljs-title function_\">tool_instagram</span>(<span class=\"hljs-attr\">q</span>: str) -> <span class=\"hljs-attr\">str</span>:\n    <span class=\"hljs-string\">''</span><span class=\"hljs-string\">'Instagram 검색'</span><span class=\"hljs-string\">''</span>\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">DuckDuckGoSearchRun</span>().<span class=\"hljs-title function_\">run</span>(f<span class=\"hljs-string\">\"site:instagram.com {q}\"</span>)\n</code></pre>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>과거 에이전트와의 윯 한 가붕, 이번에는 입력 데아터를 전달할 때입니다. 특히, 이미지를 설명하기 위해 비전 LLM을 활용하고 텍스트를 입력으로 사용할 것입네다.</p>\n<pre><code class=\"hljs language-js\">vision_llm = <span class=\"hljs-title class_\">Ollama</span>(model=<span class=\"hljs-string\">\"llava\"</span>)\n\ndes = <span class=\"hljs-string\">\"\"</span>\n<span class=\"hljs-keyword\">for</span> n,img <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">enumerate</span>(lst_imgs):\n    res = vision_llm.<span class=\"hljs-title function_\">invoke</span>(input=[<span class=\"hljs-string\">\"이미지를 정확하게 설명하세요\"</span>], images=[img])\n    des = des.<span class=\"hljs-title function_\">strip</span>() + <span class=\"hljs-string\">\"\\n\\n\"</span> + f<span class=\"hljs-string\">\"이미지{n+1}: \"</span>+res.<span class=\"hljs-title function_\">replace</span>(<span class=\"hljs-string\">'\\n'</span>,<span class=\"hljs-string\">' '</span>)\n\n<span class=\"hljs-title function_\">print</span>(des)\n</code></pre>\n<p><img src=\"/TIL/assets/img/2024-07-12-GenAIwithPythonLLMvsAgents_8.png\" alt=\"이미지\"></p>\n<p>CrewAI에서는 에이전트 실행 시 입력을 제공해야 하며, 'inputs'를 이용하여 프롬프트에서 참조할 수 있습니다.</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-js\">prompt = <span class=\"hljs-string\">''</span><span class=\"hljs-string\">'먼저 {images}에서 어떤 이미지가 인스타그램에서 좋아요를 더 많이 받을지 결정해야 합니다. 해당 이미지를 선택한 이유를 설명한 후, 해당 이미지를 기반으로 전환율을 극대화할 캡션을 작성해야 합니다. 현재 계절, 오늘의 날짜, 이번 달의 특별한 이벤트, 트렌드 있는 해시태그 및 이모티콘을 고려하여 완벽한 캡션을 만들어보세요.'</span><span class=\"hljs-string\">''</span>\n\n## <span class=\"hljs-title class_\">Agent</span>\nagent = crewai.<span class=\"hljs-title class_\">Agent</span>(\n            role=<span class=\"hljs-string\">\"인플루언서\"</span>, \n            goal=prompt,\n            backstory=<span class=\"hljs-string\">\"모든 게시물의 전환율을 극대화하는 인플루언서입니다.\"</span>,\n            tools=[tool_instagram], \n            llm=llm,\n            allow_delegation=<span class=\"hljs-title class_\">False</span>, verbose=<span class=\"hljs-title class_\">True</span>)\n\n## <span class=\"hljs-title class_\">Task</span>\ntask = crewai.<span class=\"hljs-title class_\">Task</span>(description=prompt, agent=agent,\n                   expected_output=<span class=\"hljs-string\">''</span><span class=\"hljs-string\">'인스타그램 게시물을 위한 최고의 사진과 캡션'</span><span class=\"hljs-string\">''</span>)\n\n## <span class=\"hljs-title class_\">Crew</span>\ncrew = crewai.<span class=\"hljs-title class_\">Crew</span>(agents=[agent], tasks=[task], verbose=<span class=\"hljs-title class_\">True</span>)\nres = crew.<span class=\"hljs-title function_\">kickoff</span>(inputs={<span class=\"hljs-string\">\"images\"</span>:des})\n<span class=\"hljs-title function_\">print</span>(<span class=\"hljs-string\">\"Res:\"</span>, res)\n</code></pre>\n<p>로그를 분석하기 위해 verbose=True로 설정했습니다. 에이전트는 요청을 처리하면서 필요한 도구인…</p>\n<p><img src=\"/TIL/assets/img/2024-07-12-GenAIwithPythonLLMvsAgents_9.png\" alt=\"이미지\"></p>\n<p>…을 사용해 작업을 시작합니다. 요청 결과를 검토하는 것으로 계속됩니다.</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<img src=\"/TIL/assets/img/2024-07-12-GenAIwithPythonLLMvsAgents_10.png\">\n<p>... 그러고 나면 최종 답변이 나옵니다.</p>\n<img src=\"/TIL/assets/img/2024-07-12-GenAIwithPythonLLMvsAgents_11.png\">\n<p>그래서 Agents는 LLM과 같은 이미지를 선택하고 더 나은 캡션을 생성했습니다.</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<h2>다중 에이전트</h2>\n<p>성능을 극대화하기 위해 각 에이전트에게 단일 작업을 할당하는 것이 일반적입니다. 따라서 작업을 두 부분(이미지 선택 및 캡션 생성)으로 분할하고 전체 프로세스를 자동화하기 위해 여러 에이전트로 구성된 팀을 만들겠습니다:</p>\n<ul>\n<li>사진작가 — 입력 설명을 기반으로 최적의 이미지를 선택하는 작업을 맡습니다 (웹에서 검색 가능)</li>\n<li>소셜 미디어 매니저 — 사진작가의 결과를 기반으로 최적의 캡션을 작성하는 작업을 맡습니다 (웹에서 검색 가능)</li>\n<li>매니저 — 전체 프로세스를 담당하는 작업을 맡습니다. 요청을 이해하고 다른 에이전트에 일을 할당하며 최종 결과가 올바른지 확인해야 합니다 (최종 검증을 위해 사람에게 요청 가능).</li>\n</ul>\n<p>각 작업이 실행되는 동안 출력을 확인하기 위해 콜백 함수를 추가하는 것이 유용할 수 있습니다 (이를 Task 객체에 추가해야 함).</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-js\">def <span class=\"hljs-title function_\">callback_function</span>(output):\n    <span class=\"hljs-title function_\">print</span>(f<span class=\"hljs-string\">\"작업 완료: {output.raw_output}\"</span>)\n</code></pre>\n<p>처음 두 명의 에이전트는 이전에 코딩한 것과 유사합니다. 그러나 이번에는 각 에이전트가 특정한 하나의 작업만 수행하므로 프롬프트 지침에 더 자세히 설명하겠습니다.</p>\n<pre><code class=\"hljs language-js\">######################## <span class=\"hljs-number\">1</span>-사진작가 #########################\nprompt = <span class=\"hljs-string\">''</span><span class=\"hljs-string\">'{images} 중에서 인스타그램에서 더 많은 좋아요를 받을 사진을 선택하세요.'</span><span class=\"hljs-string\">''</span>\n\n## 에이전트\n에이전트_사진작가 = crewai.<span class=\"hljs-title class_\">Agent</span>(\n    role=<span class=\"hljs-string\">\"사진작가\"</span>,\n    goal=prompt,\n    backstory=<span class=\"hljs-string\">''</span><span class=\"hljs-string\">'사진작가로써, 인스타그램에서 더 많은 좋아요를 받을 사진을 이해해야 합니다.\n     게시물로 더 많은 사람들이 상호작용하도록 하고, 전환율을 극대화해야 합니다.\n     현재 계절, 오늘 날짜, 이번 달의 특별한 이벤트에 대해 조사해보세요.\n     '</span><span class=\"hljs-string\">''</span>,\n    tools=[tool_browser, tool_instagram], \n    llm=llm,\n    allow_delegation=<span class=\"hljs-title class_\">False</span>, verbose=<span class=\"hljs-title class_\">False</span>)\n\n## 작업\n작업_사진작가 = crewai.<span class=\"hljs-title class_\">Task</span>(\n    description=prompt,\n    agent=에이전트_사진작가,\n    callback=callback_function,\n    expected_output=<span class=\"hljs-string\">''</span><span class=\"hljs-string\">'선택한 이미지 및 왜 그것이 가장 좋다고 생각하는지 설명'</span><span class=\"hljs-string\">''</span>)\n\n\n######################## <span class=\"hljs-number\">2</span>-소셜 미디어 매니저 ##################\nprompt = <span class=\"hljs-string\">''</span><span class=\"hljs-string\">'이미지를 기반으로 인스타그램 게시물의 전환율을 극대화할 캡션을 작성하세요.'</span><span class=\"hljs-string\">''</span>\n\n## 에이전트\n에이전트_소셜 = crewai.<span class=\"hljs-title class_\">Agent</span>(\n    role=<span class=\"hljs-string\">\"소셜 미디어 매니저\"</span>,\n    goal=prompt,\n    backstory=<span class=\"hljs-string\">''</span><span class=\"hljs-string\">'소셜 미디어 매니저로서, 사진작가의 결과물을 기반으로 짧은 캡션을 생성해야 합니다.\n     인스타그램에서 더 많은 좋아요를 받고, 게시물로 더 많은 사람들이 상호작용하며 전환율을 극대화해야 합니다. \n     트렌디한 주제, 해시태그 및 이모지 등에 대해 조사해보세요. \n     '</span><span class=\"hljs-string\">''</span>,\n    tools=[tool_browser, tool_instagram], \n    llm=llm,\n    allow_delegation=<span class=\"hljs-title class_\">False</span>,\n    verbose=<span class=\"hljs-title class_\">False</span>)\n\n## 작업\n작업_소셜 = crewai.<span class=\"hljs-title class_\">Task</span>(\n    description=prompt,\n    agent=에이전트_소셜,\n    expected_output=<span class=\"hljs-string\">''</span><span class=\"hljs-string\">'인스타그램 게시물을 위한 짧은 캡션'</span><span class=\"hljs-string\">''</span>)\n</code></pre>\n<p>다음 에이전트는 최종 출력물을 감시하고 인간의 검증을 요청해야 합니다. 따라서 프롬프트 설명에서 매우 정확해야 하며 에이전트 객체에서 allow_delegation=True 및 작업 객체에서 human_input=True 매개변수를 사용해야 합니다.</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-js\">######################## <span class=\"hljs-number\">3</span>-다른 에이전트들의 매니저 #############\nprompt = <span class=\"hljs-string\">''</span><span class=\"hljs-string\">'게시물 생성 프로세스를 감독하고, 게시물 좋아요를 극대화하는 최고의 사진을 선택하고, 게시물의 전환율을 극대화하는 최고의 캡션을 작성합니다.'</span><span class=\"hljs-string\">''</span>\n\n## <span class=\"hljs-title class_\">Agent</span>\nagent_manager = crewai.<span class=\"hljs-title class_\">Agent</span>(\n    role=<span class=\"hljs-string\">\"다른 에이전트들의 매니저\"</span>,\n    goal=prompt,\n    backstory=<span class=\"hljs-string\">''</span><span class=\"hljs-string\">'프로세스의 매니저로서, 완벽한 인스타그램 게시물을 만들기 위해 모든 단계를 따릅니다:\n     1- 사진작가와 함께 더 많은 인스타그램 좋아요를 받을 사진을 선택합니다.\n     2- 이미지를 기반으로 인스타그램에서 전환율을 극대화할 게시물 캡션을 작성합니다.\n     프로세스의 끝에는 반드시 인간의 최종 승인을 요청해야 합니다. 인간 입력 도구를 사용하세요.\n     '</span><span class=\"hljs-string\">''</span>,\n    llm=llm,\n    allow_delegation=<span class=\"hljs-title class_\">True</span>, verbose=<span class=\"hljs-title class_\">True</span>)\n\n## <span class=\"hljs-title class_\">Task</span>\ntask_manager = crewai.<span class=\"hljs-title class_\">Task</span>(\n    description=prompt, agent=agent_manager,\n    human_input=<span class=\"hljs-title class_\">True</span>,\n    expected_output=<span class=\"hljs-string\">''</span><span class=\"hljs-string\">'최상의 이미지와 짧은 캡션, 기본적으로 전체 인스타그램 게시물'</span><span class=\"hljs-string\">''</span>)\n</code></pre>\n<p>마지막으로, 모든 것을 Crew 객체에 넣을 수 있습니다. 이번에는 하나의 에이전트만 프로젝트 전체를 담당해야 한다는 것을 지정할 수 있습니다. 순차 프로세스는 작업이 선형적으로 진행되어 한 작업이 다음 작업을 따르는 것을 보장하며, 계층적 프로세스는 효율적인 작업 위임 및 실행을 위해 전통적인 조직적 계층 구조를 모방합니다.</p>\n<pre><code class=\"hljs language-js\">crew = crewai.<span class=\"hljs-title class_\">Crew</span>(agents=[agent_photograper, agent_social], \n                   tasks=[task_photograper, task_social, task_manager], \n                   process=crewai.<span class=\"hljs-property\">Process</span>.<span class=\"hljs-property\">hierarchical</span>,\n                   manager_agent=agent_manager,\n                   verbose=<span class=\"hljs-title class_\">True</span>)\n\nres = crew.<span class=\"hljs-title function_\">kickoff</span>(inputs={<span class=\"hljs-string\">\"images\"</span>:des})\n</code></pre>\n<img src=\"/TIL/assets/img/2024-07-12-GenAIwithPythonLLMvsAgents_12.png\">\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>로그에서 확인할 수 있듯이, 매니저가 요청을 처리하고 첫 번째 작업을 첫 번째 에이전트에게 위임했습니다. 첫 번째 결과는 완벽합니다. AI가 최근 소셜 미디어 트렌드와 인스타그램 알고리즘 논리를 분석했습니다.</p>\n<p><img src=\"/TIL/assets/img/2024-07-12-GenAIwithPythonLLMvsAgents_13.png\" alt=\"첫 번째 결과\"></p>\n<p>그러나 두 번째 결과는 약간 납득하기 어렵습니다. 에이전트가 제품에 대한 \"할인\"을 언급했습니다. 요금 및 판매와 같은 주제는 지시에 포함되어 있지 않으며 인간 감독자가 승인해야 합니다 (human_input 매개변수 덕분에).</p>\n<p><img src=\"https://miro.medium.com/v2/resize:fit:1064/1*Ogf4BPBBKolftQIQXd-EQg.gif\" alt=\"두 번째 결과\"></p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>GitHub에서 전체 코드를 확인할 수 있어요.</p>\n<h2>결론</h2>\n<p>본 글은 다양한 작업을 수행할 수 있는 에이전트를 구축하는 방법을 보여주는 튜토리얼이었습니다. LLM, LangChain 및 CrewAI를 사용하여 다양한 유형의 데이터를 처리할 수 있는 AI 팀을 만들었습니다. 에이전트는 매우 유연하므로 어떤 용도에도 사용자 정의할 수 있도록 프로세스를 가능한 일반적으로 설명했어요.</p>\n<p>즐겁게 읽으셨기를 바랍니다! 궁금한 점이나 피드백이 있으시다면 언제든지 연락해 주시거나 흥미로운 프로젝트를 공유해 주세요.</p>\n</body>\n</html>\n"},"__N_SSG":true}