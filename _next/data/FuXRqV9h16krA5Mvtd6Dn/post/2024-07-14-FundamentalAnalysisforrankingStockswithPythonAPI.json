{"pageProps":{"post":{"title":"파이썬 API를 사용한 주식 순위를 위한 기본적 분석 방법","description":"","date":"2024-07-14 23:59","slug":"2024-07-14-FundamentalAnalysisforrankingStockswithPythonAPI","content":"\n\n이 기사에서는 기초 및 주식 세부 정보에 따라 주식을 순위로 나열할 것입니다. 이 접근 방식은 기존 기사 \"Python API를 사용한 기초 주식 분석\"에서 주식 그룹의 평균과 표준 편차를 기반으로 비율에 대한 점수 방법을 적용합니다.\n\n면책 조항: 여기서 제공된 정보는 정보 목적으로만 제공되며 개인 재정, 투자 또는 기타 조언을 의도한 것이 아닙니다.\n\n이 기사에서 사용되는 주요 비율은 다음과 같습니다:\n\n- EPS (주당순이익) — 회사 이익 중 각 주식에 할당된 부분\n- PE (주가 수익 비율) — 회사의 주가와 주당 순이익 간 관계. 투자자가 해당 섹터의 다른 종목에 비해 주식이 저평가되었는지 또는 고평가되었는지 판단하는 데 도움이 됩니다.\n- PEG (예상 이익 성장률) — 주식의 P/E를 예상된 12개월 수익 성장률로 나눈 것. 일반적으로 1보다 낮은 PEG는 좋은 신호이며, 2보다 높은 PEG는 주식이 과도 가격화될 수 있음을 나타냅니다.\n- PB (주가순자산가치비율) — 1의 비율은 회사의 주식이 순자산가치에 준하는 가격에 거래되고 있음을 나타냅니다. 1보다 높은 P/B는 회사가 순자산가치에 프리미엄을 지불하고 있음을 시사하며, 1보다 낮은 비율은 회사 자산에 비해 저평가된 주식을 나타낼 수 있습니다.\n- ROE (자기자본이익률) — 회사가 자산을 이용하여 이익을 창출하는 데 효과적으로 활용하는 방법을 투자자에게 제공합니다. 더 높은 ROE는 주주 자본을 더 효과적으로 활용하고 주식 수요 증가 및 미래 이익 증가, 그리고 주가 상승으로 이어질 수 있음을 나타냅니다.\n- ROCE (총 자본 대지수이익률) — 모든 자본을 기준으로 회사의 수익성을 측정합니다.\n- FCFY (재무건전도 비율) — 회사가 주당 기대하는 영업현금흐름과 주당 시장가치를 비교하는 지표. 낮은 비율은 덜 매력적인 투자 기회를 나타냅니다.\n- D2E (부채대자본비) — 회사의 총부채를 자기자본과 비교합니다.\n- CR (유동비율) — 회사가 유동자산(1년 이내 지급 예정 금액)으로 현재 부채를 갚을 수 있는 능력을 측정합니다. 비율이 높을수록 회사의 유동성이 더 좋습니다.\n- QR (당좌비율) — 회사가 재고를 판매하거나 추가 자금을 조달하지 않고 현재 부채를 갚을 수 있는 능력을 측정합니다.\n- 자산TO (자산회전율) — 회사 자산이 매출이나 수익을 생성하는 효율성을 측정합니다.\n- DY (배당수익률) — 회사가 매년 배당으로 지급하는 금액을 주가에 상대적으로 측정한 비율. 이는 주식 투자의 배당수익률을 추정한 지표입니다.\n- 베타 — 주식의 시장 전체 대비 변동성을 측정하는 지표. 시장보다 더 많이 변동하는 주식은 1.0보다 높은 베타를 가집니다. 시장보다 변동성이 낮은 주식은 1.0보다 낮은 베타를 가집니다.\n- 52주 범위 — 52주 저점에 가까운 주식과 52주 고점에 가까운 주식을 나타내는 시각화 지표. 예를 들어, 90%는 현재 가격이 52주 고점에 매우 가깝다는 것을 나타냅니다.\n- 점수 — 각 주식의 비율 점수 합계\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n## 데이터 접근\n\n우리는 yfinance API를 활용하여 Yahoo Finance에서 데이터를 수집할 것입니다. 티커의 info 구성 요소는 여러 구성 요소 중 하나인 (예: 손익 계산서, 현금 흐름 등) 가장 많은 비율들을 제공할 것입니다.\n\n우리는 finviz screener를 웹 스크레이핑하여 관련 주식 심볼 목록을 얻을 것입니다. 연구가 동일 산업의 이상적으로 비슷한 주식 그룹에서 수행되어야 합니다.\n\n코드는 GitHub의 Jupyter 노트북으로 사용 가능합니다.\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n## Python 라이브러리\n\n다음은 필수 Python 라이브러리입니다:\n\n- yfinance — 금융 시장 데이터에 접근하기 위함\n- pandas — 데이터 프레임\n- numpy — np.nan을 사용함\n- requests — http 요청을 만들기 위함\n- BeautifulSoup — 웹 스크래핑에 사용됨\n- statistics — 표준편차와 평균을 계산하기 위함\n\n## 라이브러리 가져오기\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```python\n# 주식 정보 읽기\nimport yfinance as yf\n\n# DataFrame을 위해\nimport pandas as pd\nimport numpy as np\n\n# finviz를 파싱하기 위해\nimport requests\nfrom bs4 import BeautifulSoup\n\n# 표준 편차와 평균을 계산하기 위해\nimport statistics\n```\n\n## 비율 카테고리\n\n비율은 두 그룹으로 나뉩니다: 카테고리 1에는 낮은 값을 선호하는 비율들이 포함되고, 카테고리 2에는 높은 값을 선호하는 비율들이 포함됩니다. 주가 이익비율 (P/E)은 카테고리 1의 예시 비율입니다. 낮은 P/E 비율은 회사가 저렴하거나 역사적 패턴과 비교하여 잘 수행하고 있다는 것을 시사할 수 있습니다. 현금비율 (CR)은 카테고리 2의 예시로, 높은 CR 점수가 바람직합니다. 우리는 거래가 덜 변동적인 회사에 더 관심이 있으므로 베타 점수는 카테고리 1에 속합니다. 그러나 만약 높은 변동성을 가진 회사에 더 관심이 있다면 카테고리 2로 이동할 수 있습니다.\n\n```python\n# 카테고리 1 비율 점수 - 낮을수록 더 좋음\nCAT1_RATIOS = ['D2E', 'PEG', 'PE fwd', 'PB', 'Beta']\n\n# 카테고리 2 비율 점수 - 높을수록 더 좋음\nCAT2_RATIOS = ['ROCE', 'ROE', 'FCFY', 'CR', 'QR', 'Asset TR', 'EPS fwd']\n```\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n## 주식 심볼\n\n이전에 언급한대로, 관련 주식 심볼 목록을 얻기 위해 finviz 스크리너를 사용할 것입니다. 아래 코드는 예를 들어, 시가총액이 20억 달러 이상인 \"관리되는 가스\" 산업의 \"유틸리티\" 섹터 기업을 위한 필터를 활용하는 것입니다. 요청 매개변수 \"f\"에는 아래와 같이 필터 값을 받습니다.\n\n```js\ndef get_symbols():\n    req = requests.get('https://finviz.com/screener.ashx',\n        params={\n            'v': '111',\n            'f': 'cap_midover,ind_utilitiesregulatedgas',\n            'o': 'company',\n        },\n        headers={\n            'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',\n        })\n    # BeautifulSoup 객체 생성\n    soup = BeautifulSoup(req.text, 'html.parser')\n    \n    # 관심 있는 테이블\n    table = soup.find('table', class_='styled-table-new is-rounded is-tabular-nums w-full screener_table')\n    # 심볼 수집 배열\n    symbols = []\n    for i, row in enumerate(table.find_all('tr')):\n        # 헤더 행은 건너뛰기\n        if i != 0:\n            # 행에서 반복\n            for j, td in enumerate(row.find_all('td')):\n                # 심볼은 두 번째 열에 있음\n                if j == 1:\n                    symbols.append(td.text.strip())\n                    break\n    return symbols\n```\n\n## 주식 심볼 가져오기\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n위의 유틸리티 메소드를 호출하여 symbols 변수를 채우세요.\n\n```js\nsymbols = get_symbols()\n```\n\nget_symbols 함수를 사용하지 않고 이미 주식 심볼 집합을 알 경우 symbols 변수를 초기화할 수도 있습니다. 아래와 같이 표시됩니다:\n\n```js\nsymbols = ['ATO', 'NI', ]\n```\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n\n## 비율 계산하기\n\n먼저 유틸리티를 정의하여 yfinance API의 info 메서드를 활용하여 비율을 계산하고 채워넣습니다.\n\n```python\ndef populate_with_info(data, stock_info):\n    # print(stock_info)\n    data['Symbol'].append(stock_info['symbol'])\n    data['Name'].append(stock_info['longName'])\n    \n    # 숫자를 가독성 좋은 형식으로 변환합니다\n    data['Market Cap'].append(human_format(stock_info['marketCap']))\n    data['Price'].append(stock_info['currentPrice'])\n\n    # 사용 가능한 지표가 없을 수도 있습니다; 그런 경우 NaN을 사용합니다\n    \n    # 가치 평가 비율\n    \n    if 'priceToBook' in stock_info:\n        data['PB'].append(stock_info['priceToBook'])\n    else:\n        data['PB'].append(np.nan)\n    \n    if 'forwardEps' in stock_info:\n        data['EPS fwd'].append(stock_info['forwardEps'])\n    else:\n        data['EPS fwd'].append(np.nan)\n        \n    if 'forwardPE' in stock_info:\n        data['PE fwd'].append(stock_info['forwardPE'])\n    else:\n        data['PE fwd'].append(np.nan)\n        \n    if 'pegRatio' in stock_info:\n        data['PEG'].append(stock_info['pegRatio'])\n    else:\n        data['PEG'].append(np.nan)\n        \n    # 신뢰성 재무 비율\n    \n    if 'debtToEquity' in stock_info:\n        data['D2E'].append(stock_info['debtToEquity'])\n    else:\n        data['D2E'].append(np.nan)\n\n    # 수익성 비율\n    \n    if 'returnOnEquity' in stock_info:\n        data['ROE'].append(stock_info['returnOnEquity'])\n    else:\n        data['ROE'].append(np.nan)\n    \n    if ('freeCashflow' in stock_info) and ('marketCap' in stock_info):\n        fcfy = (stock_info['freeCashflow']/stock_info['marketCap']) * 100\n        data['FCFY'].append(round(fcfy, 2))\n    else:\n        data['FCFY'].append(np.nan)\n\n    # 유동성 비율\n    \n    if 'currentRatio' in stock_info:\n        data['CR'].append(stock_info['currentRatio'])\n    else:\n        data['CR'].append(np.nan)\n\n    if 'quickRatio' in stock_info:\n        data['QR'].append(stock_info['quickRatio'])\n    else:\n        data['CR'].append(np.nan)\n\n    # 기타 정보 (비 비율)\n    \n    if 'dividendYield' in stock_info:\n        data['DY'].append(stock_info['dividendYield']*100)\n    else:\n        data['DY'].append(0.0)\n\n    if 'beta' in stock_info:\n        data['Beta'].append(stock_info['beta'])\n    else:\n        data['Beta'].append(np.nan)\n\n    if 'fiftyTwoWeekLow' in stock_info:\n        data['52w Low'].append(stock_info['fiftyTwoWeekLow'])\n    else:\n        data['52w Low'].append(np.nan)\n        \n    if 'fiftyTwoWeekHigh' in stock_info:    \n        data['52w High'].append(stock_info['fiftyTwoWeekHigh'])\n    else:\n        data['52w High'].append(np.nan)\n```\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n비율을 찾을 수 없는 경우, NaN으로 사전에 추가됩니다. 비율이 NaN으로 설정된 주식은 제거됩니다. 또한 이 방법은 숫자를 사람이 읽을 수 있는 형식으로 변환하는 유틸리티 메서드를 활용합니다. 예를 들어, 5B(십억), 5M(백만) 등으로 표시됩니다.\n\n```js\ndef human_format(num):\n    num = float('{:.3g}'.format(num))\n    magnitude = 0\n    while abs(num) >= 1000:\n        magnitude += 1\n        num /= 1000.0\n    return '{}{}'.format('{:f}'.format(num).rstrip('0.'), ['', 'K', 'M', 'B', 'T'][magnitude])\n```\n\n마지막으로, 재무상태표와 손익계산서를 사용하여 비율을 계산하는 추가 기법 집합이 있습니다.\n\n```js\ndef roce(ticker):\n    income_stm = ticker.income_stmt\n    ebit = income_stm.loc['EBIT'].iloc[0]\n    bs = ticker.balance_sheet\n    return ebit/(bs.loc['Total Assets'].iloc[0]-bs.loc['Current Liabilities'].iloc[0])\n\ndef asset_turnover_ratio(ticker):\n    df_bs = ticker.balance_sheet\n    y0, y1 = df_bs.loc['Total Assets'].iloc[0], df_bs.loc['Total Assets'].iloc[1]\n    avg_asset = (y0 + y1)/2\n    tot_rvn_y0 = ticker.income_stmt.loc['Total Revenue'].iloc[0]/avg_asset\n    return tot_rvn_y0\n\ndef investory_turnover_ratio(ticker):\n    df_bs = ticker.balance_sheet\n    y0, y1 = df_bs.loc['Inventory'].iloc[0], df_bs.loc['Inventory'].iloc[1]\n    avg_inventory = (y0 + y1)/2\n    return ticker.income_stmt.loc['Cost Of Revenue'].iloc[0]/avg_inventory\n```\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n## 지표 수집\n\n주식 심볼에 대한 각 지표를 딕셔너리에 추가해 보겠습니다.\n\n```js\n# 나중에 DF를 만들기 위한 데이터 수집 딕셔너리\ndata = {\n    'Symbol': [],\n    'Name': [],\n    'Market Cap': [],\n    'EPS fwd': [],\n    'PE fwd': [],\n    'PEG': [],\n    'PB': [],\n    'ROE' : [],\n    'ROCE' : [],\n    'FCFY' : [],\n    'D2E' : [],\n    'CR' : [],\n    'QR' : [],\n    'Asset TR': [],\n    'DY' : [],\n    'Beta': [],\n    'Price': [],\n    '52w Low': [],\n    '52w High': []\n    }\nindustry = ''\n\nfor symbol in symbols:\n    ticker = yf.Ticker(symbol)\n    if not industry:\n        industry = ticker.info['industry']\n    else:\n        industry_current = ticker.info['industry'] \n        if industry_current != industry:\n            print(f'다른 산업 {industry_current}을(를) 만났습니다, 이전 산업 {industry}입니다. 중단합니다.')\n            break        \n    populate_with_info(data, ticker.info)\n    data['ROCE'].append(roce(ticker))\n    data['Asset TR'].append(asset_turnover_ratio(ticker))\n```\n\n이전에 언급한대로, 이 방법에는 현재 주식의 산업이 이전 주식의 산업과 다른지 간단히 확인하는 절차가 포함되어 있습니다.\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n## DataFrame 생성하기\n\n```js\n# 사전을 사용하여 DF 생성\ndf = pd.DataFrame(data)\n\n# NaN 값을 가진 주식 저장\ndf_exceptions = df[df.isna().any(axis=1)]\n\n# NaN 값을 가진 주식 제거\ndf = df.dropna()\n\n# NaN 값을 가진 행을 삭제한 후 인덱스 재설정\ndf.reset_index(drop=True, inplace=True)\n\n# 52주간 가격 범위 추가\ndf['52주 범위'] = ((df['가격'] - df['52주 최저가']) / (df['52주 최고가'] - df['52주 최저가'])) * 100\n\ndf_exceptions\n```\n\nNaN으로 설정된 비율이 있는 주식은 제거되고, 예외 DataFrame에 저장됩니다. 마지막으로 52주 가격 범위가 포함될 것입니다.\n\n<img src=\"/TIL/assets/img/2024-07-14-FundamentalAnalysisforrankingStockswithPythonAPI_0.png\" />\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n\"그리고 비예외 주식에 대한 결과는:\n\n![Fundamental Analysis](/TIL/assets/img/2024-07-14-FundamentalAnalysisforrankingStockswithPythonAPI_1.png)\n\n## 점수\n\n다음 단계는 원시 데이터에 점수를 적용하는 것입니다.\"\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\ndef score(values, value, cat) -> int:\n    '''\n    카테고리에 따라 표준 편차와 평균을 기반으로 점수를 계산합니다. 낮은 값을 선호하는 PE와 같은 비율의 경우, 다음과 같이 점수가 계산됩니다:\n    1. 주어진 PE가 -1 표준 편차와 평균 사이에 있는 경우 1점 반환\n    2. 주어진 PE가 -2 표준 편차와 -1 표준 편차 사이에 있는 경우 2점 반환\n    3. PE가 -2 표준 편차를 벗어나는 경우 3점 반환\n    4. 주어진 PE가 1 표준 편차와 평균 사이에 있는 경우 -1점 반환\n    5. 주어진 PE가 +1 표준 편차와 +2 표준 편차 사이에 있는 경우 -2점 반환\n    6. 주어진 PE가 +2 표준 편차를 벗어나는 경우 -3점 반환\n\n    높은 값을 선호하는 ROE와 같은 비율의 경우, 다음과 같이 점수가 계산됩니다:\n    1. 주어진 ROE가 평균과 +1 표준 편차 사이에 있는 경우 1점 반환\n    2. 주어진 ROE가 +1 표준 편차와 +2 표준 편차 사이에 있는 경우 2점 반환\n    3. ROE가 +2 표준 편차를 벗어나는 경우 3점 반환\n    4. 주어진 ROE가 -1 표준 편차와 평균 사이에 있는 경우 -1점 반환\n    5. 주어진 ROE가 -1 표준 편차와 -2 표준 편차 사이에 있는 경우 -2점 반환\n    6. 주어진 ROE가 -2 표준 편차를 벗어나는 경우 -3점 반환\n\n    Parameters\n    ----------\n    values : 값들의 목록\n    value: 평균, 1 표준 편차, -1 표준 편차, 2 표준 편차 또는 -2 표준 편차 내에 있는지 확인할 값\n    cat: 카테고리 유형, 유효한 값은 1 또는 2입니다.\n        \n    Returns\n    -------\n    score: 주어진 'value'에 대한 점수\n    '''\n    \n    std = statistics.stdev(values)\n    mean = statistics.mean(values)\n\n    if cat == 1:\n        if (mean + (-1 * std)) < value <= mean:\n            return 1\n        elif (mean + (-2 * std)) < value <= (mean + (-1 * std)):\n            return 2\n        elif value <= (mean + (-2 * std)):\n            return 3\n        elif mean < value <= (mean + (1 * std)):\n            return -1\n        elif (mean + (1 * std)) < value <= (mean + (2 * std)):\n            return -2\n        else:\n            return -3\n    else:\n        if mean <= value < (mean + (1 * std)):\n            return 1\n        elif (mean + (1 * std)) <= value < (mean + (2 * std)):\n            return 2\n        elif value >= (mean + (2 * std)):\n            return 3\n        elif (mean + (-1 * std)) <= value < mean:\n            return -1\n        elif (mean + (-2 * std)) <= value < (mean + (-1 * std)):\n            return -2\n        else:\n            return -3\n```\n\n요약하면 다음과 같이 카테고리 1의 비율에 제공되는 값에 대해 다음 점수가 반환됩니다: (평균 - 1 * 표준 편차)과 평균 사이에 비율이 있는 경우 1; (평균 - 2 * 표준 편차)와 (평균 - 1 * 표준 편차) 사이에 비율이 있는 경우 2; (평균 - 2 * 표준 편차)보다 작은 경우 3; 그 반대 경우에는 음수 값이 반환됩니다. 카테고리 2도 비슷한 절차를 따르지만 반대 방향으로 작동합니다. 이러한 점수는 어느 정도 임의적이며, 이상값은 최대 또는 최소 점수를 받습니다. 이상값으로 인한 편향을 제거하려면, 이상값에 대한 점수를 조정하여, 예를 들어 평균 - 2 * 표준 편차보다 낮은 비율의 경우 0을 반환하는 등의 조치를 취할 수 있습니다.\n\n점수 부여를 적용하고, 두 카테고리에 대해 제공된 각 비율에 대한 점수를 합산하는 열을 추가합니다.\n\n```js\ndf_score = df.copy()\n\nfor col in CAT1_RATIOS:\n    for index, value in df[col].items():\n        # print(f'{col} - {index} - {value}')\n        df_score.loc[index, col] = score(df[col], value, 1)\n\nfor col in CAT2_RATIOS:\n    for index, value in df[col].items():\n        # print(f'{col} - {index} - {value}')\n        df_score.loc[index, col] = score(df[col], value, 2)\n\n# 총점을 얻기 위해 순위 점수를 추가\ndf_score['Score'] = df_score[CAT1_RATIOS+CAT2_RATIOS].sum(axis=1)\n```\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\ndef make_pretty(styler):\n    # 열 형식 지정\n    styler.format({'EPS fwd': '{:.0f}', 'PE fwd': '{:.0f}', 'PEG': '{:.0f}', 'FCFY': '{:.0f}', 'PB': '{:.0f}', 'ROE': '{:.0f}',\n                   'ROCE': '{:.0f}', 'D2E': '{:.0f}', 'CR': '{:.0f}', 'QR': '{:.0f}', 'Asset TR': '{:.0f}', 'DY': '{:.2f}%',\n                   'Beta': '{:.0f}', '52w Low': '${:.2f}', 'Price': '${:.2f}', '52w High': '${:.2f}', '52w Range': '{:.2f}%', 'Score': '{:.0f}'\n                  })\n\n    # 바 시각화 설정\n    styler.bar(subset=['52w Range'], align=\"mid\", color=[\"salmon\", \"cornflowerblue\"])\n\n    # 그리드\n    styler.set_properties(**{'border': '0.1px solid black'})\n\n    # 배경 그라데이션 설정\n    for ratio in CAT1_RATIOS:\n        styler.background_gradient(subset=[ratio], cmap='RdYlGn', gmap=-df[ratio])\n    for ratio in CAT2_RATIOS:\n        styler.background_gradient(subset=[ratio], cmap='RdYlGn')\n    styler.background_gradient(subset=['Score'], cmap='PiYG')\n    \n    # 인덱스 숨기기\n    styler.hide(axis='index')\n\n    # 일부 열에 대해 왼쪽 텍스트 정렬\n    styler.set_properties(subset=['Symbol', 'Name'], **{'text-align': 'left'})\n    styler.set_properties(subset=CAT1_RATIOS + CAT2_RATIOS + ['Market Cap', 'Score'], **{'text-align': 'center'})\n\n    return styler\n```\n\n마지막으로, DataFrame에 스타일을 추가합니다:\n\n```js\n# DF에 테이블 캡션 및 스타일 추가\ndf_score.style.pipe(make_pretty).set_caption(f'{industry} 주식 스크리너').set_table_styles(\n    [{'selector': 'th.col_heading', 'props': 'text-align: center'},\n     {'selector': 'caption', 'props': [('text-align', 'center'),\n                                       ('font-size', '11pt'), ('font-weight', 'bold')]}])\n```\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n![image](/TIL/assets/img/2024-07-14-FundamentalAnalysisforrankingStockswithPythonAPI_2.png)\n\n시가총액이 20억 달러 이상인 ATO와 SR은 “Regulated Gas” 산업 중 모든 주식 중에서 가장 높은 점수를 받은 두 가지 유틸리티 섹터 주식입니다. 그러나 ATO의 가격은 현재 52주 최고가에 더 가깝고, SR의 가격은 52주 최저가에 더 가깝습니다.\n\n여러 비율이 현재 주식 가격에 의존하기 때문에 결과는 노트북을 호출하는 시점에 따라 변할 수 있습니다.\n\n## 결론\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n이 기사에서는 기초 분석 기반의 주식 순위 결정 방법을 설명하며, 이 방법은 주식 그룹의 평균과 표준 편차를 기반으로 각 비율에 점수를 할당합니다.\n\n분석 목적상, 대부분의 비율은 비슷한 주식 그룹 내에서만 의미가 있는 경우가 많으므로 관련된 주식 그룹을 선택하는 것이 중요합니다.\n\n평가 시스템이 임의적이지만, 이 포스트가 가중 점수와 같은 다른 점수 시스템을 탐구하는 기초를 제시한다고 생각합니다.\n\n정보가 유익하게 느껴졌길 바라며, 피드백을 소중히 여깁니다.","ogImage":{"url":"/TIL/assets/img/2024-07-14-FundamentalAnalysisforrankingStockswithPythonAPI_0.png"},"coverImage":"/TIL/assets/img/2024-07-14-FundamentalAnalysisforrankingStockswithPythonAPI_0.png","tag":["Tech"],"readingTime":19},"content":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n</head>\n<body>\n<p>이 기사에서는 기초 및 주식 세부 정보에 따라 주식을 순위로 나열할 것입니다. 이 접근 방식은 기존 기사 \"Python API를 사용한 기초 주식 분석\"에서 주식 그룹의 평균과 표준 편차를 기반으로 비율에 대한 점수 방법을 적용합니다.</p>\n<p>면책 조항: 여기서 제공된 정보는 정보 목적으로만 제공되며 개인 재정, 투자 또는 기타 조언을 의도한 것이 아닙니다.</p>\n<p>이 기사에서 사용되는 주요 비율은 다음과 같습니다:</p>\n<ul>\n<li>EPS (주당순이익) — 회사 이익 중 각 주식에 할당된 부분</li>\n<li>PE (주가 수익 비율) — 회사의 주가와 주당 순이익 간 관계. 투자자가 해당 섹터의 다른 종목에 비해 주식이 저평가되었는지 또는 고평가되었는지 판단하는 데 도움이 됩니다.</li>\n<li>PEG (예상 이익 성장률) — 주식의 P/E를 예상된 12개월 수익 성장률로 나눈 것. 일반적으로 1보다 낮은 PEG는 좋은 신호이며, 2보다 높은 PEG는 주식이 과도 가격화될 수 있음을 나타냅니다.</li>\n<li>PB (주가순자산가치비율) — 1의 비율은 회사의 주식이 순자산가치에 준하는 가격에 거래되고 있음을 나타냅니다. 1보다 높은 P/B는 회사가 순자산가치에 프리미엄을 지불하고 있음을 시사하며, 1보다 낮은 비율은 회사 자산에 비해 저평가된 주식을 나타낼 수 있습니다.</li>\n<li>ROE (자기자본이익률) — 회사가 자산을 이용하여 이익을 창출하는 데 효과적으로 활용하는 방법을 투자자에게 제공합니다. 더 높은 ROE는 주주 자본을 더 효과적으로 활용하고 주식 수요 증가 및 미래 이익 증가, 그리고 주가 상승으로 이어질 수 있음을 나타냅니다.</li>\n<li>ROCE (총 자본 대지수이익률) — 모든 자본을 기준으로 회사의 수익성을 측정합니다.</li>\n<li>FCFY (재무건전도 비율) — 회사가 주당 기대하는 영업현금흐름과 주당 시장가치를 비교하는 지표. 낮은 비율은 덜 매력적인 투자 기회를 나타냅니다.</li>\n<li>D2E (부채대자본비) — 회사의 총부채를 자기자본과 비교합니다.</li>\n<li>CR (유동비율) — 회사가 유동자산(1년 이내 지급 예정 금액)으로 현재 부채를 갚을 수 있는 능력을 측정합니다. 비율이 높을수록 회사의 유동성이 더 좋습니다.</li>\n<li>QR (당좌비율) — 회사가 재고를 판매하거나 추가 자금을 조달하지 않고 현재 부채를 갚을 수 있는 능력을 측정합니다.</li>\n<li>자산TO (자산회전율) — 회사 자산이 매출이나 수익을 생성하는 효율성을 측정합니다.</li>\n<li>DY (배당수익률) — 회사가 매년 배당으로 지급하는 금액을 주가에 상대적으로 측정한 비율. 이는 주식 투자의 배당수익률을 추정한 지표입니다.</li>\n<li>베타 — 주식의 시장 전체 대비 변동성을 측정하는 지표. 시장보다 더 많이 변동하는 주식은 1.0보다 높은 베타를 가집니다. 시장보다 변동성이 낮은 주식은 1.0보다 낮은 베타를 가집니다.</li>\n<li>52주 범위 — 52주 저점에 가까운 주식과 52주 고점에 가까운 주식을 나타내는 시각화 지표. 예를 들어, 90%는 현재 가격이 52주 고점에 매우 가깝다는 것을 나타냅니다.</li>\n<li>점수 — 각 주식의 비율 점수 합계</li>\n</ul>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<h2>데이터 접근</h2>\n<p>우리는 yfinance API를 활용하여 Yahoo Finance에서 데이터를 수집할 것입니다. 티커의 info 구성 요소는 여러 구성 요소 중 하나인 (예: 손익 계산서, 현금 흐름 등) 가장 많은 비율들을 제공할 것입니다.</p>\n<p>우리는 finviz screener를 웹 스크레이핑하여 관련 주식 심볼 목록을 얻을 것입니다. 연구가 동일 산업의 이상적으로 비슷한 주식 그룹에서 수행되어야 합니다.</p>\n<p>코드는 GitHub의 Jupyter 노트북으로 사용 가능합니다.</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<h2>Python 라이브러리</h2>\n<p>다음은 필수 Python 라이브러리입니다:</p>\n<ul>\n<li>yfinance — 금융 시장 데이터에 접근하기 위함</li>\n<li>pandas — 데이터 프레임</li>\n<li>numpy — np.nan을 사용함</li>\n<li>requests — http 요청을 만들기 위함</li>\n<li>BeautifulSoup — 웹 스크래핑에 사용됨</li>\n<li>statistics — 표준편차와 평균을 계산하기 위함</li>\n</ul>\n<h2>라이브러리 가져오기</h2>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\"># 주식 정보 읽기</span>\n<span class=\"hljs-keyword\">import</span> yfinance <span class=\"hljs-keyword\">as</span> yf\n\n<span class=\"hljs-comment\"># DataFrame을 위해</span>\n<span class=\"hljs-keyword\">import</span> pandas <span class=\"hljs-keyword\">as</span> pd\n<span class=\"hljs-keyword\">import</span> numpy <span class=\"hljs-keyword\">as</span> np\n\n<span class=\"hljs-comment\"># finviz를 파싱하기 위해</span>\n<span class=\"hljs-keyword\">import</span> requests\n<span class=\"hljs-keyword\">from</span> bs4 <span class=\"hljs-keyword\">import</span> BeautifulSoup\n\n<span class=\"hljs-comment\"># 표준 편차와 평균을 계산하기 위해</span>\n<span class=\"hljs-keyword\">import</span> statistics\n</code></pre>\n<h2>비율 카테고리</h2>\n<p>비율은 두 그룹으로 나뉩니다: 카테고리 1에는 낮은 값을 선호하는 비율들이 포함되고, 카테고리 2에는 높은 값을 선호하는 비율들이 포함됩니다. 주가 이익비율 (P/E)은 카테고리 1의 예시 비율입니다. 낮은 P/E 비율은 회사가 저렴하거나 역사적 패턴과 비교하여 잘 수행하고 있다는 것을 시사할 수 있습니다. 현금비율 (CR)은 카테고리 2의 예시로, 높은 CR 점수가 바람직합니다. 우리는 거래가 덜 변동적인 회사에 더 관심이 있으므로 베타 점수는 카테고리 1에 속합니다. 그러나 만약 높은 변동성을 가진 회사에 더 관심이 있다면 카테고리 2로 이동할 수 있습니다.</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\"># 카테고리 1 비율 점수 - 낮을수록 더 좋음</span>\nCAT1_RATIOS = [<span class=\"hljs-string\">'D2E'</span>, <span class=\"hljs-string\">'PEG'</span>, <span class=\"hljs-string\">'PE fwd'</span>, <span class=\"hljs-string\">'PB'</span>, <span class=\"hljs-string\">'Beta'</span>]\n\n<span class=\"hljs-comment\"># 카테고리 2 비율 점수 - 높을수록 더 좋음</span>\nCAT2_RATIOS = [<span class=\"hljs-string\">'ROCE'</span>, <span class=\"hljs-string\">'ROE'</span>, <span class=\"hljs-string\">'FCFY'</span>, <span class=\"hljs-string\">'CR'</span>, <span class=\"hljs-string\">'QR'</span>, <span class=\"hljs-string\">'Asset TR'</span>, <span class=\"hljs-string\">'EPS fwd'</span>]\n</code></pre>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<h2>주식 심볼</h2>\n<p>이전에 언급한대로, 관련 주식 심볼 목록을 얻기 위해 finviz 스크리너를 사용할 것입니다. 아래 코드는 예를 들어, 시가총액이 20억 달러 이상인 \"관리되는 가스\" 산업의 \"유틸리티\" 섹터 기업을 위한 필터를 활용하는 것입니다. 요청 매개변수 \"f\"에는 아래와 같이 필터 값을 받습니다.</p>\n<pre><code class=\"hljs language-js\">def <span class=\"hljs-title function_\">get_symbols</span>():\n    req = requests.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">'https://finviz.com/screener.ashx'</span>,\n        params={\n            <span class=\"hljs-string\">'v'</span>: <span class=\"hljs-string\">'111'</span>,\n            <span class=\"hljs-string\">'f'</span>: <span class=\"hljs-string\">'cap_midover,ind_utilitiesregulatedgas'</span>,\n            <span class=\"hljs-string\">'o'</span>: <span class=\"hljs-string\">'company'</span>,\n        },\n        headers={\n            <span class=\"hljs-string\">'user-agent'</span>: <span class=\"hljs-string\">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36'</span>,\n        })\n    # <span class=\"hljs-title class_\">BeautifulSoup</span> 객체 생성\n    soup = <span class=\"hljs-title class_\">BeautifulSoup</span>(req.<span class=\"hljs-property\">text</span>, <span class=\"hljs-string\">'html.parser'</span>)\n    \n    # 관심 있는 테이블\n    table = soup.<span class=\"hljs-title function_\">find</span>(<span class=\"hljs-string\">'table'</span>, class_=<span class=\"hljs-string\">'styled-table-new is-rounded is-tabular-nums w-full screener_table'</span>)\n    # 심볼 수집 배열\n    symbols = []\n    <span class=\"hljs-keyword\">for</span> i, row <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">enumerate</span>(table.<span class=\"hljs-title function_\">find_all</span>(<span class=\"hljs-string\">'tr'</span>)):\n        # 헤더 행은 건너뛰기\n        <span class=\"hljs-keyword\">if</span> i != <span class=\"hljs-number\">0</span>:\n            # 행에서 반복\n            <span class=\"hljs-keyword\">for</span> j, td <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">enumerate</span>(row.<span class=\"hljs-title function_\">find_all</span>(<span class=\"hljs-string\">'td'</span>)):\n                # 심볼은 두 번째 열에 있음\n                <span class=\"hljs-keyword\">if</span> j == <span class=\"hljs-number\">1</span>:\n                    symbols.<span class=\"hljs-title function_\">append</span>(td.<span class=\"hljs-property\">text</span>.<span class=\"hljs-title function_\">strip</span>())\n                    <span class=\"hljs-keyword\">break</span>\n    <span class=\"hljs-keyword\">return</span> symbols\n</code></pre>\n<h2>주식 심볼 가져오기</h2>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>위의 유틸리티 메소드를 호출하여 symbols 변수를 채우세요.</p>\n<pre><code class=\"hljs language-js\">symbols = <span class=\"hljs-title function_\">get_symbols</span>()\n</code></pre>\n<p>get_symbols 함수를 사용하지 않고 이미 주식 심볼 집합을 알 경우 symbols 변수를 초기화할 수도 있습니다. 아래와 같이 표시됩니다:</p>\n<pre><code class=\"hljs language-js\">symbols = [<span class=\"hljs-string\">'ATO'</span>, <span class=\"hljs-string\">'NI'</span>, ]\n</code></pre>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<h2>비율 계산하기</h2>\n<p>먼저 유틸리티를 정의하여 yfinance API의 info 메서드를 활용하여 비율을 계산하고 채워넣습니다.</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">populate_with_info</span>(<span class=\"hljs-params\">data, stock_info</span>):\n    <span class=\"hljs-comment\"># print(stock_info)</span>\n    data[<span class=\"hljs-string\">'Symbol'</span>].append(stock_info[<span class=\"hljs-string\">'symbol'</span>])\n    data[<span class=\"hljs-string\">'Name'</span>].append(stock_info[<span class=\"hljs-string\">'longName'</span>])\n    \n    <span class=\"hljs-comment\"># 숫자를 가독성 좋은 형식으로 변환합니다</span>\n    data[<span class=\"hljs-string\">'Market Cap'</span>].append(human_format(stock_info[<span class=\"hljs-string\">'marketCap'</span>]))\n    data[<span class=\"hljs-string\">'Price'</span>].append(stock_info[<span class=\"hljs-string\">'currentPrice'</span>])\n\n    <span class=\"hljs-comment\"># 사용 가능한 지표가 없을 수도 있습니다; 그런 경우 NaN을 사용합니다</span>\n    \n    <span class=\"hljs-comment\"># 가치 평가 비율</span>\n    \n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-string\">'priceToBook'</span> <span class=\"hljs-keyword\">in</span> stock_info:\n        data[<span class=\"hljs-string\">'PB'</span>].append(stock_info[<span class=\"hljs-string\">'priceToBook'</span>])\n    <span class=\"hljs-keyword\">else</span>:\n        data[<span class=\"hljs-string\">'PB'</span>].append(np.nan)\n    \n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-string\">'forwardEps'</span> <span class=\"hljs-keyword\">in</span> stock_info:\n        data[<span class=\"hljs-string\">'EPS fwd'</span>].append(stock_info[<span class=\"hljs-string\">'forwardEps'</span>])\n    <span class=\"hljs-keyword\">else</span>:\n        data[<span class=\"hljs-string\">'EPS fwd'</span>].append(np.nan)\n        \n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-string\">'forwardPE'</span> <span class=\"hljs-keyword\">in</span> stock_info:\n        data[<span class=\"hljs-string\">'PE fwd'</span>].append(stock_info[<span class=\"hljs-string\">'forwardPE'</span>])\n    <span class=\"hljs-keyword\">else</span>:\n        data[<span class=\"hljs-string\">'PE fwd'</span>].append(np.nan)\n        \n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-string\">'pegRatio'</span> <span class=\"hljs-keyword\">in</span> stock_info:\n        data[<span class=\"hljs-string\">'PEG'</span>].append(stock_info[<span class=\"hljs-string\">'pegRatio'</span>])\n    <span class=\"hljs-keyword\">else</span>:\n        data[<span class=\"hljs-string\">'PEG'</span>].append(np.nan)\n        \n    <span class=\"hljs-comment\"># 신뢰성 재무 비율</span>\n    \n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-string\">'debtToEquity'</span> <span class=\"hljs-keyword\">in</span> stock_info:\n        data[<span class=\"hljs-string\">'D2E'</span>].append(stock_info[<span class=\"hljs-string\">'debtToEquity'</span>])\n    <span class=\"hljs-keyword\">else</span>:\n        data[<span class=\"hljs-string\">'D2E'</span>].append(np.nan)\n\n    <span class=\"hljs-comment\"># 수익성 비율</span>\n    \n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-string\">'returnOnEquity'</span> <span class=\"hljs-keyword\">in</span> stock_info:\n        data[<span class=\"hljs-string\">'ROE'</span>].append(stock_info[<span class=\"hljs-string\">'returnOnEquity'</span>])\n    <span class=\"hljs-keyword\">else</span>:\n        data[<span class=\"hljs-string\">'ROE'</span>].append(np.nan)\n    \n    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-string\">'freeCashflow'</span> <span class=\"hljs-keyword\">in</span> stock_info) <span class=\"hljs-keyword\">and</span> (<span class=\"hljs-string\">'marketCap'</span> <span class=\"hljs-keyword\">in</span> stock_info):\n        fcfy = (stock_info[<span class=\"hljs-string\">'freeCashflow'</span>]/stock_info[<span class=\"hljs-string\">'marketCap'</span>]) * <span class=\"hljs-number\">100</span>\n        data[<span class=\"hljs-string\">'FCFY'</span>].append(<span class=\"hljs-built_in\">round</span>(fcfy, <span class=\"hljs-number\">2</span>))\n    <span class=\"hljs-keyword\">else</span>:\n        data[<span class=\"hljs-string\">'FCFY'</span>].append(np.nan)\n\n    <span class=\"hljs-comment\"># 유동성 비율</span>\n    \n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-string\">'currentRatio'</span> <span class=\"hljs-keyword\">in</span> stock_info:\n        data[<span class=\"hljs-string\">'CR'</span>].append(stock_info[<span class=\"hljs-string\">'currentRatio'</span>])\n    <span class=\"hljs-keyword\">else</span>:\n        data[<span class=\"hljs-string\">'CR'</span>].append(np.nan)\n\n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-string\">'quickRatio'</span> <span class=\"hljs-keyword\">in</span> stock_info:\n        data[<span class=\"hljs-string\">'QR'</span>].append(stock_info[<span class=\"hljs-string\">'quickRatio'</span>])\n    <span class=\"hljs-keyword\">else</span>:\n        data[<span class=\"hljs-string\">'CR'</span>].append(np.nan)\n\n    <span class=\"hljs-comment\"># 기타 정보 (비 비율)</span>\n    \n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-string\">'dividendYield'</span> <span class=\"hljs-keyword\">in</span> stock_info:\n        data[<span class=\"hljs-string\">'DY'</span>].append(stock_info[<span class=\"hljs-string\">'dividendYield'</span>]*<span class=\"hljs-number\">100</span>)\n    <span class=\"hljs-keyword\">else</span>:\n        data[<span class=\"hljs-string\">'DY'</span>].append(<span class=\"hljs-number\">0.0</span>)\n\n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-string\">'beta'</span> <span class=\"hljs-keyword\">in</span> stock_info:\n        data[<span class=\"hljs-string\">'Beta'</span>].append(stock_info[<span class=\"hljs-string\">'beta'</span>])\n    <span class=\"hljs-keyword\">else</span>:\n        data[<span class=\"hljs-string\">'Beta'</span>].append(np.nan)\n\n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-string\">'fiftyTwoWeekLow'</span> <span class=\"hljs-keyword\">in</span> stock_info:\n        data[<span class=\"hljs-string\">'52w Low'</span>].append(stock_info[<span class=\"hljs-string\">'fiftyTwoWeekLow'</span>])\n    <span class=\"hljs-keyword\">else</span>:\n        data[<span class=\"hljs-string\">'52w Low'</span>].append(np.nan)\n        \n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-string\">'fiftyTwoWeekHigh'</span> <span class=\"hljs-keyword\">in</span> stock_info:    \n        data[<span class=\"hljs-string\">'52w High'</span>].append(stock_info[<span class=\"hljs-string\">'fiftyTwoWeekHigh'</span>])\n    <span class=\"hljs-keyword\">else</span>:\n        data[<span class=\"hljs-string\">'52w High'</span>].append(np.nan)\n</code></pre>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>비율을 찾을 수 없는 경우, NaN으로 사전에 추가됩니다. 비율이 NaN으로 설정된 주식은 제거됩니다. 또한 이 방법은 숫자를 사람이 읽을 수 있는 형식으로 변환하는 유틸리티 메서드를 활용합니다. 예를 들어, 5B(십억), 5M(백만) 등으로 표시됩니다.</p>\n<pre><code class=\"hljs language-js\">def <span class=\"hljs-title function_\">human_format</span>(num):\n    num = <span class=\"hljs-title function_\">float</span>(<span class=\"hljs-string\">'{:.3g}'</span>.<span class=\"hljs-title function_\">format</span>(num))\n    magnitude = <span class=\"hljs-number\">0</span>\n    <span class=\"hljs-keyword\">while</span> <span class=\"hljs-title function_\">abs</span>(num) >= <span class=\"hljs-number\">1000</span>:\n        magnitude += <span class=\"hljs-number\">1</span>\n        num /= <span class=\"hljs-number\">1000.0</span>\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">'{}{}'</span>.<span class=\"hljs-title function_\">format</span>(<span class=\"hljs-string\">'{:f}'</span>.<span class=\"hljs-title function_\">format</span>(num).<span class=\"hljs-title function_\">rstrip</span>(<span class=\"hljs-string\">'0.'</span>), [<span class=\"hljs-string\">''</span>, <span class=\"hljs-string\">'K'</span>, <span class=\"hljs-string\">'M'</span>, <span class=\"hljs-string\">'B'</span>, <span class=\"hljs-string\">'T'</span>][magnitude])\n</code></pre>\n<p>마지막으로, 재무상태표와 손익계산서를 사용하여 비율을 계산하는 추가 기법 집합이 있습니다.</p>\n<pre><code class=\"hljs language-js\">def <span class=\"hljs-title function_\">roce</span>(ticker):\n    income_stm = ticker.<span class=\"hljs-property\">income_stmt</span>\n    ebit = income_stm.<span class=\"hljs-property\">loc</span>[<span class=\"hljs-string\">'EBIT'</span>].<span class=\"hljs-property\">iloc</span>[<span class=\"hljs-number\">0</span>]\n    bs = ticker.<span class=\"hljs-property\">balance_sheet</span>\n    <span class=\"hljs-keyword\">return</span> ebit/(bs.<span class=\"hljs-property\">loc</span>[<span class=\"hljs-string\">'Total Assets'</span>].<span class=\"hljs-property\">iloc</span>[<span class=\"hljs-number\">0</span>]-bs.<span class=\"hljs-property\">loc</span>[<span class=\"hljs-string\">'Current Liabilities'</span>].<span class=\"hljs-property\">iloc</span>[<span class=\"hljs-number\">0</span>])\n\ndef <span class=\"hljs-title function_\">asset_turnover_ratio</span>(ticker):\n    df_bs = ticker.<span class=\"hljs-property\">balance_sheet</span>\n    y0, y1 = df_bs.<span class=\"hljs-property\">loc</span>[<span class=\"hljs-string\">'Total Assets'</span>].<span class=\"hljs-property\">iloc</span>[<span class=\"hljs-number\">0</span>], df_bs.<span class=\"hljs-property\">loc</span>[<span class=\"hljs-string\">'Total Assets'</span>].<span class=\"hljs-property\">iloc</span>[<span class=\"hljs-number\">1</span>]\n    avg_asset = (y0 + y1)/<span class=\"hljs-number\">2</span>\n    tot_rvn_y0 = ticker.<span class=\"hljs-property\">income_stmt</span>.<span class=\"hljs-property\">loc</span>[<span class=\"hljs-string\">'Total Revenue'</span>].<span class=\"hljs-property\">iloc</span>[<span class=\"hljs-number\">0</span>]/avg_asset\n    <span class=\"hljs-keyword\">return</span> tot_rvn_y0\n\ndef <span class=\"hljs-title function_\">investory_turnover_ratio</span>(ticker):\n    df_bs = ticker.<span class=\"hljs-property\">balance_sheet</span>\n    y0, y1 = df_bs.<span class=\"hljs-property\">loc</span>[<span class=\"hljs-string\">'Inventory'</span>].<span class=\"hljs-property\">iloc</span>[<span class=\"hljs-number\">0</span>], df_bs.<span class=\"hljs-property\">loc</span>[<span class=\"hljs-string\">'Inventory'</span>].<span class=\"hljs-property\">iloc</span>[<span class=\"hljs-number\">1</span>]\n    avg_inventory = (y0 + y1)/<span class=\"hljs-number\">2</span>\n    <span class=\"hljs-keyword\">return</span> ticker.<span class=\"hljs-property\">income_stmt</span>.<span class=\"hljs-property\">loc</span>[<span class=\"hljs-string\">'Cost Of Revenue'</span>].<span class=\"hljs-property\">iloc</span>[<span class=\"hljs-number\">0</span>]/avg_inventory\n</code></pre>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<h2>지표 수집</h2>\n<p>주식 심볼에 대한 각 지표를 딕셔너리에 추가해 보겠습니다.</p>\n<pre><code class=\"hljs language-js\"># 나중에 <span class=\"hljs-variable constant_\">DF</span>를 만들기 위한 데이터 수집 딕셔너리\ndata = {\n    <span class=\"hljs-string\">'Symbol'</span>: [],\n    <span class=\"hljs-string\">'Name'</span>: [],\n    <span class=\"hljs-string\">'Market Cap'</span>: [],\n    <span class=\"hljs-string\">'EPS fwd'</span>: [],\n    <span class=\"hljs-string\">'PE fwd'</span>: [],\n    <span class=\"hljs-string\">'PEG'</span>: [],\n    <span class=\"hljs-string\">'PB'</span>: [],\n    <span class=\"hljs-string\">'ROE'</span> : [],\n    <span class=\"hljs-string\">'ROCE'</span> : [],\n    <span class=\"hljs-string\">'FCFY'</span> : [],\n    <span class=\"hljs-string\">'D2E'</span> : [],\n    <span class=\"hljs-string\">'CR'</span> : [],\n    <span class=\"hljs-string\">'QR'</span> : [],\n    <span class=\"hljs-string\">'Asset TR'</span>: [],\n    <span class=\"hljs-string\">'DY'</span> : [],\n    <span class=\"hljs-string\">'Beta'</span>: [],\n    <span class=\"hljs-string\">'Price'</span>: [],\n    <span class=\"hljs-string\">'52w Low'</span>: [],\n    <span class=\"hljs-string\">'52w High'</span>: []\n    }\nindustry = <span class=\"hljs-string\">''</span>\n\n<span class=\"hljs-keyword\">for</span> symbol <span class=\"hljs-keyword\">in</span> <span class=\"hljs-attr\">symbols</span>:\n    ticker = yf.<span class=\"hljs-title class_\">Ticker</span>(symbol)\n    <span class=\"hljs-keyword\">if</span> not <span class=\"hljs-attr\">industry</span>:\n        industry = ticker.<span class=\"hljs-property\">info</span>[<span class=\"hljs-string\">'industry'</span>]\n    <span class=\"hljs-attr\">else</span>:\n        industry_current = ticker.<span class=\"hljs-property\">info</span>[<span class=\"hljs-string\">'industry'</span>] \n        <span class=\"hljs-keyword\">if</span> industry_current != <span class=\"hljs-attr\">industry</span>:\n            <span class=\"hljs-title function_\">print</span>(f<span class=\"hljs-string\">'다른 산업 {industry_current}을(를) 만났습니다, 이전 산업 {industry}입니다. 중단합니다.'</span>)\n            <span class=\"hljs-keyword\">break</span>        \n    <span class=\"hljs-title function_\">populate_with_info</span>(data, ticker.<span class=\"hljs-property\">info</span>)\n    data[<span class=\"hljs-string\">'ROCE'</span>].<span class=\"hljs-title function_\">append</span>(<span class=\"hljs-title function_\">roce</span>(ticker))\n    data[<span class=\"hljs-string\">'Asset TR'</span>].<span class=\"hljs-title function_\">append</span>(<span class=\"hljs-title function_\">asset_turnover_ratio</span>(ticker))\n</code></pre>\n<p>이전에 언급한대로, 이 방법에는 현재 주식의 산업이 이전 주식의 산업과 다른지 간단히 확인하는 절차가 포함되어 있습니다.</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<h2>DataFrame 생성하기</h2>\n<pre><code class=\"hljs language-js\"># 사전을 사용하여 <span class=\"hljs-variable constant_\">DF</span> 생성\ndf = pd.<span class=\"hljs-title class_\">DataFrame</span>(data)\n\n# <span class=\"hljs-title class_\">NaN</span> 값을 가진 주식 저장\ndf_exceptions = df[df.<span class=\"hljs-title function_\">isna</span>().<span class=\"hljs-title function_\">any</span>(axis=<span class=\"hljs-number\">1</span>)]\n\n# <span class=\"hljs-title class_\">NaN</span> 값을 가진 주식 제거\ndf = df.<span class=\"hljs-title function_\">dropna</span>()\n\n# <span class=\"hljs-title class_\">NaN</span> 값을 가진 행을 삭제한 후 인덱스 재설정\ndf.<span class=\"hljs-title function_\">reset_index</span>(drop=<span class=\"hljs-title class_\">True</span>, inplace=<span class=\"hljs-title class_\">True</span>)\n\n# <span class=\"hljs-number\">52</span>주간 가격 범위 추가\ndf[<span class=\"hljs-string\">'52주 범위'</span>] = ((df[<span class=\"hljs-string\">'가격'</span>] - df[<span class=\"hljs-string\">'52주 최저가'</span>]) / (df[<span class=\"hljs-string\">'52주 최고가'</span>] - df[<span class=\"hljs-string\">'52주 최저가'</span>])) * <span class=\"hljs-number\">100</span>\n\ndf_exceptions\n</code></pre>\n<p>NaN으로 설정된 비율이 있는 주식은 제거되고, 예외 DataFrame에 저장됩니다. 마지막으로 52주 가격 범위가 포함될 것입니다.</p>\n<img src=\"/TIL/assets/img/2024-07-14-FundamentalAnalysisforrankingStockswithPythonAPI_0.png\">\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>\"그리고 비예외 주식에 대한 결과는:</p>\n<p><img src=\"/TIL/assets/img/2024-07-14-FundamentalAnalysisforrankingStockswithPythonAPI_1.png\" alt=\"Fundamental Analysis\"></p>\n<h2>점수</h2>\n<p>다음 단계는 원시 데이터에 점수를 적용하는 것입니다.\"</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-js\">def <span class=\"hljs-title function_\">score</span>(values, value, cat) -> <span class=\"hljs-attr\">int</span>:\n    <span class=\"hljs-string\">''</span><span class=\"hljs-string\">'\n    카테고리에 따라 표준 편차와 평균을 기반으로 점수를 계산합니다. 낮은 값을 선호하는 PE와 같은 비율의 경우, 다음과 같이 점수가 계산됩니다:\n    1. 주어진 PE가 -1 표준 편차와 평균 사이에 있는 경우 1점 반환\n    2. 주어진 PE가 -2 표준 편차와 -1 표준 편차 사이에 있는 경우 2점 반환\n    3. PE가 -2 표준 편차를 벗어나는 경우 3점 반환\n    4. 주어진 PE가 1 표준 편차와 평균 사이에 있는 경우 -1점 반환\n    5. 주어진 PE가 +1 표준 편차와 +2 표준 편차 사이에 있는 경우 -2점 반환\n    6. 주어진 PE가 +2 표준 편차를 벗어나는 경우 -3점 반환\n\n    높은 값을 선호하는 ROE와 같은 비율의 경우, 다음과 같이 점수가 계산됩니다:\n    1. 주어진 ROE가 평균과 +1 표준 편차 사이에 있는 경우 1점 반환\n    2. 주어진 ROE가 +1 표준 편차와 +2 표준 편차 사이에 있는 경우 2점 반환\n    3. ROE가 +2 표준 편차를 벗어나는 경우 3점 반환\n    4. 주어진 ROE가 -1 표준 편차와 평균 사이에 있는 경우 -1점 반환\n    5. 주어진 ROE가 -1 표준 편차와 -2 표준 편차 사이에 있는 경우 -2점 반환\n    6. 주어진 ROE가 -2 표준 편차를 벗어나는 경우 -3점 반환\n\n    Parameters\n    ----------\n    values : 값들의 목록\n    value: 평균, 1 표준 편차, -1 표준 편차, 2 표준 편차 또는 -2 표준 편차 내에 있는지 확인할 값\n    cat: 카테고리 유형, 유효한 값은 1 또는 2입니다.\n        \n    Returns\n    -------\n    score: 주어진 '</span>value<span class=\"hljs-string\">'에 대한 점수\n    '</span><span class=\"hljs-string\">''</span>\n    \n    std = statistics.<span class=\"hljs-title function_\">stdev</span>(values)\n    mean = statistics.<span class=\"hljs-title function_\">mean</span>(values)\n\n    <span class=\"hljs-keyword\">if</span> cat == <span class=\"hljs-number\">1</span>:\n        <span class=\"hljs-keyword\">if</span> (mean + (-<span class=\"hljs-number\">1</span> * std)) &#x3C; value &#x3C;= <span class=\"hljs-attr\">mean</span>:\n            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">1</span>\n        elif (mean + (-<span class=\"hljs-number\">2</span> * std)) &#x3C; value &#x3C;= (mean + (-<span class=\"hljs-number\">1</span> * std)):\n            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">2</span>\n        elif value &#x3C;= (mean + (-<span class=\"hljs-number\">2</span> * std)):\n            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">3</span>\n        elif mean &#x3C; value &#x3C;= (mean + (<span class=\"hljs-number\">1</span> * std)):\n            <span class=\"hljs-keyword\">return</span> -<span class=\"hljs-number\">1</span>\n        elif (mean + (<span class=\"hljs-number\">1</span> * std)) &#x3C; value &#x3C;= (mean + (<span class=\"hljs-number\">2</span> * std)):\n            <span class=\"hljs-keyword\">return</span> -<span class=\"hljs-number\">2</span>\n        <span class=\"hljs-attr\">else</span>:\n            <span class=\"hljs-keyword\">return</span> -<span class=\"hljs-number\">3</span>\n    <span class=\"hljs-attr\">else</span>:\n        <span class=\"hljs-keyword\">if</span> mean &#x3C;= value &#x3C; (mean + (<span class=\"hljs-number\">1</span> * std)):\n            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">1</span>\n        elif (mean + (<span class=\"hljs-number\">1</span> * std)) &#x3C;= value &#x3C; (mean + (<span class=\"hljs-number\">2</span> * std)):\n            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">2</span>\n        elif value >= (mean + (<span class=\"hljs-number\">2</span> * std)):\n            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">3</span>\n        elif (mean + (-<span class=\"hljs-number\">1</span> * std)) &#x3C;= value &#x3C; <span class=\"hljs-attr\">mean</span>:\n            <span class=\"hljs-keyword\">return</span> -<span class=\"hljs-number\">1</span>\n        elif (mean + (-<span class=\"hljs-number\">2</span> * std)) &#x3C;= value &#x3C; (mean + (-<span class=\"hljs-number\">1</span> * std)):\n            <span class=\"hljs-keyword\">return</span> -<span class=\"hljs-number\">2</span>\n        <span class=\"hljs-attr\">else</span>:\n            <span class=\"hljs-keyword\">return</span> -<span class=\"hljs-number\">3</span>\n</code></pre>\n<p>요약하면 다음과 같이 카테고리 1의 비율에 제공되는 값에 대해 다음 점수가 반환됩니다: (평균 - 1 * 표준 편차)과 평균 사이에 비율이 있는 경우 1; (평균 - 2 * 표준 편차)와 (평균 - 1 * 표준 편차) 사이에 비율이 있는 경우 2; (평균 - 2 * 표준 편차)보다 작은 경우 3; 그 반대 경우에는 음수 값이 반환됩니다. 카테고리 2도 비슷한 절차를 따르지만 반대 방향으로 작동합니다. 이러한 점수는 어느 정도 임의적이며, 이상값은 최대 또는 최소 점수를 받습니다. 이상값으로 인한 편향을 제거하려면, 이상값에 대한 점수를 조정하여, 예를 들어 평균 - 2 * 표준 편차보다 낮은 비율의 경우 0을 반환하는 등의 조치를 취할 수 있습니다.</p>\n<p>점수 부여를 적용하고, 두 카테고리에 대해 제공된 각 비율에 대한 점수를 합산하는 열을 추가합니다.</p>\n<pre><code class=\"hljs language-js\">df_score = df.<span class=\"hljs-title function_\">copy</span>()\n\n<span class=\"hljs-keyword\">for</span> col <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title class_\">CAT1</span><span class=\"hljs-attr\">_RATIOS</span>:\n    <span class=\"hljs-keyword\">for</span> index, value <span class=\"hljs-keyword\">in</span> df[col].<span class=\"hljs-title function_\">items</span>():\n        # <span class=\"hljs-title function_\">print</span>(f<span class=\"hljs-string\">'{col} - {index} - {value}'</span>)\n        df_score.<span class=\"hljs-property\">loc</span>[index, col] = <span class=\"hljs-title function_\">score</span>(df[col], value, <span class=\"hljs-number\">1</span>)\n\n<span class=\"hljs-keyword\">for</span> col <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title class_\">CAT2</span><span class=\"hljs-attr\">_RATIOS</span>:\n    <span class=\"hljs-keyword\">for</span> index, value <span class=\"hljs-keyword\">in</span> df[col].<span class=\"hljs-title function_\">items</span>():\n        # <span class=\"hljs-title function_\">print</span>(f<span class=\"hljs-string\">'{col} - {index} - {value}'</span>)\n        df_score.<span class=\"hljs-property\">loc</span>[index, col] = <span class=\"hljs-title function_\">score</span>(df[col], value, <span class=\"hljs-number\">2</span>)\n\n# 총점을 얻기 위해 순위 점수를 추가\ndf_score[<span class=\"hljs-string\">'Score'</span>] = df_score[<span class=\"hljs-title class_\">CAT1</span>_RATIOS+<span class=\"hljs-title class_\">CAT2</span>_RATIOS].<span class=\"hljs-title function_\">sum</span>(axis=<span class=\"hljs-number\">1</span>)\n</code></pre>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-js\">def <span class=\"hljs-title function_\">make_pretty</span>(styler):\n    # 열 형식 지정\n    styler.<span class=\"hljs-title function_\">format</span>({<span class=\"hljs-string\">'EPS fwd'</span>: <span class=\"hljs-string\">'{:.0f}'</span>, <span class=\"hljs-string\">'PE fwd'</span>: <span class=\"hljs-string\">'{:.0f}'</span>, <span class=\"hljs-string\">'PEG'</span>: <span class=\"hljs-string\">'{:.0f}'</span>, <span class=\"hljs-string\">'FCFY'</span>: <span class=\"hljs-string\">'{:.0f}'</span>, <span class=\"hljs-string\">'PB'</span>: <span class=\"hljs-string\">'{:.0f}'</span>, <span class=\"hljs-string\">'ROE'</span>: <span class=\"hljs-string\">'{:.0f}'</span>,\n                   <span class=\"hljs-string\">'ROCE'</span>: <span class=\"hljs-string\">'{:.0f}'</span>, <span class=\"hljs-string\">'D2E'</span>: <span class=\"hljs-string\">'{:.0f}'</span>, <span class=\"hljs-string\">'CR'</span>: <span class=\"hljs-string\">'{:.0f}'</span>, <span class=\"hljs-string\">'QR'</span>: <span class=\"hljs-string\">'{:.0f}'</span>, <span class=\"hljs-string\">'Asset TR'</span>: <span class=\"hljs-string\">'{:.0f}'</span>, <span class=\"hljs-string\">'DY'</span>: <span class=\"hljs-string\">'{:.2f}%'</span>,\n                   <span class=\"hljs-string\">'Beta'</span>: <span class=\"hljs-string\">'{:.0f}'</span>, <span class=\"hljs-string\">'52w Low'</span>: <span class=\"hljs-string\">'${:.2f}'</span>, <span class=\"hljs-string\">'Price'</span>: <span class=\"hljs-string\">'${:.2f}'</span>, <span class=\"hljs-string\">'52w High'</span>: <span class=\"hljs-string\">'${:.2f}'</span>, <span class=\"hljs-string\">'52w Range'</span>: <span class=\"hljs-string\">'{:.2f}%'</span>, <span class=\"hljs-string\">'Score'</span>: <span class=\"hljs-string\">'{:.0f}'</span>\n                  })\n\n    # 바 시각화 설정\n    styler.<span class=\"hljs-title function_\">bar</span>(subset=[<span class=\"hljs-string\">'52w Range'</span>], align=<span class=\"hljs-string\">\"mid\"</span>, color=[<span class=\"hljs-string\">\"salmon\"</span>, <span class=\"hljs-string\">\"cornflowerblue\"</span>])\n\n    # 그리드\n    styler.<span class=\"hljs-title function_\">set_properties</span>(**{<span class=\"hljs-string\">'border'</span>: <span class=\"hljs-string\">'0.1px solid black'</span>})\n\n    # 배경 그라데이션 설정\n    <span class=\"hljs-keyword\">for</span> ratio <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title class_\">CAT1</span><span class=\"hljs-attr\">_RATIOS</span>:\n        styler.<span class=\"hljs-title function_\">background_gradient</span>(subset=[ratio], cmap=<span class=\"hljs-string\">'RdYlGn'</span>, gmap=-df[ratio])\n    <span class=\"hljs-keyword\">for</span> ratio <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title class_\">CAT2</span><span class=\"hljs-attr\">_RATIOS</span>:\n        styler.<span class=\"hljs-title function_\">background_gradient</span>(subset=[ratio], cmap=<span class=\"hljs-string\">'RdYlGn'</span>)\n    styler.<span class=\"hljs-title function_\">background_gradient</span>(subset=[<span class=\"hljs-string\">'Score'</span>], cmap=<span class=\"hljs-string\">'PiYG'</span>)\n    \n    # 인덱스 숨기기\n    styler.<span class=\"hljs-title function_\">hide</span>(axis=<span class=\"hljs-string\">'index'</span>)\n\n    # 일부 열에 대해 왼쪽 텍스트 정렬\n    styler.<span class=\"hljs-title function_\">set_properties</span>(subset=[<span class=\"hljs-string\">'Symbol'</span>, <span class=\"hljs-string\">'Name'</span>], **{<span class=\"hljs-string\">'text-align'</span>: <span class=\"hljs-string\">'left'</span>})\n    styler.<span class=\"hljs-title function_\">set_properties</span>(subset=<span class=\"hljs-title class_\">CAT1</span>_RATIOS + <span class=\"hljs-title class_\">CAT2</span>_RATIOS + [<span class=\"hljs-string\">'Market Cap'</span>, <span class=\"hljs-string\">'Score'</span>], **{<span class=\"hljs-string\">'text-align'</span>: <span class=\"hljs-string\">'center'</span>})\n\n    <span class=\"hljs-keyword\">return</span> styler\n</code></pre>\n<p>마지막으로, DataFrame에 스타일을 추가합니다:</p>\n<pre><code class=\"hljs language-js\"># <span class=\"hljs-variable constant_\">DF</span>에 테이블 캡션 및 스타일 추가\ndf_score.<span class=\"hljs-property\">style</span>.<span class=\"hljs-title function_\">pipe</span>(make_pretty).<span class=\"hljs-title function_\">set_caption</span>(f<span class=\"hljs-string\">'{industry} 주식 스크리너'</span>).<span class=\"hljs-title function_\">set_table_styles</span>(\n    [{<span class=\"hljs-string\">'selector'</span>: <span class=\"hljs-string\">'th.col_heading'</span>, <span class=\"hljs-string\">'props'</span>: <span class=\"hljs-string\">'text-align: center'</span>},\n     {<span class=\"hljs-string\">'selector'</span>: <span class=\"hljs-string\">'caption'</span>, <span class=\"hljs-string\">'props'</span>: [(<span class=\"hljs-string\">'text-align'</span>, <span class=\"hljs-string\">'center'</span>),\n                                       (<span class=\"hljs-string\">'font-size'</span>, <span class=\"hljs-string\">'11pt'</span>), (<span class=\"hljs-string\">'font-weight'</span>, <span class=\"hljs-string\">'bold'</span>)]}])\n</code></pre>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p><img src=\"/TIL/assets/img/2024-07-14-FundamentalAnalysisforrankingStockswithPythonAPI_2.png\" alt=\"image\"></p>\n<p>시가총액이 20억 달러 이상인 ATO와 SR은 “Regulated Gas” 산업 중 모든 주식 중에서 가장 높은 점수를 받은 두 가지 유틸리티 섹터 주식입니다. 그러나 ATO의 가격은 현재 52주 최고가에 더 가깝고, SR의 가격은 52주 최저가에 더 가깝습니다.</p>\n<p>여러 비율이 현재 주식 가격에 의존하기 때문에 결과는 노트북을 호출하는 시점에 따라 변할 수 있습니다.</p>\n<h2>결론</h2>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>이 기사에서는 기초 분석 기반의 주식 순위 결정 방법을 설명하며, 이 방법은 주식 그룹의 평균과 표준 편차를 기반으로 각 비율에 점수를 할당합니다.</p>\n<p>분석 목적상, 대부분의 비율은 비슷한 주식 그룹 내에서만 의미가 있는 경우가 많으므로 관련된 주식 그룹을 선택하는 것이 중요합니다.</p>\n<p>평가 시스템이 임의적이지만, 이 포스트가 가중 점수와 같은 다른 점수 시스템을 탐구하는 기초를 제시한다고 생각합니다.</p>\n<p>정보가 유익하게 느껴졌길 바라며, 피드백을 소중히 여깁니다.</p>\n</body>\n</html>\n"},"__N_SSG":true}