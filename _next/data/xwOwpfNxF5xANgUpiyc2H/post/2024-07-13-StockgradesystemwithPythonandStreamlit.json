{"pageProps":{"post":{"title":"Python과 Streamlit으로 주식 등급 시스템 만들기","description":"","date":"2024-07-13 19:13","slug":"2024-07-13-StockgradesystemwithPythonandStreamlit","content":"\n\n![링크](/TIL/assets/img/2024-07-13-StockgradesystemwithPythonandStreamlit_0.png)\n\n주식 시장에 투자하고 싶다니 멋지네요. 어떤 것을 선택하시겠습니까? 투자에 좋은 것과 그렇지 않은 것을 어떻게 정의하겠습니까? 현재 주식 분류를 이해하기 위해 등급 시스템 또는 평가 시스템이 필요할 것입니다. 지금 개발된 해당 시스템의 한 예시를 살펴보죠.\n\n수천 가지의 주식 중에서 선택해야 하는데, 각각이 갖는 메트릭 및 성과 지표가 모두 다르기 때문에, 최상의 투자 기회를 식별하기 위해서는 견고한 분석과 정보에 기반한 의사 결정이 필요합니다. 초보자든 전문가든, 방대한 양의 데이터를 탐색하고 유망한 주식을 강조해 주는 신뢰할 수 있는 도구가 있으면 매우 가치 있을 것입니다.\n\n이 글에서는 기술적 및 기본적 지표를 활용하여 주식을 평가하는 파이썬 기반의 투자 분석 도구를 개발하는 과정을 안내하겠습니다. 이 도구는 장기 투자 가능성을 식별하는 데 도움을 주는 뿐만 아니라 단기 거래 기회를 찾아내도록 돕습니다. 이 안내서를 따라가면, 로컬 머신에서 실행할 수 있는 강력한 스크립트를 보유하게 되며, Streamlit을 사용하여 직관적인 대시보드에 결과를 표시할 수 있습니다.\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n저희는 분석의 기반이 되는 점수 체계를 설명하여 다양한 지표가 각 주식의 잠재력을 평가하는 데 어떻게 사용되는지 자세히 설명하겠습니다. 이 시스템을 이해하는 것은 매우 중요합니다. 왜냐하면 이는 저희 도구의 기초를 형성하고 의사 결정 프로세스를 안내하기 때문입니다. 이제 각 주식의 점수 평가 방법과 해당 점수의 의미에 대해 구체적으로 살펴보겠습니다.\n\n# 점수 체계 설명\n\n점수 체계는 기술적 지표와 기본적 지표를 결합하여 각 주식의 잠재력을 평가하는 데 사용됩니다. 단기적 가격 변동과 장기적 재무 건강 상태를 고려함으로써 서로 다른 투자 전략에 부합하는 균형 잡힌 평가를 도출할 수 있습니다.\n\n기술적 분석은 주식의 가격 움직임과 패턴에 초점을 맞춥니다. 여기서 우리는 두 가지 주요 지표를 사용합니다: 50일 이동평균선(MA)과 상대강도지수(RSI). 주식의 종가가 50일 이동평균선 위에 있는 경우 상승 추세를 나타내므로 해당 주식은 한 점을 받게 됩니다. 또한 RSI가 70 미만인 경우, 해당 주식이 과매수 상태가 아니며 성장할 공간이 있다는 것을 시사하므로 또 한 점을 받게 됩니다.\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n근본적 분석은 회사의 재정 건강 상태를 검토합니다. 우리는 순조 적받지 못한 (P/E) 비율과 부채 대 자본 비율을 살펴봅니다. 20 미만의 순조 P/E 비율은 주식에 1 점을 부여합니다. 이것은 주식이 미래 수익에 비해 저평가될 가능성이 있음을 나타냅니다. 마찬가지로, 1 미만의 부채 대 자본 비율은 회사가 처리 가능한 부채 수준을 갖고 있음을 시사하며, 또 다른 한 점을 획득합니다.\n\n이러한 지표를 결합하여, 점수 체계는 각 주식에 대해 1에서 4 사이의 등급을 지정합니다. 1의 점수는 최소한의 잠재력을 나타내고, 4의 점수는 우수한 잠재력을 나타냅니다. 이 이중 접근법을 통해 우리는 즉시의 시장 심리와 회사의 기본적인 재정 안정성을 동시에 포착하여, 각 주식의 투자 전망에 대해 잘 둘러싼 견해를 제공합니다.\n\n내가 아는 바로는 주식 신뢰도를 이해하는 데 도움이 되는 여러 지표들이 있습니다. 물론, 이 기사는 참된 지표 범위를 보여주는 유일한 것은 아닙니다. 결국, 이것은 실전을 연습하고, 훨씬 더 많은 지표 및 KPI와 함께 나중에 직접 개발한 시스템을 가지기 위한 연습입니다. 아마도 보다 유연하고 맞춤 설정할 수 있을 것입니다. 그러나 다음 빌드의 기초를 마련합시다.\n\n![StockgradesystemwithPythonandStreamlit_1](/TIL/assets/img/2024-07-13-StockgradesystemwithPythonandStreamlit_1.png)\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n# 필요한 도구들\n\n이 투자 분석 도구를 구축하고 실행하기 위해, 우리는 몇 가지 강력한 Python 라이브러리를 활용할 것입니다. 우리가 사용할 주요 라이브러리는 yfinance, pandas, 그리고 streamlit입니다. 이 도구들 각각은 데이터 수집부터 시각화까지 우리 분석의 다양한 부분에서 중요한 역할을 합니다.\n\nyfinance는 인기 있는 라이브러리로, 우리에게 Yahoo Finance로부터 직접적으로 과거의 시장 데이터를 가져올 수 있는 기회를 제공합니다. 이는 주식 가격 기록, 재무 제표, 그리고 다른 중요한 지표에 쉬운 접근을 제공하여 기술적 및 기본적 분석에 꼭 필요한 자원이 됩니다. yfinance를 사용하여 우리는 각 주식을 평가하는 데 필요한 데이터를 프로그래밍적으로 수집할 수 있습니다.\n\npandas는 다재다능한 데이터 조작 라이브러리로, 우리가 가져온 데이터를 처리하고 분석하는 데 도움이 될 것입니다. pandas를 사용하면 대규모 데이터 세트를 쉽게 처리하고 기술 지표를 계산하며 점수화 프로세스를 관리할 수 있습니다. 강력한 DataFrame 구조를 통해 복잡한 데이터 작업을 간단히 수행할 수 있어 분석이 효율적이고 정확하도록 보장합니다.\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nstreamlit은 Python 스크립트에서 직접 인터랙티브 웹 애플리케이션을 만드는 혁신적인 라이브러리입니다. Streamlit을 사용하면 사용자 친화적인 대시보드를 구축하여 투자 제안을 표시할 수 있습니다. 이를 통해 우리는 분석 결과를 명확하고 직관적인 방식으로 시각화하고 데이터를 해석하고 통찰력 있는 결정을 내릴 수 있게 됩니다.\n\n# 모니터링할 메트릭스\n\n우리의 분석에서는 4가지 주요 메트릭스에 집중할 것입니다: 50일 이동평균선(MA), 상대 강도 지수(RSI), 전방 P/E 비율, 그리고 부채 비율입니다. 각 메트릭스는 해당 주식의 성과와 재무 건강 상태에 대한 유용한 통찰을 제공합니다.\n\n50일 이동평균선(MA): 50일 이동평균선은 일별 가격 변동을 완화하여 기본 트렌드를 드러내는 기술적 지표입니다. 주식의 현재 종가를 50일 이동평균선과 비교함으로써 주식이 상승 트렌드인지 하향 트렌드인지 판단할 수 있습니다. 이동평균선 위의 가격은 상승 흐름을 나타내며 성장 잠재력이 있다는 것을 시사합니다.\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n상대강도지수 (RSI): RSI는 주식의 가격 움직임 속도와 변화를 측정하는 모멘텀 오실레이터입니다. 값은 0부터 100까지이며, 70 이상의 값은 주식이 과매수 상태에 있을 수 있음을 나타내고, 30 미만의 값은 과매도 상태일 수 있음을 시사합니다. RSI 추적을 통해 주식이 추세 반전을 겪을지 또는 현재 추세를 이어갈지에 대한 판단을 할 수 있습니다.\n\n정방향 주가 이익 비율 (P/E Ratio): 정방향 P/E 비율은 현재 주가를 예상된 미래 주당 순이익과 비교합니다. 낮은 정방향 P/E 비율은 주식이 미래 수익 잠재력에 비해 저평가되어 있을 수 있다는 것을 나타낼 수 있어 투자 가능성이 있는 기회로 여겨질 수 있습니다. 이 지표를 통해 주식의 가치 평가와 성장 가능성을 평가할 수 있습니다.\n\n부채-자본 비율: 이 기본적인 지표는 기업의 총 부채를 지분 자본과 비교합니다. 낮은 부채-자본 비율은 기업이 빌린 자금에 대한 의존도가 낮고 부채를 관리할 재정적 여력이 있는 것을 시사합니다. 이 비율을 분석함으로써 기업의 재정 안정성과 위험을 평가할 수 있습니다.\n\n![이미지](/TIL/assets/img/2024-07-13-StockgradesystemwithPythonandStreamlit_2.png)\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n# 코드 시작하기\n\n투자 분석 도구를 만들기 위해, 논리적으로 섹션화된 파이썬 스크립트를 작성할 것입니다. 각 섹션은 데이터 수집, 분석 및 시각화의 다른 측면을 다룰 것입니다. 선호하는 파이썬 IDE에서 investment_analysis.py라는 새로운 파이썬 파일을 생성하는 것부터 시작해봅시다.\n\n- 우선, import부터 시작해보겠습니다\n\n```python\nimport yfinance as yf\nimport pandas as pd\nimport time\nimport datetime\nimport os\nimport streamlit as st\n```\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nyfinance: Yahoo Finance에서 주식 시장 데이터를 가져 오는 데 사용됩니다\npandas: 데이터 조작 및 분석에 사용됩니다\ntime: API 요청 간의 지연을 추가하여 요율 제한을 피하기위해 사용됩니다.\ndatetime: 날짜 조작에 사용됩니다\nos: 파일 작업을 처리하는 데 사용됩니다.\nstreamlit: 결과를 표시하는 대화형 웹 대시 보드를 만드는 데 사용됩니다.\n\n2. Get and count: 주식 정보 가져 오기 및 기술 지표 계산\n\n```js\n# 지난 5 일간의 주식 가격 데이터를 가져 오기위한 함수\ndef get_stock_data(ticker):\n    stock = yf.Ticker(ticker)\n    hist = stock.history(period=\"5d\")  # 현재 및 이전 거래일을 포함하는 지난 5 일간의 데이터만 가져옵니다\n    if hist.empty:\n        raise ValueError(f\"{ticker} 에 대한 데이터를 찾을 수 없습니다.\")\n    return hist\n\n# 50일 이동 평균을 계산하는 함수\ndef calculate_moving_average(data, window):\n    data[f\"MA_{window}\"] = data['Close'].rolling(window=window).mean()\n    return data\n\n# 상대 강도 지수(RSI)를 계산하는 함수\ndef calculate_rsi(data, window=14):\n    delta = data['Close'].diff(1)\n    gain = delta.mask(delta < 0, 0)\n    loss = -delta.mask(delta > 0, 0)\n    avg_gain = gain.rolling(window=window).mean()\n    avg_loss = loss.rolling(window=window).mean()\n    rs = avg_gain / avg_loss\n    rsi = 100 - (100 / (1 + rs))\n    data[f\"RSI_{window}\"] = rsi\n    return data\n```\n\nget_stock_data: Yahoo Finance에서 지난 5 일간의 주식 가격 데이터를 가져 옴\ncalculate_moving_average: 지정된 창 기간(이 경우 50 일) 동안 종가의 이동 평균을 계산\ncalculate_rsi: 가격 움직임의 속도와 변화를 측정하는 모멘텀 오실레이터 인 RSI를 계산\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n3. 기초 지식 습득\n\n```js\n# 기초 데이터를 가져오는 함수\ndef get_fundamentals(ticker):\n    stock = yf.Ticker(ticker)\n    fundamentals = stock.info\n    return fundamentals\n```\n\n여기서 AAPL 주식에 대한 기초 데이터 범위를 얻고, 추가적인 필터링을 위해 준비해 봅시다.\n\n4. 시작점을 정해봅시다!\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\n# 기술 및 기본 분석에 기반한 주식 평가 함수\ndef score_stock(data, fundamentals):\n    score = 0\n    # 기술적 분석\n    if data['Close'].iloc[-1] > data['MA_50'].iloc[-1]:\n        score += 1\n    if data['RSI_14'].iloc[-1] < 70:\n        score += 1\n    # 기초분석 및 오류 처리\n    try:\n        if fundamentals.get('forwardPE', None) is not None and fundamentals['forwardPE'] < 20:\n            score += 1\n        if fundamentals.get('debtToEquity', None) is not None and fundamentals['debtToEquity'] < 1:\n            score += 1\n    except KeyError as e:\n        print(f\"Key error: {e}\")\n    return score\n```\n\nscore_stock: 주식을 점수화하며, 종가가 50일 이동평균(MA_50)을 초과하고 RSI가 70보다 낮으며, 순방향 P/E 비율이 20 미만이거나 부채 비율이 1 미만인 경우 1을 추가하여 주식에 대한 점수를 매깁니다. 이것이 주식에 대한 점수를 평가하는 척도가 됩니다.\n\n5. 이렇게 분석하고, 저렇게 분석하고, 주식을 분석합니다.\n\n```js\ndef analyze_stock(ticker):\n    try:\n        data = get_stock_data(ticker)\n        data = calculate_moving_average(data, 50)\n        data = calculate_rsi(data)\n        fundamentals = get_fundamentals(ticker)\n        score = score_stock(data, fundamentals)\n        return data, fundamentals, score\n    except (IndexError, ValueError) as e:\n        print(f\"Skipping {ticker} due to error: {e}\")\n        return None, None, None\n```\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nanalyze_stock: 주가 분석을 위해 과거 데이터를 가져오고 기술적 지표를 계산하며 기본 데이터를 가져와서 주식에 점수를 매깁니다. 오류가 발생하면 해당 주식은 건너뜁니다.\n\n6. 상당한 가치평가.\n\n```js\n# 분석된 주식에 기반하여 투자 제안하는 기능\ndef suggest_investments(tickers):\n    suggestions = []\n    for ticker in tickers:\n        data, fundamentals, score = analyze_stock(ticker)\n        if data is not None and fundamentals is not None:\n            suggestions.append((ticker, score, data['Close'].iloc[-1], str(datetime.date.today())))\n        time.sleep(0.25)  # HTTP 429 오류를 피하기 위해 지연 추가\n    suggestions.sort(key=lambda x: x[1], reverse=True)\n    save_suggestions(suggestions)\n    return suggestions\n\n# 제안을 CSV 파일에 저장하는 기능\ndef save_suggestions(suggestions):\n    df = pd.DataFrame(suggestions, columns=['Ticker', 'Score', 'Price', 'Date'])\n    df.to_csv('suggestions.csv', mode='a', header=not os.path.exists('suggestions.csv'), index=False)\n\ndef get_stock_list():\n    # 해당 예시에서는 S&P 500 리스트를 사용하였으나 다른 소스를 사용할 수 있음\n    sp500 = pd.read_html('https://en.wikipedia.org/wiki/List_of_S%26P_500_companies')[0]\n    return sp500['Symbol'].tolist()\r\n```\n\nsuggest_investments: 주식의 점수를 기준으로 투자할 주식을 제안하며 요청 사이에 지연을 추가하고 제안을 CSV 파일에 저장합니다.\nsave_suggestions: 미래 참고를 위해 제안을 CSV 파일에 저장합니다.\nget_stock_list: S&P500에 포함된 주식 목록을 가져옵니다.\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n7. 우리가 가진 내용을 보여줍시다.\n\n```js\ndef display_dashboard(suggestions):\n    st.title(\"투자 제안 대시보드\")\n    for ticker, score, price, date in suggestions:\n        color = \"green\" if score >= 3 else \"red\"\n        st.markdown(f\"<div style='color:{color}'>티커: {ticker}, 점수: {score}, 가격: {price}, 날짜: {date}</div>\", unsafe_allow_html=True)\n\n# 단기 분석을 수행하는 함수\ndef short_term_analysis(tickers):\n    short_term_suggestions = []\n    for ticker in tickers:\n        data, fundamentals, score = analyze_stock(ticker)\n        if data is not None and fundamentals is not None and data['RSI_14'].iloc[-1] < 30:  # 단기 기회를 위한 예시 기준\n            short_term_suggestions.append((ticker, score, data['Close'].iloc[-1], str(datetime.date.today()))\n        time.sleep(0.25)  # HTTP 429 오류를 피하기 위한 지연 추가\n    short_term_suggestions.sort(key=lambda x: x[1], reverse=True)\n    save_suggestions(short_term_suggestions)\n    return short_term_suggestions\n\n# 지난 제안 성과를 평가하는 함수\ndef evaluate_performance():\n    df = pd.read_csv('suggestions.csv')\n    df['평가_날짜'] = pd.to_datetime(df['Date']) + pd.DateOffset(weeks=1)  # 1주 후 평가\n    evaluation_results = []\n    \n    for index, row in df.iterrows():\n        ticker = row['Ticker']\n        initial_price = row['Price']\n        evaluation_date = row['평가_날짜']\n        \n        try:\n            stock = yf.Ticker(ticker)\n            hist = stock.history(start=str(evaluation_date), end=str(evaluation_date + pd.DateOffset(days=1)))\n            final_price = hist['Close'][0]\n            price_change = (final_price - initial_price) / initial_price * 100\n            evaluation_results.append((ticker, row['Date'], initial_price, final_price, price_change))\n        except IndexError:\n            # 평가 일자에 데이터가 없는 경우 처리\n            evaluation_results.append((ticker, row['Date'], initial_price, None, None))\n    \n    eval_df = pd.DataFrame(evaluation_results, columns=['티커', '제안_날짜', '초기_가격', '최종_가격', '가격_변화 (%)'])\n    eval_df.to_csv('evaluation_results.csv', index=False)\r\n```\n\ndisplay_dashboard: 색상으로 구분된 점수를 사용하여 투자 제안을 Streamlit 대시보드에 표시합니다.\nshort_term_analysis: RSI 및 기타 기준에 기반하여 단기 투자 기회를 식별합니다.\nevaluate_performance: 초기 및 최종 가격을 비교하여 지난 투자 제안의 성과를 평가합니다.\n\n8. 작동하도록 만들기 — 스크립트 실행\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\nif __name__ == \"__main__\":\n    try:\n        # 주식 분석을 위한 티커 목록 정의\n        tickers = get_stock_list()\n        \n        # 투자 제안서 가져오기\n        suggestions = suggest_investments(tickers)\n        display_dashboard(suggestions)\n\n        # 단기 투자 제안\n        short_term_suggestions = short_term_analysis(tickers)\n        st.title(\"단기 투자 제안\")\n        display_dashboard(short_term_suggestions)\n\n        # 과거 제안의 성능 평가\n        evaluate_performance()\n        evaluation_results_df = pd.read_csv('evaluation_results.csv')\n        st.title(\"평가 결과\")\n        st.write(evaluation_results_df)\n        \n    except KeyboardInterrupt:\n        st.write(\"사용자에 의해 스크립트가 중단되었습니다.\")\n```\n\n마지막으로, 주식 티커 가져오기, 투자 제안, 대시보드 표시 및 성능 평가를 포함한 주요 실행 흐름을 정의합니다.\n사용자에 의해 스크립트가 중단된 경우, 중단을 우아하게 처리하고 메시지를 표시합니다.\n평가 방식:\n\n- 3 또는 4점: 강력한 잠재성이 있음을 나타냅니다. 이러한 주식은 대부분의 기준을 충족하며 좋은 선택지로 간주됩니다.\n- 2점: 중간적인 잠재성이 있음을 나타냅니다. 이러한 주식은 일부 기준을 충족하지만 일부 리스크나 약한 지표가 있을 수 있습니다.\n- 1점: 최소한의 잠재성이 있음을 나타냅니다. 이러한 주식은 매우 적은 기준을 충족하며 상당한 리스크가 있을 수 있습니다.\n- 0점: 우리의 기준에 따라 잠재성이 없음을 나타냅니다. 이러한 주식은 주요 지표 중 어떤 것도 충족하지 않습니다.\n\n이제 다음 명령으로 실행해봅시다.\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\nstreamlit run .\\test.py\n```\n\n![Image](/TIL/assets/img/2024-07-13-StockgradesystemwithPythonandStreamlit_3.png)\n\n결과를 확인하세요:\n\n![Image](/TIL/assets/img/2024-07-13-StockgradesystemwithPythonandStreamlit_4.png)\n\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n7월 12일 2024일의 경우, 우리의 기준에 맞는 주식이 없어요: SP500의 주식 중에는 아무런 높은 등급의 주식이 존재하지 않아요.\n\n다음에 무엇을 할 수 있을까요?\n\n- 기술지표 조정: RSI나 이동평균에 대해 다양한 임계값을 고려해보세요. 예를 들어, 200일 이동평균을 사용하는 것이 더 나은 신호를 제공할 수도 있습니다.\n- 추가 지표 통합: 수익 성장률, 배당 수익률 또는 다른 기술적 패턴과 같은 더 많은 기본적 또는 기술적 지표를 분석에 추가하세요.\n- 평가: 주식의 성능을 분석하고 실제 재무 결과를 바탕으로 주식을 등급화하여 점수를 매기기 위해 현실적인 등급 시스템을 갖도록 하세요.\n\n일반적인 코드…\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```python\nimport yfinance as yf\nimport pandas as pd\nimport time\nimport datetime\nimport os\nimport streamlit as st\n\ndef get_stock_data(ticker):\n    stock = yf.Ticker(ticker)\n    hist = stock.history(period=\"5d\")  \n    if hist.empty:\n        raise ValueError(f\"{ticker}에 대한 데이터를 찾을 수 없습니다.\")\n    return hist\n\ndef calculate_moving_average(data, window):\n    data[f\"MA_{window}\"] = data['Close'].rolling(window=window).mean()\n    return data\n\ndef calculate_rsi(data, window=14):\n    delta = data['Close'].diff(1)\n    gain = delta.mask(delta < 0, 0)\n    loss = -delta.mask(delta > 0, 0)\n    avg_gain = gain.rolling(window=window).mean()\n    avg_loss = loss.rolling(window=window).mean()\n    rs = avg_gain / avg_loss\n    rsi = 100 - (100 / (1 + rs))\n    data[f\"RSI_{window}\"] = rsi\n    return data\n\ndef get_fundamentals(ticker):\n    stock = yf.Ticker(ticker)\n    fundamentals = stock.info\n    return fundamentals\n\ndef score_stock(data, fundamentals):\n    score = 0\n    if data['Close'].iloc[-1] > data['MA_50'].iloc[-1]:\n        score += 1\n    if data['RSI_14'].iloc[-1] < 70:\n        score += 1\n    try:\n        if fundamentals.get('forwardPE', None) is not None and fundamentals['forwardPE'] < 20:\n            score += 1\n        if fundamentals.get('debtToEquity', None) is not None and fundamentals['debtToEquity'] < 1:\n            score += 1\n    except KeyError as e:\n        print(f\"Key error: {e}\")\n    return score\n\ndef analyze_stock(ticker):\n    try:\n        data = get_stock_data(ticker)\n        data = calculate_moving_average(data, 50)\n        data = calculate_rsi(data)\n        fundamentals = get_fundamentals(ticker)\n        score = score_stock(data, fundamentals)\n        return data, fundamentals, score\n    except (IndexError, ValueError) as e:\n        print(f\"{ticker}을(를) 분석하는 도중 오류가 발생했습니다: {e}\")\n        return None, None, None\n\ndef suggest_investments(tickers):\n    suggestions = []\n    for ticker in tickers:\n        data, fundamentals, score = analyze_stock(ticker)\n        if data is not None and fundamentals is not None:\n            suggestions.append((ticker, score, data['Close'].iloc[-1], str(datetime.date.today())))\n        time.sleep(0.25)   \n    suggestions.sort(key=lambda x: x[1], reverse=True)\n    save_suggestions(suggestions)\n    return suggestions\n\ndef save_suggestions(suggestions):\n    df = pd.DataFrame(suggestions, columns=['주식 코드', '점수', '가격', '날짜'])\n    df.to_csv('suggestions.csv', mode='a', header=not os.path.exists('suggestions.csv'), index=False)\n\ndef get_stock_list():\n    sp500 = pd.read_html('https://en.wikipedia.org/wiki/List_of_S%26P_500_companies')[0]\n    return sp500['Symbol'].tolist()\n\ndef display_dashboard(suggestions):\n    st.title(\"투자 제안 대시보드\")\n    for ticker, score, price, date in suggestions:\n        color = \"green\" if score >= 3 else \"red\"\n        st.markdown(f\"<div style='color:{color}'>주식 코드: {ticker}, 점수: {score}, 가격: {price}, 날짜: {date}</div>\", unsafe_allow_html=True)\n\ndef short_term_analysis(tickers):\n    short_term_suggestions = []\n    for ticker in tickers:\n        data, fundamentals, score = analyze_stock(ticker)\n        if data is not None and fundamentals is not None and data['RSI_14'].iloc[-1] < 30:  # 단기 기회 조건 예시\n            short_term_suggestions.append((ticker, score, data['Close'].iloc[-1], str(datetime.date.today())))\n        time.sleep(0.25)   \n    short_term_suggestions.sort(key=lambda x: x[1], reverse=True)\n    save_suggestions(short_term_suggestions)\n    return short_term_suggestions\n\ndef evaluate_performance():\n    df = pd.read_csv('suggestions.csv')\n    df['평가 날짜'] = pd.to_datetime(df['날짜']) + pd.DateOffset(weeks=1)  # 1주 후에 평가\n    evaluation_results = []\n    \n    for index, row in df.iterrows():\n        ticker = row['주식 코드']\n        initial_price = row['가격']\n        evaluation_date = row['평가 날짜']\n        \n        try:\n            stock = yf.Ticker(ticker)\n            hist = stock.history(start=str(evaluation_date), end=str(evaluation_date + pd.DateOffset(days=1)))\n            final_price = hist['Close'][0]\n            price_change = (final_price - initial_price) / initial_price * 100\n            evaluation_results.append((ticker, row['날짜'], initial_price, final_price, price_change))\n        except IndexError:\n            # 평가 날짜에 데이터가 없는 경우 처리\n            evaluation_results.append((ticker, row['날짜'], initial_price, None, None))\n    \n    eval_df = pd.DataFrame(evaluation_results, columns=['주식 코드', '제안 일자', '초기 가격', '최종 가격', '가격 변동 (%)'])\n    eval_df.to_csv('evaluation_results.csv', index=False)\n\nif __name__ == \"__main__\":\n    try:\n        tickers = get_stock_list()\n        \n        suggestions = suggest_investments(tickers)\n        display_dashboard(suggestions)\n\n        short_term_suggestions = short_term_analysis(tickers)\n        st.title(\"단기 투자 제안\")\n        display_dashboard(short_term_suggestions)\n\n        evaluate_performance()\n        evaluation_results_df = pd.read_csv('evaluation_results.csv')\n        st.title(\"평가 결과\")\n        st.write(evaluation_results_df)\n        \n    except KeyboardInterrupt:\n        st.write(\"사용자에 의해 스크립트가 중단되었습니다.\")\n```\n\n… 그리고 면책 조항.\n\n# 면책 조항\n\n이 글과 함께 제공된 코드는 교육 목적으로만 사용됩니다. 스크립트가 제공하는 제안은 자동 분석의 기능을 보여주기 위한 것이며, 사용자는 제안된 조치를 모니터링하고 시간이 지남에 따라 성공률을 평가해야 합니다. 이 콘텐츠는 행동 요령이 아니며, 재정 자문으로 해석해서는 안 됩니다. 언제든지 본인의 연구를 수행하고 거래 결정을 내리기 전에 전문가와 상의하십시오.\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n# 결론\n\n이러한 단계를 따르면 기술적 및 기본적인 지표를 모두 사용하여 주식을 평가하는 견고한 투자 분석 도구를 만들 수 있습니다. 결과는 인터랙티브 한 Streamlit 대시 보드에 표시되어 분석을 해석하고 조치를 취하기가 쉬워집니다. 즐거운 코딩투자를 하세요!","ogImage":{"url":"/TIL/assets/img/2024-07-13-StockgradesystemwithPythonandStreamlit_0.png"},"coverImage":"/TIL/assets/img/2024-07-13-StockgradesystemwithPythonandStreamlit_0.png","tag":["Tech"],"readingTime":22},"content":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n</head>\n<body>\n<p><img src=\"/TIL/assets/img/2024-07-13-StockgradesystemwithPythonandStreamlit_0.png\" alt=\"링크\"></p>\n<p>주식 시장에 투자하고 싶다니 멋지네요. 어떤 것을 선택하시겠습니까? 투자에 좋은 것과 그렇지 않은 것을 어떻게 정의하겠습니까? 현재 주식 분류를 이해하기 위해 등급 시스템 또는 평가 시스템이 필요할 것입니다. 지금 개발된 해당 시스템의 한 예시를 살펴보죠.</p>\n<p>수천 가지의 주식 중에서 선택해야 하는데, 각각이 갖는 메트릭 및 성과 지표가 모두 다르기 때문에, 최상의 투자 기회를 식별하기 위해서는 견고한 분석과 정보에 기반한 의사 결정이 필요합니다. 초보자든 전문가든, 방대한 양의 데이터를 탐색하고 유망한 주식을 강조해 주는 신뢰할 수 있는 도구가 있으면 매우 가치 있을 것입니다.</p>\n<p>이 글에서는 기술적 및 기본적 지표를 활용하여 주식을 평가하는 파이썬 기반의 투자 분석 도구를 개발하는 과정을 안내하겠습니다. 이 도구는 장기 투자 가능성을 식별하는 데 도움을 주는 뿐만 아니라 단기 거래 기회를 찾아내도록 돕습니다. 이 안내서를 따라가면, 로컬 머신에서 실행할 수 있는 강력한 스크립트를 보유하게 되며, Streamlit을 사용하여 직관적인 대시보드에 결과를 표시할 수 있습니다.</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>저희는 분석의 기반이 되는 점수 체계를 설명하여 다양한 지표가 각 주식의 잠재력을 평가하는 데 어떻게 사용되는지 자세히 설명하겠습니다. 이 시스템을 이해하는 것은 매우 중요합니다. 왜냐하면 이는 저희 도구의 기초를 형성하고 의사 결정 프로세스를 안내하기 때문입니다. 이제 각 주식의 점수 평가 방법과 해당 점수의 의미에 대해 구체적으로 살펴보겠습니다.</p>\n<h1>점수 체계 설명</h1>\n<p>점수 체계는 기술적 지표와 기본적 지표를 결합하여 각 주식의 잠재력을 평가하는 데 사용됩니다. 단기적 가격 변동과 장기적 재무 건강 상태를 고려함으로써 서로 다른 투자 전략에 부합하는 균형 잡힌 평가를 도출할 수 있습니다.</p>\n<p>기술적 분석은 주식의 가격 움직임과 패턴에 초점을 맞춥니다. 여기서 우리는 두 가지 주요 지표를 사용합니다: 50일 이동평균선(MA)과 상대강도지수(RSI). 주식의 종가가 50일 이동평균선 위에 있는 경우 상승 추세를 나타내므로 해당 주식은 한 점을 받게 됩니다. 또한 RSI가 70 미만인 경우, 해당 주식이 과매수 상태가 아니며 성장할 공간이 있다는 것을 시사하므로 또 한 점을 받게 됩니다.</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>근본적 분석은 회사의 재정 건강 상태를 검토합니다. 우리는 순조 적받지 못한 (P/E) 비율과 부채 대 자본 비율을 살펴봅니다. 20 미만의 순조 P/E 비율은 주식에 1 점을 부여합니다. 이것은 주식이 미래 수익에 비해 저평가될 가능성이 있음을 나타냅니다. 마찬가지로, 1 미만의 부채 대 자본 비율은 회사가 처리 가능한 부채 수준을 갖고 있음을 시사하며, 또 다른 한 점을 획득합니다.</p>\n<p>이러한 지표를 결합하여, 점수 체계는 각 주식에 대해 1에서 4 사이의 등급을 지정합니다. 1의 점수는 최소한의 잠재력을 나타내고, 4의 점수는 우수한 잠재력을 나타냅니다. 이 이중 접근법을 통해 우리는 즉시의 시장 심리와 회사의 기본적인 재정 안정성을 동시에 포착하여, 각 주식의 투자 전망에 대해 잘 둘러싼 견해를 제공합니다.</p>\n<p>내가 아는 바로는 주식 신뢰도를 이해하는 데 도움이 되는 여러 지표들이 있습니다. 물론, 이 기사는 참된 지표 범위를 보여주는 유일한 것은 아닙니다. 결국, 이것은 실전을 연습하고, 훨씬 더 많은 지표 및 KPI와 함께 나중에 직접 개발한 시스템을 가지기 위한 연습입니다. 아마도 보다 유연하고 맞춤 설정할 수 있을 것입니다. 그러나 다음 빌드의 기초를 마련합시다.</p>\n<p><img src=\"/TIL/assets/img/2024-07-13-StockgradesystemwithPythonandStreamlit_1.png\" alt=\"StockgradesystemwithPythonandStreamlit_1\"></p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<h1>필요한 도구들</h1>\n<p>이 투자 분석 도구를 구축하고 실행하기 위해, 우리는 몇 가지 강력한 Python 라이브러리를 활용할 것입니다. 우리가 사용할 주요 라이브러리는 yfinance, pandas, 그리고 streamlit입니다. 이 도구들 각각은 데이터 수집부터 시각화까지 우리 분석의 다양한 부분에서 중요한 역할을 합니다.</p>\n<p>yfinance는 인기 있는 라이브러리로, 우리에게 Yahoo Finance로부터 직접적으로 과거의 시장 데이터를 가져올 수 있는 기회를 제공합니다. 이는 주식 가격 기록, 재무 제표, 그리고 다른 중요한 지표에 쉬운 접근을 제공하여 기술적 및 기본적 분석에 꼭 필요한 자원이 됩니다. yfinance를 사용하여 우리는 각 주식을 평가하는 데 필요한 데이터를 프로그래밍적으로 수집할 수 있습니다.</p>\n<p>pandas는 다재다능한 데이터 조작 라이브러리로, 우리가 가져온 데이터를 처리하고 분석하는 데 도움이 될 것입니다. pandas를 사용하면 대규모 데이터 세트를 쉽게 처리하고 기술 지표를 계산하며 점수화 프로세스를 관리할 수 있습니다. 강력한 DataFrame 구조를 통해 복잡한 데이터 작업을 간단히 수행할 수 있어 분석이 효율적이고 정확하도록 보장합니다.</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>streamlit은 Python 스크립트에서 직접 인터랙티브 웹 애플리케이션을 만드는 혁신적인 라이브러리입니다. Streamlit을 사용하면 사용자 친화적인 대시보드를 구축하여 투자 제안을 표시할 수 있습니다. 이를 통해 우리는 분석 결과를 명확하고 직관적인 방식으로 시각화하고 데이터를 해석하고 통찰력 있는 결정을 내릴 수 있게 됩니다.</p>\n<h1>모니터링할 메트릭스</h1>\n<p>우리의 분석에서는 4가지 주요 메트릭스에 집중할 것입니다: 50일 이동평균선(MA), 상대 강도 지수(RSI), 전방 P/E 비율, 그리고 부채 비율입니다. 각 메트릭스는 해당 주식의 성과와 재무 건강 상태에 대한 유용한 통찰을 제공합니다.</p>\n<p>50일 이동평균선(MA): 50일 이동평균선은 일별 가격 변동을 완화하여 기본 트렌드를 드러내는 기술적 지표입니다. 주식의 현재 종가를 50일 이동평균선과 비교함으로써 주식이 상승 트렌드인지 하향 트렌드인지 판단할 수 있습니다. 이동평균선 위의 가격은 상승 흐름을 나타내며 성장 잠재력이 있다는 것을 시사합니다.</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>상대강도지수 (RSI): RSI는 주식의 가격 움직임 속도와 변화를 측정하는 모멘텀 오실레이터입니다. 값은 0부터 100까지이며, 70 이상의 값은 주식이 과매수 상태에 있을 수 있음을 나타내고, 30 미만의 값은 과매도 상태일 수 있음을 시사합니다. RSI 추적을 통해 주식이 추세 반전을 겪을지 또는 현재 추세를 이어갈지에 대한 판단을 할 수 있습니다.</p>\n<p>정방향 주가 이익 비율 (P/E Ratio): 정방향 P/E 비율은 현재 주가를 예상된 미래 주당 순이익과 비교합니다. 낮은 정방향 P/E 비율은 주식이 미래 수익 잠재력에 비해 저평가되어 있을 수 있다는 것을 나타낼 수 있어 투자 가능성이 있는 기회로 여겨질 수 있습니다. 이 지표를 통해 주식의 가치 평가와 성장 가능성을 평가할 수 있습니다.</p>\n<p>부채-자본 비율: 이 기본적인 지표는 기업의 총 부채를 지분 자본과 비교합니다. 낮은 부채-자본 비율은 기업이 빌린 자금에 대한 의존도가 낮고 부채를 관리할 재정적 여력이 있는 것을 시사합니다. 이 비율을 분석함으로써 기업의 재정 안정성과 위험을 평가할 수 있습니다.</p>\n<p><img src=\"/TIL/assets/img/2024-07-13-StockgradesystemwithPythonandStreamlit_2.png\" alt=\"이미지\"></p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<h1>코드 시작하기</h1>\n<p>투자 분석 도구를 만들기 위해, 논리적으로 섹션화된 파이썬 스크립트를 작성할 것입니다. 각 섹션은 데이터 수집, 분석 및 시각화의 다른 측면을 다룰 것입니다. 선호하는 파이썬 IDE에서 investment_analysis.py라는 새로운 파이썬 파일을 생성하는 것부터 시작해봅시다.</p>\n<ul>\n<li>우선, import부터 시작해보겠습니다</li>\n</ul>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> yfinance <span class=\"hljs-keyword\">as</span> yf\n<span class=\"hljs-keyword\">import</span> pandas <span class=\"hljs-keyword\">as</span> pd\n<span class=\"hljs-keyword\">import</span> time\n<span class=\"hljs-keyword\">import</span> datetime\n<span class=\"hljs-keyword\">import</span> os\n<span class=\"hljs-keyword\">import</span> streamlit <span class=\"hljs-keyword\">as</span> st\n</code></pre>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>yfinance: Yahoo Finance에서 주식 시장 데이터를 가져 오는 데 사용됩니다\npandas: 데이터 조작 및 분석에 사용됩니다\ntime: API 요청 간의 지연을 추가하여 요율 제한을 피하기위해 사용됩니다.\ndatetime: 날짜 조작에 사용됩니다\nos: 파일 작업을 처리하는 데 사용됩니다.\nstreamlit: 결과를 표시하는 대화형 웹 대시 보드를 만드는 데 사용됩니다.</p>\n<ol start=\"2\">\n<li>Get and count: 주식 정보 가져 오기 및 기술 지표 계산</li>\n</ol>\n<pre><code class=\"hljs language-js\"># 지난 <span class=\"hljs-number\">5</span> 일간의 주식 가격 데이터를 가져 오기위한 함수\ndef <span class=\"hljs-title function_\">get_stock_data</span>(ticker):\n    stock = yf.<span class=\"hljs-title class_\">Ticker</span>(ticker)\n    hist = stock.<span class=\"hljs-title function_\">history</span>(period=<span class=\"hljs-string\">\"5d\"</span>)  # 현재 및 이전 거래일을 포함하는 지난 <span class=\"hljs-number\">5</span> 일간의 데이터만 가져옵니다\n    <span class=\"hljs-keyword\">if</span> hist.<span class=\"hljs-property\">empty</span>:\n        raise <span class=\"hljs-title class_\">ValueError</span>(f<span class=\"hljs-string\">\"{ticker} 에 대한 데이터를 찾을 수 없습니다.\"</span>)\n    <span class=\"hljs-keyword\">return</span> hist\n\n# <span class=\"hljs-number\">50</span>일 이동 평균을 계산하는 함수\ndef <span class=\"hljs-title function_\">calculate_moving_average</span>(data, <span class=\"hljs-variable language_\">window</span>):\n    data[f<span class=\"hljs-string\">\"MA_{window}\"</span>] = data[<span class=\"hljs-string\">'Close'</span>].<span class=\"hljs-title function_\">rolling</span>(<span class=\"hljs-variable language_\">window</span>=<span class=\"hljs-variable language_\">window</span>).<span class=\"hljs-title function_\">mean</span>()\n    <span class=\"hljs-keyword\">return</span> data\n\n# 상대 강도 지수(<span class=\"hljs-variable constant_\">RSI</span>)를 계산하는 함수\ndef <span class=\"hljs-title function_\">calculate_rsi</span>(data, <span class=\"hljs-variable language_\">window</span>=<span class=\"hljs-number\">14</span>):\n    delta = data[<span class=\"hljs-string\">'Close'</span>].<span class=\"hljs-title function_\">diff</span>(<span class=\"hljs-number\">1</span>)\n    gain = delta.<span class=\"hljs-title function_\">mask</span>(delta &#x3C; <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>)\n    loss = -delta.<span class=\"hljs-title function_\">mask</span>(delta > <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>)\n    avg_gain = gain.<span class=\"hljs-title function_\">rolling</span>(<span class=\"hljs-variable language_\">window</span>=<span class=\"hljs-variable language_\">window</span>).<span class=\"hljs-title function_\">mean</span>()\n    avg_loss = loss.<span class=\"hljs-title function_\">rolling</span>(<span class=\"hljs-variable language_\">window</span>=<span class=\"hljs-variable language_\">window</span>).<span class=\"hljs-title function_\">mean</span>()\n    rs = avg_gain / avg_loss\n    rsi = <span class=\"hljs-number\">100</span> - (<span class=\"hljs-number\">100</span> / (<span class=\"hljs-number\">1</span> + rs))\n    data[f<span class=\"hljs-string\">\"RSI_{window}\"</span>] = rsi\n    <span class=\"hljs-keyword\">return</span> data\n</code></pre>\n<p>get_stock_data: Yahoo Finance에서 지난 5 일간의 주식 가격 데이터를 가져 옴\ncalculate_moving_average: 지정된 창 기간(이 경우 50 일) 동안 종가의 이동 평균을 계산\ncalculate_rsi: 가격 움직임의 속도와 변화를 측정하는 모멘텀 오실레이터 인 RSI를 계산</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<ol start=\"3\">\n<li>기초 지식 습득</li>\n</ol>\n<pre><code class=\"hljs language-js\"># 기초 데이터를 가져오는 함수\ndef <span class=\"hljs-title function_\">get_fundamentals</span>(ticker):\n    stock = yf.<span class=\"hljs-title class_\">Ticker</span>(ticker)\n    fundamentals = stock.<span class=\"hljs-property\">info</span>\n    <span class=\"hljs-keyword\">return</span> fundamentals\n</code></pre>\n<p>여기서 AAPL 주식에 대한 기초 데이터 범위를 얻고, 추가적인 필터링을 위해 준비해 봅시다.</p>\n<ol start=\"4\">\n<li>시작점을 정해봅시다!</li>\n</ol>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-js\"># 기술 및 기본 분석에 기반한 주식 평가 함수\ndef <span class=\"hljs-title function_\">score_stock</span>(data, fundamentals):\n    score = <span class=\"hljs-number\">0</span>\n    # 기술적 분석\n    <span class=\"hljs-keyword\">if</span> data[<span class=\"hljs-string\">'Close'</span>].<span class=\"hljs-property\">iloc</span>[-<span class=\"hljs-number\">1</span>] > data[<span class=\"hljs-string\">'MA_50'</span>].<span class=\"hljs-property\">iloc</span>[-<span class=\"hljs-number\">1</span>]:\n        score += <span class=\"hljs-number\">1</span>\n    <span class=\"hljs-keyword\">if</span> data[<span class=\"hljs-string\">'RSI_14'</span>].<span class=\"hljs-property\">iloc</span>[-<span class=\"hljs-number\">1</span>] &#x3C; <span class=\"hljs-number\">70</span>:\n        score += <span class=\"hljs-number\">1</span>\n    # 기초분석 및 오류 처리\n    <span class=\"hljs-attr\">try</span>:\n        <span class=\"hljs-keyword\">if</span> fundamentals.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">'forwardPE'</span>, <span class=\"hljs-title class_\">None</span>) is not <span class=\"hljs-title class_\">None</span> and fundamentals[<span class=\"hljs-string\">'forwardPE'</span>] &#x3C; <span class=\"hljs-number\">20</span>:\n            score += <span class=\"hljs-number\">1</span>\n        <span class=\"hljs-keyword\">if</span> fundamentals.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">'debtToEquity'</span>, <span class=\"hljs-title class_\">None</span>) is not <span class=\"hljs-title class_\">None</span> and fundamentals[<span class=\"hljs-string\">'debtToEquity'</span>] &#x3C; <span class=\"hljs-number\">1</span>:\n            score += <span class=\"hljs-number\">1</span>\n    except <span class=\"hljs-title class_\">KeyError</span> <span class=\"hljs-keyword\">as</span> <span class=\"hljs-attr\">e</span>:\n        <span class=\"hljs-title function_\">print</span>(f<span class=\"hljs-string\">\"Key error: {e}\"</span>)\n    <span class=\"hljs-keyword\">return</span> score\n</code></pre>\n<p>score_stock: 주식을 점수화하며, 종가가 50일 이동평균(MA_50)을 초과하고 RSI가 70보다 낮으며, 순방향 P/E 비율이 20 미만이거나 부채 비율이 1 미만인 경우 1을 추가하여 주식에 대한 점수를 매깁니다. 이것이 주식에 대한 점수를 평가하는 척도가 됩니다.</p>\n<ol start=\"5\">\n<li>이렇게 분석하고, 저렇게 분석하고, 주식을 분석합니다.</li>\n</ol>\n<pre><code class=\"hljs language-js\">def <span class=\"hljs-title function_\">analyze_stock</span>(ticker):\n    <span class=\"hljs-attr\">try</span>:\n        data = <span class=\"hljs-title function_\">get_stock_data</span>(ticker)\n        data = <span class=\"hljs-title function_\">calculate_moving_average</span>(data, <span class=\"hljs-number\">50</span>)\n        data = <span class=\"hljs-title function_\">calculate_rsi</span>(data)\n        fundamentals = <span class=\"hljs-title function_\">get_fundamentals</span>(ticker)\n        score = <span class=\"hljs-title function_\">score_stock</span>(data, fundamentals)\n        <span class=\"hljs-keyword\">return</span> data, fundamentals, score\n    except (<span class=\"hljs-title class_\">IndexError</span>, <span class=\"hljs-title class_\">ValueError</span>) <span class=\"hljs-keyword\">as</span> <span class=\"hljs-attr\">e</span>:\n        <span class=\"hljs-title function_\">print</span>(f<span class=\"hljs-string\">\"Skipping {ticker} due to error: {e}\"</span>)\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">None</span>, <span class=\"hljs-title class_\">None</span>, <span class=\"hljs-title class_\">None</span>\n</code></pre>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>analyze_stock: 주가 분석을 위해 과거 데이터를 가져오고 기술적 지표를 계산하며 기본 데이터를 가져와서 주식에 점수를 매깁니다. 오류가 발생하면 해당 주식은 건너뜁니다.</p>\n<ol start=\"6\">\n<li>상당한 가치평가.</li>\n</ol>\n<pre><code class=\"hljs language-js\"># 분석된 주식에 기반하여 투자 제안하는 기능\ndef <span class=\"hljs-title function_\">suggest_investments</span>(tickers):\n    suggestions = []\n    <span class=\"hljs-keyword\">for</span> ticker <span class=\"hljs-keyword\">in</span> <span class=\"hljs-attr\">tickers</span>:\n        data, fundamentals, score = <span class=\"hljs-title function_\">analyze_stock</span>(ticker)\n        <span class=\"hljs-keyword\">if</span> data is not <span class=\"hljs-title class_\">None</span> and fundamentals is not <span class=\"hljs-title class_\">None</span>:\n            suggestions.<span class=\"hljs-title function_\">append</span>((ticker, score, data[<span class=\"hljs-string\">'Close'</span>].<span class=\"hljs-property\">iloc</span>[-<span class=\"hljs-number\">1</span>], <span class=\"hljs-title function_\">str</span>(datetime.<span class=\"hljs-property\">date</span>.<span class=\"hljs-title function_\">today</span>())))\n        time.<span class=\"hljs-title function_\">sleep</span>(<span class=\"hljs-number\">0.25</span>)  # <span class=\"hljs-variable constant_\">HTTP</span> <span class=\"hljs-number\">429</span> 오류를 피하기 위해 지연 추가\n    suggestions.<span class=\"hljs-title function_\">sort</span>(key=lambda <span class=\"hljs-attr\">x</span>: x[<span class=\"hljs-number\">1</span>], reverse=<span class=\"hljs-title class_\">True</span>)\n    <span class=\"hljs-title function_\">save_suggestions</span>(suggestions)\n    <span class=\"hljs-keyword\">return</span> suggestions\n\n# 제안을 <span class=\"hljs-variable constant_\">CSV</span> 파일에 저장하는 기능\ndef <span class=\"hljs-title function_\">save_suggestions</span>(suggestions):\n    df = pd.<span class=\"hljs-title class_\">DataFrame</span>(suggestions, columns=[<span class=\"hljs-string\">'Ticker'</span>, <span class=\"hljs-string\">'Score'</span>, <span class=\"hljs-string\">'Price'</span>, <span class=\"hljs-string\">'Date'</span>])\n    df.<span class=\"hljs-title function_\">to_csv</span>(<span class=\"hljs-string\">'suggestions.csv'</span>, mode=<span class=\"hljs-string\">'a'</span>, header=not os.<span class=\"hljs-property\">path</span>.<span class=\"hljs-title function_\">exists</span>(<span class=\"hljs-string\">'suggestions.csv'</span>), index=<span class=\"hljs-title class_\">False</span>)\n\ndef <span class=\"hljs-title function_\">get_stock_list</span>():\n    # 해당 예시에서는 S&#x26;P <span class=\"hljs-number\">500</span> 리스트를 사용하였으나 다른 소스를 사용할 수 있음\n    sp500 = pd.<span class=\"hljs-title function_\">read_html</span>(<span class=\"hljs-string\">'https://en.wikipedia.org/wiki/List_of_S%26P_500_companies'</span>)[<span class=\"hljs-number\">0</span>]\n    <span class=\"hljs-keyword\">return</span> sp500[<span class=\"hljs-string\">'Symbol'</span>].<span class=\"hljs-title function_\">tolist</span>()\n</code></pre>\n<p>suggest_investments: 주식의 점수를 기준으로 투자할 주식을 제안하며 요청 사이에 지연을 추가하고 제안을 CSV 파일에 저장합니다.\nsave_suggestions: 미래 참고를 위해 제안을 CSV 파일에 저장합니다.\nget_stock_list: S&#x26;P500에 포함된 주식 목록을 가져옵니다.</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<ol start=\"7\">\n<li>우리가 가진 내용을 보여줍시다.</li>\n</ol>\n<pre><code class=\"hljs language-js\">def <span class=\"hljs-title function_\">display_dashboard</span>(suggestions):\n    st.<span class=\"hljs-title function_\">title</span>(<span class=\"hljs-string\">\"투자 제안 대시보드\"</span>)\n    <span class=\"hljs-keyword\">for</span> ticker, score, price, date <span class=\"hljs-keyword\">in</span> <span class=\"hljs-attr\">suggestions</span>:\n        color = <span class=\"hljs-string\">\"green\"</span> <span class=\"hljs-keyword\">if</span> score >= <span class=\"hljs-number\">3</span> <span class=\"hljs-keyword\">else</span> <span class=\"hljs-string\">\"red\"</span>\n        st.<span class=\"hljs-title function_\">markdown</span>(f<span class=\"hljs-string\">\"&#x3C;div style='color:{color}'>티커: {ticker}, 점수: {score}, 가격: {price}, 날짜: {date}&#x3C;/div>\"</span>, unsafe_allow_html=<span class=\"hljs-title class_\">True</span>)\n\n# 단기 분석을 수행하는 함수\ndef <span class=\"hljs-title function_\">short_term_analysis</span>(tickers):\n    short_term_suggestions = []\n    <span class=\"hljs-keyword\">for</span> ticker <span class=\"hljs-keyword\">in</span> <span class=\"hljs-attr\">tickers</span>:\n        data, fundamentals, score = <span class=\"hljs-title function_\">analyze_stock</span>(ticker)\n        <span class=\"hljs-keyword\">if</span> data is not <span class=\"hljs-title class_\">None</span> and fundamentals is not <span class=\"hljs-title class_\">None</span> and data[<span class=\"hljs-string\">'RSI_14'</span>].<span class=\"hljs-property\">iloc</span>[-<span class=\"hljs-number\">1</span>] &#x3C; <span class=\"hljs-number\">30</span>:  # 단기 기회를 위한 예시 기준\n            short_term_suggestions.<span class=\"hljs-title function_\">append</span>((ticker, score, data[<span class=\"hljs-string\">'Close'</span>].<span class=\"hljs-property\">iloc</span>[-<span class=\"hljs-number\">1</span>], <span class=\"hljs-title function_\">str</span>(datetime.<span class=\"hljs-property\">date</span>.<span class=\"hljs-title function_\">today</span>()))\n        time.<span class=\"hljs-title function_\">sleep</span>(<span class=\"hljs-number\">0.25</span>)  # <span class=\"hljs-variable constant_\">HTTP</span> <span class=\"hljs-number\">429</span> 오류를 피하기 위한 지연 추가\n    short_term_suggestions.<span class=\"hljs-title function_\">sort</span>(key=lambda <span class=\"hljs-attr\">x</span>: x[<span class=\"hljs-number\">1</span>], reverse=<span class=\"hljs-title class_\">True</span>)\n    <span class=\"hljs-title function_\">save_suggestions</span>(short_term_suggestions)\n    <span class=\"hljs-keyword\">return</span> short_term_suggestions\n\n# 지난 제안 성과를 평가하는 함수\ndef evaluate_performance():\n    df = pd.<span class=\"hljs-title function_\">read_csv</span>(<span class=\"hljs-string\">'suggestions.csv'</span>)\n    df[<span class=\"hljs-string\">'평가_날짜'</span>] = pd.<span class=\"hljs-title function_\">to_datetime</span>(df[<span class=\"hljs-string\">'Date'</span>]) + pd.<span class=\"hljs-title class_\">DateOffset</span>(weeks=<span class=\"hljs-number\">1</span>)  # <span class=\"hljs-number\">1</span>주 후 평가\n    evaluation_results = []\n    \n    <span class=\"hljs-keyword\">for</span> index, row <span class=\"hljs-keyword\">in</span> df.<span class=\"hljs-title function_\">iterrows</span>():\n        ticker = row[<span class=\"hljs-string\">'Ticker'</span>]\n        initial_price = row[<span class=\"hljs-string\">'Price'</span>]\n        evaluation_date = row[<span class=\"hljs-string\">'평가_날짜'</span>]\n        \n        <span class=\"hljs-attr\">try</span>:\n            stock = yf.<span class=\"hljs-title class_\">Ticker</span>(ticker)\n            hist = stock.<span class=\"hljs-title function_\">history</span>(start=<span class=\"hljs-title function_\">str</span>(evaluation_date), end=<span class=\"hljs-title function_\">str</span>(evaluation_date + pd.<span class=\"hljs-title class_\">DateOffset</span>(days=<span class=\"hljs-number\">1</span>)))\n            final_price = hist[<span class=\"hljs-string\">'Close'</span>][<span class=\"hljs-number\">0</span>]\n            price_change = (final_price - initial_price) / initial_price * <span class=\"hljs-number\">100</span>\n            evaluation_results.<span class=\"hljs-title function_\">append</span>((ticker, row[<span class=\"hljs-string\">'Date'</span>], initial_price, final_price, price_change))\n        except <span class=\"hljs-title class_\">IndexError</span>:\n            # 평가 일자에 데이터가 없는 경우 처리\n            evaluation_results.<span class=\"hljs-title function_\">append</span>((ticker, row[<span class=\"hljs-string\">'Date'</span>], initial_price, <span class=\"hljs-title class_\">None</span>, <span class=\"hljs-title class_\">None</span>))\n    \n    eval_df = pd.<span class=\"hljs-title class_\">DataFrame</span>(evaluation_results, columns=[<span class=\"hljs-string\">'티커'</span>, <span class=\"hljs-string\">'제안_날짜'</span>, <span class=\"hljs-string\">'초기_가격'</span>, <span class=\"hljs-string\">'최종_가격'</span>, <span class=\"hljs-string\">'가격_변화 (%)'</span>])\n    eval_df.<span class=\"hljs-title function_\">to_csv</span>(<span class=\"hljs-string\">'evaluation_results.csv'</span>, index=<span class=\"hljs-title class_\">False</span>)\n</code></pre>\n<p>display_dashboard: 색상으로 구분된 점수를 사용하여 투자 제안을 Streamlit 대시보드에 표시합니다.\nshort_term_analysis: RSI 및 기타 기준에 기반하여 단기 투자 기회를 식별합니다.\nevaluate_performance: 초기 및 최종 가격을 비교하여 지난 투자 제안의 성과를 평가합니다.</p>\n<ol start=\"8\">\n<li>작동하도록 만들기 — 스크립트 실행</li>\n</ol>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">\"__main__\"</span>:\n    <span class=\"hljs-attr\">try</span>:\n        # 주식 분석을 위한 티커 목록 정의\n        tickers = <span class=\"hljs-title function_\">get_stock_list</span>()\n        \n        # 투자 제안서 가져오기\n        suggestions = <span class=\"hljs-title function_\">suggest_investments</span>(tickers)\n        <span class=\"hljs-title function_\">display_dashboard</span>(suggestions)\n\n        # 단기 투자 제안\n        short_term_suggestions = <span class=\"hljs-title function_\">short_term_analysis</span>(tickers)\n        st.<span class=\"hljs-title function_\">title</span>(<span class=\"hljs-string\">\"단기 투자 제안\"</span>)\n        <span class=\"hljs-title function_\">display_dashboard</span>(short_term_suggestions)\n\n        # 과거 제안의 성능 평가\n        evaluate_performance()\n        evaluation_results_df = pd.<span class=\"hljs-title function_\">read_csv</span>(<span class=\"hljs-string\">'evaluation_results.csv'</span>)\n        st.<span class=\"hljs-title function_\">title</span>(<span class=\"hljs-string\">\"평가 결과\"</span>)\n        st.<span class=\"hljs-title function_\">write</span>(evaluation_results_df)\n        \n    except <span class=\"hljs-title class_\">KeyboardInterrupt</span>:\n        st.<span class=\"hljs-title function_\">write</span>(<span class=\"hljs-string\">\"사용자에 의해 스크립트가 중단되었습니다.\"</span>)\n</code></pre>\n<p>마지막으로, 주식 티커 가져오기, 투자 제안, 대시보드 표시 및 성능 평가를 포함한 주요 실행 흐름을 정의합니다.\n사용자에 의해 스크립트가 중단된 경우, 중단을 우아하게 처리하고 메시지를 표시합니다.\n평가 방식:</p>\n<ul>\n<li>3 또는 4점: 강력한 잠재성이 있음을 나타냅니다. 이러한 주식은 대부분의 기준을 충족하며 좋은 선택지로 간주됩니다.</li>\n<li>2점: 중간적인 잠재성이 있음을 나타냅니다. 이러한 주식은 일부 기준을 충족하지만 일부 리스크나 약한 지표가 있을 수 있습니다.</li>\n<li>1점: 최소한의 잠재성이 있음을 나타냅니다. 이러한 주식은 매우 적은 기준을 충족하며 상당한 리스크가 있을 수 있습니다.</li>\n<li>0점: 우리의 기준에 따라 잠재성이 없음을 나타냅니다. 이러한 주식은 주요 지표 중 어떤 것도 충족하지 않습니다.</li>\n</ul>\n<p>이제 다음 명령으로 실행해봅시다.</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-js\">streamlit run .\\test.<span class=\"hljs-property\">py</span>\n</code></pre>\n<p><img src=\"/TIL/assets/img/2024-07-13-StockgradesystemwithPythonandStreamlit_3.png\" alt=\"Image\"></p>\n<p>결과를 확인하세요:</p>\n<p><img src=\"/TIL/assets/img/2024-07-13-StockgradesystemwithPythonandStreamlit_4.png\" alt=\"Image\"></p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>7월 12일 2024일의 경우, 우리의 기준에 맞는 주식이 없어요: SP500의 주식 중에는 아무런 높은 등급의 주식이 존재하지 않아요.</p>\n<p>다음에 무엇을 할 수 있을까요?</p>\n<ul>\n<li>기술지표 조정: RSI나 이동평균에 대해 다양한 임계값을 고려해보세요. 예를 들어, 200일 이동평균을 사용하는 것이 더 나은 신호를 제공할 수도 있습니다.</li>\n<li>추가 지표 통합: 수익 성장률, 배당 수익률 또는 다른 기술적 패턴과 같은 더 많은 기본적 또는 기술적 지표를 분석에 추가하세요.</li>\n<li>평가: 주식의 성능을 분석하고 실제 재무 결과를 바탕으로 주식을 등급화하여 점수를 매기기 위해 현실적인 등급 시스템을 갖도록 하세요.</li>\n</ul>\n<p>일반적인 코드…</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> yfinance <span class=\"hljs-keyword\">as</span> yf\n<span class=\"hljs-keyword\">import</span> pandas <span class=\"hljs-keyword\">as</span> pd\n<span class=\"hljs-keyword\">import</span> time\n<span class=\"hljs-keyword\">import</span> datetime\n<span class=\"hljs-keyword\">import</span> os\n<span class=\"hljs-keyword\">import</span> streamlit <span class=\"hljs-keyword\">as</span> st\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_stock_data</span>(<span class=\"hljs-params\">ticker</span>):\n    stock = yf.Ticker(ticker)\n    hist = stock.history(period=<span class=\"hljs-string\">\"5d\"</span>)  \n    <span class=\"hljs-keyword\">if</span> hist.empty:\n        <span class=\"hljs-keyword\">raise</span> ValueError(<span class=\"hljs-string\">f\"<span class=\"hljs-subst\">{ticker}</span>에 대한 데이터를 찾을 수 없습니다.\"</span>)\n    <span class=\"hljs-keyword\">return</span> hist\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">calculate_moving_average</span>(<span class=\"hljs-params\">data, window</span>):\n    data[<span class=\"hljs-string\">f\"MA_<span class=\"hljs-subst\">{window}</span>\"</span>] = data[<span class=\"hljs-string\">'Close'</span>].rolling(window=window).mean()\n    <span class=\"hljs-keyword\">return</span> data\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">calculate_rsi</span>(<span class=\"hljs-params\">data, window=<span class=\"hljs-number\">14</span></span>):\n    delta = data[<span class=\"hljs-string\">'Close'</span>].diff(<span class=\"hljs-number\">1</span>)\n    gain = delta.mask(delta &#x3C; <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>)\n    loss = -delta.mask(delta > <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>)\n    avg_gain = gain.rolling(window=window).mean()\n    avg_loss = loss.rolling(window=window).mean()\n    rs = avg_gain / avg_loss\n    rsi = <span class=\"hljs-number\">100</span> - (<span class=\"hljs-number\">100</span> / (<span class=\"hljs-number\">1</span> + rs))\n    data[<span class=\"hljs-string\">f\"RSI_<span class=\"hljs-subst\">{window}</span>\"</span>] = rsi\n    <span class=\"hljs-keyword\">return</span> data\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_fundamentals</span>(<span class=\"hljs-params\">ticker</span>):\n    stock = yf.Ticker(ticker)\n    fundamentals = stock.info\n    <span class=\"hljs-keyword\">return</span> fundamentals\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">score_stock</span>(<span class=\"hljs-params\">data, fundamentals</span>):\n    score = <span class=\"hljs-number\">0</span>\n    <span class=\"hljs-keyword\">if</span> data[<span class=\"hljs-string\">'Close'</span>].iloc[-<span class=\"hljs-number\">1</span>] > data[<span class=\"hljs-string\">'MA_50'</span>].iloc[-<span class=\"hljs-number\">1</span>]:\n        score += <span class=\"hljs-number\">1</span>\n    <span class=\"hljs-keyword\">if</span> data[<span class=\"hljs-string\">'RSI_14'</span>].iloc[-<span class=\"hljs-number\">1</span>] &#x3C; <span class=\"hljs-number\">70</span>:\n        score += <span class=\"hljs-number\">1</span>\n    <span class=\"hljs-keyword\">try</span>:\n        <span class=\"hljs-keyword\">if</span> fundamentals.get(<span class=\"hljs-string\">'forwardPE'</span>, <span class=\"hljs-literal\">None</span>) <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-literal\">None</span> <span class=\"hljs-keyword\">and</span> fundamentals[<span class=\"hljs-string\">'forwardPE'</span>] &#x3C; <span class=\"hljs-number\">20</span>:\n            score += <span class=\"hljs-number\">1</span>\n        <span class=\"hljs-keyword\">if</span> fundamentals.get(<span class=\"hljs-string\">'debtToEquity'</span>, <span class=\"hljs-literal\">None</span>) <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-literal\">None</span> <span class=\"hljs-keyword\">and</span> fundamentals[<span class=\"hljs-string\">'debtToEquity'</span>] &#x3C; <span class=\"hljs-number\">1</span>:\n            score += <span class=\"hljs-number\">1</span>\n    <span class=\"hljs-keyword\">except</span> KeyError <span class=\"hljs-keyword\">as</span> e:\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f\"Key error: <span class=\"hljs-subst\">{e}</span>\"</span>)\n    <span class=\"hljs-keyword\">return</span> score\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">analyze_stock</span>(<span class=\"hljs-params\">ticker</span>):\n    <span class=\"hljs-keyword\">try</span>:\n        data = get_stock_data(ticker)\n        data = calculate_moving_average(data, <span class=\"hljs-number\">50</span>)\n        data = calculate_rsi(data)\n        fundamentals = get_fundamentals(ticker)\n        score = score_stock(data, fundamentals)\n        <span class=\"hljs-keyword\">return</span> data, fundamentals, score\n    <span class=\"hljs-keyword\">except</span> (IndexError, ValueError) <span class=\"hljs-keyword\">as</span> e:\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f\"<span class=\"hljs-subst\">{ticker}</span>을(를) 분석하는 도중 오류가 발생했습니다: <span class=\"hljs-subst\">{e}</span>\"</span>)\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">None</span>, <span class=\"hljs-literal\">None</span>, <span class=\"hljs-literal\">None</span>\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">suggest_investments</span>(<span class=\"hljs-params\">tickers</span>):\n    suggestions = []\n    <span class=\"hljs-keyword\">for</span> ticker <span class=\"hljs-keyword\">in</span> tickers:\n        data, fundamentals, score = analyze_stock(ticker)\n        <span class=\"hljs-keyword\">if</span> data <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-literal\">None</span> <span class=\"hljs-keyword\">and</span> fundamentals <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-literal\">None</span>:\n            suggestions.append((ticker, score, data[<span class=\"hljs-string\">'Close'</span>].iloc[-<span class=\"hljs-number\">1</span>], <span class=\"hljs-built_in\">str</span>(datetime.date.today())))\n        time.sleep(<span class=\"hljs-number\">0.25</span>)   \n    suggestions.sort(key=<span class=\"hljs-keyword\">lambda</span> x: x[<span class=\"hljs-number\">1</span>], reverse=<span class=\"hljs-literal\">True</span>)\n    save_suggestions(suggestions)\n    <span class=\"hljs-keyword\">return</span> suggestions\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">save_suggestions</span>(<span class=\"hljs-params\">suggestions</span>):\n    df = pd.DataFrame(suggestions, columns=[<span class=\"hljs-string\">'주식 코드'</span>, <span class=\"hljs-string\">'점수'</span>, <span class=\"hljs-string\">'가격'</span>, <span class=\"hljs-string\">'날짜'</span>])\n    df.to_csv(<span class=\"hljs-string\">'suggestions.csv'</span>, mode=<span class=\"hljs-string\">'a'</span>, header=<span class=\"hljs-keyword\">not</span> os.path.exists(<span class=\"hljs-string\">'suggestions.csv'</span>), index=<span class=\"hljs-literal\">False</span>)\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_stock_list</span>():\n    sp500 = pd.read_html(<span class=\"hljs-string\">'https://en.wikipedia.org/wiki/List_of_S%26P_500_companies'</span>)[<span class=\"hljs-number\">0</span>]\n    <span class=\"hljs-keyword\">return</span> sp500[<span class=\"hljs-string\">'Symbol'</span>].tolist()\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">display_dashboard</span>(<span class=\"hljs-params\">suggestions</span>):\n    st.title(<span class=\"hljs-string\">\"투자 제안 대시보드\"</span>)\n    <span class=\"hljs-keyword\">for</span> ticker, score, price, date <span class=\"hljs-keyword\">in</span> suggestions:\n        color = <span class=\"hljs-string\">\"green\"</span> <span class=\"hljs-keyword\">if</span> score >= <span class=\"hljs-number\">3</span> <span class=\"hljs-keyword\">else</span> <span class=\"hljs-string\">\"red\"</span>\n        st.markdown(<span class=\"hljs-string\">f\"&#x3C;div style='color:<span class=\"hljs-subst\">{color}</span>'>주식 코드: <span class=\"hljs-subst\">{ticker}</span>, 점수: <span class=\"hljs-subst\">{score}</span>, 가격: <span class=\"hljs-subst\">{price}</span>, 날짜: <span class=\"hljs-subst\">{date}</span>&#x3C;/div>\"</span>, unsafe_allow_html=<span class=\"hljs-literal\">True</span>)\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">short_term_analysis</span>(<span class=\"hljs-params\">tickers</span>):\n    short_term_suggestions = []\n    <span class=\"hljs-keyword\">for</span> ticker <span class=\"hljs-keyword\">in</span> tickers:\n        data, fundamentals, score = analyze_stock(ticker)\n        <span class=\"hljs-keyword\">if</span> data <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-literal\">None</span> <span class=\"hljs-keyword\">and</span> fundamentals <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-literal\">None</span> <span class=\"hljs-keyword\">and</span> data[<span class=\"hljs-string\">'RSI_14'</span>].iloc[-<span class=\"hljs-number\">1</span>] &#x3C; <span class=\"hljs-number\">30</span>:  <span class=\"hljs-comment\"># 단기 기회 조건 예시</span>\n            short_term_suggestions.append((ticker, score, data[<span class=\"hljs-string\">'Close'</span>].iloc[-<span class=\"hljs-number\">1</span>], <span class=\"hljs-built_in\">str</span>(datetime.date.today())))\n        time.sleep(<span class=\"hljs-number\">0.25</span>)   \n    short_term_suggestions.sort(key=<span class=\"hljs-keyword\">lambda</span> x: x[<span class=\"hljs-number\">1</span>], reverse=<span class=\"hljs-literal\">True</span>)\n    save_suggestions(short_term_suggestions)\n    <span class=\"hljs-keyword\">return</span> short_term_suggestions\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">evaluate_performance</span>():\n    df = pd.read_csv(<span class=\"hljs-string\">'suggestions.csv'</span>)\n    df[<span class=\"hljs-string\">'평가 날짜'</span>] = pd.to_datetime(df[<span class=\"hljs-string\">'날짜'</span>]) + pd.DateOffset(weeks=<span class=\"hljs-number\">1</span>)  <span class=\"hljs-comment\"># 1주 후에 평가</span>\n    evaluation_results = []\n    \n    <span class=\"hljs-keyword\">for</span> index, row <span class=\"hljs-keyword\">in</span> df.iterrows():\n        ticker = row[<span class=\"hljs-string\">'주식 코드'</span>]\n        initial_price = row[<span class=\"hljs-string\">'가격'</span>]\n        evaluation_date = row[<span class=\"hljs-string\">'평가 날짜'</span>]\n        \n        <span class=\"hljs-keyword\">try</span>:\n            stock = yf.Ticker(ticker)\n            hist = stock.history(start=<span class=\"hljs-built_in\">str</span>(evaluation_date), end=<span class=\"hljs-built_in\">str</span>(evaluation_date + pd.DateOffset(days=<span class=\"hljs-number\">1</span>)))\n            final_price = hist[<span class=\"hljs-string\">'Close'</span>][<span class=\"hljs-number\">0</span>]\n            price_change = (final_price - initial_price) / initial_price * <span class=\"hljs-number\">100</span>\n            evaluation_results.append((ticker, row[<span class=\"hljs-string\">'날짜'</span>], initial_price, final_price, price_change))\n        <span class=\"hljs-keyword\">except</span> IndexError:\n            <span class=\"hljs-comment\"># 평가 날짜에 데이터가 없는 경우 처리</span>\n            evaluation_results.append((ticker, row[<span class=\"hljs-string\">'날짜'</span>], initial_price, <span class=\"hljs-literal\">None</span>, <span class=\"hljs-literal\">None</span>))\n    \n    eval_df = pd.DataFrame(evaluation_results, columns=[<span class=\"hljs-string\">'주식 코드'</span>, <span class=\"hljs-string\">'제안 일자'</span>, <span class=\"hljs-string\">'초기 가격'</span>, <span class=\"hljs-string\">'최종 가격'</span>, <span class=\"hljs-string\">'가격 변동 (%)'</span>])\n    eval_df.to_csv(<span class=\"hljs-string\">'evaluation_results.csv'</span>, index=<span class=\"hljs-literal\">False</span>)\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">\"__main__\"</span>:\n    <span class=\"hljs-keyword\">try</span>:\n        tickers = get_stock_list()\n        \n        suggestions = suggest_investments(tickers)\n        display_dashboard(suggestions)\n\n        short_term_suggestions = short_term_analysis(tickers)\n        st.title(<span class=\"hljs-string\">\"단기 투자 제안\"</span>)\n        display_dashboard(short_term_suggestions)\n\n        evaluate_performance()\n        evaluation_results_df = pd.read_csv(<span class=\"hljs-string\">'evaluation_results.csv'</span>)\n        st.title(<span class=\"hljs-string\">\"평가 결과\"</span>)\n        st.write(evaluation_results_df)\n        \n    <span class=\"hljs-keyword\">except</span> KeyboardInterrupt:\n        st.write(<span class=\"hljs-string\">\"사용자에 의해 스크립트가 중단되었습니다.\"</span>)\n</code></pre>\n<p>… 그리고 면책 조항.</p>\n<h1>면책 조항</h1>\n<p>이 글과 함께 제공된 코드는 교육 목적으로만 사용됩니다. 스크립트가 제공하는 제안은 자동 분석의 기능을 보여주기 위한 것이며, 사용자는 제안된 조치를 모니터링하고 시간이 지남에 따라 성공률을 평가해야 합니다. 이 콘텐츠는 행동 요령이 아니며, 재정 자문으로 해석해서는 안 됩니다. 언제든지 본인의 연구를 수행하고 거래 결정을 내리기 전에 전문가와 상의하십시오.</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<h1>결론</h1>\n<p>이러한 단계를 따르면 기술적 및 기본적인 지표를 모두 사용하여 주식을 평가하는 견고한 투자 분석 도구를 만들 수 있습니다. 결과는 인터랙티브 한 Streamlit 대시 보드에 표시되어 분석을 해석하고 조치를 취하기가 쉬워집니다. 즐거운 코딩투자를 하세요!</p>\n</body>\n</html>\n"},"__N_SSG":true}