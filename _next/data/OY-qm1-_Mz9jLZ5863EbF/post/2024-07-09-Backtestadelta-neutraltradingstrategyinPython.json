{"pageProps":{"post":{"title":"Python으로 델타 뉴트럴 트레이딩 전략 백테스트 하는 방법","description":"","date":"2024-07-09 14:50","slug":"2024-07-09-Backtestadelta-neutraltradingstrategyinPython","content":"\n\n\n![image](/assets/img/2024-07-09-Backtestadelta-neutraltradingstrategyinPython_0.png)\n\n옵션의 가장 강력한 사용 방법 중 하나는 투자 포트폴리오를 기본 자산의 방향성 스윙으로부터 격리시키는 능력입니다.\n\nApple 주식을 매수하면 다음과 같은 상황이 발생합니다:\n- Apple 주식이 상승하면 가치가 증가합니다.\n- Apple 주식이 하락하면 가치가 감소합니다.\n\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n\n<img src=\"/assets/img/2024-07-09-Backtestadelta-neutraltradingstrategyinPython_1.png\" />\n\n당신의 포지션은 방향성 노출이 있으며 델타가 1이라고 합니다.\n\n그냥 포지션을 유지하면 주식에서 미실현 이익과 손실에 노출됩니다.\n\n대부분의 소액 투자자들에게 작은 손실은 투자의 일부입니다.\n\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n그러나 대형 기관 투자자들은 특정 투자 규정(예: 미 실현 손실이 15%를 초과해서는 안 된다)에 따라, 미 실현 손실이 발생하는 것은 금물입니다.\n\n# 델타 제거하기\n\n다행히도, 우리가 보게 될 것처럼, 주식 보유량과 옵션을 조합하여 보유 위치에서 델타를 부분적/전적으로 제거하는 것이 가능합니다. 이를 적극적으로 관리하여 가능합니다.\n\n옵션 용어에서는 이를 델타 헷징이라고 합니다.\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n## 방향성 노출 조정하기\n\n현재 인벤토리에 주식 보유 중이라면, 방향성 노출을 조정하는 간편한 방법은 콜 옵션을 매수하거나 공매도하는 것입니다.\n\n![이미지1](/assets/img/2024-07-09-Backtestadelta-neutraltradingstrategyinPython_2.png)\n\n![이미지2](/assets/img/2024-07-09-Backtestadelta-neutraltradingstrategyinPython_3.png)\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n특정 계약에서 콜의 델타는 0.77이며, 완전히 델타 중립이 되기 위해 주식 대 콜 옵션의 비율은 77:100이어야 합니다.\n\n많은 옵션 계약에서는 100단위의 주식/상품/자산을 표현합니다. 따라서, 각 콜 옵션을 판매할 때마다 77주를 구매/보유해야 합니다.\n\n보유 주식 수 = 매도한 콜 옵션 수 * 100 * 델타\n\n다음 날/주에 콜의 델타가 0.80으로 증가하면, 각 콜 당 추가로 3주를 더 매입해야 합니다.\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n엄밀히 말하면 역방향도 가능합니다. 매수하거나 빌림으로써 주식 보유량과 델타를 일치시킬 수 있습니다.\n\n그러나 콜 옵션은 100주의 주식을 나타내므로 델타의 정확한 가치를 제어할 수 있는 기회가 줄어듭니다. (예: 0.2개의 콜 옵션을 구매하여 20주의 델타를 확보할 수는 없습니다).\n\n# 델타 헷지 전략 테스트 중\n\n위의 비디오에서 사용된 예시는 John Hull의 다음 교과서에 나와 있습니다.\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n![image](/assets/img/2024-07-09-Backtestadelta-neutraltradingstrategyinPython_4.png)\n\n이 예제에서는 1000개의 숏 콜(short calls)을 시작으로 책이 시작됩니다. 이것은 10만 주의 가치가 있는 숏 포지션을 나타냅니다.\n\n이 연습의 목표는 콜의 델타에 기반하여 매주 포트폴리오를 리밸런싱하는 것입니다.\n\n![image](/assets/img/2024-07-09-Backtestadelta-neutraltradingstrategyinPython_5.png)\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n통화물이 처음으로 주 0에 구입되었을 때, 해당 통화물의 델타는 0.522입니다. 따라서 모든 통화물의 델타 합은 52,200입니다.\n\n주식 한 주의 델타가 1이라면, 우리는 이를 완벽하게 균형을 이루기 위해 52,200주를 구입하거나 보유해야 합니다.\n\n이 과정은 이후의 모든 주에도 계속됩니다.\n\n## 주의\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n주식 가격이 1주차와 2주차에 하락하는 것을 관찰하실 수 있습니다.\n\n하지만, 우리는 주식을 판매하고 있습니다.\n\n이로 인해 주식 거래에서 손실이 발생합니다.\n\n그러나 우리의 숏 콜 포지션은 네거티브 델타를 가지고 있습니다. (주식 가격이 하락함에 따라 가치가 증가), 우리는 콜 옵션을 더 낮은 가격에 다시 매수하여 우리의 숏 포지션에서 이익을 실현할 수 있습니다.\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n네트 효과는 포트폴리오에서 발생하는 어떤 이익도 손실을 상쇄합니다.\n\n## 왜 필요할까요\n\n델타 헷징의 대부분 목표는 알 수 없는 방향 위험을 절연하는 것입니다.\n\n이러한 경우는 주로 선거나 정부 발표와 같은 이벤트가 예정되어 있는 경우에 발생합니다.\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n곰계의 소식이 나쁜 경우에는 포트폴리오 자산에 손실이 발생할 수 있지만, 옵션 거래에서의 수익은 그 손실을 일부 또는 전체로 상쇄시킬 것입니다.\n\n## Python 코드\n\nHull 교재에서는 델타 값과 가격들의 시리즈를 제공했습니다.\n\n델타 값은 양수로 표기되어 있으며, 공매도를 할 경우 해당 값을 음수로 바꿔야 합니다.\n\n<!-- TIL 수평 -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\ndelta_values = np.array(delta_values)\ndelta_values=list(-delta_values) if apple.long_short_option == 'Short' \nelse delta_values\n```\n\n```js\nimport numpy as np\nprices = [49, 48.12, 47.37, 50.25, 51.75, 53.12, 53, 49.88, 48.5, \n          49.88, 50.37, 52.13, 51.88, 52.87, 54.87, 54.62, 55.87, 57.25]\ndelta_values = [0.522, 0.458, 0.4, 0.596, 0.693, 0.774, 0.771, 0.706, 0.674, 0.787, 0.550, \n                0.413, 0.542, 0.591, 0.768, 0.759, 0.865, 0.978, 0.990, 1, 1]\n\ndelta_values = np.array(delta_values)\n\nclass Position:\n    def __init__(self, current_pos_delta, \n                 option_contracts, \n                 shares_held, \n                 cash,\n                 long_short_option, \n                 PnL\n                 ):\n        self.current_pos_delta = current_pos_delta\n        self.option_contracts = option_contracts\n        self.shares_held = shares_held\n        self.cash = cash\n        self.long_short_option = long_short_option\n        self.PnL = PnL\n        pass\n\napple = Position(0, 1000, 0, 0, 'Short', 0)\n\ndef buy_sell(long_short, price, quantity):\n    if long_short==\"Long\":\n        apple.cash -= price*quantity\n        pass\n        \n    elif long_short=='Short/Sell':\n        apple.cash += price*quantity\n        pass\n\ndef delta_hedge(option_contracts,\n                option_delta,\n                shares_held,\n                price\n                ):\n    new_pos_delta = option_contracts*option_delta*100\n    delta_hedge = new_pos_delta - apple.current_pos_delta\n    long_short = \"Short/Sell\" if delta_hedge>0 else \"Long\"\n    shares_held += -new_pos_delta\n    holdings_value = shares_held*price\n\n    buy_sell(long_short=long_short, price=price, quantity=abs(int(delta_hedge)))\n    apple.PnL = holdings_value+apple.cash\n\n    print(\"|Delta to hedge: \", delta_hedge, \"|\",\n          \"Shares/Tokens to\" ,long_short,\": \" ,abs(int(delta_hedge)),\"|\", \n          \"Shares Held: \", int(shares_held), \"|\", \n          \"Value of Holdings: $\", holdings_value ,\"|\", \n          \"Cash holdings: $\", apple.cash, \"|\",\n          \"PnL: $\", apple.PnL, \"|\")\n    apple.current_pos_delta = new_pos_delta\n    pass\n\ndelta_values=list(-delta_values) if apple.long_short_option == 'Short' else delta_values\n\nfor (delta, price) in zip(delta_values, prices):\n    delta_hedge(option_contracts=apple.option_contracts,\n                option_delta=delta,\n                shares_held=apple.shares_held,\n                price=price)\r\n```\n\n위 코드를 실행하여 command line에서 출력되는 내용은 다음과 같습니다.","ogImage":{"url":"/assets/img/2024-07-09-Backtestadelta-neutraltradingstrategyinPython_0.png"},"coverImage":"/assets/img/2024-07-09-Backtestadelta-neutraltradingstrategyinPython_0.png","tag":["Tech"],"readingTime":9},"content":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n</head>\n<body>\n<p><img src=\"/assets/img/2024-07-09-Backtestadelta-neutraltradingstrategyinPython_0.png\" alt=\"image\"></p>\n<p>옵션의 가장 강력한 사용 방법 중 하나는 투자 포트폴리오를 기본 자산의 방향성 스윙으로부터 격리시키는 능력입니다.</p>\n<p>Apple 주식을 매수하면 다음과 같은 상황이 발생합니다:</p>\n<ul>\n<li>Apple 주식이 상승하면 가치가 증가합니다.</li>\n<li>Apple 주식이 하락하면 가치가 감소합니다.</li>\n</ul>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<img src=\"/assets/img/2024-07-09-Backtestadelta-neutraltradingstrategyinPython_1.png\">\n<p>당신의 포지션은 방향성 노출이 있으며 델타가 1이라고 합니다.</p>\n<p>그냥 포지션을 유지하면 주식에서 미실현 이익과 손실에 노출됩니다.</p>\n<p>대부분의 소액 투자자들에게 작은 손실은 투자의 일부입니다.</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>그러나 대형 기관 투자자들은 특정 투자 규정(예: 미 실현 손실이 15%를 초과해서는 안 된다)에 따라, 미 실현 손실이 발생하는 것은 금물입니다.</p>\n<h1>델타 제거하기</h1>\n<p>다행히도, 우리가 보게 될 것처럼, 주식 보유량과 옵션을 조합하여 보유 위치에서 델타를 부분적/전적으로 제거하는 것이 가능합니다. 이를 적극적으로 관리하여 가능합니다.</p>\n<p>옵션 용어에서는 이를 델타 헷징이라고 합니다.</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<h2>방향성 노출 조정하기</h2>\n<p>현재 인벤토리에 주식 보유 중이라면, 방향성 노출을 조정하는 간편한 방법은 콜 옵션을 매수하거나 공매도하는 것입니다.</p>\n<p><img src=\"/assets/img/2024-07-09-Backtestadelta-neutraltradingstrategyinPython_2.png\" alt=\"이미지1\"></p>\n<p><img src=\"/assets/img/2024-07-09-Backtestadelta-neutraltradingstrategyinPython_3.png\" alt=\"이미지2\"></p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>특정 계약에서 콜의 델타는 0.77이며, 완전히 델타 중립이 되기 위해 주식 대 콜 옵션의 비율은 77:100이어야 합니다.</p>\n<p>많은 옵션 계약에서는 100단위의 주식/상품/자산을 표현합니다. 따라서, 각 콜 옵션을 판매할 때마다 77주를 구매/보유해야 합니다.</p>\n<p>보유 주식 수 = 매도한 콜 옵션 수 * 100 * 델타</p>\n<p>다음 날/주에 콜의 델타가 0.80으로 증가하면, 각 콜 당 추가로 3주를 더 매입해야 합니다.</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>엄밀히 말하면 역방향도 가능합니다. 매수하거나 빌림으로써 주식 보유량과 델타를 일치시킬 수 있습니다.</p>\n<p>그러나 콜 옵션은 100주의 주식을 나타내므로 델타의 정확한 가치를 제어할 수 있는 기회가 줄어듭니다. (예: 0.2개의 콜 옵션을 구매하여 20주의 델타를 확보할 수는 없습니다).</p>\n<h1>델타 헷지 전략 테스트 중</h1>\n<p>위의 비디오에서 사용된 예시는 John Hull의 다음 교과서에 나와 있습니다.</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p><img src=\"/assets/img/2024-07-09-Backtestadelta-neutraltradingstrategyinPython_4.png\" alt=\"image\"></p>\n<p>이 예제에서는 1000개의 숏 콜(short calls)을 시작으로 책이 시작됩니다. 이것은 10만 주의 가치가 있는 숏 포지션을 나타냅니다.</p>\n<p>이 연습의 목표는 콜의 델타에 기반하여 매주 포트폴리오를 리밸런싱하는 것입니다.</p>\n<p><img src=\"/assets/img/2024-07-09-Backtestadelta-neutraltradingstrategyinPython_5.png\" alt=\"image\"></p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>통화물이 처음으로 주 0에 구입되었을 때, 해당 통화물의 델타는 0.522입니다. 따라서 모든 통화물의 델타 합은 52,200입니다.</p>\n<p>주식 한 주의 델타가 1이라면, 우리는 이를 완벽하게 균형을 이루기 위해 52,200주를 구입하거나 보유해야 합니다.</p>\n<p>이 과정은 이후의 모든 주에도 계속됩니다.</p>\n<h2>주의</h2>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>주식 가격이 1주차와 2주차에 하락하는 것을 관찰하실 수 있습니다.</p>\n<p>하지만, 우리는 주식을 판매하고 있습니다.</p>\n<p>이로 인해 주식 거래에서 손실이 발생합니다.</p>\n<p>그러나 우리의 숏 콜 포지션은 네거티브 델타를 가지고 있습니다. (주식 가격이 하락함에 따라 가치가 증가), 우리는 콜 옵션을 더 낮은 가격에 다시 매수하여 우리의 숏 포지션에서 이익을 실현할 수 있습니다.</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>네트 효과는 포트폴리오에서 발생하는 어떤 이익도 손실을 상쇄합니다.</p>\n<h2>왜 필요할까요</h2>\n<p>델타 헷징의 대부분 목표는 알 수 없는 방향 위험을 절연하는 것입니다.</p>\n<p>이러한 경우는 주로 선거나 정부 발표와 같은 이벤트가 예정되어 있는 경우에 발생합니다.</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>곰계의 소식이 나쁜 경우에는 포트폴리오 자산에 손실이 발생할 수 있지만, 옵션 거래에서의 수익은 그 손실을 일부 또는 전체로 상쇄시킬 것입니다.</p>\n<h2>Python 코드</h2>\n<p>Hull 교재에서는 델타 값과 가격들의 시리즈를 제공했습니다.</p>\n<p>델타 값은 양수로 표기되어 있으며, 공매도를 할 경우 해당 값을 음수로 바꿔야 합니다.</p>\n<!-- TIL 수평 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-js\">delta_values = np.<span class=\"hljs-title function_\">array</span>(delta_values)\ndelta_values=<span class=\"hljs-title function_\">list</span>(-delta_values) <span class=\"hljs-keyword\">if</span> apple.<span class=\"hljs-property\">long_short_option</span> == <span class=\"hljs-string\">'Short'</span> \n<span class=\"hljs-keyword\">else</span> delta_values\n</code></pre>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> numpy <span class=\"hljs-keyword\">as</span> np\nprices = [<span class=\"hljs-number\">49</span>, <span class=\"hljs-number\">48.12</span>, <span class=\"hljs-number\">47.37</span>, <span class=\"hljs-number\">50.25</span>, <span class=\"hljs-number\">51.75</span>, <span class=\"hljs-number\">53.12</span>, <span class=\"hljs-number\">53</span>, <span class=\"hljs-number\">49.88</span>, <span class=\"hljs-number\">48.5</span>, \n          <span class=\"hljs-number\">49.88</span>, <span class=\"hljs-number\">50.37</span>, <span class=\"hljs-number\">52.13</span>, <span class=\"hljs-number\">51.88</span>, <span class=\"hljs-number\">52.87</span>, <span class=\"hljs-number\">54.87</span>, <span class=\"hljs-number\">54.62</span>, <span class=\"hljs-number\">55.87</span>, <span class=\"hljs-number\">57.25</span>]\ndelta_values = [<span class=\"hljs-number\">0.522</span>, <span class=\"hljs-number\">0.458</span>, <span class=\"hljs-number\">0.4</span>, <span class=\"hljs-number\">0.596</span>, <span class=\"hljs-number\">0.693</span>, <span class=\"hljs-number\">0.774</span>, <span class=\"hljs-number\">0.771</span>, <span class=\"hljs-number\">0.706</span>, <span class=\"hljs-number\">0.674</span>, <span class=\"hljs-number\">0.787</span>, <span class=\"hljs-number\">0.550</span>, \n                <span class=\"hljs-number\">0.413</span>, <span class=\"hljs-number\">0.542</span>, <span class=\"hljs-number\">0.591</span>, <span class=\"hljs-number\">0.768</span>, <span class=\"hljs-number\">0.759</span>, <span class=\"hljs-number\">0.865</span>, <span class=\"hljs-number\">0.978</span>, <span class=\"hljs-number\">0.990</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>]\n\ndelta_values = np.<span class=\"hljs-title function_\">array</span>(delta_values)\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Position</span>:\n    def <span class=\"hljs-title function_\">__init__</span>(self, current_pos_delta, \n                 option_contracts, \n                 shares_held, \n                 cash,\n                 long_short_option, \n                 <span class=\"hljs-title class_\">PnL</span>\n                 ):\n        self.<span class=\"hljs-property\">current_pos_delta</span> = current_pos_delta\n        self.<span class=\"hljs-property\">option_contracts</span> = option_contracts\n        self.<span class=\"hljs-property\">shares_held</span> = shares_held\n        self.<span class=\"hljs-property\">cash</span> = cash\n        self.<span class=\"hljs-property\">long_short_option</span> = long_short_option\n        self.<span class=\"hljs-property\">PnL</span> = <span class=\"hljs-title class_\">PnL</span>\n        pass\n\napple = <span class=\"hljs-title class_\">Position</span>(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1000</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-string\">'Short'</span>, <span class=\"hljs-number\">0</span>)\n\ndef <span class=\"hljs-title function_\">buy_sell</span>(long_short, price, quantity):\n    <span class=\"hljs-keyword\">if</span> long_short==<span class=\"hljs-string\">\"Long\"</span>:\n        apple.<span class=\"hljs-property\">cash</span> -= price*quantity\n        pass\n        \n    elif long_short==<span class=\"hljs-string\">'Short/Sell'</span>:\n        apple.<span class=\"hljs-property\">cash</span> += price*quantity\n        pass\n\ndef <span class=\"hljs-title function_\">delta_hedge</span>(option_contracts,\n                option_delta,\n                shares_held,\n                price\n                ):\n    new_pos_delta = option_contracts*option_delta*<span class=\"hljs-number\">100</span>\n    delta_hedge = new_pos_delta - apple.<span class=\"hljs-property\">current_pos_delta</span>\n    long_short = <span class=\"hljs-string\">\"Short/Sell\"</span> <span class=\"hljs-keyword\">if</span> delta_hedge><span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">else</span> <span class=\"hljs-string\">\"Long\"</span>\n    shares_held += -new_pos_delta\n    holdings_value = shares_held*price\n\n    <span class=\"hljs-title function_\">buy_sell</span>(long_short=long_short, price=price, quantity=<span class=\"hljs-title function_\">abs</span>(<span class=\"hljs-title function_\">int</span>(delta_hedge)))\n    apple.<span class=\"hljs-property\">PnL</span> = holdings_value+apple.<span class=\"hljs-property\">cash</span>\n\n    <span class=\"hljs-title function_\">print</span>(<span class=\"hljs-string\">\"|Delta to hedge: \"</span>, delta_hedge, <span class=\"hljs-string\">\"|\"</span>,\n          <span class=\"hljs-string\">\"Shares/Tokens to\"</span> ,long_short,<span class=\"hljs-string\">\": \"</span> ,<span class=\"hljs-title function_\">abs</span>(<span class=\"hljs-title function_\">int</span>(delta_hedge)),<span class=\"hljs-string\">\"|\"</span>, \n          <span class=\"hljs-string\">\"Shares Held: \"</span>, <span class=\"hljs-title function_\">int</span>(shares_held), <span class=\"hljs-string\">\"|\"</span>, \n          <span class=\"hljs-string\">\"Value of Holdings: $\"</span>, holdings_value ,<span class=\"hljs-string\">\"|\"</span>, \n          <span class=\"hljs-string\">\"Cash holdings: $\"</span>, apple.<span class=\"hljs-property\">cash</span>, <span class=\"hljs-string\">\"|\"</span>,\n          <span class=\"hljs-string\">\"PnL: $\"</span>, apple.<span class=\"hljs-property\">PnL</span>, <span class=\"hljs-string\">\"|\"</span>)\n    apple.<span class=\"hljs-property\">current_pos_delta</span> = new_pos_delta\n    pass\n\ndelta_values=<span class=\"hljs-title function_\">list</span>(-delta_values) <span class=\"hljs-keyword\">if</span> apple.<span class=\"hljs-property\">long_short_option</span> == <span class=\"hljs-string\">'Short'</span> <span class=\"hljs-keyword\">else</span> delta_values\n\n<span class=\"hljs-keyword\">for</span> (delta, price) <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">zip</span>(delta_values, prices):\n    <span class=\"hljs-title function_\">delta_hedge</span>(option_contracts=apple.<span class=\"hljs-property\">option_contracts</span>,\n                option_delta=delta,\n                shares_held=apple.<span class=\"hljs-property\">shares_held</span>,\n                price=price)\n</code></pre>\n<p>위 코드를 실행하여 command line에서 출력되는 내용은 다음과 같습니다.</p>\n</body>\n</html>\n"},"__N_SSG":true}