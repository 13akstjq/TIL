<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>PySpark 윈도우 연산을 마스터하기 위한 5가지 예제 | TIL</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://13akstjq.github.io/TIL//post/2024-07-14-5ExamplestoMasterPySparkWindowOperations" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="PySpark 윈도우 연산을 마스터하기 위한 5가지 예제 | TIL" data-gatsby-head="true"/><meta property="og:title" content="PySpark 윈도우 연산을 마스터하기 위한 5가지 예제 | TIL" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/TIL/assets/img/2024-07-14-5ExamplestoMasterPySparkWindowOperations_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://TIL.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://13akstjq.github.io/TIL//post/2024-07-14-5ExamplestoMasterPySparkWindowOperations" data-gatsby-head="true"/><meta name="twitter:title" content="PySpark 윈도우 연산을 마스터하기 위한 5가지 예제 | TIL" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/TIL/assets/img/2024-07-14-5ExamplestoMasterPySparkWindowOperations_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | TIL" data-gatsby-head="true"/><meta name="article:published_time" content="2024-07-14 20:16" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/TIL/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/TIL/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/TIL/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/TIL/favicons/favicon-96x96.png"/><link rel="icon" href="/TIL/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/TIL/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/TIL/favicons/browserconfig.xml"/><link rel="preload" href="/TIL/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/TIL/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/TIL/_next/static/css/0eef537492fed77a.css" as="style"/><link rel="stylesheet" href="/TIL/_next/static/css/0eef537492fed77a.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/TIL/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/TIL/_next/static/chunks/webpack-21ffe88bdca56cba.js" defer=""></script><script src="/TIL/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/TIL/_next/static/chunks/main-a5eeabb286676ce6.js" defer=""></script><script src="/TIL/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/TIL/_next/static/chunks/75fc9c18-4a646156c659a948.js" defer=""></script><script src="/TIL/_next/static/chunks/348-02483b66b493dd81.js" defer=""></script><script src="/TIL/_next/static/chunks/pages/post/%5Bslug%5D-8ded8b979ba73586.js" defer=""></script><script src="/TIL/_next/static/KUC9M_yIlA1Ugo01xmkHL/_buildManifest.js" defer=""></script><script src="/TIL/_next/static/KUC9M_yIlA1Ugo01xmkHL/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/TIL">TIL</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/TIL/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">PySpark 윈도우 연산을 마스터하기 위한 5가지 예제</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="PySpark 윈도우 연산을 마스터하기 위한 5가지 예제" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/TIL/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">TIL</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On Jul 14, 2024</span><span class="posts_reading_time__f7YPP">16<!-- --> min read</span></span></div></div></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<p><img src="/TIL/assets/img/2024-07-14-5ExamplestoMasterPySparkWindowOperations_0.png" alt="Window Operations"></p>
<p>내가 사용해 본 모든 데이터 분석 및 조작 도구에는 윈도우 연산이 있습니다. 일부는 다른 것보다 유연하고 능력이 높지만, 윈도우에서 계산을 할 수 있는 것이 필수적입니다.</p>
<p>데이터 분석에서 윈도우란 무엇인가요?</p>
<p>윈도우는 어떤 방식으로 관련된 행들의 집합입니다. 이 관련은 동일한 그룹에 속하거나 연속적인 n일에 존재하는 것일 수 있습니다. 필요한 제약 조건으로 윈도우를 생성한 후, 해당 윈도우에서 계산이나 집계를 수행할 수 있습니다.</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>이 기사에서는 PySpark를 사용하여 창 작업에 대해 포괄적으로 이해할 수 있는 5가지 구체적인 예제를 살펴보겠습니다. 우리는 파티션과 함께 윈도우를 생성하는 방법, 이러한 윈도우를 사용자 정의하는 방법, 그리고 이를 통해 계산을 수행하는 방법을 배울 것입니다.</p>
<p>PySpark는 대규모 데이터 처리에 사용되는 분석 엔진인 Spark의 Python API입니다.</p>
<h1>데이터</h1>
<p>이 기사를 위해 모의 데이터로 샘플 데이터셋을 준비했고, 해당 데이터셋은 제 저장소에서 다운로드할 수 있습니다. 이 기사에서 사용할 데이터셋은 "sample_sales_pyspark.csv"라고 부릅니다.</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>자, spark 세션을 시작하고 이 데이터셋으로부터 DataFrame을 생성해 봅시다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">from</span> pyspark.<span class="hljs-property">sql</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">SparkSession</span>
<span class="hljs-keyword">from</span> pyspark.<span class="hljs-property">sql</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">Window</span>, functions <span class="hljs-keyword">as</span> F

spark = <span class="hljs-title class_">SparkSession</span>.<span class="hljs-property">builder</span>.<span class="hljs-title function_">getOrCreate</span>()

data = spark.<span class="hljs-property">read</span>.<span class="hljs-title function_">csv</span>(<span class="hljs-string">"sample_sales_pyspark.csv"</span>, header=<span class="hljs-title class_">True</span>)

data.<span class="hljs-title function_">show</span>(<span class="hljs-number">15</span>)

# output
+----------+------------+----------+---------+---------+-----+
|store_code|product_code|sales_date|sales_qty|sales_rev|price|
+----------+------------+----------+---------+---------+-----+
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">01</span>|       <span class="hljs-number">14</span>|    <span class="hljs-number">17654</span>| <span class="hljs-number">1261</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">02</span>|       <span class="hljs-number">19</span>|    <span class="hljs-number">24282</span>| <span class="hljs-number">1278</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">03</span>|       <span class="hljs-number">15</span>|    <span class="hljs-number">19305</span>| <span class="hljs-number">1287</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">04</span>|       <span class="hljs-number">21</span>|    <span class="hljs-number">28287</span>| <span class="hljs-number">1347</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">05</span>|        <span class="hljs-number">4</span>|     <span class="hljs-number">5404</span>| <span class="hljs-number">1351</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">06</span>|        <span class="hljs-number">5</span>|     <span class="hljs-number">6775</span>| <span class="hljs-number">1355</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">07</span>|       <span class="hljs-number">10</span>|    <span class="hljs-number">12420</span>| <span class="hljs-number">1242</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">08</span>|       <span class="hljs-number">18</span>|    <span class="hljs-number">22500</span>| <span class="hljs-number">1250</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">09</span>|        <span class="hljs-number">5</span>|     <span class="hljs-number">6555</span>| <span class="hljs-number">1311</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">10</span>|        <span class="hljs-number">2</span>|     <span class="hljs-number">2638</span>| <span class="hljs-number">1319</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">11</span>|       <span class="hljs-number">15</span>|    <span class="hljs-number">19575</span>| <span class="hljs-number">1305</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">12</span>|       <span class="hljs-number">21</span>|    <span class="hljs-number">28182</span>| <span class="hljs-number">1342</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">13</span>|        <span class="hljs-number">7</span>|     <span class="hljs-number">9268</span>| <span class="hljs-number">1324</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">14</span>|       <span class="hljs-number">17</span>|    <span class="hljs-number">22576</span>| <span class="hljs-number">1328</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">15</span>|       <span class="hljs-number">16</span>|    <span class="hljs-number">20320</span>| <span class="hljs-number">1270</span>|
+----------+------------+----------+---------+---------+-----+
</code></pre>
<h2>예제 1</h2>
<p>우선, 파티션과 정렬 열을 기준으로 윈도우를 생성합니다. DataFrame에서는 각 제품의 누적 판매량을 각 상점별로 계산하려면 윈도우를 다음과 같이 정의합니다:</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js"><span class="hljs-variable language_">window</span> = <span class="hljs-title class_">Window</span>.<span class="hljs-title function_">partitionBy</span>(<span class="hljs-string">"store_code"</span>, <span class="hljs-string">"product_code"</span>).<span class="hljs-title function_">orderBy</span>(<span class="hljs-string">"sales_date"</span>)
</code></pre>
<p>누적 판매량을 계산하려면 이 윈도우 위에 sum 함수를 적용하기만 하면 됩니다:</p>
<pre><code class="hljs language-js">data = data.<span class="hljs-title function_">withColumn</span>(<span class="hljs-string">"total_sales"</span>, F.<span class="hljs-title function_">sum</span>(<span class="hljs-string">"sales_qty"</span>).<span class="hljs-title function_">over</span>(<span class="hljs-variable language_">window</span>))
</code></pre>
<p>이 코드는 "total_sales"라는 새 열을 만들며, 이전에 정의한 윈도우 상에서 계산된 판매 수량의 누적 합계를 포함합니다.</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>" B1" 스토어의 첫 30개 행을 확인해봐서 누적값이 올바르게 계산되었는지 확인해보세요:</p>
<pre><code class="hljs language-js">data \
.<span class="hljs-title function_">filter</span>((F.<span class="hljs-title function_">col</span>(<span class="hljs-string">"store_code"</span>)==<span class="hljs-string">"B1"</span>)) \
.<span class="hljs-title function_">select</span>(<span class="hljs-string">"store_code"</span>, <span class="hljs-string">"product_code"</span>, <span class="hljs-string">"sales_date"</span>, <span class="hljs-string">"sales_qty"</span>, <span class="hljs-string">"total_sales"</span>) \
.<span class="hljs-title function_">show</span>(<span class="hljs-number">30</span>)

# output
+----------+------------+----------+---------+-----------+
|store_code|product_code|sales_date|sales_qty|total_sales|
+----------+------------+----------+---------+-----------+
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">01</span>|       <span class="hljs-number">14</span>|       <span class="hljs-number">14.0</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">02</span>|       <span class="hljs-number">19</span>|       <span class="hljs-number">33.0</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">03</span>|       <span class="hljs-number">15</span>|       <span class="hljs-number">48.0</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">04</span>|       <span class="hljs-number">21</span>|       <span class="hljs-number">69.0</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">05</span>|        <span class="hljs-number">4</span>|       <span class="hljs-number">73.0</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">06</span>|        <span class="hljs-number">5</span>|       <span class="hljs-number">78.0</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">07</span>|       <span class="hljs-number">10</span>|       <span class="hljs-number">88.0</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">08</span>|       <span class="hljs-number">18</span>|      <span class="hljs-number">106.0</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">09</span>|        <span class="hljs-number">5</span>|      <span class="hljs-number">111.0</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">10</span>|        <span class="hljs-number">2</span>|      <span class="hljs-number">113.0</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">11</span>|       <span class="hljs-number">15</span>|      <span class="hljs-number">128.0</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">12</span>|       <span class="hljs-number">21</span>|      <span class="hljs-number">149.0</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">13</span>|        <span class="hljs-number">7</span>|      <span class="hljs-number">156.0</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">14</span>|       <span class="hljs-number">17</span>|      <span class="hljs-number">173.0</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">15</span>|       <span class="hljs-number">16</span>|      <span class="hljs-number">189.0</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89915</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">01</span>|       <span class="hljs-number">20</span>|       <span class="hljs-number">20.0</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89915</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">02</span>|        <span class="hljs-number">0</span>|       <span class="hljs-number">20.0</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89915</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">03</span>|       <span class="hljs-number">10</span>|       <span class="hljs-number">30.0</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89915</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">04</span>|       <span class="hljs-number">13</span>|       <span class="hljs-number">43.0</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89915</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">05</span>|       <span class="hljs-number">21</span>|       <span class="hljs-number">64.0</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89915</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">06</span>|        <span class="hljs-number">4</span>|       <span class="hljs-number">68.0</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89915</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">07</span>|       <span class="hljs-number">20</span>|       <span class="hljs-number">88.0</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89915</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">08</span>|       <span class="hljs-number">16</span>|      <span class="hljs-number">104.0</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89915</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">09</span>|       <span class="hljs-number">21</span>|      <span class="hljs-number">125.0</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89915</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">10</span>|        <span class="hljs-number">2</span>|      <span class="hljs-number">127.0</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89915</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">11</span>|       <span class="hljs-number">15</span>|      <span class="hljs-number">142.0</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89915</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">12</span>|       <span class="hljs-number">15</span>|      <span class="hljs-number">157.0</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89915</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">13</span>|       <span class="hljs-number">14</span>|      <span class="hljs-number">171.0</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89915</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">14</span>|        <span class="hljs-number">3</span>|      <span class="hljs-number">174.0</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89915</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">15</span>|        <span class="hljs-number">1</span>|      <span class="hljs-number">175.0</span>|
+----------+------------+----------+---------+-----------+
</code></pre>
<p>첫 15개 행은 제품 89912에 속하므로 총 판매액 열은 판매 수량 열의 값들의 누적 합을 보여줍니다. 16번째 행에서 제품 코드가 변경되어 누적 합이 초기화됩니다. 이는 우리가 스토어 코드와 제품 코드로 분할된 윈도우를 생성했기 때문입니다.</p>
<h2>예시 2</h2>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>창을 생성한 후에는 다양한 집계를 계산할 수 있어요. 예를 들어, 앞에서 정의한 창에 대해 max 함수를 적용하면, 결과는 주어진 상점의 제품의 누적 최대 가격이 될 거예요.</p>
<p>창을 생성하는 코드를 작성할 테니까, 위를 계속 찾지 않아도 돼요.</p>
<pre><code class="hljs language-js"># 창 정의
<span class="hljs-variable language_">window</span> = <span class="hljs-title class_">Window</span>.<span class="hljs-title function_">partitionBy</span>(<span class="hljs-string">"store_code"</span>, <span class="hljs-string">"product_code"</span>).<span class="hljs-title function_">orderBy</span>(<span class="hljs-string">"sales_date"</span>)

# 누적 최대 가격
data = data.<span class="hljs-title function_">withColumn</span>(<span class="hljs-string">"max_price"</span>, F.<span class="hljs-title function_">max</span>(<span class="hljs-string">"price"</span>).<span class="hljs-title function_">over</span>(<span class="hljs-variable language_">window</span>))

# 결과 확인
data \
.<span class="hljs-title function_">filter</span>((F.<span class="hljs-title function_">col</span>(<span class="hljs-string">"store_code"</span>)==<span class="hljs-string">"B1"</span>)) \
.<span class="hljs-title function_">select</span>(<span class="hljs-string">"store_code"</span>, <span class="hljs-string">"product_code"</span>, <span class="hljs-string">"sales_date"</span>, <span class="hljs-string">"price"</span>, <span class="hljs-string">"max_price"</span>) \
.<span class="hljs-title function_">show</span>(<span class="hljs-number">15</span>)

# 결과
+----------+------------+----------+-----+---------+
|store_code|product_code|sales_date|price|max_price|
+----------+------------+----------+-----+---------+
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">01</span>| <span class="hljs-number">1261</span>|     <span class="hljs-number">1261</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">02</span>| <span class="hljs-number">1278</span>|     <span class="hljs-number">1278</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">03</span>| <span class="hljs-number">1287</span>|     <span class="hljs-number">1287</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">04</span>| <span class="hljs-number">1347</span>|     <span class="hljs-number">1347</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">05</span>| <span class="hljs-number">1351</span>|     <span class="hljs-number">1351</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">06</span>| <span class="hljs-number">1355</span>|     <span class="hljs-number">1355</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">07</span>| <span class="hljs-number">1242</span>|     <span class="hljs-number">1355</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">08</span>| <span class="hljs-number">1250</span>|     <span class="hljs-number">1355</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">09</span>| <span class="hljs-number">1311</span>|     <span class="hljs-number">1355</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">10</span>| <span class="hljs-number">1319</span>|     <span class="hljs-number">1355</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">11</span>| <span class="hljs-number">1305</span>|     <span class="hljs-number">1355</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">12</span>| <span class="hljs-number">1342</span>|     <span class="hljs-number">1355</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">13</span>| <span class="hljs-number">1324</span>|     <span class="hljs-number">1355</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">14</span>| <span class="hljs-number">1328</span>|     <span class="hljs-number">1355</span>|
|        <span class="hljs-variable constant_">B1</span>|       <span class="hljs-number">89912</span>|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">15</span>| <span class="hljs-number">1270</span>|     <span class="hljs-number">1355</span>|
+----------+------------+----------+-----+---------+
</code></pre>
<p>"max_price" 열의 값은 증가하거나 동일하게 유지돼요. 7번째 행에서는 가격이 실제로 낮아지지만, 누적 최대 값이 표시돼서 최대 가격 값은 그대로 유지돌아요.</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h2>예제 3</h2>
<p>lag 및 lead는 일반적으로 사용되는 윈도우 함수 중 일부입니다. 시계열 데이터를 분석할 때 자주 사용합니다. 현재 행의 앞이나 뒤에 오프셋된 값을 반환합니다.</p>
<ul>
<li>lag("sales_qty", 1) : 1행 전</li>
<li>lag("sales_qty", 2) : 2행 전</li>
<li>lead("sales_qty", 1) : 1행 후</li>
<li>lead("sales_qty", 2) : 2행 후</li>
</ul>
<p>lag의 음수 값을 사용하여 오프셋을 지정할 수 있으므로 lag("sales_qty", 1)은 lead("sales_qty", -1)과 동일합니다. 둘 다 이전 행의 값을 제공합니다. 테스트해 봅시다.</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js"># 창을 정의합니다
<span class="hljs-variable language_">window</span> = <span class="hljs-title class_">Window</span>.<span class="hljs-title function_">partitionBy</span>(<span class="hljs-string">"store_code"</span>, <span class="hljs-string">"product_code"</span>).<span class="hljs-title function_">orderBy</span>(<span class="hljs-string">"sales_date"</span>)

# 전일 판매 수량
data = data.<span class="hljs-title function_">withColumn</span>(<span class="hljs-string">"prev_day_sales_lag"</span>, F.<span class="hljs-title function_">lag</span>(<span class="hljs-string">"sales_qty"</span>, <span class="hljs-number">1</span>).<span class="hljs-title function_">over</span>(<span class="hljs-variable language_">window</span>))
data = data.<span class="hljs-title function_">withColumn</span>(<span class="hljs-string">"prev_day_sales_lead"</span>, F.<span class="hljs-title function_">lead</span>(<span class="hljs-string">"sales_qty"</span>, -<span class="hljs-number">1</span>).<span class="hljs-title function_">over</span>(<span class="hljs-variable language_">window</span>))

# 다른 제품-매장 쌍에 대한 출력 확인
data \
.<span class="hljs-title function_">filter</span>((F.<span class="hljs-title function_">col</span>(<span class="hljs-string">"store_code"</span>)==<span class="hljs-string">"A1"</span>) &#x26; (F.<span class="hljs-title function_">col</span>(<span class="hljs-string">"product_code"</span>)==<span class="hljs-string">"95955"</span>)) \
.<span class="hljs-title function_">select</span>(<span class="hljs-string">"sales_date"</span>, <span class="hljs-string">"sales_qty"</span>, <span class="hljs-string">"prev_day_sales_lag"</span>, <span class="hljs-string">"prev_day_sales_lead"</span>) \
.<span class="hljs-title function_">show</span>(<span class="hljs-number">15</span>)

# 출력 결과
+----------+---------+------------------+-------------------+
|sales_date|sales_qty|prev_day_sales_lag|prev_day_sales_lead|
+----------+---------+------------------+-------------------+
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">01</span>|       <span class="hljs-number">13</span>|              <span class="hljs-variable constant_">NULL</span>|               <span class="hljs-variable constant_">NULL</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">02</span>|        <span class="hljs-number">3</span>|                <span class="hljs-number">13</span>|                 <span class="hljs-number">13</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">03</span>|       <span class="hljs-number">22</span>|                 <span class="hljs-number">3</span>|                  <span class="hljs-number">3</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">04</span>|       <span class="hljs-number">17</span>|                <span class="hljs-number">22</span>|                 <span class="hljs-number">22</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">05</span>|       <span class="hljs-number">20</span>|                <span class="hljs-number">17</span>|                 <span class="hljs-number">17</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">06</span>|       <span class="hljs-number">14</span>|                <span class="hljs-number">20</span>|                 <span class="hljs-number">20</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">07</span>|       <span class="hljs-number">10</span>|                <span class="hljs-number">14</span>|                 <span class="hljs-number">14</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">08</span>|       <span class="hljs-number">10</span>|                <span class="hljs-number">10</span>|                 <span class="hljs-number">10</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">09</span>|       <span class="hljs-number">15</span>|                <span class="hljs-number">10</span>|                 <span class="hljs-number">10</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">10</span>|       <span class="hljs-number">15</span>|                <span class="hljs-number">15</span>|                 <span class="hljs-number">15</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">11</span>|        <span class="hljs-number">8</span>|                <span class="hljs-number">15</span>|                 <span class="hljs-number">15</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">12</span>|        <span class="hljs-number">9</span>|                 <span class="hljs-number">8</span>|                  <span class="hljs-number">8</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">13</span>|       <span class="hljs-number">13</span>|                 <span class="hljs-number">9</span>|                  <span class="hljs-number">9</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">14</span>|        <span class="hljs-number">6</span>|                <span class="hljs-number">13</span>|                 <span class="hljs-number">13</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">15</span>|       <span class="hljs-number">21</span>|                 <span class="hljs-number">6</span>|                  <span class="hljs-number">6</span>|
+----------+---------+------------------+-------------------+
</code></pre>
<p>첫 번째 행의 전일 값은 NULL입니다. 이는 해당 행이 이전 날짜를 가지고 있지 않기 때문에 발생합니다.</p>
<h2>예시 4</h2>
<p>행을 기반으로 한 창을 정의한 후, rowsBetween 메소드를 사용하여 범위를 좁힐 수 있습니다.</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>요즘 세 가지 이유로 판매량의 평균을 계산하려면 이 창을 다음과 같이 정의할 수 있습니다:</p>
<pre><code class="hljs language-js"><span class="hljs-variable language_">window</span> = <span class="hljs-title class_">Window</span> \
.<span class="hljs-title function_">partitionBy</span>(<span class="hljs-string">"store_code"</span>, <span class="hljs-string">"product_code"</span>) \
.<span class="hljs-title function_">orderBy</span>(<span class="hljs-string">"sales_date"</span>) \
.<span class="hljs-title function_">rowsBetween</span>(-<span class="hljs-number">3</span>, -<span class="hljs-number">1</span>)
</code></pre>
<p>첫 번째 매개변수가 시작이고 두 번째 매개변수가 끝입니다. 각 행에 대한 마지막 세 행을 포함하는 창을 사용자 정의했습니다. "-1"은 현재 행의 이전 행을 가리키고 "-3"은 현재 행의 세 번째 이전 행을 나타냅니다.</p>
<p><img src="/TIL/assets/img/2024-07-14-5ExamplestoMasterPySparkWindowOperations_1.png" alt="이미지"></p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>지난 세 날 동안의 평균 판매 수량을 계산하려면 이 윈도우에 mean 함수를 적용하기만 하면 됩니다.</p>
<pre><code class="hljs language-js"># 윈도우 정의
<span class="hljs-variable language_">window</span> = <span class="hljs-title class_">Window</span> \
.<span class="hljs-title function_">partitionBy</span>(<span class="hljs-string">"store_code"</span>, <span class="hljs-string">"product_code"</span>) \
.<span class="hljs-title function_">orderBy</span>(<span class="hljs-string">"sales_date"</span>) \
.<span class="hljs-title function_">rowsBetween</span>(-<span class="hljs-number">3</span>, -<span class="hljs-number">1</span>)

# 평균 계산
data = data.<span class="hljs-title function_">withColumn</span>(<span class="hljs-string">"last_3_day_avg"</span>, F.<span class="hljs-title function_">mean</span>(<span class="hljs-string">"sales_qty"</span>).<span class="hljs-title function_">over</span>(<span class="hljs-variable language_">window</span>))

# 데이터 표시
data \
.<span class="hljs-title function_">filter</span>((F.<span class="hljs-title function_">col</span>(<span class="hljs-string">"store_code"</span>)==<span class="hljs-string">"A1"</span>) &#x26; (F.<span class="hljs-title function_">col</span>(<span class="hljs-string">"product_code"</span>)==<span class="hljs-string">"95955"</span>)) \
.<span class="hljs-title function_">select</span>(<span class="hljs-string">"sales_date"</span>, <span class="hljs-string">"sales_qty"</span>, <span class="hljs-string">"last_3_day_avg"</span>) \
.<span class="hljs-title function_">show</span>()

# 결과
+----------+---------+------------------+
|sales_date|sales_qty|    last_3_day_avg|
+----------+---------+------------------+
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">01</span>|       <span class="hljs-number">13</span>|              <span class="hljs-variable constant_">NULL</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">02</span>|        <span class="hljs-number">3</span>|              <span class="hljs-number">13.0</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">03</span>|       <span class="hljs-number">22</span>|               <span class="hljs-number">8.0</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">04</span>|       <span class="hljs-number">17</span>|<span class="hljs-number">12.666666666666666</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">05</span>|       <span class="hljs-number">20</span>|              <span class="hljs-number">14.0</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">06</span>|       <span class="hljs-number">14</span>|<span class="hljs-number">19.666666666666668</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">07</span>|       <span class="hljs-number">10</span>|              <span class="hljs-number">17.0</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">08</span>|       <span class="hljs-number">10</span>|<span class="hljs-number">14.666666666666666</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">09</span>|       <span class="hljs-number">15</span>|<span class="hljs-number">11.333333333333334</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">10</span>|       <span class="hljs-number">15</span>|<span class="hljs-number">11.666666666666666</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">11</span>|        <span class="hljs-number">8</span>|<span class="hljs-number">13.333333333333334</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">12</span>|        <span class="hljs-number">9</span>|<span class="hljs-number">12.666666666666666</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">13</span>|       <span class="hljs-number">13</span>|<span class="hljs-number">10.666666666666666</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">14</span>|        <span class="hljs-number">6</span>|              <span class="hljs-number">10.0</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">15</span>|       <span class="hljs-number">21</span>| <span class="hljs-number">9.333333333333334</span>|
+----------+---------+------------------+
</code></pre>
<p>예를 들어, 네 번째 행인 "2021-05-04"의 경우, 지난 세 행(13, 3, 22)의 값의 평균인 13.75입니다.</p>
<h2>예시 5</h2>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>입력 데이터의 각 행에서 정의된 창 내의 열의 누적 평균 값을 계산해야 하는 경우를 생각해보세요. 각 행에 대해 계산은 창의 첫 번째 행과 현재 행 사이의 행을 포함해야 합니다.</p>
<p>이를 위해 unboundedPreceding으로 시작점을 정의할 수 있습니다. 마찬가지로, 창의 끝까지 가려면 unboundedFollowing을 사용할 수 있습니다.</p>
<img src="/TIL/assets/img/2024-07-14-5ExamplestoMasterPySparkWindowOperations_2.png">
<p>창을 정의한 후 나머지는 동일합니다.</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js"># 윈도우 정의
<span class="hljs-variable language_">window</span> = <span class="hljs-title class_">Window</span> \
.<span class="hljs-title function_">partitionBy</span>(<span class="hljs-string">"store_code"</span>, <span class="hljs-string">"product_code"</span>) \
.<span class="hljs-title function_">orderBy</span>(<span class="hljs-string">"sales_date"</span>) \
.<span class="hljs-title function_">rowsBetween</span>(<span class="hljs-title class_">Window</span>.<span class="hljs-property">unboundedPreceding</span>, -<span class="hljs-number">1</span>)

# 평균 계산
data = data.<span class="hljs-title function_">withColumn</span>(<span class="hljs-string">"누적평균"</span>, F.<span class="hljs-title function_">mean</span>(<span class="hljs-string">"sales_qty"</span>).<span class="hljs-title function_">over</span>(<span class="hljs-variable language_">window</span>))

# 데이터 출력
data \
.<span class="hljs-title function_">filter</span>((F.<span class="hljs-title function_">col</span>(<span class="hljs-string">"store_code"</span>)==<span class="hljs-string">"A1"</span>) &#x26; (F.<span class="hljs-title function_">col</span>(<span class="hljs-string">"product_code"</span>)==<span class="hljs-string">"95955"</span>)) \
.<span class="hljs-title function_">select</span>(<span class="hljs-string">"sales_date"</span>, <span class="hljs-string">"sales_qty"</span>, <span class="hljs-string">"누적평균"</span>) \
.<span class="hljs-title function_">show</span>()

# 결과
+----------+---------+------------------+
|sales_date|sales_qty|   누적평균       |
+----------+---------+------------------+
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">01</span>|       <span class="hljs-number">13</span>|              <span class="hljs-variable constant_">NULL</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">02</span>|        <span class="hljs-number">3</span>|              <span class="hljs-number">13.0</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">03</span>|       <span class="hljs-number">22</span>|               <span class="hljs-number">8.0</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">04</span>|       <span class="hljs-number">17</span>|<span class="hljs-number">12.666666666666666</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">05</span>|       <span class="hljs-number">20</span>|             <span class="hljs-number">13.75</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">06</span>|       <span class="hljs-number">14</span>|              <span class="hljs-number">15.0</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">07</span>|       <span class="hljs-number">10</span>|<span class="hljs-number">14.833333333333334</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">08</span>|       <span class="hljs-number">10</span>|<span class="hljs-number">14.142857142857142</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">09</span>|       <span class="hljs-number">15</span>|            <span class="hljs-number">13.625</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">10</span>|       <span class="hljs-number">15</span>|<span class="hljs-number">13.777777777777779</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">11</span>|        <span class="hljs-number">8</span>|              <span class="hljs-number">13.9</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">12</span>|        <span class="hljs-number">9</span>|<span class="hljs-number">13.363636363636363</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">13</span>|       <span class="hljs-number">13</span>|              <span class="hljs-number">13.0</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">14</span>|        <span class="hljs-number">6</span>|              <span class="hljs-number">13.0</span>|
|<span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">15</span>|       <span class="hljs-number">21</span>|              <span class="hljs-number">12.5</span>|
+----------+---------+------------------+
</code></pre>
<p>누적평균 열에는 현재 행까지의 모든 행의 평균 판매량이 포함됩니다 (현재 행은 제외됨). 현재 행을 누적 평균 계산에 포함하려면 다음과 같이 윈도우를 정의할 수 있습니다:</p>
<pre><code class="hljs language-js"><span class="hljs-variable language_">window</span> = <span class="hljs-title class_">Window</span> \
.<span class="hljs-title function_">partitionBy</span>(<span class="hljs-string">"store_code"</span>, <span class="hljs-string">"product_code"</span>) \
.<span class="hljs-title function_">orderBy</span>(<span class="hljs-string">"sales_date"</span>) \
.<span class="hljs-title function_">rowsBetween</span>(<span class="hljs-title class_">Window</span>.<span class="hljs-property">unboundedPreceding</span>, <span class="hljs-title class_">Window</span>.<span class="hljs-property">currentRow</span>)
</code></pre>
<h1>마지막으로</h1>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>윈도우 작업은 데이터 분석에 있어 근본적인 작업입니다. 특히 시계열 데이터를 다루거나 시계열 데이터에 대한 예측 분석을 위해 머신러닝 모델을 만들 때 다양한 피처를 생성하기 위해 윈도우 작업을 사용합니다.</p>
<p>대부분의 데이터 분석 및 조작 도구는 윈도우 작업을 수행하는 데 도움이 되는 기능을 제공합니다. 이 글에서는 PySpark를 사용하여 이러한 작업을 수행하는 방법을 배웠습니다.</p>
<p>읽어 주셔서 감사합니다. 피드백이 있으시면 언제든지 알려주세요.</p>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"PySpark 윈도우 연산을 마스터하기 위한 5가지 예제","description":"","date":"2024-07-14 20:16","slug":"2024-07-14-5ExamplestoMasterPySparkWindowOperations","content":"\n\n\n![Window Operations](/TIL/assets/img/2024-07-14-5ExamplestoMasterPySparkWindowOperations_0.png)\n\n내가 사용해 본 모든 데이터 분석 및 조작 도구에는 윈도우 연산이 있습니다. 일부는 다른 것보다 유연하고 능력이 높지만, 윈도우에서 계산을 할 수 있는 것이 필수적입니다.\n\n데이터 분석에서 윈도우란 무엇인가요?\n\n윈도우는 어떤 방식으로 관련된 행들의 집합입니다. 이 관련은 동일한 그룹에 속하거나 연속적인 n일에 존재하는 것일 수 있습니다. 필요한 제약 조건으로 윈도우를 생성한 후, 해당 윈도우에서 계산이나 집계를 수행할 수 있습니다.\n\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n이 기사에서는 PySpark를 사용하여 창 작업에 대해 포괄적으로 이해할 수 있는 5가지 구체적인 예제를 살펴보겠습니다. 우리는 파티션과 함께 윈도우를 생성하는 방법, 이러한 윈도우를 사용자 정의하는 방법, 그리고 이를 통해 계산을 수행하는 방법을 배울 것입니다.\n\nPySpark는 대규모 데이터 처리에 사용되는 분석 엔진인 Spark의 Python API입니다.\n\n# 데이터\n\n이 기사를 위해 모의 데이터로 샘플 데이터셋을 준비했고, 해당 데이터셋은 제 저장소에서 다운로드할 수 있습니다. 이 기사에서 사용할 데이터셋은 \"sample_sales_pyspark.csv\"라고 부릅니다.\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n자, spark 세션을 시작하고 이 데이터셋으로부터 DataFrame을 생성해 봅시다.\n\n```js\nfrom pyspark.sql import SparkSession\nfrom pyspark.sql import Window, functions as F\n\nspark = SparkSession.builder.getOrCreate()\n\ndata = spark.read.csv(\"sample_sales_pyspark.csv\", header=True)\n\ndata.show(15)\n\n# output\n+----------+------------+----------+---------+---------+-----+\n|store_code|product_code|sales_date|sales_qty|sales_rev|price|\n+----------+------------+----------+---------+---------+-----+\n|        B1|       89912|2021-05-01|       14|    17654| 1261|\n|        B1|       89912|2021-05-02|       19|    24282| 1278|\n|        B1|       89912|2021-05-03|       15|    19305| 1287|\n|        B1|       89912|2021-05-04|       21|    28287| 1347|\n|        B1|       89912|2021-05-05|        4|     5404| 1351|\n|        B1|       89912|2021-05-06|        5|     6775| 1355|\n|        B1|       89912|2021-05-07|       10|    12420| 1242|\n|        B1|       89912|2021-05-08|       18|    22500| 1250|\n|        B1|       89912|2021-05-09|        5|     6555| 1311|\n|        B1|       89912|2021-05-10|        2|     2638| 1319|\n|        B1|       89912|2021-05-11|       15|    19575| 1305|\n|        B1|       89912|2021-05-12|       21|    28182| 1342|\n|        B1|       89912|2021-05-13|        7|     9268| 1324|\n|        B1|       89912|2021-05-14|       17|    22576| 1328|\n|        B1|       89912|2021-05-15|       16|    20320| 1270|\n+----------+------------+----------+---------+---------+-----+\n```\n\n## 예제 1\n\n우선, 파티션과 정렬 열을 기준으로 윈도우를 생성합니다. DataFrame에서는 각 제품의 누적 판매량을 각 상점별로 계산하려면 윈도우를 다음과 같이 정의합니다:\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\nwindow = Window.partitionBy(\"store_code\", \"product_code\").orderBy(\"sales_date\")\n```\n\n누적 판매량을 계산하려면 이 윈도우 위에 sum 함수를 적용하기만 하면 됩니다:\n\n```js\ndata = data.withColumn(\"total_sales\", F.sum(\"sales_qty\").over(window))\n```\n\n이 코드는 \"total_sales\"라는 새 열을 만들며, 이전에 정의한 윈도우 상에서 계산된 판매 수량의 누적 합계를 포함합니다.\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n\" B1\" 스토어의 첫 30개 행을 확인해봐서 누적값이 올바르게 계산되었는지 확인해보세요:\n\n```js\ndata \\\n.filter((F.col(\"store_code\")==\"B1\")) \\\n.select(\"store_code\", \"product_code\", \"sales_date\", \"sales_qty\", \"total_sales\") \\\n.show(30)\n\n# output\n+----------+------------+----------+---------+-----------+\n|store_code|product_code|sales_date|sales_qty|total_sales|\n+----------+------------+----------+---------+-----------+\n|        B1|       89912|2021-05-01|       14|       14.0|\n|        B1|       89912|2021-05-02|       19|       33.0|\n|        B1|       89912|2021-05-03|       15|       48.0|\n|        B1|       89912|2021-05-04|       21|       69.0|\n|        B1|       89912|2021-05-05|        4|       73.0|\n|        B1|       89912|2021-05-06|        5|       78.0|\n|        B1|       89912|2021-05-07|       10|       88.0|\n|        B1|       89912|2021-05-08|       18|      106.0|\n|        B1|       89912|2021-05-09|        5|      111.0|\n|        B1|       89912|2021-05-10|        2|      113.0|\n|        B1|       89912|2021-05-11|       15|      128.0|\n|        B1|       89912|2021-05-12|       21|      149.0|\n|        B1|       89912|2021-05-13|        7|      156.0|\n|        B1|       89912|2021-05-14|       17|      173.0|\n|        B1|       89912|2021-05-15|       16|      189.0|\n|        B1|       89915|2021-05-01|       20|       20.0|\n|        B1|       89915|2021-05-02|        0|       20.0|\n|        B1|       89915|2021-05-03|       10|       30.0|\n|        B1|       89915|2021-05-04|       13|       43.0|\n|        B1|       89915|2021-05-05|       21|       64.0|\n|        B1|       89915|2021-05-06|        4|       68.0|\n|        B1|       89915|2021-05-07|       20|       88.0|\n|        B1|       89915|2021-05-08|       16|      104.0|\n|        B1|       89915|2021-05-09|       21|      125.0|\n|        B1|       89915|2021-05-10|        2|      127.0|\n|        B1|       89915|2021-05-11|       15|      142.0|\n|        B1|       89915|2021-05-12|       15|      157.0|\n|        B1|       89915|2021-05-13|       14|      171.0|\n|        B1|       89915|2021-05-14|        3|      174.0|\n|        B1|       89915|2021-05-15|        1|      175.0|\n+----------+------------+----------+---------+-----------+\n```\n\n첫 15개 행은 제품 89912에 속하므로 총 판매액 열은 판매 수량 열의 값들의 누적 합을 보여줍니다. 16번째 행에서 제품 코드가 변경되어 누적 합이 초기화됩니다. 이는 우리가 스토어 코드와 제품 코드로 분할된 윈도우를 생성했기 때문입니다.\n\n## 예시 2\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n창을 생성한 후에는 다양한 집계를 계산할 수 있어요. 예를 들어, 앞에서 정의한 창에 대해 max 함수를 적용하면, 결과는 주어진 상점의 제품의 누적 최대 가격이 될 거예요.\n\n창을 생성하는 코드를 작성할 테니까, 위를 계속 찾지 않아도 돼요.\n\n```js\n# 창 정의\nwindow = Window.partitionBy(\"store_code\", \"product_code\").orderBy(\"sales_date\")\n\n# 누적 최대 가격\ndata = data.withColumn(\"max_price\", F.max(\"price\").over(window))\n\n# 결과 확인\ndata \\\n.filter((F.col(\"store_code\")==\"B1\")) \\\n.select(\"store_code\", \"product_code\", \"sales_date\", \"price\", \"max_price\") \\\n.show(15)\n\n# 결과\n+----------+------------+----------+-----+---------+\n|store_code|product_code|sales_date|price|max_price|\n+----------+------------+----------+-----+---------+\n|        B1|       89912|2021-05-01| 1261|     1261|\n|        B1|       89912|2021-05-02| 1278|     1278|\n|        B1|       89912|2021-05-03| 1287|     1287|\n|        B1|       89912|2021-05-04| 1347|     1347|\n|        B1|       89912|2021-05-05| 1351|     1351|\n|        B1|       89912|2021-05-06| 1355|     1355|\n|        B1|       89912|2021-05-07| 1242|     1355|\n|        B1|       89912|2021-05-08| 1250|     1355|\n|        B1|       89912|2021-05-09| 1311|     1355|\n|        B1|       89912|2021-05-10| 1319|     1355|\n|        B1|       89912|2021-05-11| 1305|     1355|\n|        B1|       89912|2021-05-12| 1342|     1355|\n|        B1|       89912|2021-05-13| 1324|     1355|\n|        B1|       89912|2021-05-14| 1328|     1355|\n|        B1|       89912|2021-05-15| 1270|     1355|\n+----------+------------+----------+-----+---------+\n```\n\n\"max_price\" 열의 값은 증가하거나 동일하게 유지돼요. 7번째 행에서는 가격이 실제로 낮아지지만, 누적 최대 값이 표시돼서 최대 가격 값은 그대로 유지돌아요.\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n## 예제 3\n\nlag 및 lead는 일반적으로 사용되는 윈도우 함수 중 일부입니다. 시계열 데이터를 분석할 때 자주 사용합니다. 현재 행의 앞이나 뒤에 오프셋된 값을 반환합니다.\n\n- lag(\"sales_qty\", 1) : 1행 전\n- lag(\"sales_qty\", 2) : 2행 전\n- lead(\"sales_qty\", 1) : 1행 후\n- lead(\"sales_qty\", 2) : 2행 후\n\nlag의 음수 값을 사용하여 오프셋을 지정할 수 있으므로 lag(\"sales_qty\", 1)은 lead(\"sales_qty\", -1)과 동일합니다. 둘 다 이전 행의 값을 제공합니다. 테스트해 봅시다.\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\n# 창을 정의합니다\nwindow = Window.partitionBy(\"store_code\", \"product_code\").orderBy(\"sales_date\")\n\n# 전일 판매 수량\ndata = data.withColumn(\"prev_day_sales_lag\", F.lag(\"sales_qty\", 1).over(window))\ndata = data.withColumn(\"prev_day_sales_lead\", F.lead(\"sales_qty\", -1).over(window))\n\n# 다른 제품-매장 쌍에 대한 출력 확인\ndata \\\n.filter((F.col(\"store_code\")==\"A1\") \u0026 (F.col(\"product_code\")==\"95955\")) \\\n.select(\"sales_date\", \"sales_qty\", \"prev_day_sales_lag\", \"prev_day_sales_lead\") \\\n.show(15)\n\n# 출력 결과\n+----------+---------+------------------+-------------------+\n|sales_date|sales_qty|prev_day_sales_lag|prev_day_sales_lead|\n+----------+---------+------------------+-------------------+\n|2021-05-01|       13|              NULL|               NULL|\n|2021-05-02|        3|                13|                 13|\n|2021-05-03|       22|                 3|                  3|\n|2021-05-04|       17|                22|                 22|\n|2021-05-05|       20|                17|                 17|\n|2021-05-06|       14|                20|                 20|\n|2021-05-07|       10|                14|                 14|\n|2021-05-08|       10|                10|                 10|\n|2021-05-09|       15|                10|                 10|\n|2021-05-10|       15|                15|                 15|\n|2021-05-11|        8|                15|                 15|\n|2021-05-12|        9|                 8|                  8|\n|2021-05-13|       13|                 9|                  9|\n|2021-05-14|        6|                13|                 13|\n|2021-05-15|       21|                 6|                  6|\n+----------+---------+------------------+-------------------+\n```\n\n첫 번째 행의 전일 값은 NULL입니다. 이는 해당 행이 이전 날짜를 가지고 있지 않기 때문에 발생합니다.\n\n## 예시 4\n\n행을 기반으로 한 창을 정의한 후, rowsBetween 메소드를 사용하여 범위를 좁힐 수 있습니다.\n\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n요즘 세 가지 이유로 판매량의 평균을 계산하려면 이 창을 다음과 같이 정의할 수 있습니다:\n\n```js\nwindow = Window \\\n.partitionBy(\"store_code\", \"product_code\") \\\n.orderBy(\"sales_date\") \\\n.rowsBetween(-3, -1)\n```\n\n첫 번째 매개변수가 시작이고 두 번째 매개변수가 끝입니다. 각 행에 대한 마지막 세 행을 포함하는 창을 사용자 정의했습니다. \"-1\"은 현재 행의 이전 행을 가리키고 \"-3\"은 현재 행의 세 번째 이전 행을 나타냅니다.\n\n![이미지](/TIL/assets/img/2024-07-14-5ExamplestoMasterPySparkWindowOperations_1.png)\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n지난 세 날 동안의 평균 판매 수량을 계산하려면 이 윈도우에 mean 함수를 적용하기만 하면 됩니다.\n\n```js\n# 윈도우 정의\nwindow = Window \\\n.partitionBy(\"store_code\", \"product_code\") \\\n.orderBy(\"sales_date\") \\\n.rowsBetween(-3, -1)\n\n# 평균 계산\ndata = data.withColumn(\"last_3_day_avg\", F.mean(\"sales_qty\").over(window))\n\n# 데이터 표시\ndata \\\n.filter((F.col(\"store_code\")==\"A1\") \u0026 (F.col(\"product_code\")==\"95955\")) \\\n.select(\"sales_date\", \"sales_qty\", \"last_3_day_avg\") \\\n.show()\n\n# 결과\n+----------+---------+------------------+\n|sales_date|sales_qty|    last_3_day_avg|\n+----------+---------+------------------+\n|2021-05-01|       13|              NULL|\n|2021-05-02|        3|              13.0|\n|2021-05-03|       22|               8.0|\n|2021-05-04|       17|12.666666666666666|\n|2021-05-05|       20|              14.0|\n|2021-05-06|       14|19.666666666666668|\n|2021-05-07|       10|              17.0|\n|2021-05-08|       10|14.666666666666666|\n|2021-05-09|       15|11.333333333333334|\n|2021-05-10|       15|11.666666666666666|\n|2021-05-11|        8|13.333333333333334|\n|2021-05-12|        9|12.666666666666666|\n|2021-05-13|       13|10.666666666666666|\n|2021-05-14|        6|              10.0|\n|2021-05-15|       21| 9.333333333333334|\n+----------+---------+------------------+\n```\n\n예를 들어, 네 번째 행인 \"2021-05-04\"의 경우, 지난 세 행(13, 3, 22)의 값의 평균인 13.75입니다.\n\n## 예시 5\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n입력 데이터의 각 행에서 정의된 창 내의 열의 누적 평균 값을 계산해야 하는 경우를 생각해보세요. 각 행에 대해 계산은 창의 첫 번째 행과 현재 행 사이의 행을 포함해야 합니다.\n\n이를 위해 unboundedPreceding으로 시작점을 정의할 수 있습니다. 마찬가지로, 창의 끝까지 가려면 unboundedFollowing을 사용할 수 있습니다.\n\n\u003cimg src=\"/TIL/assets/img/2024-07-14-5ExamplestoMasterPySparkWindowOperations_2.png\" /\u003e\n\n창을 정의한 후 나머지는 동일합니다.\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\n# 윈도우 정의\nwindow = Window \\\n.partitionBy(\"store_code\", \"product_code\") \\\n.orderBy(\"sales_date\") \\\n.rowsBetween(Window.unboundedPreceding, -1)\n\n# 평균 계산\ndata = data.withColumn(\"누적평균\", F.mean(\"sales_qty\").over(window))\n\n# 데이터 출력\ndata \\\n.filter((F.col(\"store_code\")==\"A1\") \u0026 (F.col(\"product_code\")==\"95955\")) \\\n.select(\"sales_date\", \"sales_qty\", \"누적평균\") \\\n.show()\n\n# 결과\n+----------+---------+------------------+\n|sales_date|sales_qty|   누적평균       |\n+----------+---------+------------------+\n|2021-05-01|       13|              NULL|\n|2021-05-02|        3|              13.0|\n|2021-05-03|       22|               8.0|\n|2021-05-04|       17|12.666666666666666|\n|2021-05-05|       20|             13.75|\n|2021-05-06|       14|              15.0|\n|2021-05-07|       10|14.833333333333334|\n|2021-05-08|       10|14.142857142857142|\n|2021-05-09|       15|            13.625|\n|2021-05-10|       15|13.777777777777779|\n|2021-05-11|        8|              13.9|\n|2021-05-12|        9|13.363636363636363|\n|2021-05-13|       13|              13.0|\n|2021-05-14|        6|              13.0|\n|2021-05-15|       21|              12.5|\n+----------+---------+------------------+\n```\n\n누적평균 열에는 현재 행까지의 모든 행의 평균 판매량이 포함됩니다 (현재 행은 제외됨). 현재 행을 누적 평균 계산에 포함하려면 다음과 같이 윈도우를 정의할 수 있습니다:\n\n```js\nwindow = Window \\\n.partitionBy(\"store_code\", \"product_code\") \\\n.orderBy(\"sales_date\") \\\n.rowsBetween(Window.unboundedPreceding, Window.currentRow)\n```\n\n# 마지막으로\n\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n윈도우 작업은 데이터 분석에 있어 근본적인 작업입니다. 특히 시계열 데이터를 다루거나 시계열 데이터에 대한 예측 분석을 위해 머신러닝 모델을 만들 때 다양한 피처를 생성하기 위해 윈도우 작업을 사용합니다.\n\n대부분의 데이터 분석 및 조작 도구는 윈도우 작업을 수행하는 데 도움이 되는 기능을 제공합니다. 이 글에서는 PySpark를 사용하여 이러한 작업을 수행하는 방법을 배웠습니다.\n\n읽어 주셔서 감사합니다. 피드백이 있으시면 언제든지 알려주세요.","ogImage":{"url":"/TIL/assets/img/2024-07-14-5ExamplestoMasterPySparkWindowOperations_0.png"},"coverImage":"/TIL/assets/img/2024-07-14-5ExamplestoMasterPySparkWindowOperations_0.png","tag":["Tech"],"readingTime":16},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cp\u003e\u003cimg src=\"/TIL/assets/img/2024-07-14-5ExamplestoMasterPySparkWindowOperations_0.png\" alt=\"Window Operations\"\u003e\u003c/p\u003e\n\u003cp\u003e내가 사용해 본 모든 데이터 분석 및 조작 도구에는 윈도우 연산이 있습니다. 일부는 다른 것보다 유연하고 능력이 높지만, 윈도우에서 계산을 할 수 있는 것이 필수적입니다.\u003c/p\u003e\n\u003cp\u003e데이터 분석에서 윈도우란 무엇인가요?\u003c/p\u003e\n\u003cp\u003e윈도우는 어떤 방식으로 관련된 행들의 집합입니다. 이 관련은 동일한 그룹에 속하거나 연속적인 n일에 존재하는 것일 수 있습니다. 필요한 제약 조건으로 윈도우를 생성한 후, 해당 윈도우에서 계산이나 집계를 수행할 수 있습니다.\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e이 기사에서는 PySpark를 사용하여 창 작업에 대해 포괄적으로 이해할 수 있는 5가지 구체적인 예제를 살펴보겠습니다. 우리는 파티션과 함께 윈도우를 생성하는 방법, 이러한 윈도우를 사용자 정의하는 방법, 그리고 이를 통해 계산을 수행하는 방법을 배울 것입니다.\u003c/p\u003e\n\u003cp\u003ePySpark는 대규모 데이터 처리에 사용되는 분석 엔진인 Spark의 Python API입니다.\u003c/p\u003e\n\u003ch1\u003e데이터\u003c/h1\u003e\n\u003cp\u003e이 기사를 위해 모의 데이터로 샘플 데이터셋을 준비했고, 해당 데이터셋은 제 저장소에서 다운로드할 수 있습니다. 이 기사에서 사용할 데이터셋은 \"sample_sales_pyspark.csv\"라고 부릅니다.\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e자, spark 세션을 시작하고 이 데이터셋으로부터 DataFrame을 생성해 봅시다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pyspark.\u003cspan class=\"hljs-property\"\u003esql\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eSparkSession\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pyspark.\u003cspan class=\"hljs-property\"\u003esql\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eWindow\u003c/span\u003e, functions \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e F\n\nspark = \u003cspan class=\"hljs-title class_\"\u003eSparkSession\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ebuilder\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003egetOrCreate\u003c/span\u003e()\n\ndata = spark.\u003cspan class=\"hljs-property\"\u003eread\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ecsv\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"sample_sales_pyspark.csv\"\u003c/span\u003e, header=\u003cspan class=\"hljs-title class_\"\u003eTrue\u003c/span\u003e)\n\ndata.\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e)\n\n# output\n+----------+------------+----------+---------+---------+-----+\n|store_code|product_code|sales_date|sales_qty|sales_rev|price|\n+----------+------------+----------+---------+---------+-----+\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e01\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e|    \u003cspan class=\"hljs-number\"\u003e17654\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e1261\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e02\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e19\u003c/span\u003e|    \u003cspan class=\"hljs-number\"\u003e24282\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e1278\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e03\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e|    \u003cspan class=\"hljs-number\"\u003e19305\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e1287\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e04\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e|    \u003cspan class=\"hljs-number\"\u003e28287\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e1347\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e|     \u003cspan class=\"hljs-number\"\u003e5404\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e1351\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e06\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e|     \u003cspan class=\"hljs-number\"\u003e6775\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e1355\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e07\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e|    \u003cspan class=\"hljs-number\"\u003e12420\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e1242\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e08\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e18\u003c/span\u003e|    \u003cspan class=\"hljs-number\"\u003e22500\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e1250\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e09\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e|     \u003cspan class=\"hljs-number\"\u003e6555\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e1311\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e|     \u003cspan class=\"hljs-number\"\u003e2638\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e1319\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e11\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e|    \u003cspan class=\"hljs-number\"\u003e19575\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e1305\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e12\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e|    \u003cspan class=\"hljs-number\"\u003e28182\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e1342\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e13\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e7\u003c/span\u003e|     \u003cspan class=\"hljs-number\"\u003e9268\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e1324\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e17\u003c/span\u003e|    \u003cspan class=\"hljs-number\"\u003e22576\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e1328\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e16\u003c/span\u003e|    \u003cspan class=\"hljs-number\"\u003e20320\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e1270\u003c/span\u003e|\n+----------+------------+----------+---------+---------+-----+\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e예제 1\u003c/h2\u003e\n\u003cp\u003e우선, 파티션과 정렬 열을 기준으로 윈도우를 생성합니다. DataFrame에서는 각 제품의 누적 판매량을 각 상점별로 계산하려면 윈도우를 다음과 같이 정의합니다:\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-variable language_\"\u003ewindow\u003c/span\u003e = \u003cspan class=\"hljs-title class_\"\u003eWindow\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003epartitionBy\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"store_code\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"product_code\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eorderBy\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"sales_date\"\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e누적 판매량을 계산하려면 이 윈도우 위에 sum 함수를 적용하기만 하면 됩니다:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003edata = data.\u003cspan class=\"hljs-title function_\"\u003ewithColumn\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"total_sales\"\u003c/span\u003e, F.\u003cspan class=\"hljs-title function_\"\u003esum\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"sales_qty\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eover\u003c/span\u003e(\u003cspan class=\"hljs-variable language_\"\u003ewindow\u003c/span\u003e))\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이 코드는 \"total_sales\"라는 새 열을 만들며, 이전에 정의한 윈도우 상에서 계산된 판매 수량의 누적 합계를 포함합니다.\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e\" B1\" 스토어의 첫 30개 행을 확인해봐서 누적값이 올바르게 계산되었는지 확인해보세요:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003edata \\\n.\u003cspan class=\"hljs-title function_\"\u003efilter\u003c/span\u003e((F.\u003cspan class=\"hljs-title function_\"\u003ecol\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"store_code\"\u003c/span\u003e)==\u003cspan class=\"hljs-string\"\u003e\"B1\"\u003c/span\u003e)) \\\n.\u003cspan class=\"hljs-title function_\"\u003eselect\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"store_code\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"product_code\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"sales_date\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"sales_qty\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"total_sales\"\u003c/span\u003e) \\\n.\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e)\n\n# output\n+----------+------------+----------+---------+-----------+\n|store_code|product_code|sales_date|sales_qty|total_sales|\n+----------+------------+----------+---------+-----------+\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e01\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e14.0\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e02\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e19\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e33.0\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e03\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e48.0\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e04\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e69.0\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e73.0\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e06\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e78.0\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e07\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e88.0\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e08\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e18\u003c/span\u003e|      \u003cspan class=\"hljs-number\"\u003e106.0\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e09\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e|      \u003cspan class=\"hljs-number\"\u003e111.0\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e|      \u003cspan class=\"hljs-number\"\u003e113.0\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e11\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e|      \u003cspan class=\"hljs-number\"\u003e128.0\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e12\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e|      \u003cspan class=\"hljs-number\"\u003e149.0\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e13\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e7\u003c/span\u003e|      \u003cspan class=\"hljs-number\"\u003e156.0\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e17\u003c/span\u003e|      \u003cspan class=\"hljs-number\"\u003e173.0\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e16\u003c/span\u003e|      \u003cspan class=\"hljs-number\"\u003e189.0\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89915\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e01\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e20.0\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89915\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e02\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e20.0\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89915\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e03\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e30.0\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89915\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e04\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e13\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e43.0\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89915\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e64.0\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89915\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e06\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e68.0\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89915\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e07\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e88.0\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89915\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e08\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e16\u003c/span\u003e|      \u003cspan class=\"hljs-number\"\u003e104.0\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89915\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e09\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e|      \u003cspan class=\"hljs-number\"\u003e125.0\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89915\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e|      \u003cspan class=\"hljs-number\"\u003e127.0\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89915\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e11\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e|      \u003cspan class=\"hljs-number\"\u003e142.0\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89915\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e12\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e|      \u003cspan class=\"hljs-number\"\u003e157.0\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89915\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e13\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e|      \u003cspan class=\"hljs-number\"\u003e171.0\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89915\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e|      \u003cspan class=\"hljs-number\"\u003e174.0\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89915\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|      \u003cspan class=\"hljs-number\"\u003e175.0\u003c/span\u003e|\n+----------+------------+----------+---------+-----------+\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e첫 15개 행은 제품 89912에 속하므로 총 판매액 열은 판매 수량 열의 값들의 누적 합을 보여줍니다. 16번째 행에서 제품 코드가 변경되어 누적 합이 초기화됩니다. 이는 우리가 스토어 코드와 제품 코드로 분할된 윈도우를 생성했기 때문입니다.\u003c/p\u003e\n\u003ch2\u003e예시 2\u003c/h2\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e창을 생성한 후에는 다양한 집계를 계산할 수 있어요. 예를 들어, 앞에서 정의한 창에 대해 max 함수를 적용하면, 결과는 주어진 상점의 제품의 누적 최대 가격이 될 거예요.\u003c/p\u003e\n\u003cp\u003e창을 생성하는 코드를 작성할 테니까, 위를 계속 찾지 않아도 돼요.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 창 정의\n\u003cspan class=\"hljs-variable language_\"\u003ewindow\u003c/span\u003e = \u003cspan class=\"hljs-title class_\"\u003eWindow\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003epartitionBy\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"store_code\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"product_code\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eorderBy\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"sales_date\"\u003c/span\u003e)\n\n# 누적 최대 가격\ndata = data.\u003cspan class=\"hljs-title function_\"\u003ewithColumn\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"max_price\"\u003c/span\u003e, F.\u003cspan class=\"hljs-title function_\"\u003emax\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"price\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eover\u003c/span\u003e(\u003cspan class=\"hljs-variable language_\"\u003ewindow\u003c/span\u003e))\n\n# 결과 확인\ndata \\\n.\u003cspan class=\"hljs-title function_\"\u003efilter\u003c/span\u003e((F.\u003cspan class=\"hljs-title function_\"\u003ecol\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"store_code\"\u003c/span\u003e)==\u003cspan class=\"hljs-string\"\u003e\"B1\"\u003c/span\u003e)) \\\n.\u003cspan class=\"hljs-title function_\"\u003eselect\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"store_code\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"product_code\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"sales_date\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"price\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"max_price\"\u003c/span\u003e) \\\n.\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e)\n\n# 결과\n+----------+------------+----------+-----+---------+\n|store_code|product_code|sales_date|price|max_price|\n+----------+------------+----------+-----+---------+\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e01\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e1261\u003c/span\u003e|     \u003cspan class=\"hljs-number\"\u003e1261\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e02\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e1278\u003c/span\u003e|     \u003cspan class=\"hljs-number\"\u003e1278\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e03\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e1287\u003c/span\u003e|     \u003cspan class=\"hljs-number\"\u003e1287\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e04\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e1347\u003c/span\u003e|     \u003cspan class=\"hljs-number\"\u003e1347\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e1351\u003c/span\u003e|     \u003cspan class=\"hljs-number\"\u003e1351\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e06\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e1355\u003c/span\u003e|     \u003cspan class=\"hljs-number\"\u003e1355\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e07\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e1242\u003c/span\u003e|     \u003cspan class=\"hljs-number\"\u003e1355\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e08\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e1250\u003c/span\u003e|     \u003cspan class=\"hljs-number\"\u003e1355\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e09\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e1311\u003c/span\u003e|     \u003cspan class=\"hljs-number\"\u003e1355\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e1319\u003c/span\u003e|     \u003cspan class=\"hljs-number\"\u003e1355\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e11\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e1305\u003c/span\u003e|     \u003cspan class=\"hljs-number\"\u003e1355\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e12\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e1342\u003c/span\u003e|     \u003cspan class=\"hljs-number\"\u003e1355\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e13\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e1324\u003c/span\u003e|     \u003cspan class=\"hljs-number\"\u003e1355\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e1328\u003c/span\u003e|     \u003cspan class=\"hljs-number\"\u003e1355\u003c/span\u003e|\n|        \u003cspan class=\"hljs-variable constant_\"\u003eB1\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e89912\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e1270\u003c/span\u003e|     \u003cspan class=\"hljs-number\"\u003e1355\u003c/span\u003e|\n+----------+------------+----------+-----+---------+\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\"max_price\" 열의 값은 증가하거나 동일하게 유지돼요. 7번째 행에서는 가격이 실제로 낮아지지만, 누적 최대 값이 표시돼서 최대 가격 값은 그대로 유지돌아요.\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003ch2\u003e예제 3\u003c/h2\u003e\n\u003cp\u003elag 및 lead는 일반적으로 사용되는 윈도우 함수 중 일부입니다. 시계열 데이터를 분석할 때 자주 사용합니다. 현재 행의 앞이나 뒤에 오프셋된 값을 반환합니다.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003elag(\"sales_qty\", 1) : 1행 전\u003c/li\u003e\n\u003cli\u003elag(\"sales_qty\", 2) : 2행 전\u003c/li\u003e\n\u003cli\u003elead(\"sales_qty\", 1) : 1행 후\u003c/li\u003e\n\u003cli\u003elead(\"sales_qty\", 2) : 2행 후\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003elag의 음수 값을 사용하여 오프셋을 지정할 수 있으므로 lag(\"sales_qty\", 1)은 lead(\"sales_qty\", -1)과 동일합니다. 둘 다 이전 행의 값을 제공합니다. 테스트해 봅시다.\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 창을 정의합니다\n\u003cspan class=\"hljs-variable language_\"\u003ewindow\u003c/span\u003e = \u003cspan class=\"hljs-title class_\"\u003eWindow\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003epartitionBy\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"store_code\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"product_code\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eorderBy\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"sales_date\"\u003c/span\u003e)\n\n# 전일 판매 수량\ndata = data.\u003cspan class=\"hljs-title function_\"\u003ewithColumn\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"prev_day_sales_lag\"\u003c/span\u003e, F.\u003cspan class=\"hljs-title function_\"\u003elag\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"sales_qty\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eover\u003c/span\u003e(\u003cspan class=\"hljs-variable language_\"\u003ewindow\u003c/span\u003e))\ndata = data.\u003cspan class=\"hljs-title function_\"\u003ewithColumn\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"prev_day_sales_lead\"\u003c/span\u003e, F.\u003cspan class=\"hljs-title function_\"\u003elead\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"sales_qty\"\u003c/span\u003e, -\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eover\u003c/span\u003e(\u003cspan class=\"hljs-variable language_\"\u003ewindow\u003c/span\u003e))\n\n# 다른 제품-매장 쌍에 대한 출력 확인\ndata \\\n.\u003cspan class=\"hljs-title function_\"\u003efilter\u003c/span\u003e((F.\u003cspan class=\"hljs-title function_\"\u003ecol\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"store_code\"\u003c/span\u003e)==\u003cspan class=\"hljs-string\"\u003e\"A1\"\u003c/span\u003e) \u0026#x26; (F.\u003cspan class=\"hljs-title function_\"\u003ecol\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"product_code\"\u003c/span\u003e)==\u003cspan class=\"hljs-string\"\u003e\"95955\"\u003c/span\u003e)) \\\n.\u003cspan class=\"hljs-title function_\"\u003eselect\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"sales_date\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"sales_qty\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"prev_day_sales_lag\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"prev_day_sales_lead\"\u003c/span\u003e) \\\n.\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e)\n\n# 출력 결과\n+----------+---------+------------------+-------------------+\n|sales_date|sales_qty|prev_day_sales_lag|prev_day_sales_lead|\n+----------+---------+------------------+-------------------+\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e01\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e13\u003c/span\u003e|              \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|               \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e02\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e|                \u003cspan class=\"hljs-number\"\u003e13\u003c/span\u003e|                 \u003cspan class=\"hljs-number\"\u003e13\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e03\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e22\u003c/span\u003e|                 \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e|                  \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e04\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e17\u003c/span\u003e|                \u003cspan class=\"hljs-number\"\u003e22\u003c/span\u003e|                 \u003cspan class=\"hljs-number\"\u003e22\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e|                \u003cspan class=\"hljs-number\"\u003e17\u003c/span\u003e|                 \u003cspan class=\"hljs-number\"\u003e17\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e06\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e|                \u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e|                 \u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e07\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e|                \u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e|                 \u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e08\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e|                \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e|                 \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e09\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e|                \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e|                 \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e|                \u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e|                 \u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e11\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e|                \u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e|                 \u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e12\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e9\u003c/span\u003e|                 \u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e|                  \u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e13\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e13\u003c/span\u003e|                 \u003cspan class=\"hljs-number\"\u003e9\u003c/span\u003e|                  \u003cspan class=\"hljs-number\"\u003e9\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e|                \u003cspan class=\"hljs-number\"\u003e13\u003c/span\u003e|                 \u003cspan class=\"hljs-number\"\u003e13\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e|                 \u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e|                  \u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e|\n+----------+---------+------------------+-------------------+\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e첫 번째 행의 전일 값은 NULL입니다. 이는 해당 행이 이전 날짜를 가지고 있지 않기 때문에 발생합니다.\u003c/p\u003e\n\u003ch2\u003e예시 4\u003c/h2\u003e\n\u003cp\u003e행을 기반으로 한 창을 정의한 후, rowsBetween 메소드를 사용하여 범위를 좁힐 수 있습니다.\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e요즘 세 가지 이유로 판매량의 평균을 계산하려면 이 창을 다음과 같이 정의할 수 있습니다:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-variable language_\"\u003ewindow\u003c/span\u003e = \u003cspan class=\"hljs-title class_\"\u003eWindow\u003c/span\u003e \\\n.\u003cspan class=\"hljs-title function_\"\u003epartitionBy\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"store_code\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"product_code\"\u003c/span\u003e) \\\n.\u003cspan class=\"hljs-title function_\"\u003eorderBy\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"sales_date\"\u003c/span\u003e) \\\n.\u003cspan class=\"hljs-title function_\"\u003erowsBetween\u003c/span\u003e(-\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, -\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e첫 번째 매개변수가 시작이고 두 번째 매개변수가 끝입니다. 각 행에 대한 마지막 세 행을 포함하는 창을 사용자 정의했습니다. \"-1\"은 현재 행의 이전 행을 가리키고 \"-3\"은 현재 행의 세 번째 이전 행을 나타냅니다.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/TIL/assets/img/2024-07-14-5ExamplestoMasterPySparkWindowOperations_1.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e지난 세 날 동안의 평균 판매 수량을 계산하려면 이 윈도우에 mean 함수를 적용하기만 하면 됩니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 윈도우 정의\n\u003cspan class=\"hljs-variable language_\"\u003ewindow\u003c/span\u003e = \u003cspan class=\"hljs-title class_\"\u003eWindow\u003c/span\u003e \\\n.\u003cspan class=\"hljs-title function_\"\u003epartitionBy\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"store_code\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"product_code\"\u003c/span\u003e) \\\n.\u003cspan class=\"hljs-title function_\"\u003eorderBy\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"sales_date\"\u003c/span\u003e) \\\n.\u003cspan class=\"hljs-title function_\"\u003erowsBetween\u003c/span\u003e(-\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, -\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\n\n# 평균 계산\ndata = data.\u003cspan class=\"hljs-title function_\"\u003ewithColumn\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"last_3_day_avg\"\u003c/span\u003e, F.\u003cspan class=\"hljs-title function_\"\u003emean\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"sales_qty\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eover\u003c/span\u003e(\u003cspan class=\"hljs-variable language_\"\u003ewindow\u003c/span\u003e))\n\n# 데이터 표시\ndata \\\n.\u003cspan class=\"hljs-title function_\"\u003efilter\u003c/span\u003e((F.\u003cspan class=\"hljs-title function_\"\u003ecol\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"store_code\"\u003c/span\u003e)==\u003cspan class=\"hljs-string\"\u003e\"A1\"\u003c/span\u003e) \u0026#x26; (F.\u003cspan class=\"hljs-title function_\"\u003ecol\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"product_code\"\u003c/span\u003e)==\u003cspan class=\"hljs-string\"\u003e\"95955\"\u003c/span\u003e)) \\\n.\u003cspan class=\"hljs-title function_\"\u003eselect\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"sales_date\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"sales_qty\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"last_3_day_avg\"\u003c/span\u003e) \\\n.\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e()\n\n# 결과\n+----------+---------+------------------+\n|sales_date|sales_qty|    last_3_day_avg|\n+----------+---------+------------------+\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e01\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e13\u003c/span\u003e|              \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e02\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e|              \u003cspan class=\"hljs-number\"\u003e13.0\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e03\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e22\u003c/span\u003e|               \u003cspan class=\"hljs-number\"\u003e8.0\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e04\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e17\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e12.666666666666666\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e|              \u003cspan class=\"hljs-number\"\u003e14.0\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e06\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e19.666666666666668\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e07\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e|              \u003cspan class=\"hljs-number\"\u003e17.0\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e08\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e14.666666666666666\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e09\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e11.333333333333334\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e11.666666666666666\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e11\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e13.333333333333334\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e12\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e9\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e12.666666666666666\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e13\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e13\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e10.666666666666666\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e|              \u003cspan class=\"hljs-number\"\u003e10.0\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e9.333333333333334\u003c/span\u003e|\n+----------+---------+------------------+\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e예를 들어, 네 번째 행인 \"2021-05-04\"의 경우, 지난 세 행(13, 3, 22)의 값의 평균인 13.75입니다.\u003c/p\u003e\n\u003ch2\u003e예시 5\u003c/h2\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e입력 데이터의 각 행에서 정의된 창 내의 열의 누적 평균 값을 계산해야 하는 경우를 생각해보세요. 각 행에 대해 계산은 창의 첫 번째 행과 현재 행 사이의 행을 포함해야 합니다.\u003c/p\u003e\n\u003cp\u003e이를 위해 unboundedPreceding으로 시작점을 정의할 수 있습니다. 마찬가지로, 창의 끝까지 가려면 unboundedFollowing을 사용할 수 있습니다.\u003c/p\u003e\n\u003cimg src=\"/TIL/assets/img/2024-07-14-5ExamplestoMasterPySparkWindowOperations_2.png\"\u003e\n\u003cp\u003e창을 정의한 후 나머지는 동일합니다.\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 윈도우 정의\n\u003cspan class=\"hljs-variable language_\"\u003ewindow\u003c/span\u003e = \u003cspan class=\"hljs-title class_\"\u003eWindow\u003c/span\u003e \\\n.\u003cspan class=\"hljs-title function_\"\u003epartitionBy\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"store_code\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"product_code\"\u003c/span\u003e) \\\n.\u003cspan class=\"hljs-title function_\"\u003eorderBy\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"sales_date\"\u003c/span\u003e) \\\n.\u003cspan class=\"hljs-title function_\"\u003erowsBetween\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eWindow\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eunboundedPreceding\u003c/span\u003e, -\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\n\n# 평균 계산\ndata = data.\u003cspan class=\"hljs-title function_\"\u003ewithColumn\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"누적평균\"\u003c/span\u003e, F.\u003cspan class=\"hljs-title function_\"\u003emean\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"sales_qty\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eover\u003c/span\u003e(\u003cspan class=\"hljs-variable language_\"\u003ewindow\u003c/span\u003e))\n\n# 데이터 출력\ndata \\\n.\u003cspan class=\"hljs-title function_\"\u003efilter\u003c/span\u003e((F.\u003cspan class=\"hljs-title function_\"\u003ecol\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"store_code\"\u003c/span\u003e)==\u003cspan class=\"hljs-string\"\u003e\"A1\"\u003c/span\u003e) \u0026#x26; (F.\u003cspan class=\"hljs-title function_\"\u003ecol\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"product_code\"\u003c/span\u003e)==\u003cspan class=\"hljs-string\"\u003e\"95955\"\u003c/span\u003e)) \\\n.\u003cspan class=\"hljs-title function_\"\u003eselect\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"sales_date\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"sales_qty\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"누적평균\"\u003c/span\u003e) \\\n.\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e()\n\n# 결과\n+----------+---------+------------------+\n|sales_date|sales_qty|   누적평균       |\n+----------+---------+------------------+\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e01\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e13\u003c/span\u003e|              \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e02\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e|              \u003cspan class=\"hljs-number\"\u003e13.0\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e03\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e22\u003c/span\u003e|               \u003cspan class=\"hljs-number\"\u003e8.0\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e04\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e17\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e12.666666666666666\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e|             \u003cspan class=\"hljs-number\"\u003e13.75\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e06\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e|              \u003cspan class=\"hljs-number\"\u003e15.0\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e07\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e14.833333333333334\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e08\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e14.142857142857142\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e09\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e|            \u003cspan class=\"hljs-number\"\u003e13.625\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e13.777777777777779\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e11\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e|              \u003cspan class=\"hljs-number\"\u003e13.9\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e12\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e9\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e13.363636363636363\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e13\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e13\u003c/span\u003e|              \u003cspan class=\"hljs-number\"\u003e13.0\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e|              \u003cspan class=\"hljs-number\"\u003e13.0\u003c/span\u003e|\n|\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e|              \u003cspan class=\"hljs-number\"\u003e12.5\u003c/span\u003e|\n+----------+---------+------------------+\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e누적평균 열에는 현재 행까지의 모든 행의 평균 판매량이 포함됩니다 (현재 행은 제외됨). 현재 행을 누적 평균 계산에 포함하려면 다음과 같이 윈도우를 정의할 수 있습니다:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-variable language_\"\u003ewindow\u003c/span\u003e = \u003cspan class=\"hljs-title class_\"\u003eWindow\u003c/span\u003e \\\n.\u003cspan class=\"hljs-title function_\"\u003epartitionBy\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"store_code\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"product_code\"\u003c/span\u003e) \\\n.\u003cspan class=\"hljs-title function_\"\u003eorderBy\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"sales_date\"\u003c/span\u003e) \\\n.\u003cspan class=\"hljs-title function_\"\u003erowsBetween\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eWindow\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eunboundedPreceding\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eWindow\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ecurrentRow\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003e마지막으로\u003c/h1\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e윈도우 작업은 데이터 분석에 있어 근본적인 작업입니다. 특히 시계열 데이터를 다루거나 시계열 데이터에 대한 예측 분석을 위해 머신러닝 모델을 만들 때 다양한 피처를 생성하기 위해 윈도우 작업을 사용합니다.\u003c/p\u003e\n\u003cp\u003e대부분의 데이터 분석 및 조작 도구는 윈도우 작업을 수행하는 데 도움이 되는 기능을 제공합니다. 이 글에서는 PySpark를 사용하여 이러한 작업을 수행하는 방법을 배웠습니다.\u003c/p\u003e\n\u003cp\u003e읽어 주셔서 감사합니다. 피드백이 있으시면 언제든지 알려주세요.\u003c/p\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-07-14-5ExamplestoMasterPySparkWindowOperations"},"buildId":"KUC9M_yIlA1Ugo01xmkHL","assetPrefix":"/TIL","isFallback":false,"gsp":true,"scriptLoader":[{"async":true,"src":"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4877378276818686","strategy":"lazyOnload","crossOrigin":"anonymous"}]}</script></body></html>