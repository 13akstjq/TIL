<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>FastAPI Apppy에서 모듈러 아키텍처로 전환하는 방법 | TIL</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://13akstjq.github.io/TIL//post/2024-07-09-FastAPIFromApppytoaModularArchitecture" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="FastAPI Apppy에서 모듈러 아키텍처로 전환하는 방법 | TIL" data-gatsby-head="true"/><meta property="og:title" content="FastAPI Apppy에서 모듈러 아키텍처로 전환하는 방법 | TIL" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-07-09-FastAPIFromApppytoaModularArchitecture_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://TIL.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://13akstjq.github.io/TIL//post/2024-07-09-FastAPIFromApppytoaModularArchitecture" data-gatsby-head="true"/><meta name="twitter:title" content="FastAPI Apppy에서 모듈러 아키텍처로 전환하는 방법 | TIL" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-07-09-FastAPIFromApppytoaModularArchitecture_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | TIL" data-gatsby-head="true"/><meta name="article:published_time" content="2024-07-09 20:24" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/TIL/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/TIL/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/TIL/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/TIL/favicons/favicon-96x96.png"/><link rel="icon" href="/TIL/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/TIL/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/TIL/favicons/browserconfig.xml"/><link rel="preload" href="/TIL/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/TIL/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/TIL/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/TIL/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/TIL/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/TIL/_next/static/chunks/webpack-21ffe88bdca56cba.js" defer=""></script><script src="/TIL/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/TIL/_next/static/chunks/main-a5eeabb286676ce6.js" defer=""></script><script src="/TIL/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/TIL/_next/static/chunks/75fc9c18-ac4aa08aae62f90e.js" defer=""></script><script src="/TIL/_next/static/chunks/463-925361deb4cec4b1.js" defer=""></script><script src="/TIL/_next/static/chunks/pages/post/%5Bslug%5D-9d7ebbd29b9e08ce.js" defer=""></script><script src="/TIL/_next/static/FuXRqV9h16krA5Mvtd6Dn/_buildManifest.js" defer=""></script><script src="/TIL/_next/static/FuXRqV9h16krA5Mvtd6Dn/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/TIL">TIL</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/TIL/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">FastAPI Apppy에서 모듈러 아키텍처로 전환하는 방법</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="FastAPI Apppy에서 모듈러 아키텍처로 전환하는 방법" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/TIL/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">TIL</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On Jul 9, 2024</span><span class="posts_reading_time__f7YPP">16<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-07-09-FastAPIFromApppytoaModularArchitecture&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<img src="/TIL/assets/img/2024-07-09-FastAPIFromApppytoaModularArchitecture_0.png">
<p>패스트API를 사용하여 백엔드를 구축할 때, 일반적으로 하나의 app.py 파일로 시작하는 것이 흔합니다. 이 접근 방식은 작은 프로젝트에 적합하지만, 응용 프로그램이 성장함에 따라 유지 보수와 확장이 어려워집니다.</p>
<p>이 블로그 포스트에서는 Routers, Controllers, Services 및 Repositories로 구성된 구조화된 아키텍처를 사용하여 FastAPI 애플리케이션을 모놀리식 app.py 파일에서 리팩토링하는 방법을 살펴보겠습니다.</p>
<h2>소개: 우리의 할 일 API</h2>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>리팩터링 프로세스에 뛰어들기 전에 함께 작업할 API를 살펴보겠습니다. 다음과 같은 엔드포인트를 가진 간단한 할 일 애플리케이션을 구축 중입니다.</p>
<p><img src="/TIL/assets/img/2024-07-09-FastAPIFromApppytoaModularArchitecture_1.png" alt="API Image"></p>
<p>이러한 API를 통해 사용자는 할 일 항목에 대한 CRUD(Create, Read, Update, Delete) 작업을 수행할 수 있습니다. 각 할 일 항목은 다음과 같은 속성을 가지게 될 것입니다.</p>
<p>이제 작업 중인 API를 이해했으므로 몇 가지 전제 조건 및 이를 구현하는 방법을 살펴보겠습니다.</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h2>준비 사항</h2>
<p>처음 접근과 리팩토링을 시작하기 전에 FastAPI 프로젝트를 설정해 봅시다.</p>
<pre><code class="hljs language-js">python3 -m venv venv
source env/bin/activate  # <span class="hljs-title class_">Windows</span>에서는 <span class="hljs-string">`env\Scripts\activate
</span></code></pre>
<pre><code class="hljs language-js">fastapi;
uvicorn;
</code></pre>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-bash">pip3 install -r requirements.txt
</code></pre>
<h2>초기 접근 방식: 모든 것을 app.py에서 처리</h2>
<p>간단한 Todo API를 시작해봅시다. 이 API는 루트 레벨의 app.py에서 완전히 구현되어 있습니다.</p>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, HTTPException
<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel

app = FastAPI()

<span class="hljs-comment"># 새로운 todo를 생성하기 위한 Pydantic 모델</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TodoCreate</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    title: <span class="hljs-built_in">str</span>

<span class="hljs-comment"># todo 항목을 위한 Pydantic 모델. TodoCreate를 상속받고 id 및 completed 필드를 추가합니다.</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Todo</span>(<span class="hljs-title class_ inherited__">TodoCreate</span>):
    <span class="hljs-built_in">id</span>: <span class="hljs-built_in">int</span>
    completed: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>

<span class="hljs-comment"># 데이터베이스를 모방한 todos의 인메모리 저장소</span>
todos = []

<span class="hljs-comment"># 새로운 todo를 생성하는 엔드포인트</span>
<span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">"/todos"</span>, response_model=Todo</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_todo</span>(<span class="hljs-params">todo: TodoCreate</span>):
    <span class="hljs-comment"># id를 증가시킨 새로운 todo 항목을 생성합니다.</span>
    new_todo = Todo(<span class="hljs-built_in">id</span>=<span class="hljs-built_in">len</span>(todos) + <span class="hljs-number">1</span>, **todo.model_dump())
    todos.append(new_todo)  <span class="hljs-comment"># 새로운 todo를 목록에 추가합니다.</span>
    <span class="hljs-keyword">return</span> new_todo  <span class="hljs-comment"># 생성된 todo를 응답으로 반환합니다.</span>

<span class="hljs-comment"># 모든 todo를 가져오는 엔드포인트</span>
<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/todos"</span>, response_model=<span class="hljs-built_in">list</span>[Todo]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_todos</span>():
    <span class="hljs-keyword">return</span> todos  <span class="hljs-comment"># todo 목록을 응답으로 반환합니다.</span>

<span class="hljs-comment"># 특정 id의 todo를 가져오는 엔드포인트</span>
<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/todos/{todo_id}"</span>, response_model=Todo</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_todo</span>(<span class="hljs-params">todo_id: <span class="hljs-built_in">int</span></span>):
    <span class="hljs-keyword">for</span> todo <span class="hljs-keyword">in</span> todos:
        <span class="hljs-keyword">if</span> todo.<span class="hljs-built_in">id</span> == todo_id:
            <span class="hljs-keyword">return</span> todo  <span class="hljs-comment"># 찾은 경우 해당 todo를 반환합니다.</span>
    <span class="hljs-comment"># 해당 todo를 찾을 수 없는 경우 404 상태 코드와 메시지를 포함한 HTTPException을 발생시킵니다.</span>
    <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">404</span>, detail=<span class="hljs-string">"Todo가 없습니다"</span>)

<span class="hljs-comment"># id에 따라 todo를 업데이트하는 엔드포인트</span>
<span class="hljs-meta">@app.put(<span class="hljs-params"><span class="hljs-string">"/todos/{todo_id}"</span>, response_model=Todo</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">update_todo</span>(<span class="hljs-params">todo_id: <span class="hljs-built_in">int</span>, updated_todo: TodoCreate</span>):
    <span class="hljs-keyword">for</span> todo <span class="hljs-keyword">in</span> todos:
        <span class="hljs-keyword">if</span> todo.<span class="hljs-built_in">id</span> == todo_id:
            todo.title = updated_todo.title  <span class="hljs-comment"># todo의 제목을 업데이트합니다.</span>
            <span class="hljs-keyword">return</span> todo  <span class="hljs-comment"># 업데이트된 todo를 반환합니다.</span>
    <span class="hljs-comment"># 해당 todo를 찾을 수 없는 경우 404 상태 코드와 메시지를 포함한 HTTPException을 발생시킵니다.</span>
    <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">404</span>, detail=<span class="hljs-string">"Todo가 없습니다"</span>)

<span class="hljs-comment"># id에 따라 todo를 삭제하는 엔드포인트</span>
<span class="hljs-meta">@app.delete(<span class="hljs-params"><span class="hljs-string">"/todos/{todo_id}"</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">delete_todo</span>(<span class="hljs-params">todo_id: <span class="hljs-built_in">int</span></span>):
    <span class="hljs-keyword">for</span> index, todo <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(todos):
        <span class="hljs-keyword">if</span> todo.<span class="hljs-built_in">id</span> == todo_id:
            <span class="hljs-keyword">del</span> todos[index]  <span class="hljs-comment"># 목록에서 todo를 삭제합니다.</span>
            <span class="hljs-keyword">return</span> {<span class="hljs-string">"message"</span>: <span class="hljs-string">"Todo가 성공적으로 삭제되었습니다"</span>}  <span class="hljs-comment"># 성공 메시지를 반환합니다.</span>
    <span class="hljs-comment"># 해당 todo를 찾을 수 없는 경우 404 상태 코드와 메시지를 포함한 HTTPException을 발생시킵니다.</span>
    <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">404</span>, detail=<span class="hljs-string">"Todo가 없습니다"</span>)

<span class="hljs-comment"># Uvicorn 서버를 사용하여 애플리케이션을 실행하는 주요 블록</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-keyword">import</span> uvicorn
    uvicorn.run(<span class="hljs-string">"app:app"</span>, port=<span class="hljs-number">3000</span>, host=<span class="hljs-string">"0.0.0.0"</span>, reload=<span class="hljs-literal">True</span>)
</code></pre>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>API를 시작하려면 python3 app.py 명령어를 사용해요</p>
<p>음...</p>
<p>이 방법은 작은 애플리케이션에는 작동하지만 몇 가지 단점이 있어요:</p>
<ul>
<li>모든 라우팅, 비즈니스 로직 및 데이터 저장소가 단일 파일에 혼합되어 있어요.</li>
<li>애플리케이션이 성장함에 따라 유지 및 확장하기 어려워져요.</li>
<li>개별 구성 요소를 테스트하는 것이 어려워져요.</li>
<li>코드의 재사용성이 제한되어요</li>
</ul>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p><img src="/TIL/assets/img/2024-07-09-FastAPIFromApppytoaModularArchitecture_2.png" alt="FastAPIFromApppytoaModularArchitecture"></p>
<p>Refactoring journey starts now...</p>
<h2>Routers Introduction</h2>
<p>To structure our application effectively, the first step is to introduce routers.</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>새로운 폴더를 만들어 routers라는 이름을 붙이고 todo_router.py라는 파일을 추가해주세요.</p>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> APIRouter

router = APIRouter()

<span class="hljs-meta">@router.post(<span class="hljs-params"><span class="hljs-string">"/todos"</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_todo</span>():
    <span class="hljs-keyword">pass</span>

<span class="hljs-meta">@router.get(<span class="hljs-params"><span class="hljs-string">"/todos"</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_todos</span>():
    <span class="hljs-keyword">pass</span>

<span class="hljs-meta">@router.get(<span class="hljs-params"><span class="hljs-string">"/todos/{todo_id}"</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_todo</span>(<span class="hljs-params">todo_id: <span class="hljs-built_in">int</span></span>):
    <span class="hljs-keyword">pass</span>

<span class="hljs-meta">@router.put(<span class="hljs-params"><span class="hljs-string">"/todos/{todo_id}"</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">update_todo</span>(<span class="hljs-params">todo_id: <span class="hljs-built_in">int</span></span>):
    <span class="hljs-keyword">pass</span>

<span class="hljs-meta">@router.delete(<span class="hljs-params"><span class="hljs-string">"/todos/{todo_id}"</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">delete_todo</span>(<span class="hljs-params">todo_id: <span class="hljs-built_in">int</span></span>):
    <span class="hljs-keyword">pass</span>
</code></pre>
<p>이제 app.py를 업데이트하여 라우터를 사용하세요.</p>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI
<span class="hljs-keyword">from</span> routers <span class="hljs-keyword">import</span> todo_router

app = FastAPI()

app.include_router(todo_router.router)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-keyword">import</span> uvicorn
    uvicorn.run(<span class="hljs-string">"app:app"</span>, port=<span class="hljs-number">3000</span>, host=<span class="hljs-string">"0.0.0.0"</span>, reload=<span class="hljs-literal">True</span>)
</code></pre>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>라우터를 도입함으로써 작업 관련 라우트를 메인 app.py 파일에서 분리하여 코드를 더 깔끔하고 집중적으로 유지하였습니다.</p>
<h2>컨트롤러 추가</h2>
<p>다음으로, 요청 처리 로직을 처리하기 위한 컨트롤러를 도입할 예정입니다.</p>
<p>controllers라는 새 디렉토리를 생성하고 todo_controller.py라는 파일을 추가하세요.</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> <span class="hljs-title class_">HTTPException</span>
<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> <span class="hljs-title class_">BaseModel</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TodoCreate</span>(<span class="hljs-title class_">BaseModel</span>):
    <span class="hljs-attr">title</span>: str

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Todo</span>(<span class="hljs-title class_">TodoCreate</span>):
    <span class="hljs-attr">id</span>: int
    <span class="hljs-attr">completed</span>: bool = <span class="hljs-title class_">False</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TodoController</span>:
    def <span class="hljs-title function_">__init__</span>(self):
        self.<span class="hljs-property">todos</span> = []

    def <span class="hljs-title function_">create_todo</span>(self, <span class="hljs-attr">todo</span>: <span class="hljs-title class_">TodoCreate</span>):
        new_todo = <span class="hljs-title class_">Todo</span>(id=<span class="hljs-title function_">len</span>(self.<span class="hljs-property">todos</span>) + <span class="hljs-number">1</span>, **todo.<span class="hljs-title function_">model_dump</span>())
        self.<span class="hljs-property">todos</span>.<span class="hljs-title function_">append</span>(new_todo)
        <span class="hljs-keyword">return</span> new_todo

    def <span class="hljs-title function_">get_todos</span>(self):
        <span class="hljs-keyword">return</span> self.<span class="hljs-property">todos</span>

    def <span class="hljs-title function_">get_todo</span>(self, <span class="hljs-attr">todo_id</span>: int):
        <span class="hljs-keyword">for</span> todo <span class="hljs-keyword">in</span> self.<span class="hljs-property">todos</span>:
            <span class="hljs-keyword">if</span> todo.<span class="hljs-property">id</span> == <span class="hljs-attr">todo_id</span>:
                <span class="hljs-keyword">return</span> todo
        raise <span class="hljs-title class_">HTTPException</span>(status_code=<span class="hljs-number">404</span>, detail=<span class="hljs-string">"Todo를 찾을 수 없습니다."</span>)

    def <span class="hljs-title function_">update_todo</span>(self, <span class="hljs-attr">todo_id</span>: int, <span class="hljs-attr">updated_todo</span>: <span class="hljs-title class_">TodoCreate</span>):
        <span class="hljs-keyword">for</span> todo <span class="hljs-keyword">in</span> self.<span class="hljs-property">todos</span>:
            <span class="hljs-keyword">if</span> todo.<span class="hljs-property">id</span> == <span class="hljs-attr">todo_id</span>:
                todo.<span class="hljs-property">title</span> = updated_todo.<span class="hljs-property">title</span>
                <span class="hljs-keyword">return</span> todo
        raise <span class="hljs-title class_">HTTPException</span>(status_code=<span class="hljs-number">404</span>, detail=<span class="hljs-string">"Todo를 찾을 수 없습니다."</span>)

    def <span class="hljs-title function_">delete_todo</span>(self, <span class="hljs-attr">todo_id</span>: int):
        <span class="hljs-keyword">for</span> index, todo <span class="hljs-keyword">in</span> <span class="hljs-title function_">enumerate</span>(self.<span class="hljs-property">todos</span>):
            <span class="hljs-keyword">if</span> todo.<span class="hljs-property">id</span> == <span class="hljs-attr">todo_id</span>:
                del self.<span class="hljs-property">todos</span>[index]
                <span class="hljs-keyword">return</span> {<span class="hljs-string">"message"</span>: <span class="hljs-string">"Todo가 성공적으로 삭제되었습니다."</span>}
        raise <span class="hljs-title class_">HTTPException</span>(status_code=<span class="hljs-number">404</span>, detail=<span class="hljs-string">"Todo를 찾을 수 없습니다."</span>)
</code></pre>
<p>todo_router.py 파일을 업데이트하여 컨트롤러를 사용하십시오.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> <span class="hljs-title class_">APIRouter</span>
<span class="hljs-keyword">from</span> controllers.<span class="hljs-property">todo_controller</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">TodoController</span>, <span class="hljs-title class_">TodoCreate</span>, <span class="hljs-title class_">Todo</span>

router = <span class="hljs-title class_">APIRouter</span>()
todo_controller = <span class="hljs-title class_">TodoController</span>()

@router.<span class="hljs-title function_">post</span>(<span class="hljs-string">"/todos"</span>, response_model=<span class="hljs-title class_">Todo</span>)
def <span class="hljs-title function_">create_todo</span>(<span class="hljs-attr">todo</span>: <span class="hljs-title class_">TodoCreate</span>):
    <span class="hljs-keyword">return</span> todo_controller.<span class="hljs-title function_">create_todo</span>(todo)

@router.<span class="hljs-title function_">get</span>(<span class="hljs-string">"/todos"</span>, response_model=list[<span class="hljs-title class_">Todo</span>])
def <span class="hljs-title function_">get_todos</span>():
    <span class="hljs-keyword">return</span> todo_controller.<span class="hljs-title function_">get_todos</span>()

@router.<span class="hljs-title function_">get</span>(<span class="hljs-string">"/todos/{todo_id}"</span>, response_model=<span class="hljs-title class_">Todo</span>)
def <span class="hljs-title function_">get_todo</span>(<span class="hljs-attr">todo_id</span>: int):
    <span class="hljs-keyword">return</span> todo_controller.<span class="hljs-title function_">get_todo</span>(todo_id)

@router.<span class="hljs-title function_">put</span>(<span class="hljs-string">"/todos/{todo_id}"</span>, response_model=<span class="hljs-title class_">Todo</span>)
def <span class="hljs-title function_">update_todo</span>(<span class="hljs-attr">todo_id</span>: int, <span class="hljs-attr">updated_todo</span>: <span class="hljs-title class_">TodoCreate</span>):
    <span class="hljs-keyword">return</span> todo_controller.<span class="hljs-title function_">update_todo</span>(todo_id, updated_todo)

@router.<span class="hljs-title function_">delete</span>(<span class="hljs-string">"/todos/{todo_id}"</span>)
def <span class="hljs-title function_">delete_todo</span>(<span class="hljs-attr">todo_id</span>: int):
    <span class="hljs-keyword">return</span> todo_controller.<span class="hljs-title function_">delete_todo</span>(todo_id)
</code></pre>
<h2>서비스 레이어 구현</h2>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>이제 비즈니스 로직을 처리하는 서비스 레이어를 소개해 봅시다.</p>
<p>services 라는 새 디렉토리를 만들고 todo_service.py 라는 파일을 추가해 주세요.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> <span class="hljs-title class_">BaseModel</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TodoCreate</span>(<span class="hljs-title class_">BaseModel</span>):
    <span class="hljs-attr">title</span>: str

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Todo</span>(<span class="hljs-title class_">TodoCreate</span>):
    <span class="hljs-attr">id</span>: int
    <span class="hljs-attr">completed</span>: bool = <span class="hljs-title class_">False</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TodoService</span>:
    def <span class="hljs-title function_">__init__</span>(self):
        self.<span class="hljs-property">todos</span> = []

    def <span class="hljs-title function_">create_todo</span>(self, <span class="hljs-attr">todo</span>: <span class="hljs-title class_">TodoCreate</span>) -> <span class="hljs-title class_">Todo</span>:
        new_todo = <span class="hljs-title class_">Todo</span>(id=<span class="hljs-title function_">len</span>(self.<span class="hljs-property">todos</span>) + <span class="hljs-number">1</span>, **todo.<span class="hljs-title function_">model_dump</span>())
        self.<span class="hljs-property">todos</span>.<span class="hljs-title function_">append</span>(new_todo)
        <span class="hljs-keyword">return</span> new_todo

    def <span class="hljs-title function_">get_todos</span>(self) -> list[<span class="hljs-title class_">Todo</span>]:
        <span class="hljs-keyword">return</span> self.<span class="hljs-property">todos</span>

    def <span class="hljs-title function_">get_todo</span>(self, <span class="hljs-attr">todo_id</span>: int) -> <span class="hljs-title class_">Todo</span> | <span class="hljs-title class_">None</span>:
        <span class="hljs-keyword">for</span> todo <span class="hljs-keyword">in</span> self.<span class="hljs-property">todos</span>:
            <span class="hljs-keyword">if</span> todo.<span class="hljs-property">id</span> == <span class="hljs-attr">todo_id</span>:
                <span class="hljs-keyword">return</span> todo
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">None</span>

    def <span class="hljs-title function_">update_todo</span>(self, <span class="hljs-attr">todo_id</span>: int, <span class="hljs-attr">updated_todo</span>: <span class="hljs-title class_">TodoCreate</span>) -> <span class="hljs-title class_">Todo</span> | <span class="hljs-title class_">None</span>:
        <span class="hljs-keyword">for</span> todo <span class="hljs-keyword">in</span> self.<span class="hljs-property">todos</span>:
            <span class="hljs-keyword">if</span> todo.<span class="hljs-property">id</span> == <span class="hljs-attr">todo_id</span>:
                todo.<span class="hljs-property">title</span> = updated_todo.<span class="hljs-property">title</span>
                <span class="hljs-keyword">return</span> todo
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">None</span>

    def <span class="hljs-title function_">delete_todo</span>(self, <span class="hljs-attr">todo_id</span>: int) -> <span class="hljs-attr">bool</span>:
        <span class="hljs-keyword">for</span> index, todo <span class="hljs-keyword">in</span> <span class="hljs-title function_">enumerate</span>(self.<span class="hljs-property">todos</span>):
            <span class="hljs-keyword">if</span> todo.<span class="hljs-property">id</span> == <span class="hljs-attr">todo_id</span>:
                del self.<span class="hljs-property">todos</span>[index]
                <span class="hljs-keyword">return</span> <span class="hljs-title class_">True</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">False</span>
</code></pre>
<p>todo_controller.py를 업데이트하여 서비스를 사용하도록합니다.</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> <span class="hljs-title class_">HTTPException</span>
<span class="hljs-keyword">from</span> services.<span class="hljs-property">todo_service</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">TodoService</span>, <span class="hljs-title class_">TodoCreate</span>, <span class="hljs-title class_">Todo</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TodoController</span>:
    def <span class="hljs-title function_">__init__</span>(self):
        self.<span class="hljs-property">todo_service</span> = <span class="hljs-title class_">TodoService</span>()

    def <span class="hljs-title function_">create_todo</span>(self, <span class="hljs-attr">todo</span>: <span class="hljs-title class_">TodoCreate</span>):
        <span class="hljs-keyword">return</span> self.<span class="hljs-property">todo_service</span>.<span class="hljs-title function_">create_todo</span>(todo)

    def <span class="hljs-title function_">get_todos</span>(self):
        <span class="hljs-keyword">return</span> self.<span class="hljs-property">todo_service</span>.<span class="hljs-title function_">get_todos</span>()

    def <span class="hljs-title function_">get_todo</span>(self, <span class="hljs-attr">todo_id</span>: int):
        todo = self.<span class="hljs-property">todo_service</span>.<span class="hljs-title function_">get_todo</span>(todo_id)
        <span class="hljs-keyword">if</span> todo is <span class="hljs-title class_">None</span>:
            raise <span class="hljs-title class_">HTTPException</span>(status_code=<span class="hljs-number">404</span>, detail=<span class="hljs-string">"할 일을 찾을 수 없습니다"</span>)
        <span class="hljs-keyword">return</span> todo

    def <span class="hljs-title function_">update_todo</span>(self, <span class="hljs-attr">todo_id</span>: int, <span class="hljs-attr">updated_todo</span>: <span class="hljs-title class_">TodoCreate</span>):
        todo = self.<span class="hljs-property">todo_service</span>.<span class="hljs-title function_">update_todo</span>(todo_id, updated_todo)
        <span class="hljs-keyword">if</span> todo is <span class="hljs-title class_">None</span>:
            raise <span class="hljs-title class_">HTTPException</span>(status_code=<span class="hljs-number">404</span>, detail=<span class="hljs-string">"할 일을 찾을 수 없습니다"</span>)
        <span class="hljs-keyword">return</span> todo

    def <span class="hljs-title function_">delete_todo</span>(self, <span class="hljs-attr">todo_id</span>: int):
        <span class="hljs-keyword">if</span> self.<span class="hljs-property">todo_service</span>.<span class="hljs-title function_">delete_todo</span>(todo_id):
            <span class="hljs-keyword">return</span> {<span class="hljs-string">"message"</span>: <span class="hljs-string">"할 일이 성공적으로 삭제되었습니다"</span>}
        raise <span class="hljs-title class_">HTTPException</span>(status_code=<span class="hljs-number">404</span>, detail=<span class="hljs-string">"할 일을 찾을 수 없습니다"</span>)
</code></pre>
<h2>레포지터리 레이어 생성</h2>
<p>마지막으로 데이터 지속성을 처리하는 레포지터리 레이어를 소개합니다.</p>
<p>repositories라는 새 디렉토리를 만들고 todo_repository.py라는 파일을 추가하세요.</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TodoCreate</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    title: <span class="hljs-built_in">str</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Todo</span>(<span class="hljs-title class_ inherited__">TodoCreate</span>):
    <span class="hljs-built_in">id</span>: <span class="hljs-built_in">int</span>
    completed: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TodoRepository</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.todos = []

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_todo</span>(<span class="hljs-params">self, todo: TodoCreate</span>) -> Todo:
        new_todo = Todo(<span class="hljs-built_in">id</span>=<span class="hljs-built_in">len</span>(self.todos) + <span class="hljs-number">1</span>, **todo.model_dump())
        self.todos.append(new_todo)
        <span class="hljs-keyword">return</span> new_todo

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_todos</span>(<span class="hljs-params">self</span>) -> <span class="hljs-built_in">list</span>[Todo]:
        <span class="hljs-keyword">return</span> self.todos

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_todo</span>(<span class="hljs-params">self, todo_id: <span class="hljs-built_in">int</span></span>) -> Todo | <span class="hljs-literal">None</span>:
        <span class="hljs-keyword">for</span> todo <span class="hljs-keyword">in</span> self.todos:
            <span class="hljs-keyword">if</span> todo.<span class="hljs-built_in">id</span> == todo_id:
                <span class="hljs-keyword">return</span> todo
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_todo</span>(<span class="hljs-params">self, todo_id: <span class="hljs-built_in">int</span>, updated_todo: TodoCreate</span>) -> Todo | <span class="hljs-literal">None</span>:
        <span class="hljs-keyword">for</span> todo <span class="hljs-keyword">in</span> self.todos:
            <span class="hljs-keyword">if</span> todo.<span class="hljs-built_in">id</span> == todo_id:
                todo.title = updated_todo.title
                <span class="hljs-keyword">return</span> todo
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">delete_todo</span>(<span class="hljs-params">self, todo_id: <span class="hljs-built_in">int</span></span>) -> <span class="hljs-built_in">bool</span>:
        <span class="hljs-keyword">for</span> index, todo <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(self.todos):
            <span class="hljs-keyword">if</span> todo.<span class="hljs-built_in">id</span> == todo_id:
                <span class="hljs-keyword">del</span> self.todos[index]
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
</code></pre>
<p>Update <code>todo_service.py</code> to use the repository,</p>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> repositories.todo_repository <span class="hljs-keyword">import</span> TodoRepository, TodoCreate, Todo

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TodoService</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.todo_repository = TodoRepository()

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_todo</span>(<span class="hljs-params">self, todo: TodoCreate</span>) -> Todo:
        <span class="hljs-keyword">return</span> self.todo_repository.create_todo(todo)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_todos</span>(<span class="hljs-params">self</span>) -> <span class="hljs-built_in">list</span>[Todo]:
        <span class="hljs-keyword">return</span> self.todo_repository.get_todos()

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_todo</span>(<span class="hljs-params">self, todo_id: <span class="hljs-built_in">int</span></span>) -> Todo | <span class="hljs-literal">None</span>:
        <span class="hljs-keyword">return</span> self.todo_repository.get_todo(todo_id)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_todo</span>(<span class="hljs-params">self, todo_id: <span class="hljs-built_in">int</span>, updated_todo: TodoCreate</span>) -> Todo | <span class="hljs-literal">None</span>:
        <span class="hljs-keyword">return</span> self.todo_repository.update_todo(todo_id, updated_todo)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">delete_todo</span>(<span class="hljs-params">self, todo_id: <span class="hljs-built_in">int</span></span>) -> <span class="hljs-built_in">bool</span>:
        <span class="hljs-keyword">return</span> self.todo_repository.delete_todo(todo_id)
</code></pre>
<p>우리의 리팩터링 여정은 여기서 끝납니다…</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>파이썬 앱.py에서 구조화된 모듈 아키텍처로 이어지는 이 여정에서, 우리는 Todo API를 더 확장 가능하고 유지 관리 가능한 애플리케이션으로 변형시켰습니다. 라우터, 컨트롤러, 서비스 및 리포지토리를 도입함으로써, 우리는 관심사의 명확한 분리와 프로젝트 확장에 따른 복잡성 관리 능력을 향상시켰습니다.</p>
<h2>모듈식 아키텍처의 주요 이점:</h2>
<ul>
<li>향상된 유지 보수성: 각 컴포넌트 - 라우터, 컨트롤러, 서비스 및 리포지토리 -는 이제 특정 책임을 처리하여 변경 시 의도치 않은 부작용의 위험을 줄입니다.</li>
<li>향상된 테스트 용이성: 각 레이어가 명확하게 구분되어 유닛 테스트가 보다 간편해집니다. 우리는 각 컴포넌트를 독립적으로 테스트하여 응용 프로그램 전체에서 견고함과 신뢰성을 보장할 수 있습니다.</li>
<li>확장성과 유연성: 모듈식 디자인은 확장을 용이하게 합니다. 새로운 기능을 추가하거나 기존 기능을 수정할 때 전체 코드베이스를 철저히 재작업하지 않고도 수행할 수 있습니다. 이 유연성은 데이터베이스 전환이나 비즈니스 로직 업데이트와 같은 작업에도 연결됩니다.</li>
</ul>
<p>우리의 리포지토리는 이제 다음과 같이 보입니다...</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p><code>&#x3C;img src="/TIL/assets/img/2024-07-09-FastAPIFromApppytoaModularArchitecture_3.png" /></code></p>
<p>FastAPI 애플리케이션을 모듈식 아키텍처로 리팩토링함으로써, 지속적인 성장과 유연성을 위한 견고한 기반을 마련했습니다. 이 접근 방식은 현재 개발 노력을 향상시킬 뿐만 아니라 앞으로의 도전과 기회에 대비하는 데 도움이 됩니다.</p>
<p>안녕히 가세요!!</p>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"FastAPI Apppy에서 모듈러 아키텍처로 전환하는 방법","description":"","date":"2024-07-09 20:24","slug":"2024-07-09-FastAPIFromApppytoaModularArchitecture","content":"\n\u003cimg src=\"/TIL/assets/img/2024-07-09-FastAPIFromApppytoaModularArchitecture_0.png\" /\u003e\n\n패스트API를 사용하여 백엔드를 구축할 때, 일반적으로 하나의 app.py 파일로 시작하는 것이 흔합니다. 이 접근 방식은 작은 프로젝트에 적합하지만, 응용 프로그램이 성장함에 따라 유지 보수와 확장이 어려워집니다.\n\n이 블로그 포스트에서는 Routers, Controllers, Services 및 Repositories로 구성된 구조화된 아키텍처를 사용하여 FastAPI 애플리케이션을 모놀리식 app.py 파일에서 리팩토링하는 방법을 살펴보겠습니다.\n\n## 소개: 우리의 할 일 API\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n리팩터링 프로세스에 뛰어들기 전에 함께 작업할 API를 살펴보겠습니다. 다음과 같은 엔드포인트를 가진 간단한 할 일 애플리케이션을 구축 중입니다.\n\n![API Image](/TIL/assets/img/2024-07-09-FastAPIFromApppytoaModularArchitecture_1.png)\n\n이러한 API를 통해 사용자는 할 일 항목에 대한 CRUD(Create, Read, Update, Delete) 작업을 수행할 수 있습니다. 각 할 일 항목은 다음과 같은 속성을 가지게 될 것입니다.\n\n이제 작업 중인 API를 이해했으므로 몇 가지 전제 조건 및 이를 구현하는 방법을 살펴보겠습니다.\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n## 준비 사항\n\n처음 접근과 리팩토링을 시작하기 전에 FastAPI 프로젝트를 설정해 봅시다.\n\n```js\npython3 -m venv venv\nsource env/bin/activate  # Windows에서는 `env\\Scripts\\activate\n```\n\n```js\nfastapi;\nuvicorn;\n```\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```bash\npip3 install -r requirements.txt\n```\n\n## 초기 접근 방식: 모든 것을 app.py에서 처리\n\n간단한 Todo API를 시작해봅시다. 이 API는 루트 레벨의 app.py에서 완전히 구현되어 있습니다.\n\n```python\nfrom fastapi import FastAPI, HTTPException\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\n# 새로운 todo를 생성하기 위한 Pydantic 모델\nclass TodoCreate(BaseModel):\n    title: str\n\n# todo 항목을 위한 Pydantic 모델. TodoCreate를 상속받고 id 및 completed 필드를 추가합니다.\nclass Todo(TodoCreate):\n    id: int\n    completed: bool = False\n\n# 데이터베이스를 모방한 todos의 인메모리 저장소\ntodos = []\n\n# 새로운 todo를 생성하는 엔드포인트\n@app.post(\"/todos\", response_model=Todo)\ndef create_todo(todo: TodoCreate):\n    # id를 증가시킨 새로운 todo 항목을 생성합니다.\n    new_todo = Todo(id=len(todos) + 1, **todo.model_dump())\n    todos.append(new_todo)  # 새로운 todo를 목록에 추가합니다.\n    return new_todo  # 생성된 todo를 응답으로 반환합니다.\n\n# 모든 todo를 가져오는 엔드포인트\n@app.get(\"/todos\", response_model=list[Todo])\ndef get_todos():\n    return todos  # todo 목록을 응답으로 반환합니다.\n\n# 특정 id의 todo를 가져오는 엔드포인트\n@app.get(\"/todos/{todo_id}\", response_model=Todo)\ndef get_todo(todo_id: int):\n    for todo in todos:\n        if todo.id == todo_id:\n            return todo  # 찾은 경우 해당 todo를 반환합니다.\n    # 해당 todo를 찾을 수 없는 경우 404 상태 코드와 메시지를 포함한 HTTPException을 발생시킵니다.\n    raise HTTPException(status_code=404, detail=\"Todo가 없습니다\")\n\n# id에 따라 todo를 업데이트하는 엔드포인트\n@app.put(\"/todos/{todo_id}\", response_model=Todo)\ndef update_todo(todo_id: int, updated_todo: TodoCreate):\n    for todo in todos:\n        if todo.id == todo_id:\n            todo.title = updated_todo.title  # todo의 제목을 업데이트합니다.\n            return todo  # 업데이트된 todo를 반환합니다.\n    # 해당 todo를 찾을 수 없는 경우 404 상태 코드와 메시지를 포함한 HTTPException을 발생시킵니다.\n    raise HTTPException(status_code=404, detail=\"Todo가 없습니다\")\n\n# id에 따라 todo를 삭제하는 엔드포인트\n@app.delete(\"/todos/{todo_id}\")\ndef delete_todo(todo_id: int):\n    for index, todo in enumerate(todos):\n        if todo.id == todo_id:\n            del todos[index]  # 목록에서 todo를 삭제합니다.\n            return {\"message\": \"Todo가 성공적으로 삭제되었습니다\"}  # 성공 메시지를 반환합니다.\n    # 해당 todo를 찾을 수 없는 경우 404 상태 코드와 메시지를 포함한 HTTPException을 발생시킵니다.\n    raise HTTPException(status_code=404, detail=\"Todo가 없습니다\")\n\n# Uvicorn 서버를 사용하여 애플리케이션을 실행하는 주요 블록\nif __name__ == \"__main__\":\n    import uvicorn\n    uvicorn.run(\"app:app\", port=3000, host=\"0.0.0.0\", reload=True)\n```\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\nAPI를 시작하려면 python3 app.py 명령어를 사용해요\n\n음...\n\n이 방법은 작은 애플리케이션에는 작동하지만 몇 가지 단점이 있어요:\n\n- 모든 라우팅, 비즈니스 로직 및 데이터 저장소가 단일 파일에 혼합되어 있어요.\n- 애플리케이션이 성장함에 따라 유지 및 확장하기 어려워져요.\n- 개별 구성 요소를 테스트하는 것이 어려워져요.\n- 코드의 재사용성이 제한되어요\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n![FastAPIFromApppytoaModularArchitecture](/TIL/assets/img/2024-07-09-FastAPIFromApppytoaModularArchitecture_2.png)\n\nRefactoring journey starts now...\n\n## Routers Introduction\n\nTo structure our application effectively, the first step is to introduce routers.\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n새로운 폴더를 만들어 routers라는 이름을 붙이고 todo_router.py라는 파일을 추가해주세요.\n\n```python\nfrom fastapi import APIRouter\n\nrouter = APIRouter()\n\n@router.post(\"/todos\")\ndef create_todo():\n    pass\n\n@router.get(\"/todos\")\ndef get_todos():\n    pass\n\n@router.get(\"/todos/{todo_id}\")\ndef get_todo(todo_id: int):\n    pass\n\n@router.put(\"/todos/{todo_id}\")\ndef update_todo(todo_id: int):\n    pass\n\n@router.delete(\"/todos/{todo_id}\")\ndef delete_todo(todo_id: int):\n    pass\n```\n\n이제 app.py를 업데이트하여 라우터를 사용하세요.\n\n```python\nfrom fastapi import FastAPI\nfrom routers import todo_router\n\napp = FastAPI()\n\napp.include_router(todo_router.router)\n\nif __name__ == \"__main__\":\n    import uvicorn\n    uvicorn.run(\"app:app\", port=3000, host=\"0.0.0.0\", reload=True)\n```\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n라우터를 도입함으로써 작업 관련 라우트를 메인 app.py 파일에서 분리하여 코드를 더 깔끔하고 집중적으로 유지하였습니다.\n\n## 컨트롤러 추가\n\n다음으로, 요청 처리 로직을 처리하기 위한 컨트롤러를 도입할 예정입니다.\n\ncontrollers라는 새 디렉토리를 생성하고 todo_controller.py라는 파일을 추가하세요.\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\nfrom fastapi import HTTPException\nfrom pydantic import BaseModel\n\nclass TodoCreate(BaseModel):\n    title: str\n\nclass Todo(TodoCreate):\n    id: int\n    completed: bool = False\n\nclass TodoController:\n    def __init__(self):\n        self.todos = []\n\n    def create_todo(self, todo: TodoCreate):\n        new_todo = Todo(id=len(self.todos) + 1, **todo.model_dump())\n        self.todos.append(new_todo)\n        return new_todo\n\n    def get_todos(self):\n        return self.todos\n\n    def get_todo(self, todo_id: int):\n        for todo in self.todos:\n            if todo.id == todo_id:\n                return todo\n        raise HTTPException(status_code=404, detail=\"Todo를 찾을 수 없습니다.\")\n\n    def update_todo(self, todo_id: int, updated_todo: TodoCreate):\n        for todo in self.todos:\n            if todo.id == todo_id:\n                todo.title = updated_todo.title\n                return todo\n        raise HTTPException(status_code=404, detail=\"Todo를 찾을 수 없습니다.\")\n\n    def delete_todo(self, todo_id: int):\n        for index, todo in enumerate(self.todos):\n            if todo.id == todo_id:\n                del self.todos[index]\n                return {\"message\": \"Todo가 성공적으로 삭제되었습니다.\"}\n        raise HTTPException(status_code=404, detail=\"Todo를 찾을 수 없습니다.\")\n```\n\ntodo_router.py 파일을 업데이트하여 컨트롤러를 사용하십시오.\n\n```js\nfrom fastapi import APIRouter\nfrom controllers.todo_controller import TodoController, TodoCreate, Todo\n\nrouter = APIRouter()\ntodo_controller = TodoController()\n\n@router.post(\"/todos\", response_model=Todo)\ndef create_todo(todo: TodoCreate):\n    return todo_controller.create_todo(todo)\n\n@router.get(\"/todos\", response_model=list[Todo])\ndef get_todos():\n    return todo_controller.get_todos()\n\n@router.get(\"/todos/{todo_id}\", response_model=Todo)\ndef get_todo(todo_id: int):\n    return todo_controller.get_todo(todo_id)\n\n@router.put(\"/todos/{todo_id}\", response_model=Todo)\ndef update_todo(todo_id: int, updated_todo: TodoCreate):\n    return todo_controller.update_todo(todo_id, updated_todo)\n\n@router.delete(\"/todos/{todo_id}\")\ndef delete_todo(todo_id: int):\n    return todo_controller.delete_todo(todo_id)\n```\n\n## 서비스 레이어 구현\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n이제 비즈니스 로직을 처리하는 서비스 레이어를 소개해 봅시다.\n\nservices 라는 새 디렉토리를 만들고 todo_service.py 라는 파일을 추가해 주세요.\n\n```js\nfrom pydantic import BaseModel\n\nclass TodoCreate(BaseModel):\n    title: str\n\nclass Todo(TodoCreate):\n    id: int\n    completed: bool = False\n\nclass TodoService:\n    def __init__(self):\n        self.todos = []\n\n    def create_todo(self, todo: TodoCreate) -\u003e Todo:\n        new_todo = Todo(id=len(self.todos) + 1, **todo.model_dump())\n        self.todos.append(new_todo)\n        return new_todo\n\n    def get_todos(self) -\u003e list[Todo]:\n        return self.todos\n\n    def get_todo(self, todo_id: int) -\u003e Todo | None:\n        for todo in self.todos:\n            if todo.id == todo_id:\n                return todo\n        return None\n\n    def update_todo(self, todo_id: int, updated_todo: TodoCreate) -\u003e Todo | None:\n        for todo in self.todos:\n            if todo.id == todo_id:\n                todo.title = updated_todo.title\n                return todo\n        return None\n\n    def delete_todo(self, todo_id: int) -\u003e bool:\n        for index, todo in enumerate(self.todos):\n            if todo.id == todo_id:\n                del self.todos[index]\n                return True\n        return False\n```\n\ntodo_controller.py를 업데이트하여 서비스를 사용하도록합니다.\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\nfrom fastapi import HTTPException\nfrom services.todo_service import TodoService, TodoCreate, Todo\n\nclass TodoController:\n    def __init__(self):\n        self.todo_service = TodoService()\n\n    def create_todo(self, todo: TodoCreate):\n        return self.todo_service.create_todo(todo)\n\n    def get_todos(self):\n        return self.todo_service.get_todos()\n\n    def get_todo(self, todo_id: int):\n        todo = self.todo_service.get_todo(todo_id)\n        if todo is None:\n            raise HTTPException(status_code=404, detail=\"할 일을 찾을 수 없습니다\")\n        return todo\n\n    def update_todo(self, todo_id: int, updated_todo: TodoCreate):\n        todo = self.todo_service.update_todo(todo_id, updated_todo)\n        if todo is None:\n            raise HTTPException(status_code=404, detail=\"할 일을 찾을 수 없습니다\")\n        return todo\n\n    def delete_todo(self, todo_id: int):\n        if self.todo_service.delete_todo(todo_id):\n            return {\"message\": \"할 일이 성공적으로 삭제되었습니다\"}\n        raise HTTPException(status_code=404, detail=\"할 일을 찾을 수 없습니다\")\n```\n\n## 레포지터리 레이어 생성\n\n마지막으로 데이터 지속성을 처리하는 레포지터리 레이어를 소개합니다.\n\nrepositories라는 새 디렉토리를 만들고 todo_repository.py라는 파일을 추가하세요.\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```python\nfrom pydantic import BaseModel\n\nclass TodoCreate(BaseModel):\n    title: str\n\nclass Todo(TodoCreate):\n    id: int\n    completed: bool = False\n\nclass TodoRepository:\n    def __init__(self):\n        self.todos = []\n\n    def create_todo(self, todo: TodoCreate) -\u003e Todo:\n        new_todo = Todo(id=len(self.todos) + 1, **todo.model_dump())\n        self.todos.append(new_todo)\n        return new_todo\n\n    def get_todos(self) -\u003e list[Todo]:\n        return self.todos\n\n    def get_todo(self, todo_id: int) -\u003e Todo | None:\n        for todo in self.todos:\n            if todo.id == todo_id:\n                return todo\n        return None\n\n    def update_todo(self, todo_id: int, updated_todo: TodoCreate) -\u003e Todo | None:\n        for todo in self.todos:\n            if todo.id == todo_id:\n                todo.title = updated_todo.title\n                return todo\n        return None\n\n    def delete_todo(self, todo_id: int) -\u003e bool:\n        for index, todo in enumerate(self.todos):\n            if todo.id == todo_id:\n                del self.todos[index]\n                return True\n        return False\n```\n\nUpdate `todo_service.py` to use the repository,\n\n```python\nfrom repositories.todo_repository import TodoRepository, TodoCreate, Todo\n\nclass TodoService:\n    def __init__(self):\n        self.todo_repository = TodoRepository()\n\n    def create_todo(self, todo: TodoCreate) -\u003e Todo:\n        return self.todo_repository.create_todo(todo)\n\n    def get_todos(self) -\u003e list[Todo]:\n        return self.todo_repository.get_todos()\n\n    def get_todo(self, todo_id: int) -\u003e Todo | None:\n        return self.todo_repository.get_todo(todo_id)\n\n    def update_todo(self, todo_id: int, updated_todo: TodoCreate) -\u003e Todo | None:\n        return self.todo_repository.update_todo(todo_id, updated_todo)\n\n    def delete_todo(self, todo_id: int) -\u003e bool:\n        return self.todo_repository.delete_todo(todo_id)\n```\n\n우리의 리팩터링 여정은 여기서 끝납니다…\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n파이썬 앱.py에서 구조화된 모듈 아키텍처로 이어지는 이 여정에서, 우리는 Todo API를 더 확장 가능하고 유지 관리 가능한 애플리케이션으로 변형시켰습니다. 라우터, 컨트롤러, 서비스 및 리포지토리를 도입함으로써, 우리는 관심사의 명확한 분리와 프로젝트 확장에 따른 복잡성 관리 능력을 향상시켰습니다.\n\n## 모듈식 아키텍처의 주요 이점:\n\n- 향상된 유지 보수성: 각 컴포넌트 - 라우터, 컨트롤러, 서비스 및 리포지토리 -는 이제 특정 책임을 처리하여 변경 시 의도치 않은 부작용의 위험을 줄입니다.\n- 향상된 테스트 용이성: 각 레이어가 명확하게 구분되어 유닛 테스트가 보다 간편해집니다. 우리는 각 컴포넌트를 독립적으로 테스트하여 응용 프로그램 전체에서 견고함과 신뢰성을 보장할 수 있습니다.\n- 확장성과 유연성: 모듈식 디자인은 확장을 용이하게 합니다. 새로운 기능을 추가하거나 기존 기능을 수정할 때 전체 코드베이스를 철저히 재작업하지 않고도 수행할 수 있습니다. 이 유연성은 데이터베이스 전환이나 비즈니스 로직 업데이트와 같은 작업에도 연결됩니다.\n\n우리의 리포지토리는 이제 다음과 같이 보입니다...\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n`\u003cimg src=\"/TIL/assets/img/2024-07-09-FastAPIFromApppytoaModularArchitecture_3.png\" /\u003e`\n\nFastAPI 애플리케이션을 모듈식 아키텍처로 리팩토링함으로써, 지속적인 성장과 유연성을 위한 견고한 기반을 마련했습니다. 이 접근 방식은 현재 개발 노력을 향상시킬 뿐만 아니라 앞으로의 도전과 기회에 대비하는 데 도움이 됩니다.\n\n안녕히 가세요!!\n","ogImage":{"url":"/assets/img/2024-07-09-FastAPIFromApppytoaModularArchitecture_0.png"},"coverImage":"/TIL/assets/img/2024-07-09-FastAPIFromApppytoaModularArchitecture_0.png","tag":["Tech"],"readingTime":16},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cimg src=\"/TIL/assets/img/2024-07-09-FastAPIFromApppytoaModularArchitecture_0.png\"\u003e\n\u003cp\u003e패스트API를 사용하여 백엔드를 구축할 때, 일반적으로 하나의 app.py 파일로 시작하는 것이 흔합니다. 이 접근 방식은 작은 프로젝트에 적합하지만, 응용 프로그램이 성장함에 따라 유지 보수와 확장이 어려워집니다.\u003c/p\u003e\n\u003cp\u003e이 블로그 포스트에서는 Routers, Controllers, Services 및 Repositories로 구성된 구조화된 아키텍처를 사용하여 FastAPI 애플리케이션을 모놀리식 app.py 파일에서 리팩토링하는 방법을 살펴보겠습니다.\u003c/p\u003e\n\u003ch2\u003e소개: 우리의 할 일 API\u003c/h2\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e리팩터링 프로세스에 뛰어들기 전에 함께 작업할 API를 살펴보겠습니다. 다음과 같은 엔드포인트를 가진 간단한 할 일 애플리케이션을 구축 중입니다.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/TIL/assets/img/2024-07-09-FastAPIFromApppytoaModularArchitecture_1.png\" alt=\"API Image\"\u003e\u003c/p\u003e\n\u003cp\u003e이러한 API를 통해 사용자는 할 일 항목에 대한 CRUD(Create, Read, Update, Delete) 작업을 수행할 수 있습니다. 각 할 일 항목은 다음과 같은 속성을 가지게 될 것입니다.\u003c/p\u003e\n\u003cp\u003e이제 작업 중인 API를 이해했으므로 몇 가지 전제 조건 및 이를 구현하는 방법을 살펴보겠습니다.\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003ch2\u003e준비 사항\u003c/h2\u003e\n\u003cp\u003e처음 접근과 리팩토링을 시작하기 전에 FastAPI 프로젝트를 설정해 봅시다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003epython3 -m venv venv\nsource env/bin/activate  # \u003cspan class=\"hljs-title class_\"\u003eWindows\u003c/span\u003e에서는 \u003cspan class=\"hljs-string\"\u003e`env\\Scripts\\activate\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003efastapi;\nuvicorn;\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003epip3 install -r requirements.txt\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e초기 접근 방식: 모든 것을 app.py에서 처리\u003c/h2\u003e\n\u003cp\u003e간단한 Todo API를 시작해봅시다. 이 API는 루트 레벨의 app.py에서 완전히 구현되어 있습니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e fastapi \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e FastAPI, HTTPException\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pydantic \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e BaseModel\n\napp = FastAPI()\n\n\u003cspan class=\"hljs-comment\"\u003e# 새로운 todo를 생성하기 위한 Pydantic 모델\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTodoCreate\u003c/span\u003e(\u003cspan class=\"hljs-title class_ inherited__\"\u003eBaseModel\u003c/span\u003e):\n    title: \u003cspan class=\"hljs-built_in\"\u003estr\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e# todo 항목을 위한 Pydantic 모델. TodoCreate를 상속받고 id 및 completed 필드를 추가합니다.\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTodo\u003c/span\u003e(\u003cspan class=\"hljs-title class_ inherited__\"\u003eTodoCreate\u003c/span\u003e):\n    \u003cspan class=\"hljs-built_in\"\u003eid\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003eint\u003c/span\u003e\n    completed: \u003cspan class=\"hljs-built_in\"\u003ebool\u003c/span\u003e = \u003cspan class=\"hljs-literal\"\u003eFalse\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e# 데이터베이스를 모방한 todos의 인메모리 저장소\u003c/span\u003e\ntodos = []\n\n\u003cspan class=\"hljs-comment\"\u003e# 새로운 todo를 생성하는 엔드포인트\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e@app.post(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-string\"\u003e\"/todos\"\u003c/span\u003e, response_model=Todo\u003c/span\u003e)\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003ecreate_todo\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003etodo: TodoCreate\u003c/span\u003e):\n    \u003cspan class=\"hljs-comment\"\u003e# id를 증가시킨 새로운 todo 항목을 생성합니다.\u003c/span\u003e\n    new_todo = Todo(\u003cspan class=\"hljs-built_in\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-built_in\"\u003elen\u003c/span\u003e(todos) + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, **todo.model_dump())\n    todos.append(new_todo)  \u003cspan class=\"hljs-comment\"\u003e# 새로운 todo를 목록에 추가합니다.\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e new_todo  \u003cspan class=\"hljs-comment\"\u003e# 생성된 todo를 응답으로 반환합니다.\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e# 모든 todo를 가져오는 엔드포인트\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e@app.get(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-string\"\u003e\"/todos\"\u003c/span\u003e, response_model=\u003cspan class=\"hljs-built_in\"\u003elist\u003c/span\u003e[Todo]\u003c/span\u003e)\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eget_todos\u003c/span\u003e():\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e todos  \u003cspan class=\"hljs-comment\"\u003e# todo 목록을 응답으로 반환합니다.\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e# 특정 id의 todo를 가져오는 엔드포인트\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e@app.get(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-string\"\u003e\"/todos/{todo_id}\"\u003c/span\u003e, response_model=Todo\u003c/span\u003e)\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eget_todo\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003etodo_id: \u003cspan class=\"hljs-built_in\"\u003eint\u003c/span\u003e\u003c/span\u003e):\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e todo \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e todos:\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e todo.\u003cspan class=\"hljs-built_in\"\u003eid\u003c/span\u003e == todo_id:\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e todo  \u003cspan class=\"hljs-comment\"\u003e# 찾은 경우 해당 todo를 반환합니다.\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e# 해당 todo를 찾을 수 없는 경우 404 상태 코드와 메시지를 포함한 HTTPException을 발생시킵니다.\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eraise\u003c/span\u003e HTTPException(status_code=\u003cspan class=\"hljs-number\"\u003e404\u003c/span\u003e, detail=\u003cspan class=\"hljs-string\"\u003e\"Todo가 없습니다\"\u003c/span\u003e)\n\n\u003cspan class=\"hljs-comment\"\u003e# id에 따라 todo를 업데이트하는 엔드포인트\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e@app.put(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-string\"\u003e\"/todos/{todo_id}\"\u003c/span\u003e, response_model=Todo\u003c/span\u003e)\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eupdate_todo\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003etodo_id: \u003cspan class=\"hljs-built_in\"\u003eint\u003c/span\u003e, updated_todo: TodoCreate\u003c/span\u003e):\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e todo \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e todos:\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e todo.\u003cspan class=\"hljs-built_in\"\u003eid\u003c/span\u003e == todo_id:\n            todo.title = updated_todo.title  \u003cspan class=\"hljs-comment\"\u003e# todo의 제목을 업데이트합니다.\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e todo  \u003cspan class=\"hljs-comment\"\u003e# 업데이트된 todo를 반환합니다.\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e# 해당 todo를 찾을 수 없는 경우 404 상태 코드와 메시지를 포함한 HTTPException을 발생시킵니다.\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eraise\u003c/span\u003e HTTPException(status_code=\u003cspan class=\"hljs-number\"\u003e404\u003c/span\u003e, detail=\u003cspan class=\"hljs-string\"\u003e\"Todo가 없습니다\"\u003c/span\u003e)\n\n\u003cspan class=\"hljs-comment\"\u003e# id에 따라 todo를 삭제하는 엔드포인트\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e@app.delete(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-string\"\u003e\"/todos/{todo_id}\"\u003c/span\u003e\u003c/span\u003e)\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003edelete_todo\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003etodo_id: \u003cspan class=\"hljs-built_in\"\u003eint\u003c/span\u003e\u003c/span\u003e):\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e index, todo \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eenumerate\u003c/span\u003e(todos):\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e todo.\u003cspan class=\"hljs-built_in\"\u003eid\u003c/span\u003e == todo_id:\n            \u003cspan class=\"hljs-keyword\"\u003edel\u003c/span\u003e todos[index]  \u003cspan class=\"hljs-comment\"\u003e# 목록에서 todo를 삭제합니다.\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\u003cspan class=\"hljs-string\"\u003e\"message\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Todo가 성공적으로 삭제되었습니다\"\u003c/span\u003e}  \u003cspan class=\"hljs-comment\"\u003e# 성공 메시지를 반환합니다.\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e# 해당 todo를 찾을 수 없는 경우 404 상태 코드와 메시지를 포함한 HTTPException을 발생시킵니다.\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eraise\u003c/span\u003e HTTPException(status_code=\u003cspan class=\"hljs-number\"\u003e404\u003c/span\u003e, detail=\u003cspan class=\"hljs-string\"\u003e\"Todo가 없습니다\"\u003c/span\u003e)\n\n\u003cspan class=\"hljs-comment\"\u003e# Uvicorn 서버를 사용하여 애플리케이션을 실행하는 주요 블록\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e __name__ == \u003cspan class=\"hljs-string\"\u003e\"__main__\"\u003c/span\u003e:\n    \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e uvicorn\n    uvicorn.run(\u003cspan class=\"hljs-string\"\u003e\"app:app\"\u003c/span\u003e, port=\u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e, host=\u003cspan class=\"hljs-string\"\u003e\"0.0.0.0\"\u003c/span\u003e, reload=\u003cspan class=\"hljs-literal\"\u003eTrue\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003eAPI를 시작하려면 python3 app.py 명령어를 사용해요\u003c/p\u003e\n\u003cp\u003e음...\u003c/p\u003e\n\u003cp\u003e이 방법은 작은 애플리케이션에는 작동하지만 몇 가지 단점이 있어요:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e모든 라우팅, 비즈니스 로직 및 데이터 저장소가 단일 파일에 혼합되어 있어요.\u003c/li\u003e\n\u003cli\u003e애플리케이션이 성장함에 따라 유지 및 확장하기 어려워져요.\u003c/li\u003e\n\u003cli\u003e개별 구성 요소를 테스트하는 것이 어려워져요.\u003c/li\u003e\n\u003cli\u003e코드의 재사용성이 제한되어요\u003c/li\u003e\n\u003c/ul\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e\u003cimg src=\"/TIL/assets/img/2024-07-09-FastAPIFromApppytoaModularArchitecture_2.png\" alt=\"FastAPIFromApppytoaModularArchitecture\"\u003e\u003c/p\u003e\n\u003cp\u003eRefactoring journey starts now...\u003c/p\u003e\n\u003ch2\u003eRouters Introduction\u003c/h2\u003e\n\u003cp\u003eTo structure our application effectively, the first step is to introduce routers.\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e새로운 폴더를 만들어 routers라는 이름을 붙이고 todo_router.py라는 파일을 추가해주세요.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e fastapi \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e APIRouter\n\nrouter = APIRouter()\n\n\u003cspan class=\"hljs-meta\"\u003e@router.post(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-string\"\u003e\"/todos\"\u003c/span\u003e\u003c/span\u003e)\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003ecreate_todo\u003c/span\u003e():\n    \u003cspan class=\"hljs-keyword\"\u003epass\u003c/span\u003e\n\n\u003cspan class=\"hljs-meta\"\u003e@router.get(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-string\"\u003e\"/todos\"\u003c/span\u003e\u003c/span\u003e)\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eget_todos\u003c/span\u003e():\n    \u003cspan class=\"hljs-keyword\"\u003epass\u003c/span\u003e\n\n\u003cspan class=\"hljs-meta\"\u003e@router.get(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-string\"\u003e\"/todos/{todo_id}\"\u003c/span\u003e\u003c/span\u003e)\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eget_todo\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003etodo_id: \u003cspan class=\"hljs-built_in\"\u003eint\u003c/span\u003e\u003c/span\u003e):\n    \u003cspan class=\"hljs-keyword\"\u003epass\u003c/span\u003e\n\n\u003cspan class=\"hljs-meta\"\u003e@router.put(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-string\"\u003e\"/todos/{todo_id}\"\u003c/span\u003e\u003c/span\u003e)\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eupdate_todo\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003etodo_id: \u003cspan class=\"hljs-built_in\"\u003eint\u003c/span\u003e\u003c/span\u003e):\n    \u003cspan class=\"hljs-keyword\"\u003epass\u003c/span\u003e\n\n\u003cspan class=\"hljs-meta\"\u003e@router.delete(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-string\"\u003e\"/todos/{todo_id}\"\u003c/span\u003e\u003c/span\u003e)\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003edelete_todo\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003etodo_id: \u003cspan class=\"hljs-built_in\"\u003eint\u003c/span\u003e\u003c/span\u003e):\n    \u003cspan class=\"hljs-keyword\"\u003epass\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이제 app.py를 업데이트하여 라우터를 사용하세요.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e fastapi \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e FastAPI\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e routers \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e todo_router\n\napp = FastAPI()\n\napp.include_router(todo_router.router)\n\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e __name__ == \u003cspan class=\"hljs-string\"\u003e\"__main__\"\u003c/span\u003e:\n    \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e uvicorn\n    uvicorn.run(\u003cspan class=\"hljs-string\"\u003e\"app:app\"\u003c/span\u003e, port=\u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e, host=\u003cspan class=\"hljs-string\"\u003e\"0.0.0.0\"\u003c/span\u003e, reload=\u003cspan class=\"hljs-literal\"\u003eTrue\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e라우터를 도입함으로써 작업 관련 라우트를 메인 app.py 파일에서 분리하여 코드를 더 깔끔하고 집중적으로 유지하였습니다.\u003c/p\u003e\n\u003ch2\u003e컨트롤러 추가\u003c/h2\u003e\n\u003cp\u003e다음으로, 요청 처리 로직을 처리하기 위한 컨트롤러를 도입할 예정입니다.\u003c/p\u003e\n\u003cp\u003econtrollers라는 새 디렉토리를 생성하고 todo_controller.py라는 파일을 추가하세요.\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e fastapi \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eHTTPException\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pydantic \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eBaseModel\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTodoCreate\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eBaseModel\u003c/span\u003e):\n    \u003cspan class=\"hljs-attr\"\u003etitle\u003c/span\u003e: str\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTodo\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eTodoCreate\u003c/span\u003e):\n    \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e: int\n    \u003cspan class=\"hljs-attr\"\u003ecompleted\u003c/span\u003e: bool = \u003cspan class=\"hljs-title class_\"\u003eFalse\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTodoController\u003c/span\u003e:\n    def \u003cspan class=\"hljs-title function_\"\u003e__init__\u003c/span\u003e(self):\n        self.\u003cspan class=\"hljs-property\"\u003etodos\u003c/span\u003e = []\n\n    def \u003cspan class=\"hljs-title function_\"\u003ecreate_todo\u003c/span\u003e(self, \u003cspan class=\"hljs-attr\"\u003etodo\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eTodoCreate\u003c/span\u003e):\n        new_todo = \u003cspan class=\"hljs-title class_\"\u003eTodo\u003c/span\u003e(id=\u003cspan class=\"hljs-title function_\"\u003elen\u003c/span\u003e(self.\u003cspan class=\"hljs-property\"\u003etodos\u003c/span\u003e) + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, **todo.\u003cspan class=\"hljs-title function_\"\u003emodel_dump\u003c/span\u003e())\n        self.\u003cspan class=\"hljs-property\"\u003etodos\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eappend\u003c/span\u003e(new_todo)\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e new_todo\n\n    def \u003cspan class=\"hljs-title function_\"\u003eget_todos\u003c/span\u003e(self):\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e self.\u003cspan class=\"hljs-property\"\u003etodos\u003c/span\u003e\n\n    def \u003cspan class=\"hljs-title function_\"\u003eget_todo\u003c/span\u003e(self, \u003cspan class=\"hljs-attr\"\u003etodo_id\u003c/span\u003e: int):\n        \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e todo \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e self.\u003cspan class=\"hljs-property\"\u003etodos\u003c/span\u003e:\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e todo.\u003cspan class=\"hljs-property\"\u003eid\u003c/span\u003e == \u003cspan class=\"hljs-attr\"\u003etodo_id\u003c/span\u003e:\n                \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e todo\n        raise \u003cspan class=\"hljs-title class_\"\u003eHTTPException\u003c/span\u003e(status_code=\u003cspan class=\"hljs-number\"\u003e404\u003c/span\u003e, detail=\u003cspan class=\"hljs-string\"\u003e\"Todo를 찾을 수 없습니다.\"\u003c/span\u003e)\n\n    def \u003cspan class=\"hljs-title function_\"\u003eupdate_todo\u003c/span\u003e(self, \u003cspan class=\"hljs-attr\"\u003etodo_id\u003c/span\u003e: int, \u003cspan class=\"hljs-attr\"\u003eupdated_todo\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eTodoCreate\u003c/span\u003e):\n        \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e todo \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e self.\u003cspan class=\"hljs-property\"\u003etodos\u003c/span\u003e:\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e todo.\u003cspan class=\"hljs-property\"\u003eid\u003c/span\u003e == \u003cspan class=\"hljs-attr\"\u003etodo_id\u003c/span\u003e:\n                todo.\u003cspan class=\"hljs-property\"\u003etitle\u003c/span\u003e = updated_todo.\u003cspan class=\"hljs-property\"\u003etitle\u003c/span\u003e\n                \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e todo\n        raise \u003cspan class=\"hljs-title class_\"\u003eHTTPException\u003c/span\u003e(status_code=\u003cspan class=\"hljs-number\"\u003e404\u003c/span\u003e, detail=\u003cspan class=\"hljs-string\"\u003e\"Todo를 찾을 수 없습니다.\"\u003c/span\u003e)\n\n    def \u003cspan class=\"hljs-title function_\"\u003edelete_todo\u003c/span\u003e(self, \u003cspan class=\"hljs-attr\"\u003etodo_id\u003c/span\u003e: int):\n        \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e index, todo \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eenumerate\u003c/span\u003e(self.\u003cspan class=\"hljs-property\"\u003etodos\u003c/span\u003e):\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e todo.\u003cspan class=\"hljs-property\"\u003eid\u003c/span\u003e == \u003cspan class=\"hljs-attr\"\u003etodo_id\u003c/span\u003e:\n                del self.\u003cspan class=\"hljs-property\"\u003etodos\u003c/span\u003e[index]\n                \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\u003cspan class=\"hljs-string\"\u003e\"message\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Todo가 성공적으로 삭제되었습니다.\"\u003c/span\u003e}\n        raise \u003cspan class=\"hljs-title class_\"\u003eHTTPException\u003c/span\u003e(status_code=\u003cspan class=\"hljs-number\"\u003e404\u003c/span\u003e, detail=\u003cspan class=\"hljs-string\"\u003e\"Todo를 찾을 수 없습니다.\"\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003etodo_router.py 파일을 업데이트하여 컨트롤러를 사용하십시오.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e fastapi \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eAPIRouter\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e controllers.\u003cspan class=\"hljs-property\"\u003etodo_controller\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTodoController\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eTodoCreate\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eTodo\u003c/span\u003e\n\nrouter = \u003cspan class=\"hljs-title class_\"\u003eAPIRouter\u003c/span\u003e()\ntodo_controller = \u003cspan class=\"hljs-title class_\"\u003eTodoController\u003c/span\u003e()\n\n@router.\u003cspan class=\"hljs-title function_\"\u003epost\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"/todos\"\u003c/span\u003e, response_model=\u003cspan class=\"hljs-title class_\"\u003eTodo\u003c/span\u003e)\ndef \u003cspan class=\"hljs-title function_\"\u003ecreate_todo\u003c/span\u003e(\u003cspan class=\"hljs-attr\"\u003etodo\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eTodoCreate\u003c/span\u003e):\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e todo_controller.\u003cspan class=\"hljs-title function_\"\u003ecreate_todo\u003c/span\u003e(todo)\n\n@router.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"/todos\"\u003c/span\u003e, response_model=list[\u003cspan class=\"hljs-title class_\"\u003eTodo\u003c/span\u003e])\ndef \u003cspan class=\"hljs-title function_\"\u003eget_todos\u003c/span\u003e():\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e todo_controller.\u003cspan class=\"hljs-title function_\"\u003eget_todos\u003c/span\u003e()\n\n@router.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"/todos/{todo_id}\"\u003c/span\u003e, response_model=\u003cspan class=\"hljs-title class_\"\u003eTodo\u003c/span\u003e)\ndef \u003cspan class=\"hljs-title function_\"\u003eget_todo\u003c/span\u003e(\u003cspan class=\"hljs-attr\"\u003etodo_id\u003c/span\u003e: int):\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e todo_controller.\u003cspan class=\"hljs-title function_\"\u003eget_todo\u003c/span\u003e(todo_id)\n\n@router.\u003cspan class=\"hljs-title function_\"\u003eput\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"/todos/{todo_id}\"\u003c/span\u003e, response_model=\u003cspan class=\"hljs-title class_\"\u003eTodo\u003c/span\u003e)\ndef \u003cspan class=\"hljs-title function_\"\u003eupdate_todo\u003c/span\u003e(\u003cspan class=\"hljs-attr\"\u003etodo_id\u003c/span\u003e: int, \u003cspan class=\"hljs-attr\"\u003eupdated_todo\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eTodoCreate\u003c/span\u003e):\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e todo_controller.\u003cspan class=\"hljs-title function_\"\u003eupdate_todo\u003c/span\u003e(todo_id, updated_todo)\n\n@router.\u003cspan class=\"hljs-title function_\"\u003edelete\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"/todos/{todo_id}\"\u003c/span\u003e)\ndef \u003cspan class=\"hljs-title function_\"\u003edelete_todo\u003c/span\u003e(\u003cspan class=\"hljs-attr\"\u003etodo_id\u003c/span\u003e: int):\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e todo_controller.\u003cspan class=\"hljs-title function_\"\u003edelete_todo\u003c/span\u003e(todo_id)\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e서비스 레이어 구현\u003c/h2\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e이제 비즈니스 로직을 처리하는 서비스 레이어를 소개해 봅시다.\u003c/p\u003e\n\u003cp\u003eservices 라는 새 디렉토리를 만들고 todo_service.py 라는 파일을 추가해 주세요.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pydantic \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eBaseModel\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTodoCreate\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eBaseModel\u003c/span\u003e):\n    \u003cspan class=\"hljs-attr\"\u003etitle\u003c/span\u003e: str\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTodo\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eTodoCreate\u003c/span\u003e):\n    \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e: int\n    \u003cspan class=\"hljs-attr\"\u003ecompleted\u003c/span\u003e: bool = \u003cspan class=\"hljs-title class_\"\u003eFalse\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTodoService\u003c/span\u003e:\n    def \u003cspan class=\"hljs-title function_\"\u003e__init__\u003c/span\u003e(self):\n        self.\u003cspan class=\"hljs-property\"\u003etodos\u003c/span\u003e = []\n\n    def \u003cspan class=\"hljs-title function_\"\u003ecreate_todo\u003c/span\u003e(self, \u003cspan class=\"hljs-attr\"\u003etodo\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eTodoCreate\u003c/span\u003e) -\u003e \u003cspan class=\"hljs-title class_\"\u003eTodo\u003c/span\u003e:\n        new_todo = \u003cspan class=\"hljs-title class_\"\u003eTodo\u003c/span\u003e(id=\u003cspan class=\"hljs-title function_\"\u003elen\u003c/span\u003e(self.\u003cspan class=\"hljs-property\"\u003etodos\u003c/span\u003e) + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, **todo.\u003cspan class=\"hljs-title function_\"\u003emodel_dump\u003c/span\u003e())\n        self.\u003cspan class=\"hljs-property\"\u003etodos\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eappend\u003c/span\u003e(new_todo)\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e new_todo\n\n    def \u003cspan class=\"hljs-title function_\"\u003eget_todos\u003c/span\u003e(self) -\u003e list[\u003cspan class=\"hljs-title class_\"\u003eTodo\u003c/span\u003e]:\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e self.\u003cspan class=\"hljs-property\"\u003etodos\u003c/span\u003e\n\n    def \u003cspan class=\"hljs-title function_\"\u003eget_todo\u003c/span\u003e(self, \u003cspan class=\"hljs-attr\"\u003etodo_id\u003c/span\u003e: int) -\u003e \u003cspan class=\"hljs-title class_\"\u003eTodo\u003c/span\u003e | \u003cspan class=\"hljs-title class_\"\u003eNone\u003c/span\u003e:\n        \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e todo \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e self.\u003cspan class=\"hljs-property\"\u003etodos\u003c/span\u003e:\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e todo.\u003cspan class=\"hljs-property\"\u003eid\u003c/span\u003e == \u003cspan class=\"hljs-attr\"\u003etodo_id\u003c/span\u003e:\n                \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e todo\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eNone\u003c/span\u003e\n\n    def \u003cspan class=\"hljs-title function_\"\u003eupdate_todo\u003c/span\u003e(self, \u003cspan class=\"hljs-attr\"\u003etodo_id\u003c/span\u003e: int, \u003cspan class=\"hljs-attr\"\u003eupdated_todo\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eTodoCreate\u003c/span\u003e) -\u003e \u003cspan class=\"hljs-title class_\"\u003eTodo\u003c/span\u003e | \u003cspan class=\"hljs-title class_\"\u003eNone\u003c/span\u003e:\n        \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e todo \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e self.\u003cspan class=\"hljs-property\"\u003etodos\u003c/span\u003e:\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e todo.\u003cspan class=\"hljs-property\"\u003eid\u003c/span\u003e == \u003cspan class=\"hljs-attr\"\u003etodo_id\u003c/span\u003e:\n                todo.\u003cspan class=\"hljs-property\"\u003etitle\u003c/span\u003e = updated_todo.\u003cspan class=\"hljs-property\"\u003etitle\u003c/span\u003e\n                \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e todo\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eNone\u003c/span\u003e\n\n    def \u003cspan class=\"hljs-title function_\"\u003edelete_todo\u003c/span\u003e(self, \u003cspan class=\"hljs-attr\"\u003etodo_id\u003c/span\u003e: int) -\u003e \u003cspan class=\"hljs-attr\"\u003ebool\u003c/span\u003e:\n        \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e index, todo \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eenumerate\u003c/span\u003e(self.\u003cspan class=\"hljs-property\"\u003etodos\u003c/span\u003e):\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e todo.\u003cspan class=\"hljs-property\"\u003eid\u003c/span\u003e == \u003cspan class=\"hljs-attr\"\u003etodo_id\u003c/span\u003e:\n                del self.\u003cspan class=\"hljs-property\"\u003etodos\u003c/span\u003e[index]\n                \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTrue\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eFalse\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003etodo_controller.py를 업데이트하여 서비스를 사용하도록합니다.\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e fastapi \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eHTTPException\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e services.\u003cspan class=\"hljs-property\"\u003etodo_service\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTodoService\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eTodoCreate\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eTodo\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTodoController\u003c/span\u003e:\n    def \u003cspan class=\"hljs-title function_\"\u003e__init__\u003c/span\u003e(self):\n        self.\u003cspan class=\"hljs-property\"\u003etodo_service\u003c/span\u003e = \u003cspan class=\"hljs-title class_\"\u003eTodoService\u003c/span\u003e()\n\n    def \u003cspan class=\"hljs-title function_\"\u003ecreate_todo\u003c/span\u003e(self, \u003cspan class=\"hljs-attr\"\u003etodo\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eTodoCreate\u003c/span\u003e):\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e self.\u003cspan class=\"hljs-property\"\u003etodo_service\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ecreate_todo\u003c/span\u003e(todo)\n\n    def \u003cspan class=\"hljs-title function_\"\u003eget_todos\u003c/span\u003e(self):\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e self.\u003cspan class=\"hljs-property\"\u003etodo_service\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eget_todos\u003c/span\u003e()\n\n    def \u003cspan class=\"hljs-title function_\"\u003eget_todo\u003c/span\u003e(self, \u003cspan class=\"hljs-attr\"\u003etodo_id\u003c/span\u003e: int):\n        todo = self.\u003cspan class=\"hljs-property\"\u003etodo_service\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eget_todo\u003c/span\u003e(todo_id)\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e todo is \u003cspan class=\"hljs-title class_\"\u003eNone\u003c/span\u003e:\n            raise \u003cspan class=\"hljs-title class_\"\u003eHTTPException\u003c/span\u003e(status_code=\u003cspan class=\"hljs-number\"\u003e404\u003c/span\u003e, detail=\u003cspan class=\"hljs-string\"\u003e\"할 일을 찾을 수 없습니다\"\u003c/span\u003e)\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e todo\n\n    def \u003cspan class=\"hljs-title function_\"\u003eupdate_todo\u003c/span\u003e(self, \u003cspan class=\"hljs-attr\"\u003etodo_id\u003c/span\u003e: int, \u003cspan class=\"hljs-attr\"\u003eupdated_todo\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eTodoCreate\u003c/span\u003e):\n        todo = self.\u003cspan class=\"hljs-property\"\u003etodo_service\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eupdate_todo\u003c/span\u003e(todo_id, updated_todo)\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e todo is \u003cspan class=\"hljs-title class_\"\u003eNone\u003c/span\u003e:\n            raise \u003cspan class=\"hljs-title class_\"\u003eHTTPException\u003c/span\u003e(status_code=\u003cspan class=\"hljs-number\"\u003e404\u003c/span\u003e, detail=\u003cspan class=\"hljs-string\"\u003e\"할 일을 찾을 수 없습니다\"\u003c/span\u003e)\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e todo\n\n    def \u003cspan class=\"hljs-title function_\"\u003edelete_todo\u003c/span\u003e(self, \u003cspan class=\"hljs-attr\"\u003etodo_id\u003c/span\u003e: int):\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e self.\u003cspan class=\"hljs-property\"\u003etodo_service\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003edelete_todo\u003c/span\u003e(todo_id):\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\u003cspan class=\"hljs-string\"\u003e\"message\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"할 일이 성공적으로 삭제되었습니다\"\u003c/span\u003e}\n        raise \u003cspan class=\"hljs-title class_\"\u003eHTTPException\u003c/span\u003e(status_code=\u003cspan class=\"hljs-number\"\u003e404\u003c/span\u003e, detail=\u003cspan class=\"hljs-string\"\u003e\"할 일을 찾을 수 없습니다\"\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e레포지터리 레이어 생성\u003c/h2\u003e\n\u003cp\u003e마지막으로 데이터 지속성을 처리하는 레포지터리 레이어를 소개합니다.\u003c/p\u003e\n\u003cp\u003erepositories라는 새 디렉토리를 만들고 todo_repository.py라는 파일을 추가하세요.\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pydantic \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e BaseModel\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTodoCreate\u003c/span\u003e(\u003cspan class=\"hljs-title class_ inherited__\"\u003eBaseModel\u003c/span\u003e):\n    title: \u003cspan class=\"hljs-built_in\"\u003estr\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTodo\u003c/span\u003e(\u003cspan class=\"hljs-title class_ inherited__\"\u003eTodoCreate\u003c/span\u003e):\n    \u003cspan class=\"hljs-built_in\"\u003eid\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003eint\u003c/span\u003e\n    completed: \u003cspan class=\"hljs-built_in\"\u003ebool\u003c/span\u003e = \u003cspan class=\"hljs-literal\"\u003eFalse\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTodoRepository\u003c/span\u003e:\n    \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003e__init__\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself\u003c/span\u003e):\n        self.todos = []\n\n    \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003ecreate_todo\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself, todo: TodoCreate\u003c/span\u003e) -\u003e Todo:\n        new_todo = Todo(\u003cspan class=\"hljs-built_in\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-built_in\"\u003elen\u003c/span\u003e(self.todos) + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, **todo.model_dump())\n        self.todos.append(new_todo)\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e new_todo\n\n    \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eget_todos\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself\u003c/span\u003e) -\u003e \u003cspan class=\"hljs-built_in\"\u003elist\u003c/span\u003e[Todo]:\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e self.todos\n\n    \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eget_todo\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself, todo_id: \u003cspan class=\"hljs-built_in\"\u003eint\u003c/span\u003e\u003c/span\u003e) -\u003e Todo | \u003cspan class=\"hljs-literal\"\u003eNone\u003c/span\u003e:\n        \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e todo \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e self.todos:\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e todo.\u003cspan class=\"hljs-built_in\"\u003eid\u003c/span\u003e == todo_id:\n                \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e todo\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003eNone\u003c/span\u003e\n\n    \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eupdate_todo\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself, todo_id: \u003cspan class=\"hljs-built_in\"\u003eint\u003c/span\u003e, updated_todo: TodoCreate\u003c/span\u003e) -\u003e Todo | \u003cspan class=\"hljs-literal\"\u003eNone\u003c/span\u003e:\n        \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e todo \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e self.todos:\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e todo.\u003cspan class=\"hljs-built_in\"\u003eid\u003c/span\u003e == todo_id:\n                todo.title = updated_todo.title\n                \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e todo\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003eNone\u003c/span\u003e\n\n    \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003edelete_todo\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself, todo_id: \u003cspan class=\"hljs-built_in\"\u003eint\u003c/span\u003e\u003c/span\u003e) -\u003e \u003cspan class=\"hljs-built_in\"\u003ebool\u003c/span\u003e:\n        \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e index, todo \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eenumerate\u003c/span\u003e(self.todos):\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e todo.\u003cspan class=\"hljs-built_in\"\u003eid\u003c/span\u003e == todo_id:\n                \u003cspan class=\"hljs-keyword\"\u003edel\u003c/span\u003e self.todos[index]\n                \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003eTrue\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003eFalse\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eUpdate \u003ccode\u003etodo_service.py\u003c/code\u003e to use the repository,\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e repositories.todo_repository \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e TodoRepository, TodoCreate, Todo\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTodoService\u003c/span\u003e:\n    \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003e__init__\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself\u003c/span\u003e):\n        self.todo_repository = TodoRepository()\n\n    \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003ecreate_todo\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself, todo: TodoCreate\u003c/span\u003e) -\u003e Todo:\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e self.todo_repository.create_todo(todo)\n\n    \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eget_todos\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself\u003c/span\u003e) -\u003e \u003cspan class=\"hljs-built_in\"\u003elist\u003c/span\u003e[Todo]:\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e self.todo_repository.get_todos()\n\n    \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eget_todo\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself, todo_id: \u003cspan class=\"hljs-built_in\"\u003eint\u003c/span\u003e\u003c/span\u003e) -\u003e Todo | \u003cspan class=\"hljs-literal\"\u003eNone\u003c/span\u003e:\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e self.todo_repository.get_todo(todo_id)\n\n    \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eupdate_todo\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself, todo_id: \u003cspan class=\"hljs-built_in\"\u003eint\u003c/span\u003e, updated_todo: TodoCreate\u003c/span\u003e) -\u003e Todo | \u003cspan class=\"hljs-literal\"\u003eNone\u003c/span\u003e:\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e self.todo_repository.update_todo(todo_id, updated_todo)\n\n    \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003edelete_todo\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself, todo_id: \u003cspan class=\"hljs-built_in\"\u003eint\u003c/span\u003e\u003c/span\u003e) -\u003e \u003cspan class=\"hljs-built_in\"\u003ebool\u003c/span\u003e:\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e self.todo_repository.delete_todo(todo_id)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e우리의 리팩터링 여정은 여기서 끝납니다…\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e파이썬 앱.py에서 구조화된 모듈 아키텍처로 이어지는 이 여정에서, 우리는 Todo API를 더 확장 가능하고 유지 관리 가능한 애플리케이션으로 변형시켰습니다. 라우터, 컨트롤러, 서비스 및 리포지토리를 도입함으로써, 우리는 관심사의 명확한 분리와 프로젝트 확장에 따른 복잡성 관리 능력을 향상시켰습니다.\u003c/p\u003e\n\u003ch2\u003e모듈식 아키텍처의 주요 이점:\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e향상된 유지 보수성: 각 컴포넌트 - 라우터, 컨트롤러, 서비스 및 리포지토리 -는 이제 특정 책임을 처리하여 변경 시 의도치 않은 부작용의 위험을 줄입니다.\u003c/li\u003e\n\u003cli\u003e향상된 테스트 용이성: 각 레이어가 명확하게 구분되어 유닛 테스트가 보다 간편해집니다. 우리는 각 컴포넌트를 독립적으로 테스트하여 응용 프로그램 전체에서 견고함과 신뢰성을 보장할 수 있습니다.\u003c/li\u003e\n\u003cli\u003e확장성과 유연성: 모듈식 디자인은 확장을 용이하게 합니다. 새로운 기능을 추가하거나 기존 기능을 수정할 때 전체 코드베이스를 철저히 재작업하지 않고도 수행할 수 있습니다. 이 유연성은 데이터베이스 전환이나 비즈니스 로직 업데이트와 같은 작업에도 연결됩니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e우리의 리포지토리는 이제 다음과 같이 보입니다...\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e\u003ccode\u003e\u0026#x3C;img src=\"/TIL/assets/img/2024-07-09-FastAPIFromApppytoaModularArchitecture_3.png\" /\u003e\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eFastAPI 애플리케이션을 모듈식 아키텍처로 리팩토링함으로써, 지속적인 성장과 유연성을 위한 견고한 기반을 마련했습니다. 이 접근 방식은 현재 개발 노력을 향상시킬 뿐만 아니라 앞으로의 도전과 기회에 대비하는 데 도움이 됩니다.\u003c/p\u003e\n\u003cp\u003e안녕히 가세요!!\u003c/p\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-07-09-FastAPIFromApppytoaModularArchitecture"},"buildId":"FuXRqV9h16krA5Mvtd6Dn","assetPrefix":"/TIL","isFallback":false,"gsp":true,"scriptLoader":[{"async":true,"src":"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4877378276818686","strategy":"lazyOnload","crossOrigin":"anonymous"}]}</script></body></html>