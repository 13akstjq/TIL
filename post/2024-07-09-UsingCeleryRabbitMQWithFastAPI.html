<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>FastAPIì—ì„œ Celeryì™€ RabbitMQ ì‚¬ìš© ë°©ë²• | TIL</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://13akstjq.github.io/TIL//post/2024-07-09-UsingCeleryRabbitMQWithFastAPI" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="FastAPIì—ì„œ Celeryì™€ RabbitMQ ì‚¬ìš© ë°©ë²• | TIL" data-gatsby-head="true"/><meta property="og:title" content="FastAPIì—ì„œ Celeryì™€ RabbitMQ ì‚¬ìš© ë°©ë²• | TIL" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-07-09-UsingCeleryRabbitMQWithFastAPI_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://TIL.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://13akstjq.github.io/TIL//post/2024-07-09-UsingCeleryRabbitMQWithFastAPI" data-gatsby-head="true"/><meta name="twitter:title" content="FastAPIì—ì„œ Celeryì™€ RabbitMQ ì‚¬ìš© ë°©ë²• | TIL" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-07-09-UsingCeleryRabbitMQWithFastAPI_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | TIL" data-gatsby-head="true"/><meta name="article:published_time" content="2024-07-09 19:19" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/TIL/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/TIL/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/TIL/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/TIL/favicons/favicon-96x96.png"/><link rel="icon" href="/TIL/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/TIL/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/TIL/favicons/browserconfig.xml"/><link rel="preload" href="/TIL/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/TIL/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/TIL/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/TIL/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/TIL/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/TIL/_next/static/chunks/webpack-21ffe88bdca56cba.js" defer=""></script><script src="/TIL/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/TIL/_next/static/chunks/main-a5eeabb286676ce6.js" defer=""></script><script src="/TIL/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/TIL/_next/static/chunks/75fc9c18-4a646156c659a948.js" defer=""></script><script src="/TIL/_next/static/chunks/348-02483b66b493dd81.js" defer=""></script><script src="/TIL/_next/static/chunks/pages/post/%5Bslug%5D-8ded8b979ba73586.js" defer=""></script><script src="/TIL/_next/static/N1mNhRlQaHCliEGDvPEpG/_buildManifest.js" defer=""></script><script src="/TIL/_next/static/N1mNhRlQaHCliEGDvPEpG/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/TIL">TIL</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/TIL/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">FastAPIì—ì„œ Celeryì™€ RabbitMQ ì‚¬ìš© ë°©ë²•</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="FastAPIì—ì„œ Celeryì™€ RabbitMQ ì‚¬ìš© ë°©ë²•" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/TIL/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">TIL</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On Jul 9, 2024</span><span class="posts_reading_time__f7YPP">10<!-- --> min read</span></span></div></div></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<p><img src="/TIL/assets/img/2024-07-09-UsingCeleryRabbitMQWithFastAPI_0.png" alt="í‘œ"></p>
<p>ì•ˆë…•í•˜ì„¸ìš”, ìš°ì£¼ ì—¬ëŸ¬ë¶„! ì˜¤ëŠ˜ì€ Celery + RabbitMQì™€ FastAPIë¥¼ ì‚¬ìš©í•œ ìµœê·¼ ê²½í—˜ì„ ê³µìœ í•˜ë ¤ê³  í•©ë‹ˆë‹¤. ìµœê·¼ì— ì˜¤ë””ì˜¤ ë¶„ì„ ê´€ë ¨ í”„ë¡œì íŠ¸ë¥¼ í•˜ê³  ìˆì—ˆì–´ìš”. ì´ í”„ë¡œì íŠ¸ì—ì„œ ì¼ë¶€ ì‘ì—…ì€ ì™„ë£Œí•˜ëŠ” ë° ì¡°ê¸ˆ ì‹œê°„ì´ ê±¸ë ¸ì–´ìš”. ë”°ë¼ì„œ í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ì— ìš”ì²­ì„ ë³´ë‚´ë©´ ì´ëŸ¬í•œ ì‘ì—… ë•Œë¬¸ì— ì„œë²„ê°€ ì ì‹œ ë°”ì  ê±°ì˜ˆìš”. ê·¸ë˜ì„œ í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µì„ ë³´ë‚´ëŠ” ë° ìƒë‹¹í•œ ì‹œê°„ì´ ì†Œìš”ë˜ì—ˆì£ . ì´ ìƒí™©ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‘ì—…ì„ ì‹¤í–‰í•˜ëŠ” ë°©ë²•ì„ ì°¾ì•˜ì–´ìš”. ê²°êµ­ í•´ê²°ì±…ì¸ Celery â€” ë¶„ì‚° ì‘ì—… íë¥¼ ì°¾ì•˜ê³ , ì´ ê¸€ì—ì„œëŠ” ì–´ë–»ê²Œ Celeryë¥¼ ì‚¬ìš©í•´ ëª©í‘œë¥¼ ì´ë£¨ì—ˆëŠ”ì§€ ì„¤ëª…í•  ê±°ì˜ˆìš”.</p>
<p>CeleryëŠ” ì‹¤ì‹œê°„ ì²˜ë¦¬ë¥¼ ì§€ì›í•˜ëŠ” ì‘ì—… íì´ë©° ì‘ì—… ìŠ¤ì¼€ì¤„ë§ë„ ì§€ì›í•´ìš”. ê°„ë‹¨íˆ ë§í•´, ì„œë²„ê°€ ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¬ëŠ” ì‘ì—…ì— ëŒ€í•œ ìš”ì²­ì„ ë°›ìœ¼ë©´ í•´ë‹¹ ì‘ì—…ì„ Celery ì‘ì—… íì— ì¶”ê°€í•˜ê³  ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰ë  ê±°ì˜ˆìš”. CeleryëŠ” ì‘ì—…ì˜ ìƒíƒœë¥¼ ìœ ì§€í•˜ëŠ”ë°, ëŒ€ê¸° ì¤‘ì¸ì§€, ì‹œì‘ëœ ìƒíƒœì¸ì§€, ì„±ê³µì ì¸ì§€ ë“±ì„ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”. Celeryì—ëŠ” ë©”ì‹œì§€ ë¸Œë¡œì»¤ ì„œë¹„ìŠ¤ê°€ í•„ìš”í•´ìš”. ì„œë²„(ì£¼ ì–´í”Œë¦¬ì¼€ì´ì…˜)ê°€ ì‘ì—…ì„ ìœ„í•´ ìš”ì²­ì„ ë°›ìœ¼ë©´, celery ì›Œì»¤ê°€ ì´ìš© ê°€ëŠ¥í•  ë•Œê¹Œì§€ ì‘ì—…ì€ ì‘ì—… íì— ìˆì–´ì•¼ í•´ìš”. ì›Œì»¤ê°€ ì‚¬ìš© ê°€ëŠ¥í•˜ë©´ ë©”ì‹œì§€ íì—ì„œ ì‘ì—…ì„ ì‹¤í–‰í•  ê±°ì˜ˆìš”. RabbitMQëŠ” celeryì˜ ê¸°ë³¸ ë©”ì‹œì§€ ë¸Œë¡œì»¤ì¸ë°, Redis, Amazon SQS, Apache Kafkaì™€ ê°™ì€ ë‹¤ë¥¸ ì†”ë£¨ì…˜ì´ ìˆì–´ìš”. ì €ëŠ” ì´ë¥¼ ê°€ì¥ ê°„ë‹¨í•˜ê²Œ í•˜ê³ ì RabbitMQë¥¼ ì‚¬ìš©í–ˆì–´ìš”. ì´ ì• ë‹ˆë©”ì´ì…˜ ë™ì˜ìƒì—ì„œ ì´ ì‘ì—…ì´ ì–´ë–»ê²Œ ì´ë£¨ì–´ì§€ëŠ”ì§€ ì„¤ëª…í•©ë‹ˆë‹¤.</p>
<h1>êµ¬í˜„</h1>
<!-- TIL ìˆ˜í‰ -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>ë¨¼ì € RabbitMQë¥¼ ì„¤ì •í•´ ë´…ì‹œë‹¤. í”„ë¡œì íŠ¸ë¥¼ ê°œë°œí•˜ëŠ” í™˜ê²½ì€ Windowsë¥¼ ì‚¬ìš©í•˜ê³  ìˆì–´ìš”. RabbitMQë¥¼ ì„¤ì •í•˜ê¸° ìœ„í•´ì„œ Docker ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ê³  ìˆì–´ìš”. ì›í•˜ì‹ ë‹¤ë©´ Docker ëŒ€ì‹ ì— RabbitMQë¥¼ ì„¤ì¹˜í•  ìˆ˜ë„ ìˆì–´ìš”.</p>
<pre><code class="hljs language-js">docker run -p <span class="hljs-number">15672</span>:<span class="hljs-number">15672</span> -p <span class="hljs-number">5672</span>:<span class="hljs-number">5672</span> <span class="hljs-attr">rabbitmq</span>:<span class="hljs-number">3</span>-management
</code></pre>
<p>Docker ì»¨í…Œì´ë„ˆê°€ ì‹œì‘ë˜ë©´, ë¸Œë¼ìš°ì €ë¥¼ í†µí•´ 127.0.0.1:5672ë¡œ RabbitMQ ëŒ€ì‹œë³´ë“œì— ë¡œê·¸ì¸í•  ìˆ˜ ìˆì–´ìš”. ì‚¬ìš©ì ì´ë¦„ê³¼ ë¹„ë°€ë²ˆí˜¸ëŠ” ëª¨ë‘ 'guest'ì—ìš”.</p>
<img src="/TIL/assets/img/2024-07-09-UsingCeleryRabbitMQWithFastAPI_1.png">
<!-- TIL ìˆ˜í‰ -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>ì´ì œ Celeryë¥¼ ì„¤ì¹˜í•˜ê³  ì„¤ì •í•´ ë´…ì‹œë‹¤. ë‹¤ìŒ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•˜ì„¸ìš”. ì €ëŠ” python-dotenv ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ .env íŒŒì¼ì—ì„œ ë³´ì•ˆ ì •ë³´ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
<pre><code class="hljs language-js">pip install celery python-dotenv
</code></pre>
<p>ë‚´ FastAPI í”„ë¡œì íŠ¸ëŠ” ì´ì™€ ìœ ì‚¬í•œ í´ë” êµ¬ì¡°ë¥¼ ê°€ì§€ê³  ìˆì–´ìš”.</p>
<pre><code class="hljs language-js">app/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ __init__.<span class="hljs-property">py</span>
â”‚   â””â”€â”€ celery_config.<span class="hljs-property">py</span>
â”œâ”€â”€ tasks/
â”‚   â”œâ”€â”€ __init__.<span class="hljs-property">py</span>
â”‚   â””â”€â”€ celery_tasks.<span class="hljs-property">py</span>
â”œâ”€â”€ __init__.<span class="hljs-property">py</span>
â”œâ”€â”€ main.<span class="hljs-property">py</span>
â”œâ”€â”€ .<span class="hljs-property">env</span>
â””â”€â”€ requirements.<span class="hljs-property">txt</span>
</code></pre>
<!-- TIL ìˆ˜í‰ -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>ë¨¼ì €, .env íŒŒì¼ì—ì„œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ë§Œë“¤ì–´ë´…ì‹œë‹¤. Celeryì—ëŠ” ë‘ ê°€ì§€ê°€ í•„ìš”í•©ë‹ˆë‹¤. ì²« ë²ˆì§¸ëŠ” ë©”ì‹œì§€ ë¸Œë¡œì»¤ URLì…ë‹ˆë‹¤. ì œ ê²½ìš°ì—ëŠ” RabbitMQ ì„œë²„ URLì…ë‹ˆë‹¤. (<code>USERNAME</code>, <code>PASSWORD</code>ë¥¼ êµì²´í•˜ì—¬ ì‚¬ìš©ìëª…ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. ê¸°ë³¸ê°’ì€ guestì…ë‹ˆë‹¤.) ë‘ ë²ˆì§¸ëŠ” ê²°ê³¼ ë°±ì—”ë“œì…ë‹ˆë‹¤. Celeryê°€ ì‘ì—… ì‹¤í–‰ ê²°ê³¼ë¥¼ ì €ì¥í•˜ëŠ” ê³³ìœ¼ë¡œ, ì‘ì—…ì„ ì™„ë£Œí•œ í›„ì— ì´ ê²°ê³¼ë¥¼ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<pre><code class="hljs language-js"><span class="hljs-variable constant_">CELERY_BROKER_URL</span>=<span class="hljs-attr">amqp</span>:<span class="hljs-comment">//&#x3C;USERNAME>:&#x3C;PASSWORD>@localhost:5672//</span>
<span class="hljs-variable constant_">CELERY_RESULT_BACKEND</span>=<span class="hljs-attr">rpc</span>:<span class="hljs-comment">//</span>
</code></pre>
<p>ì¢‹ì•„ìš”. ì´ì œ Celery ì•±ì„ ìƒì„±í•˜ê³  êµ¬ì„±í•´ë´…ì‹œë‹¤. ì´ë¥¼ ìœ„í•´ celery_config.py íŒŒì¼ì„ ë§Œë“¤ê² ìŠµë‹ˆë‹¤.</p>
<pre><code class="hljs language-js"># celery_config.<span class="hljs-property">py</span>
# ë³„ë„ì˜ íŒŒì¼ì—ì„œ celery ì‘ì—…ì„ ì •ì˜í•˜ê¸° ìœ„í•œ êµ¬ì„±.
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> celery <span class="hljs-keyword">import</span> <span class="hljs-title class_">Celery</span>
<span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv

<span class="hljs-title function_">load_dotenv</span>() # í™˜ê²½ ë³€ìˆ˜ë¥¼ ë¶ˆëŸ¬ì˜¤ê¸° ìœ„í•œ ì½”ë“œ

celery_app = <span class="hljs-title class_">Celery</span>(__name__, broker=os.<span class="hljs-title function_">getenv</span>(<span class="hljs-string">"CELERY_BROKER_URL"</span>), backend=os.<span class="hljs-title function_">getenv</span>(<span class="hljs-string">"CELERY_RESULT_BACKEND"</span>))

celery_app.<span class="hljs-property">conf</span>.<span class="hljs-title function_">update</span>(
    imports=[<span class="hljs-string">'app.tasks.celery_tasks'</span>], # celery ì‘ì—… íŒŒì¼ ê²½ë¡œ
    broker_connection_retry_on_startup=<span class="hljs-title class_">True</span>,
    task_track_started=<span class="hljs-title class_">True</span>
)
</code></pre>
<!-- TIL ìˆ˜í‰ -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>ë¶„ë¦¬ëœ íŒŒì¼ì„ ë§Œë“¤ì–´ Celery ì‘ì—…ì„ ì •ì˜í–ˆì–´ìš”. í•˜ì§€ë§Œ ê·¸ê±´ ê¼­ í•„ìš”í•˜ì§€ ì•Šì•„ìš”. ì´ íŒŒì¼ ì•ˆì— ì‘ì—…ë“¤ì„ ì •ì˜í•  ìˆ˜ ìˆì–´ìš”. ë§Œì•½ ì´ íŒŒì¼ ì•ˆì— ì‘ì—…ì„ ì •ì˜í•œë‹¤ë©´, imports=['app.tasks.celery_tasks'] ë¼ì¸ì„ ì¶”ê°€í•  í•„ìš”ê°€ ì—†ì–´ìš”. ë”°ë¼ì„œ, ë‹¹ì‹ ì˜ êµ¬ì„±ì€ ì´ëŸ° ì‹ì´ì—ìš”.</p>
<pre><code class="hljs language-js"># celery_config.<span class="hljs-property">py</span>
# ì´ íŒŒì¼ ì•ˆì— <span class="hljs-title class_">Celery</span> ì‘ì—…ì„ ì •ì˜í•˜ê¸° ìœ„í•œ êµ¬ì„±.
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> celery <span class="hljs-keyword">import</span> <span class="hljs-title class_">Celery</span>
<span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv

<span class="hljs-title function_">load_dotenv</span>() # í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ

celery_app = <span class="hljs-title class_">Celery</span>(__name__, broker=os.<span class="hljs-title function_">getenv</span>(<span class="hljs-string">"CELERY_BROKER_URL"</span>), backend=os.<span class="hljs-title function_">getenv</span>(<span class="hljs-string">"CELERY_RESULT_BACKEND"</span>))

celery_app.<span class="hljs-property">conf</span>.<span class="hljs-title function_">update</span>(
    broker_connection_retry_on_startup=<span class="hljs-title class_">True</span>,
    task_track_started=<span class="hljs-title class_">True</span>
)
</code></pre>
<p>ì´ì œ Celery ì‘ì—…ì„ ë§Œë“¤ì–´ë´ìš”. celery_tasks.py íŒŒì¼ì„ ë§Œë“¤ê³  ê·¸ ì•ˆì— ì‘ì—…ë“¤ì„ ì •ì˜í–ˆì–´ìš”. Celery ì‘ì—…ì„ ì •ì˜í•˜ê¸° ìœ„í•´ ë°ì½”ë ˆì´í„°ë¥¼ ì‚¬ìš©í•´ìš”.</p>
<pre><code class="hljs language-js"># celery_tasks.<span class="hljs-property">py</span>
<span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">from</span> app.<span class="hljs-property">config</span>.<span class="hljs-property">celery_config</span> <span class="hljs-keyword">import</span> celery_app


@celery_app.<span class="hljs-property">task</span>
def <span class="hljs-title function_">my_task</span>(x, y):
    ans = x + y
    <span class="hljs-title function_">print</span>(ans)
    <span class="hljs-keyword">return</span> ans


<span class="hljs-keyword">async</span> def <span class="hljs-title function_">my_async_task</span>(x, y):
    <span class="hljs-keyword">await</span> asyncio.<span class="hljs-title function_">sleep</span>(<span class="hljs-number">3</span>)
    ans = x + y
    <span class="hljs-title function_">print</span>(ans)
    <span class="hljs-keyword">return</span> ans


@celery_app.<span class="hljs-property">task</span>
def <span class="hljs-title function_">my_second_task</span>(x, y):
    result = asyncio.<span class="hljs-title function_">run</span>(<span class="hljs-title function_">my_async_task</span>(x, y))
    <span class="hljs-keyword">return</span> result
</code></pre>
<!-- TIL ìˆ˜í‰ -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>ë³„ë„ì˜ íŒŒì¼ ëŒ€ì‹  ì´ëŸ¬í•œ ë°©ì‹ìœ¼ë¡œ êµ¬ì„± íŒŒì¼ ë‚´ì—ì„œ ì‘ì—…ì„ ì •ì˜í•  ìˆ˜ ìˆì–´ìš”.</p>
<pre><code class="hljs language-python"><span class="hljs-comment"># celery_config.py</span>
<span class="hljs-comment"># ì´ íŒŒì¼ ì•ˆì—ì„œ Celery ì‘ì—…ì„ ì •ì˜í•˜ëŠ” ì„¤ì •ì…ë‹ˆë‹¤.</span>
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">from</span> celery <span class="hljs-keyword">import</span> Celery
<span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv

load_dotenv() <span class="hljs-comment"># í™˜ê²½ ë³€ìˆ˜ë¥¼ ë¶ˆëŸ¬ì˜¤ê¸°</span>

celery_app = Celery(__name__, broker=os.getenv(<span class="hljs-string">"CELERY_BROKER_URL"</span>), backend=os.getenv(<span class="hljs-string">"CELERY_RESULT_BACKEND"</span>))

celery_app.conf.update(
    broker_connection_retry_on_startup=<span class="hljs-literal">True</span>,
    task_track_started=<span class="hljs-literal">True</span>
)

<span class="hljs-meta">@celery_app.task</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">my_task</span>(<span class="hljs-params">x, y</span>):
   ans = x + y
   <span class="hljs-built_in">print</span>(ans)
   <span class="hljs-keyword">return</span> ans

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">my_async_task</span>(<span class="hljs-params">x, y</span>):
   <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">3</span>)
   ans = x + y
   <span class="hljs-built_in">print</span>(ans)
   <span class="hljs-keyword">return</span> ans

<span class="hljs-meta">@celery_app.task</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">my_second_task</span>(<span class="hljs-params">x, y</span>):
   result = asyncio.run(my_async_task(x, y))
   <span class="hljs-keyword">return</span> result
</code></pre>
<p>ì´ì œ ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œ ì´ëŸ¬í•œ ì‘ì—…ì„ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”. ì•„ë˜ëŠ” ì˜ˆì‹œ ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ì…ë‹ˆë‹¤. ì—¬ê¸°ì„œ GET ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë§Œë“¤ì—ˆì–´ìš”. ì´ ì—”ë“œí¬ì¸íŠ¸ í•¸ë“¤ëŸ¬ ë‚´ë¶€ì—ì„œ Celery ì‘ì—…ì„ ì‚¬ìš©í•´ìš”.</p>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI

<span class="hljs-keyword">from</span> app.tasks.celery_tasks <span class="hljs-keyword">import</span> my_task

app = FastAPI()

<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/run"</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_run</span>():
   task_response = my_task.delay(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>)
   <span class="hljs-keyword">return</span> {<span class="hljs-string">"message"</span>: <span class="hljs-string">"ì‘ì—… ì‹¤í–‰ì´ ì‹œì‘ëì–´ìš”!"</span>}

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    uvicorn.run(app, port=<span class="hljs-number">8080</span>)
</code></pre>
<!-- TIL ìˆ˜í‰ -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>ì•Œê² ì–´ìš”. ì½”ë”© ë¶€ë¶„ì€ ëë‚¬ìŠµë‹ˆë‹¤. ì´ì œ ì„¸ëŸ´ë¦¬ ì›Œì»¤ë¥¼ ì‹¤í–‰í•´ë´…ì‹œë‹¤. ì´ ì„¸ëŸ´ë¦¬ ì›Œì»¤ëŠ” RabbitMQì˜ ë©”ì‹œì§€ ëŒ€ê¸°ì—´ì— ìˆëŠ” ì‘ì—…ì„ ì‹¤í–‰í•  ê²ƒì…ë‹ˆë‹¤. ë§Œì•½ RabbitMQ ì„œë²„ë¥¼ ì‹œì‘í•˜ì§€ ì•Šì•˜ë‹¤ë©´, ì„¸ëŸ´ë¦¬ ì›Œì»¤ë¥¼ ì‹œì‘í•˜ê¸° ì „ì— RabbitMQë¥¼ ì‹œì‘í•´ì£¼ì„¸ìš”.</p>
<pre><code class="hljs language-js">celery --app app.<span class="hljs-property">config</span>.<span class="hljs-property">celery_config</span>.<span class="hljs-property">celery_app</span> worker --loglevel=info --pool=solo
</code></pre>
<p>ë§Œì•½ ì„¸ëŸ´ë¦¬ê°€ ì–´ë– í•œ ì˜¤ë¥˜ ì—†ì´ ì‹¤í–‰ëœë‹¤ë©´, í„°ë¯¸ë„ì—ì„œ ë‹¤ìŒê³¼ ìœ ì‚¬í•œ ì¶œë ¥ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<img src="/TIL/assets/img/2024-07-09-UsingCeleryRabbitMQWithFastAPI_2.png">
<!-- TIL ìˆ˜í‰ -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>ìœ„ ì´ë¯¸ì§€ì—ì„œ [ì‘ì—…] ì„¹ì…˜ ì•„ë˜ì—ì„œ celery_tasks.py íŒŒì¼ì— ì •ì˜í•œ celery ì‘ì—…ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‘ì—… ëŒ€ê¸°ì—´ì´ ìƒˆ ì‘ì—…ì„ ë°›ìœ¼ë©´ celeryê°€ í•´ë‹¹ ì‘ì—…ì„ ì‹¤í–‰í•©ë‹ˆë‹¤. ì´ì œ FastAPI ì„œë²„ë¥¼ ì‹¤í–‰í•´ ë´…ì‹œë‹¤.</p>
<pre><code class="hljs language-js">uvicorn app.<span class="hljs-property">main</span>:app --port <span class="hljs-number">8000</span>
</code></pre>
<p>Swagger ë¬¸ì„œ í˜ì´ì§€ì—ì„œ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì‹œë„í•´ ë´…ì‹œë‹¤. ì—”ë“œí¬ì¸íŠ¸ì— ìš”ì²­ì„ ë³´ë‚¸ í›„ celery í„°ë¯¸ë„ì„ í™•ì¸í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì¶œë ¥ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<img src="/TIL/assets/img/2024-07-09-UsingCeleryRabbitMQWithFastAPI_3.png">
<!-- TIL ìˆ˜í‰ -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>ì‘ì—…ì„ ë°›ì•˜ê³ , ì‘ì—…ì„ ì‹¤í–‰í•˜ê¸° ì‹œì‘í–ˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ì‹¤í–‰ì´ ì™„ë£Œëœ í›„ì—ëŠ” ì‘ì—…ì´ ì„±ê³µí–ˆë‹¤ê³  í•©ë‹ˆë‹¤. ì´ëŠ” ìš°ë¦¬ì˜ ì‘ì—…ì´ FastAPI ì„œë²„ì— ì˜í•´ ì‹¤í–‰ë˜ëŠ” ê²ƒì´ ì•„ë‹Œ celery ì›Œì»¤ì— ì˜í•´ ì‹¤í–‰ëœë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.</p>
<h2>ì‘ì—… ëª¨ë‹ˆí„°ë§</h2>
<p>Celery ì‘ì—…ê³¼ ì›Œì»¤ë¥¼ ëª¨ë‹ˆí„°ë§í•˜ê¸° ìœ„í•´ Flowerë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Flowerë¥¼ ì„¤ì¹˜í•´ë³´ê² ìŠµë‹ˆë‹¤.</p>
<pre><code class="hljs language-js">pip install flower
</code></pre>
<!-- TIL ìˆ˜í‰ -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>ë¡œì»¬ ë¨¸ì‹ ì—ì„œ flowerë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.</p>
<pre><code class="hljs language-js">celery flower --app app.<span class="hljs-property">config</span>.<span class="hljs-property">celery_config</span>.<span class="hljs-property">celery_app</span> --<span class="hljs-attr">broker</span>:<span class="hljs-attr">amqp</span>:<span class="hljs-comment">//localhost//</span>
</code></pre>
<p>ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ flower ëª¨ë‹ˆí„°ë§ ë„êµ¬ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <a href="http://localhost:5555/" rel="nofollow" target="_blank">http://localhost:5555/</a> ìœ¼ë¡œ ì´ë™í•˜ì„¸ìš”.</p>
<p><img src="/TIL/assets/img/2024-07-09-UsingCeleryRabbitMQWithFastAPI_4.png" alt="Flower Monitoring Tool"></p>
<!-- TIL ìˆ˜í‰ -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>ìš”ì¦˜ FastAPI í”„ë¡œì íŠ¸ì—ì„œ Celery + RabbitMQë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ì†Œê°œí–ˆì–´. ì—¬ê¸°ì„œ ì–´ë–¤ ì¼ì´ ë²Œì–´ì§€ëŠ”ì§€ ì´í•´í•  ìˆ˜ ìˆì„ ê±°ì•¼. ì´ê±´ ì´ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ê°€ì¥ ê°„ë‹¨í•œ ë°©ë²•ì´ì•¼. ë‚˜ëŠ” ê¸°ë³¸ ì‘ì—… ëŒ€ê¸°ì—´ì„ ì‚¬ìš©í–ˆì–´. ì›í•œë‹¤ë©´ ë” ë§ì€ ì‘ì—… ëŒ€ê¸°ì—´ì„ ìƒì„±í•  ìˆ˜ë„ ìˆì–´. ê·¸ë¦¬ê³  ë” ë§ì€ êµ¬ì„± ê°€ëŠ¥í•œ ì‚¬í•­ë“¤ë„ ìˆì–´. ê·¸ë“¤ì˜ ì„¤ëª…ì„œë¥¼ í™•ì¸í•´ë´. ì‘ì—… ì™„ë£Œ ìƒíƒœë¥¼ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì•Œë¦¬ê¸° ìœ„í•´ WebSocketì„ ì‚¬ìš©í•  ìˆ˜ë„ ìˆì–´. ì´ê²Œ ì „ë¶€ì•¼. ë‹¤ìŒ ë¸”ë¡œê·¸ì—ì„œ ë§Œë‚˜ì. ì¦ê±°ìš´ ì½”ë”©ì´ ë˜ê¸¸!</p>
<h1>Stackademic ğŸ“</h1>
<p>ëê¹Œì§€ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•´ìš”. ë– ë‚˜ì‹œê¸° ì „ì— ì´ëŸ° ì  ìœ ì˜í•´ì£¼ì„¸ìš”:</p>
<ul>
<li>ë°•ìˆ˜ë¥¼ ì¹˜ê³  ì‘ê°€ë¥¼ íŒ”ë¡œìš°í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ì–´ìš”! ğŸ‘</li>
<li>ì €í¬ë¥¼ íŒ”ë¡œìš°í•´ì£¼ì„¸ìš” X | LinkedIn | YouTube | Discord</li>
<li>ë‹¤ë¥¸ í”Œë«í¼ë„ ë°©ë¬¸í•´ë³´ì„¸ìš”: In Plain English | CoFeed | Differ</li>
<li>Stackademic.comì—ì„œ ë” ë§ì€ ì½˜í…ì¸ ë¥¼ ë§Œë‚˜ë³´ì„¸ìš”</li>
</ul>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"FastAPIì—ì„œ Celeryì™€ RabbitMQ ì‚¬ìš© ë°©ë²•","description":"","date":"2024-07-09 19:19","slug":"2024-07-09-UsingCeleryRabbitMQWithFastAPI","content":"\n![í‘œ](/TIL/assets/img/2024-07-09-UsingCeleryRabbitMQWithFastAPI_0.png)\n\nì•ˆë…•í•˜ì„¸ìš”, ìš°ì£¼ ì—¬ëŸ¬ë¶„! ì˜¤ëŠ˜ì€ Celery + RabbitMQì™€ FastAPIë¥¼ ì‚¬ìš©í•œ ìµœê·¼ ê²½í—˜ì„ ê³µìœ í•˜ë ¤ê³  í•©ë‹ˆë‹¤. ìµœê·¼ì— ì˜¤ë””ì˜¤ ë¶„ì„ ê´€ë ¨ í”„ë¡œì íŠ¸ë¥¼ í•˜ê³  ìˆì—ˆì–´ìš”. ì´ í”„ë¡œì íŠ¸ì—ì„œ ì¼ë¶€ ì‘ì—…ì€ ì™„ë£Œí•˜ëŠ” ë° ì¡°ê¸ˆ ì‹œê°„ì´ ê±¸ë ¸ì–´ìš”. ë”°ë¼ì„œ í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ì— ìš”ì²­ì„ ë³´ë‚´ë©´ ì´ëŸ¬í•œ ì‘ì—… ë•Œë¬¸ì— ì„œë²„ê°€ ì ì‹œ ë°”ì  ê±°ì˜ˆìš”. ê·¸ë˜ì„œ í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µì„ ë³´ë‚´ëŠ” ë° ìƒë‹¹í•œ ì‹œê°„ì´ ì†Œìš”ë˜ì—ˆì£ . ì´ ìƒí™©ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‘ì—…ì„ ì‹¤í–‰í•˜ëŠ” ë°©ë²•ì„ ì°¾ì•˜ì–´ìš”. ê²°êµ­ í•´ê²°ì±…ì¸ Celery â€” ë¶„ì‚° ì‘ì—… íë¥¼ ì°¾ì•˜ê³ , ì´ ê¸€ì—ì„œëŠ” ì–´ë–»ê²Œ Celeryë¥¼ ì‚¬ìš©í•´ ëª©í‘œë¥¼ ì´ë£¨ì—ˆëŠ”ì§€ ì„¤ëª…í•  ê±°ì˜ˆìš”.\n\nCeleryëŠ” ì‹¤ì‹œê°„ ì²˜ë¦¬ë¥¼ ì§€ì›í•˜ëŠ” ì‘ì—… íì´ë©° ì‘ì—… ìŠ¤ì¼€ì¤„ë§ë„ ì§€ì›í•´ìš”. ê°„ë‹¨íˆ ë§í•´, ì„œë²„ê°€ ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¬ëŠ” ì‘ì—…ì— ëŒ€í•œ ìš”ì²­ì„ ë°›ìœ¼ë©´ í•´ë‹¹ ì‘ì—…ì„ Celery ì‘ì—… íì— ì¶”ê°€í•˜ê³  ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰ë  ê±°ì˜ˆìš”. CeleryëŠ” ì‘ì—…ì˜ ìƒíƒœë¥¼ ìœ ì§€í•˜ëŠ”ë°, ëŒ€ê¸° ì¤‘ì¸ì§€, ì‹œì‘ëœ ìƒíƒœì¸ì§€, ì„±ê³µì ì¸ì§€ ë“±ì„ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”. Celeryì—ëŠ” ë©”ì‹œì§€ ë¸Œë¡œì»¤ ì„œë¹„ìŠ¤ê°€ í•„ìš”í•´ìš”. ì„œë²„(ì£¼ ì–´í”Œë¦¬ì¼€ì´ì…˜)ê°€ ì‘ì—…ì„ ìœ„í•´ ìš”ì²­ì„ ë°›ìœ¼ë©´, celery ì›Œì»¤ê°€ ì´ìš© ê°€ëŠ¥í•  ë•Œê¹Œì§€ ì‘ì—…ì€ ì‘ì—… íì— ìˆì–´ì•¼ í•´ìš”. ì›Œì»¤ê°€ ì‚¬ìš© ê°€ëŠ¥í•˜ë©´ ë©”ì‹œì§€ íì—ì„œ ì‘ì—…ì„ ì‹¤í–‰í•  ê±°ì˜ˆìš”. RabbitMQëŠ” celeryì˜ ê¸°ë³¸ ë©”ì‹œì§€ ë¸Œë¡œì»¤ì¸ë°, Redis, Amazon SQS, Apache Kafkaì™€ ê°™ì€ ë‹¤ë¥¸ ì†”ë£¨ì…˜ì´ ìˆì–´ìš”. ì €ëŠ” ì´ë¥¼ ê°€ì¥ ê°„ë‹¨í•˜ê²Œ í•˜ê³ ì RabbitMQë¥¼ ì‚¬ìš©í–ˆì–´ìš”. ì´ ì• ë‹ˆë©”ì´ì…˜ ë™ì˜ìƒì—ì„œ ì´ ì‘ì—…ì´ ì–´ë–»ê²Œ ì´ë£¨ì–´ì§€ëŠ”ì§€ ì„¤ëª…í•©ë‹ˆë‹¤.\n\n# êµ¬í˜„\n\n\u003c!-- TIL ìˆ˜í‰ --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\në¨¼ì € RabbitMQë¥¼ ì„¤ì •í•´ ë´…ì‹œë‹¤. í”„ë¡œì íŠ¸ë¥¼ ê°œë°œí•˜ëŠ” í™˜ê²½ì€ Windowsë¥¼ ì‚¬ìš©í•˜ê³  ìˆì–´ìš”. RabbitMQë¥¼ ì„¤ì •í•˜ê¸° ìœ„í•´ì„œ Docker ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ê³  ìˆì–´ìš”. ì›í•˜ì‹ ë‹¤ë©´ Docker ëŒ€ì‹ ì— RabbitMQë¥¼ ì„¤ì¹˜í•  ìˆ˜ë„ ìˆì–´ìš”.\n\n```js\ndocker run -p 15672:15672 -p 5672:5672 rabbitmq:3-management\n```\n\nDocker ì»¨í…Œì´ë„ˆê°€ ì‹œì‘ë˜ë©´, ë¸Œë¼ìš°ì €ë¥¼ í†µí•´ 127.0.0.1:5672ë¡œ RabbitMQ ëŒ€ì‹œë³´ë“œì— ë¡œê·¸ì¸í•  ìˆ˜ ìˆì–´ìš”. ì‚¬ìš©ì ì´ë¦„ê³¼ ë¹„ë°€ë²ˆí˜¸ëŠ” ëª¨ë‘ 'guest'ì—ìš”.\n\n\u003cimg src=\"/TIL/assets/img/2024-07-09-UsingCeleryRabbitMQWithFastAPI_1.png\" /\u003e\n\n\u003c!-- TIL ìˆ˜í‰ --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\nì´ì œ Celeryë¥¼ ì„¤ì¹˜í•˜ê³  ì„¤ì •í•´ ë´…ì‹œë‹¤. ë‹¤ìŒ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•˜ì„¸ìš”. ì €ëŠ” python-dotenv ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ .env íŒŒì¼ì—ì„œ ë³´ì•ˆ ì •ë³´ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.\n\n```js\npip install celery python-dotenv\n```\n\në‚´ FastAPI í”„ë¡œì íŠ¸ëŠ” ì´ì™€ ìœ ì‚¬í•œ í´ë” êµ¬ì¡°ë¥¼ ê°€ì§€ê³  ìˆì–´ìš”.\n\n```js\napp/\nâ”œâ”€â”€ config/\nâ”‚   â”œâ”€â”€ __init__.py\nâ”‚   â””â”€â”€ celery_config.py\nâ”œâ”€â”€ tasks/\nâ”‚   â”œâ”€â”€ __init__.py\nâ”‚   â””â”€â”€ celery_tasks.py\nâ”œâ”€â”€ __init__.py\nâ”œâ”€â”€ main.py\nâ”œâ”€â”€ .env\nâ””â”€â”€ requirements.txt\n```\n\n\u003c!-- TIL ìˆ˜í‰ --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\në¨¼ì €, .env íŒŒì¼ì—ì„œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ë§Œë“¤ì–´ë´…ì‹œë‹¤. Celeryì—ëŠ” ë‘ ê°€ì§€ê°€ í•„ìš”í•©ë‹ˆë‹¤. ì²« ë²ˆì§¸ëŠ” ë©”ì‹œì§€ ë¸Œë¡œì»¤ URLì…ë‹ˆë‹¤. ì œ ê²½ìš°ì—ëŠ” RabbitMQ ì„œë²„ URLì…ë‹ˆë‹¤. (`USERNAME`, `PASSWORD`ë¥¼ êµì²´í•˜ì—¬ ì‚¬ìš©ìëª…ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. ê¸°ë³¸ê°’ì€ guestì…ë‹ˆë‹¤.) ë‘ ë²ˆì§¸ëŠ” ê²°ê³¼ ë°±ì—”ë“œì…ë‹ˆë‹¤. Celeryê°€ ì‘ì—… ì‹¤í–‰ ê²°ê³¼ë¥¼ ì €ì¥í•˜ëŠ” ê³³ìœ¼ë¡œ, ì‘ì—…ì„ ì™„ë£Œí•œ í›„ì— ì´ ê²°ê³¼ë¥¼ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n```js\nCELERY_BROKER_URL=amqp://\u003cUSERNAME\u003e:\u003cPASSWORD\u003e@localhost:5672//\nCELERY_RESULT_BACKEND=rpc://\n```\n\nì¢‹ì•„ìš”. ì´ì œ Celery ì•±ì„ ìƒì„±í•˜ê³  êµ¬ì„±í•´ë´…ì‹œë‹¤. ì´ë¥¼ ìœ„í•´ celery_config.py íŒŒì¼ì„ ë§Œë“¤ê² ìŠµë‹ˆë‹¤.\n\n```js\n# celery_config.py\n# ë³„ë„ì˜ íŒŒì¼ì—ì„œ celery ì‘ì—…ì„ ì •ì˜í•˜ê¸° ìœ„í•œ êµ¬ì„±.\nimport os\nfrom celery import Celery\nfrom dotenv import load_dotenv\n\nload_dotenv() # í™˜ê²½ ë³€ìˆ˜ë¥¼ ë¶ˆëŸ¬ì˜¤ê¸° ìœ„í•œ ì½”ë“œ\n\ncelery_app = Celery(__name__, broker=os.getenv(\"CELERY_BROKER_URL\"), backend=os.getenv(\"CELERY_RESULT_BACKEND\"))\n\ncelery_app.conf.update(\n    imports=['app.tasks.celery_tasks'], # celery ì‘ì—… íŒŒì¼ ê²½ë¡œ\n    broker_connection_retry_on_startup=True,\n    task_track_started=True\n)\n```\n\n\u003c!-- TIL ìˆ˜í‰ --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\në¶„ë¦¬ëœ íŒŒì¼ì„ ë§Œë“¤ì–´ Celery ì‘ì—…ì„ ì •ì˜í–ˆì–´ìš”. í•˜ì§€ë§Œ ê·¸ê±´ ê¼­ í•„ìš”í•˜ì§€ ì•Šì•„ìš”. ì´ íŒŒì¼ ì•ˆì— ì‘ì—…ë“¤ì„ ì •ì˜í•  ìˆ˜ ìˆì–´ìš”. ë§Œì•½ ì´ íŒŒì¼ ì•ˆì— ì‘ì—…ì„ ì •ì˜í•œë‹¤ë©´, imports=['app.tasks.celery_tasks'] ë¼ì¸ì„ ì¶”ê°€í•  í•„ìš”ê°€ ì—†ì–´ìš”. ë”°ë¼ì„œ, ë‹¹ì‹ ì˜ êµ¬ì„±ì€ ì´ëŸ° ì‹ì´ì—ìš”.\n\n```js\n# celery_config.py\n# ì´ íŒŒì¼ ì•ˆì— Celery ì‘ì—…ì„ ì •ì˜í•˜ê¸° ìœ„í•œ êµ¬ì„±.\nimport os\nfrom celery import Celery\nfrom dotenv import load_dotenv\n\nload_dotenv() # í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ\n\ncelery_app = Celery(__name__, broker=os.getenv(\"CELERY_BROKER_URL\"), backend=os.getenv(\"CELERY_RESULT_BACKEND\"))\n\ncelery_app.conf.update(\n    broker_connection_retry_on_startup=True,\n    task_track_started=True\n)\n```\n\nì´ì œ Celery ì‘ì—…ì„ ë§Œë“¤ì–´ë´ìš”. celery_tasks.py íŒŒì¼ì„ ë§Œë“¤ê³  ê·¸ ì•ˆì— ì‘ì—…ë“¤ì„ ì •ì˜í–ˆì–´ìš”. Celery ì‘ì—…ì„ ì •ì˜í•˜ê¸° ìœ„í•´ ë°ì½”ë ˆì´í„°ë¥¼ ì‚¬ìš©í•´ìš”.\n\n```js\n# celery_tasks.py\nimport asyncio\nfrom app.config.celery_config import celery_app\n\n\n@celery_app.task\ndef my_task(x, y):\n    ans = x + y\n    print(ans)\n    return ans\n\n\nasync def my_async_task(x, y):\n    await asyncio.sleep(3)\n    ans = x + y\n    print(ans)\n    return ans\n\n\n@celery_app.task\ndef my_second_task(x, y):\n    result = asyncio.run(my_async_task(x, y))\n    return result\n```\n\n\u003c!-- TIL ìˆ˜í‰ --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\në³„ë„ì˜ íŒŒì¼ ëŒ€ì‹  ì´ëŸ¬í•œ ë°©ì‹ìœ¼ë¡œ êµ¬ì„± íŒŒì¼ ë‚´ì—ì„œ ì‘ì—…ì„ ì •ì˜í•  ìˆ˜ ìˆì–´ìš”.\n\n```python\n# celery_config.py\n# ì´ íŒŒì¼ ì•ˆì—ì„œ Celery ì‘ì—…ì„ ì •ì˜í•˜ëŠ” ì„¤ì •ì…ë‹ˆë‹¤.\nimport os\nimport asyncio\nfrom celery import Celery\nfrom dotenv import load_dotenv\n\nload_dotenv() # í™˜ê²½ ë³€ìˆ˜ë¥¼ ë¶ˆëŸ¬ì˜¤ê¸°\n\ncelery_app = Celery(__name__, broker=os.getenv(\"CELERY_BROKER_URL\"), backend=os.getenv(\"CELERY_RESULT_BACKEND\"))\n\ncelery_app.conf.update(\n    broker_connection_retry_on_startup=True,\n    task_track_started=True\n)\n\n@celery_app.task\ndef my_task(x, y):\n   ans = x + y\n   print(ans)\n   return ans\n\nasync def my_async_task(x, y):\n   await asyncio.sleep(3)\n   ans = x + y\n   print(ans)\n   return ans\n\n@celery_app.task\ndef my_second_task(x, y):\n   result = asyncio.run(my_async_task(x, y))\n   return result\n```\n\nì´ì œ ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œ ì´ëŸ¬í•œ ì‘ì—…ì„ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”. ì•„ë˜ëŠ” ì˜ˆì‹œ ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ì…ë‹ˆë‹¤. ì—¬ê¸°ì„œ GET ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë§Œë“¤ì—ˆì–´ìš”. ì´ ì—”ë“œí¬ì¸íŠ¸ í•¸ë“¤ëŸ¬ ë‚´ë¶€ì—ì„œ Celery ì‘ì—…ì„ ì‚¬ìš©í•´ìš”.\n\n```python\nfrom fastapi import FastAPI\n\nfrom app.tasks.celery_tasks import my_task\n\napp = FastAPI()\n\n@app.get(\"/run\")\ndef handle_run():\n   task_response = my_task.delay(5, 6)\n   return {\"message\": \"ì‘ì—… ì‹¤í–‰ì´ ì‹œì‘ëì–´ìš”!\"}\n\nif __name__ == '__main__':\n    uvicorn.run(app, port=8080)\n```\n\n\u003c!-- TIL ìˆ˜í‰ --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\nì•Œê² ì–´ìš”. ì½”ë”© ë¶€ë¶„ì€ ëë‚¬ìŠµë‹ˆë‹¤. ì´ì œ ì„¸ëŸ´ë¦¬ ì›Œì»¤ë¥¼ ì‹¤í–‰í•´ë´…ì‹œë‹¤. ì´ ì„¸ëŸ´ë¦¬ ì›Œì»¤ëŠ” RabbitMQì˜ ë©”ì‹œì§€ ëŒ€ê¸°ì—´ì— ìˆëŠ” ì‘ì—…ì„ ì‹¤í–‰í•  ê²ƒì…ë‹ˆë‹¤. ë§Œì•½ RabbitMQ ì„œë²„ë¥¼ ì‹œì‘í•˜ì§€ ì•Šì•˜ë‹¤ë©´, ì„¸ëŸ´ë¦¬ ì›Œì»¤ë¥¼ ì‹œì‘í•˜ê¸° ì „ì— RabbitMQë¥¼ ì‹œì‘í•´ì£¼ì„¸ìš”.\n\n```js\ncelery --app app.config.celery_config.celery_app worker --loglevel=info --pool=solo\n```\n\në§Œì•½ ì„¸ëŸ´ë¦¬ê°€ ì–´ë– í•œ ì˜¤ë¥˜ ì—†ì´ ì‹¤í–‰ëœë‹¤ë©´, í„°ë¯¸ë„ì—ì„œ ë‹¤ìŒê³¼ ìœ ì‚¬í•œ ì¶œë ¥ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n\u003cimg src=\"/TIL/assets/img/2024-07-09-UsingCeleryRabbitMQWithFastAPI_2.png\" /\u003e\n\n\u003c!-- TIL ìˆ˜í‰ --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\nìœ„ ì´ë¯¸ì§€ì—ì„œ [ì‘ì—…] ì„¹ì…˜ ì•„ë˜ì—ì„œ celery_tasks.py íŒŒì¼ì— ì •ì˜í•œ celery ì‘ì—…ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‘ì—… ëŒ€ê¸°ì—´ì´ ìƒˆ ì‘ì—…ì„ ë°›ìœ¼ë©´ celeryê°€ í•´ë‹¹ ì‘ì—…ì„ ì‹¤í–‰í•©ë‹ˆë‹¤. ì´ì œ FastAPI ì„œë²„ë¥¼ ì‹¤í–‰í•´ ë´…ì‹œë‹¤.\n\n```js\nuvicorn app.main:app --port 8000\n```\n\nSwagger ë¬¸ì„œ í˜ì´ì§€ì—ì„œ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì‹œë„í•´ ë´…ì‹œë‹¤. ì—”ë“œí¬ì¸íŠ¸ì— ìš”ì²­ì„ ë³´ë‚¸ í›„ celery í„°ë¯¸ë„ì„ í™•ì¸í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì¶œë ¥ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n\u003cimg src=\"/TIL/assets/img/2024-07-09-UsingCeleryRabbitMQWithFastAPI_3.png\" /\u003e\n\n\u003c!-- TIL ìˆ˜í‰ --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\nì‘ì—…ì„ ë°›ì•˜ê³ , ì‘ì—…ì„ ì‹¤í–‰í•˜ê¸° ì‹œì‘í–ˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ì‹¤í–‰ì´ ì™„ë£Œëœ í›„ì—ëŠ” ì‘ì—…ì´ ì„±ê³µí–ˆë‹¤ê³  í•©ë‹ˆë‹¤. ì´ëŠ” ìš°ë¦¬ì˜ ì‘ì—…ì´ FastAPI ì„œë²„ì— ì˜í•´ ì‹¤í–‰ë˜ëŠ” ê²ƒì´ ì•„ë‹Œ celery ì›Œì»¤ì— ì˜í•´ ì‹¤í–‰ëœë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.\n\n## ì‘ì—… ëª¨ë‹ˆí„°ë§\n\nCelery ì‘ì—…ê³¼ ì›Œì»¤ë¥¼ ëª¨ë‹ˆí„°ë§í•˜ê¸° ìœ„í•´ Flowerë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Flowerë¥¼ ì„¤ì¹˜í•´ë³´ê² ìŠµë‹ˆë‹¤.\n\n```js\npip install flower\n```\n\n\u003c!-- TIL ìˆ˜í‰ --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\në¡œì»¬ ë¨¸ì‹ ì—ì„œ flowerë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.\n\n```js\ncelery flower --app app.config.celery_config.celery_app --broker:amqp://localhost//\n```\n\nì›¹ ë¸Œë¼ìš°ì €ì—ì„œ flower ëª¨ë‹ˆí„°ë§ ë„êµ¬ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. http://localhost:5555/ ìœ¼ë¡œ ì´ë™í•˜ì„¸ìš”.\n\n![Flower Monitoring Tool](/TIL/assets/img/2024-07-09-UsingCeleryRabbitMQWithFastAPI_4.png)\n\n\u003c!-- TIL ìˆ˜í‰ --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\nìš”ì¦˜ FastAPI í”„ë¡œì íŠ¸ì—ì„œ Celery + RabbitMQë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ì†Œê°œí–ˆì–´. ì—¬ê¸°ì„œ ì–´ë–¤ ì¼ì´ ë²Œì–´ì§€ëŠ”ì§€ ì´í•´í•  ìˆ˜ ìˆì„ ê±°ì•¼. ì´ê±´ ì´ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ê°€ì¥ ê°„ë‹¨í•œ ë°©ë²•ì´ì•¼. ë‚˜ëŠ” ê¸°ë³¸ ì‘ì—… ëŒ€ê¸°ì—´ì„ ì‚¬ìš©í–ˆì–´. ì›í•œë‹¤ë©´ ë” ë§ì€ ì‘ì—… ëŒ€ê¸°ì—´ì„ ìƒì„±í•  ìˆ˜ë„ ìˆì–´. ê·¸ë¦¬ê³  ë” ë§ì€ êµ¬ì„± ê°€ëŠ¥í•œ ì‚¬í•­ë“¤ë„ ìˆì–´. ê·¸ë“¤ì˜ ì„¤ëª…ì„œë¥¼ í™•ì¸í•´ë´. ì‘ì—… ì™„ë£Œ ìƒíƒœë¥¼ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì•Œë¦¬ê¸° ìœ„í•´ WebSocketì„ ì‚¬ìš©í•  ìˆ˜ë„ ìˆì–´. ì´ê²Œ ì „ë¶€ì•¼. ë‹¤ìŒ ë¸”ë¡œê·¸ì—ì„œ ë§Œë‚˜ì. ì¦ê±°ìš´ ì½”ë”©ì´ ë˜ê¸¸!\n\n# Stackademic ğŸ“\n\nëê¹Œì§€ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•´ìš”. ë– ë‚˜ì‹œê¸° ì „ì— ì´ëŸ° ì  ìœ ì˜í•´ì£¼ì„¸ìš”:\n\n- ë°•ìˆ˜ë¥¼ ì¹˜ê³  ì‘ê°€ë¥¼ íŒ”ë¡œìš°í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ì–´ìš”! ğŸ‘\n- ì €í¬ë¥¼ íŒ”ë¡œìš°í•´ì£¼ì„¸ìš” X | LinkedIn | YouTube | Discord\n- ë‹¤ë¥¸ í”Œë«í¼ë„ ë°©ë¬¸í•´ë³´ì„¸ìš”: In Plain English | CoFeed | Differ\n- Stackademic.comì—ì„œ ë” ë§ì€ ì½˜í…ì¸ ë¥¼ ë§Œë‚˜ë³´ì„¸ìš”\n","ogImage":{"url":"/assets/img/2024-07-09-UsingCeleryRabbitMQWithFastAPI_0.png"},"coverImage":"/TIL/assets/img/2024-07-09-UsingCeleryRabbitMQWithFastAPI_0.png","tag":["Tech"],"readingTime":10},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cp\u003e\u003cimg src=\"/TIL/assets/img/2024-07-09-UsingCeleryRabbitMQWithFastAPI_0.png\" alt=\"í‘œ\"\u003e\u003c/p\u003e\n\u003cp\u003eì•ˆë…•í•˜ì„¸ìš”, ìš°ì£¼ ì—¬ëŸ¬ë¶„! ì˜¤ëŠ˜ì€ Celery + RabbitMQì™€ FastAPIë¥¼ ì‚¬ìš©í•œ ìµœê·¼ ê²½í—˜ì„ ê³µìœ í•˜ë ¤ê³  í•©ë‹ˆë‹¤. ìµœê·¼ì— ì˜¤ë””ì˜¤ ë¶„ì„ ê´€ë ¨ í”„ë¡œì íŠ¸ë¥¼ í•˜ê³  ìˆì—ˆì–´ìš”. ì´ í”„ë¡œì íŠ¸ì—ì„œ ì¼ë¶€ ì‘ì—…ì€ ì™„ë£Œí•˜ëŠ” ë° ì¡°ê¸ˆ ì‹œê°„ì´ ê±¸ë ¸ì–´ìš”. ë”°ë¼ì„œ í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ì— ìš”ì²­ì„ ë³´ë‚´ë©´ ì´ëŸ¬í•œ ì‘ì—… ë•Œë¬¸ì— ì„œë²„ê°€ ì ì‹œ ë°”ì  ê±°ì˜ˆìš”. ê·¸ë˜ì„œ í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µì„ ë³´ë‚´ëŠ” ë° ìƒë‹¹í•œ ì‹œê°„ì´ ì†Œìš”ë˜ì—ˆì£ . ì´ ìƒí™©ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‘ì—…ì„ ì‹¤í–‰í•˜ëŠ” ë°©ë²•ì„ ì°¾ì•˜ì–´ìš”. ê²°êµ­ í•´ê²°ì±…ì¸ Celery â€” ë¶„ì‚° ì‘ì—… íë¥¼ ì°¾ì•˜ê³ , ì´ ê¸€ì—ì„œëŠ” ì–´ë–»ê²Œ Celeryë¥¼ ì‚¬ìš©í•´ ëª©í‘œë¥¼ ì´ë£¨ì—ˆëŠ”ì§€ ì„¤ëª…í•  ê±°ì˜ˆìš”.\u003c/p\u003e\n\u003cp\u003eCeleryëŠ” ì‹¤ì‹œê°„ ì²˜ë¦¬ë¥¼ ì§€ì›í•˜ëŠ” ì‘ì—… íì´ë©° ì‘ì—… ìŠ¤ì¼€ì¤„ë§ë„ ì§€ì›í•´ìš”. ê°„ë‹¨íˆ ë§í•´, ì„œë²„ê°€ ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¬ëŠ” ì‘ì—…ì— ëŒ€í•œ ìš”ì²­ì„ ë°›ìœ¼ë©´ í•´ë‹¹ ì‘ì—…ì„ Celery ì‘ì—… íì— ì¶”ê°€í•˜ê³  ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰ë  ê±°ì˜ˆìš”. CeleryëŠ” ì‘ì—…ì˜ ìƒíƒœë¥¼ ìœ ì§€í•˜ëŠ”ë°, ëŒ€ê¸° ì¤‘ì¸ì§€, ì‹œì‘ëœ ìƒíƒœì¸ì§€, ì„±ê³µì ì¸ì§€ ë“±ì„ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”. Celeryì—ëŠ” ë©”ì‹œì§€ ë¸Œë¡œì»¤ ì„œë¹„ìŠ¤ê°€ í•„ìš”í•´ìš”. ì„œë²„(ì£¼ ì–´í”Œë¦¬ì¼€ì´ì…˜)ê°€ ì‘ì—…ì„ ìœ„í•´ ìš”ì²­ì„ ë°›ìœ¼ë©´, celery ì›Œì»¤ê°€ ì´ìš© ê°€ëŠ¥í•  ë•Œê¹Œì§€ ì‘ì—…ì€ ì‘ì—… íì— ìˆì–´ì•¼ í•´ìš”. ì›Œì»¤ê°€ ì‚¬ìš© ê°€ëŠ¥í•˜ë©´ ë©”ì‹œì§€ íì—ì„œ ì‘ì—…ì„ ì‹¤í–‰í•  ê±°ì˜ˆìš”. RabbitMQëŠ” celeryì˜ ê¸°ë³¸ ë©”ì‹œì§€ ë¸Œë¡œì»¤ì¸ë°, Redis, Amazon SQS, Apache Kafkaì™€ ê°™ì€ ë‹¤ë¥¸ ì†”ë£¨ì…˜ì´ ìˆì–´ìš”. ì €ëŠ” ì´ë¥¼ ê°€ì¥ ê°„ë‹¨í•˜ê²Œ í•˜ê³ ì RabbitMQë¥¼ ì‚¬ìš©í–ˆì–´ìš”. ì´ ì• ë‹ˆë©”ì´ì…˜ ë™ì˜ìƒì—ì„œ ì´ ì‘ì—…ì´ ì–´ë–»ê²Œ ì´ë£¨ì–´ì§€ëŠ”ì§€ ì„¤ëª…í•©ë‹ˆë‹¤.\u003c/p\u003e\n\u003ch1\u003eêµ¬í˜„\u003c/h1\u003e\n\u003c!-- TIL ìˆ˜í‰ --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003eë¨¼ì € RabbitMQë¥¼ ì„¤ì •í•´ ë´…ì‹œë‹¤. í”„ë¡œì íŠ¸ë¥¼ ê°œë°œí•˜ëŠ” í™˜ê²½ì€ Windowsë¥¼ ì‚¬ìš©í•˜ê³  ìˆì–´ìš”. RabbitMQë¥¼ ì„¤ì •í•˜ê¸° ìœ„í•´ì„œ Docker ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ê³  ìˆì–´ìš”. ì›í•˜ì‹ ë‹¤ë©´ Docker ëŒ€ì‹ ì— RabbitMQë¥¼ ì„¤ì¹˜í•  ìˆ˜ë„ ìˆì–´ìš”.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003edocker run -p \u003cspan class=\"hljs-number\"\u003e15672\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e15672\u003c/span\u003e -p \u003cspan class=\"hljs-number\"\u003e5672\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e5672\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003erabbitmq\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e-management\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eDocker ì»¨í…Œì´ë„ˆê°€ ì‹œì‘ë˜ë©´, ë¸Œë¼ìš°ì €ë¥¼ í†µí•´ 127.0.0.1:5672ë¡œ RabbitMQ ëŒ€ì‹œë³´ë“œì— ë¡œê·¸ì¸í•  ìˆ˜ ìˆì–´ìš”. ì‚¬ìš©ì ì´ë¦„ê³¼ ë¹„ë°€ë²ˆí˜¸ëŠ” ëª¨ë‘ 'guest'ì—ìš”.\u003c/p\u003e\n\u003cimg src=\"/TIL/assets/img/2024-07-09-UsingCeleryRabbitMQWithFastAPI_1.png\"\u003e\n\u003c!-- TIL ìˆ˜í‰ --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003eì´ì œ Celeryë¥¼ ì„¤ì¹˜í•˜ê³  ì„¤ì •í•´ ë´…ì‹œë‹¤. ë‹¤ìŒ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•˜ì„¸ìš”. ì €ëŠ” python-dotenv ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ .env íŒŒì¼ì—ì„œ ë³´ì•ˆ ì •ë³´ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003epip install celery python-dotenv\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eë‚´ FastAPI í”„ë¡œì íŠ¸ëŠ” ì´ì™€ ìœ ì‚¬í•œ í´ë” êµ¬ì¡°ë¥¼ ê°€ì§€ê³  ìˆì–´ìš”.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003eapp/\nâ”œâ”€â”€ config/\nâ”‚   â”œâ”€â”€ __init__.\u003cspan class=\"hljs-property\"\u003epy\u003c/span\u003e\nâ”‚   â””â”€â”€ celery_config.\u003cspan class=\"hljs-property\"\u003epy\u003c/span\u003e\nâ”œâ”€â”€ tasks/\nâ”‚   â”œâ”€â”€ __init__.\u003cspan class=\"hljs-property\"\u003epy\u003c/span\u003e\nâ”‚   â””â”€â”€ celery_tasks.\u003cspan class=\"hljs-property\"\u003epy\u003c/span\u003e\nâ”œâ”€â”€ __init__.\u003cspan class=\"hljs-property\"\u003epy\u003c/span\u003e\nâ”œâ”€â”€ main.\u003cspan class=\"hljs-property\"\u003epy\u003c/span\u003e\nâ”œâ”€â”€ .\u003cspan class=\"hljs-property\"\u003eenv\u003c/span\u003e\nâ””â”€â”€ requirements.\u003cspan class=\"hljs-property\"\u003etxt\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- TIL ìˆ˜í‰ --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003eë¨¼ì €, .env íŒŒì¼ì—ì„œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ë§Œë“¤ì–´ë´…ì‹œë‹¤. Celeryì—ëŠ” ë‘ ê°€ì§€ê°€ í•„ìš”í•©ë‹ˆë‹¤. ì²« ë²ˆì§¸ëŠ” ë©”ì‹œì§€ ë¸Œë¡œì»¤ URLì…ë‹ˆë‹¤. ì œ ê²½ìš°ì—ëŠ” RabbitMQ ì„œë²„ URLì…ë‹ˆë‹¤. (\u003ccode\u003eUSERNAME\u003c/code\u003e, \u003ccode\u003ePASSWORD\u003c/code\u003eë¥¼ êµì²´í•˜ì—¬ ì‚¬ìš©ìëª…ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. ê¸°ë³¸ê°’ì€ guestì…ë‹ˆë‹¤.) ë‘ ë²ˆì§¸ëŠ” ê²°ê³¼ ë°±ì—”ë“œì…ë‹ˆë‹¤. Celeryê°€ ì‘ì—… ì‹¤í–‰ ê²°ê³¼ë¥¼ ì €ì¥í•˜ëŠ” ê³³ìœ¼ë¡œ, ì‘ì—…ì„ ì™„ë£Œí•œ í›„ì— ì´ ê²°ê³¼ë¥¼ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-variable constant_\"\u003eCELERY_BROKER_URL\u003c/span\u003e=\u003cspan class=\"hljs-attr\"\u003eamqp\u003c/span\u003e:\u003cspan class=\"hljs-comment\"\u003e//\u0026#x3C;USERNAME\u003e:\u0026#x3C;PASSWORD\u003e@localhost:5672//\u003c/span\u003e\n\u003cspan class=\"hljs-variable constant_\"\u003eCELERY_RESULT_BACKEND\u003c/span\u003e=\u003cspan class=\"hljs-attr\"\u003erpc\u003c/span\u003e:\u003cspan class=\"hljs-comment\"\u003e//\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eì¢‹ì•„ìš”. ì´ì œ Celery ì•±ì„ ìƒì„±í•˜ê³  êµ¬ì„±í•´ë´…ì‹œë‹¤. ì´ë¥¼ ìœ„í•´ celery_config.py íŒŒì¼ì„ ë§Œë“¤ê² ìŠµë‹ˆë‹¤.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# celery_config.\u003cspan class=\"hljs-property\"\u003epy\u003c/span\u003e\n# ë³„ë„ì˜ íŒŒì¼ì—ì„œ celery ì‘ì—…ì„ ì •ì˜í•˜ê¸° ìœ„í•œ êµ¬ì„±.\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e os\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e celery \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eCelery\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e dotenv \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e load_dotenv\n\n\u003cspan class=\"hljs-title function_\"\u003eload_dotenv\u003c/span\u003e() # í™˜ê²½ ë³€ìˆ˜ë¥¼ ë¶ˆëŸ¬ì˜¤ê¸° ìœ„í•œ ì½”ë“œ\n\ncelery_app = \u003cspan class=\"hljs-title class_\"\u003eCelery\u003c/span\u003e(__name__, broker=os.\u003cspan class=\"hljs-title function_\"\u003egetenv\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"CELERY_BROKER_URL\"\u003c/span\u003e), backend=os.\u003cspan class=\"hljs-title function_\"\u003egetenv\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"CELERY_RESULT_BACKEND\"\u003c/span\u003e))\n\ncelery_app.\u003cspan class=\"hljs-property\"\u003econf\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eupdate\u003c/span\u003e(\n    imports=[\u003cspan class=\"hljs-string\"\u003e'app.tasks.celery_tasks'\u003c/span\u003e], # celery ì‘ì—… íŒŒì¼ ê²½ë¡œ\n    broker_connection_retry_on_startup=\u003cspan class=\"hljs-title class_\"\u003eTrue\u003c/span\u003e,\n    task_track_started=\u003cspan class=\"hljs-title class_\"\u003eTrue\u003c/span\u003e\n)\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- TIL ìˆ˜í‰ --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003eë¶„ë¦¬ëœ íŒŒì¼ì„ ë§Œë“¤ì–´ Celery ì‘ì—…ì„ ì •ì˜í–ˆì–´ìš”. í•˜ì§€ë§Œ ê·¸ê±´ ê¼­ í•„ìš”í•˜ì§€ ì•Šì•„ìš”. ì´ íŒŒì¼ ì•ˆì— ì‘ì—…ë“¤ì„ ì •ì˜í•  ìˆ˜ ìˆì–´ìš”. ë§Œì•½ ì´ íŒŒì¼ ì•ˆì— ì‘ì—…ì„ ì •ì˜í•œë‹¤ë©´, imports=['app.tasks.celery_tasks'] ë¼ì¸ì„ ì¶”ê°€í•  í•„ìš”ê°€ ì—†ì–´ìš”. ë”°ë¼ì„œ, ë‹¹ì‹ ì˜ êµ¬ì„±ì€ ì´ëŸ° ì‹ì´ì—ìš”.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# celery_config.\u003cspan class=\"hljs-property\"\u003epy\u003c/span\u003e\n# ì´ íŒŒì¼ ì•ˆì— \u003cspan class=\"hljs-title class_\"\u003eCelery\u003c/span\u003e ì‘ì—…ì„ ì •ì˜í•˜ê¸° ìœ„í•œ êµ¬ì„±.\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e os\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e celery \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eCelery\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e dotenv \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e load_dotenv\n\n\u003cspan class=\"hljs-title function_\"\u003eload_dotenv\u003c/span\u003e() # í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ\n\ncelery_app = \u003cspan class=\"hljs-title class_\"\u003eCelery\u003c/span\u003e(__name__, broker=os.\u003cspan class=\"hljs-title function_\"\u003egetenv\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"CELERY_BROKER_URL\"\u003c/span\u003e), backend=os.\u003cspan class=\"hljs-title function_\"\u003egetenv\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"CELERY_RESULT_BACKEND\"\u003c/span\u003e))\n\ncelery_app.\u003cspan class=\"hljs-property\"\u003econf\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eupdate\u003c/span\u003e(\n    broker_connection_retry_on_startup=\u003cspan class=\"hljs-title class_\"\u003eTrue\u003c/span\u003e,\n    task_track_started=\u003cspan class=\"hljs-title class_\"\u003eTrue\u003c/span\u003e\n)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eì´ì œ Celery ì‘ì—…ì„ ë§Œë“¤ì–´ë´ìš”. celery_tasks.py íŒŒì¼ì„ ë§Œë“¤ê³  ê·¸ ì•ˆì— ì‘ì—…ë“¤ì„ ì •ì˜í–ˆì–´ìš”. Celery ì‘ì—…ì„ ì •ì˜í•˜ê¸° ìœ„í•´ ë°ì½”ë ˆì´í„°ë¥¼ ì‚¬ìš©í•´ìš”.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# celery_tasks.\u003cspan class=\"hljs-property\"\u003epy\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e asyncio\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e app.\u003cspan class=\"hljs-property\"\u003econfig\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ecelery_config\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e celery_app\n\n\n@celery_app.\u003cspan class=\"hljs-property\"\u003etask\u003c/span\u003e\ndef \u003cspan class=\"hljs-title function_\"\u003emy_task\u003c/span\u003e(x, y):\n    ans = x + y\n    \u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(ans)\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e ans\n\n\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e def \u003cspan class=\"hljs-title function_\"\u003emy_async_task\u003c/span\u003e(x, y):\n    \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e asyncio.\u003cspan class=\"hljs-title function_\"\u003esleep\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e)\n    ans = x + y\n    \u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(ans)\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e ans\n\n\n@celery_app.\u003cspan class=\"hljs-property\"\u003etask\u003c/span\u003e\ndef \u003cspan class=\"hljs-title function_\"\u003emy_second_task\u003c/span\u003e(x, y):\n    result = asyncio.\u003cspan class=\"hljs-title function_\"\u003erun\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003emy_async_task\u003c/span\u003e(x, y))\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e result\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- TIL ìˆ˜í‰ --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003eë³„ë„ì˜ íŒŒì¼ ëŒ€ì‹  ì´ëŸ¬í•œ ë°©ì‹ìœ¼ë¡œ êµ¬ì„± íŒŒì¼ ë‚´ì—ì„œ ì‘ì—…ì„ ì •ì˜í•  ìˆ˜ ìˆì–´ìš”.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-comment\"\u003e# celery_config.py\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e# ì´ íŒŒì¼ ì•ˆì—ì„œ Celery ì‘ì—…ì„ ì •ì˜í•˜ëŠ” ì„¤ì •ì…ë‹ˆë‹¤.\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e os\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e asyncio\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e celery \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e Celery\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e dotenv \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e load_dotenv\n\nload_dotenv() \u003cspan class=\"hljs-comment\"\u003e# í™˜ê²½ ë³€ìˆ˜ë¥¼ ë¶ˆëŸ¬ì˜¤ê¸°\u003c/span\u003e\n\ncelery_app = Celery(__name__, broker=os.getenv(\u003cspan class=\"hljs-string\"\u003e\"CELERY_BROKER_URL\"\u003c/span\u003e), backend=os.getenv(\u003cspan class=\"hljs-string\"\u003e\"CELERY_RESULT_BACKEND\"\u003c/span\u003e))\n\ncelery_app.conf.update(\n    broker_connection_retry_on_startup=\u003cspan class=\"hljs-literal\"\u003eTrue\u003c/span\u003e,\n    task_track_started=\u003cspan class=\"hljs-literal\"\u003eTrue\u003c/span\u003e\n)\n\n\u003cspan class=\"hljs-meta\"\u003e@celery_app.task\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003emy_task\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ex, y\u003c/span\u003e):\n   ans = x + y\n   \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(ans)\n   \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e ans\n\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003emy_async_task\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ex, y\u003c/span\u003e):\n   \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e asyncio.sleep(\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e)\n   ans = x + y\n   \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(ans)\n   \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e ans\n\n\u003cspan class=\"hljs-meta\"\u003e@celery_app.task\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003emy_second_task\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ex, y\u003c/span\u003e):\n   result = asyncio.run(my_async_task(x, y))\n   \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e result\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eì´ì œ ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œ ì´ëŸ¬í•œ ì‘ì—…ì„ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”. ì•„ë˜ëŠ” ì˜ˆì‹œ ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ì…ë‹ˆë‹¤. ì—¬ê¸°ì„œ GET ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë§Œë“¤ì—ˆì–´ìš”. ì´ ì—”ë“œí¬ì¸íŠ¸ í•¸ë“¤ëŸ¬ ë‚´ë¶€ì—ì„œ Celery ì‘ì—…ì„ ì‚¬ìš©í•´ìš”.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e fastapi \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e FastAPI\n\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e app.tasks.celery_tasks \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e my_task\n\napp = FastAPI()\n\n\u003cspan class=\"hljs-meta\"\u003e@app.get(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-string\"\u003e\"/run\"\u003c/span\u003e\u003c/span\u003e)\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003ehandle_run\u003c/span\u003e():\n   task_response = my_task.delay(\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e)\n   \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\u003cspan class=\"hljs-string\"\u003e\"message\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"ì‘ì—… ì‹¤í–‰ì´ ì‹œì‘ëì–´ìš”!\"\u003c/span\u003e}\n\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e __name__ == \u003cspan class=\"hljs-string\"\u003e'__main__'\u003c/span\u003e:\n    uvicorn.run(app, port=\u003cspan class=\"hljs-number\"\u003e8080\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- TIL ìˆ˜í‰ --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003eì•Œê² ì–´ìš”. ì½”ë”© ë¶€ë¶„ì€ ëë‚¬ìŠµë‹ˆë‹¤. ì´ì œ ì„¸ëŸ´ë¦¬ ì›Œì»¤ë¥¼ ì‹¤í–‰í•´ë´…ì‹œë‹¤. ì´ ì„¸ëŸ´ë¦¬ ì›Œì»¤ëŠ” RabbitMQì˜ ë©”ì‹œì§€ ëŒ€ê¸°ì—´ì— ìˆëŠ” ì‘ì—…ì„ ì‹¤í–‰í•  ê²ƒì…ë‹ˆë‹¤. ë§Œì•½ RabbitMQ ì„œë²„ë¥¼ ì‹œì‘í•˜ì§€ ì•Šì•˜ë‹¤ë©´, ì„¸ëŸ´ë¦¬ ì›Œì»¤ë¥¼ ì‹œì‘í•˜ê¸° ì „ì— RabbitMQë¥¼ ì‹œì‘í•´ì£¼ì„¸ìš”.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003ecelery --app app.\u003cspan class=\"hljs-property\"\u003econfig\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ecelery_config\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ecelery_app\u003c/span\u003e worker --loglevel=info --pool=solo\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eë§Œì•½ ì„¸ëŸ´ë¦¬ê°€ ì–´ë– í•œ ì˜¤ë¥˜ ì—†ì´ ì‹¤í–‰ëœë‹¤ë©´, í„°ë¯¸ë„ì—ì„œ ë‹¤ìŒê³¼ ìœ ì‚¬í•œ ì¶œë ¥ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\u003c/p\u003e\n\u003cimg src=\"/TIL/assets/img/2024-07-09-UsingCeleryRabbitMQWithFastAPI_2.png\"\u003e\n\u003c!-- TIL ìˆ˜í‰ --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003eìœ„ ì´ë¯¸ì§€ì—ì„œ [ì‘ì—…] ì„¹ì…˜ ì•„ë˜ì—ì„œ celery_tasks.py íŒŒì¼ì— ì •ì˜í•œ celery ì‘ì—…ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‘ì—… ëŒ€ê¸°ì—´ì´ ìƒˆ ì‘ì—…ì„ ë°›ìœ¼ë©´ celeryê°€ í•´ë‹¹ ì‘ì—…ì„ ì‹¤í–‰í•©ë‹ˆë‹¤. ì´ì œ FastAPI ì„œë²„ë¥¼ ì‹¤í–‰í•´ ë´…ì‹œë‹¤.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003euvicorn app.\u003cspan class=\"hljs-property\"\u003emain\u003c/span\u003e:app --port \u003cspan class=\"hljs-number\"\u003e8000\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eSwagger ë¬¸ì„œ í˜ì´ì§€ì—ì„œ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì‹œë„í•´ ë´…ì‹œë‹¤. ì—”ë“œí¬ì¸íŠ¸ì— ìš”ì²­ì„ ë³´ë‚¸ í›„ celery í„°ë¯¸ë„ì„ í™•ì¸í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì¶œë ¥ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\u003c/p\u003e\n\u003cimg src=\"/TIL/assets/img/2024-07-09-UsingCeleryRabbitMQWithFastAPI_3.png\"\u003e\n\u003c!-- TIL ìˆ˜í‰ --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003eì‘ì—…ì„ ë°›ì•˜ê³ , ì‘ì—…ì„ ì‹¤í–‰í•˜ê¸° ì‹œì‘í–ˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ì‹¤í–‰ì´ ì™„ë£Œëœ í›„ì—ëŠ” ì‘ì—…ì´ ì„±ê³µí–ˆë‹¤ê³  í•©ë‹ˆë‹¤. ì´ëŠ” ìš°ë¦¬ì˜ ì‘ì—…ì´ FastAPI ì„œë²„ì— ì˜í•´ ì‹¤í–‰ë˜ëŠ” ê²ƒì´ ì•„ë‹Œ celery ì›Œì»¤ì— ì˜í•´ ì‹¤í–‰ëœë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.\u003c/p\u003e\n\u003ch2\u003eì‘ì—… ëª¨ë‹ˆí„°ë§\u003c/h2\u003e\n\u003cp\u003eCelery ì‘ì—…ê³¼ ì›Œì»¤ë¥¼ ëª¨ë‹ˆí„°ë§í•˜ê¸° ìœ„í•´ Flowerë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Flowerë¥¼ ì„¤ì¹˜í•´ë³´ê² ìŠµë‹ˆë‹¤.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003epip install flower\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- TIL ìˆ˜í‰ --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003eë¡œì»¬ ë¨¸ì‹ ì—ì„œ flowerë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003ecelery flower --app app.\u003cspan class=\"hljs-property\"\u003econfig\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ecelery_config\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ecelery_app\u003c/span\u003e --\u003cspan class=\"hljs-attr\"\u003ebroker\u003c/span\u003e:\u003cspan class=\"hljs-attr\"\u003eamqp\u003c/span\u003e:\u003cspan class=\"hljs-comment\"\u003e//localhost//\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eì›¹ ë¸Œë¼ìš°ì €ì—ì„œ flower ëª¨ë‹ˆí„°ë§ ë„êµ¬ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. \u003ca href=\"http://localhost:5555/\" rel=\"nofollow\" target=\"_blank\"\u003ehttp://localhost:5555/\u003c/a\u003e ìœ¼ë¡œ ì´ë™í•˜ì„¸ìš”.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/TIL/assets/img/2024-07-09-UsingCeleryRabbitMQWithFastAPI_4.png\" alt=\"Flower Monitoring Tool\"\u003e\u003c/p\u003e\n\u003c!-- TIL ìˆ˜í‰ --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003eìš”ì¦˜ FastAPI í”„ë¡œì íŠ¸ì—ì„œ Celery + RabbitMQë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ì†Œê°œí–ˆì–´. ì—¬ê¸°ì„œ ì–´ë–¤ ì¼ì´ ë²Œì–´ì§€ëŠ”ì§€ ì´í•´í•  ìˆ˜ ìˆì„ ê±°ì•¼. ì´ê±´ ì´ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ê°€ì¥ ê°„ë‹¨í•œ ë°©ë²•ì´ì•¼. ë‚˜ëŠ” ê¸°ë³¸ ì‘ì—… ëŒ€ê¸°ì—´ì„ ì‚¬ìš©í–ˆì–´. ì›í•œë‹¤ë©´ ë” ë§ì€ ì‘ì—… ëŒ€ê¸°ì—´ì„ ìƒì„±í•  ìˆ˜ë„ ìˆì–´. ê·¸ë¦¬ê³  ë” ë§ì€ êµ¬ì„± ê°€ëŠ¥í•œ ì‚¬í•­ë“¤ë„ ìˆì–´. ê·¸ë“¤ì˜ ì„¤ëª…ì„œë¥¼ í™•ì¸í•´ë´. ì‘ì—… ì™„ë£Œ ìƒíƒœë¥¼ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì•Œë¦¬ê¸° ìœ„í•´ WebSocketì„ ì‚¬ìš©í•  ìˆ˜ë„ ìˆì–´. ì´ê²Œ ì „ë¶€ì•¼. ë‹¤ìŒ ë¸”ë¡œê·¸ì—ì„œ ë§Œë‚˜ì. ì¦ê±°ìš´ ì½”ë”©ì´ ë˜ê¸¸!\u003c/p\u003e\n\u003ch1\u003eStackademic ğŸ“\u003c/h1\u003e\n\u003cp\u003eëê¹Œì§€ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•´ìš”. ë– ë‚˜ì‹œê¸° ì „ì— ì´ëŸ° ì  ìœ ì˜í•´ì£¼ì„¸ìš”:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eë°•ìˆ˜ë¥¼ ì¹˜ê³  ì‘ê°€ë¥¼ íŒ”ë¡œìš°í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ì–´ìš”! ğŸ‘\u003c/li\u003e\n\u003cli\u003eì €í¬ë¥¼ íŒ”ë¡œìš°í•´ì£¼ì„¸ìš” X | LinkedIn | YouTube | Discord\u003c/li\u003e\n\u003cli\u003eë‹¤ë¥¸ í”Œë«í¼ë„ ë°©ë¬¸í•´ë³´ì„¸ìš”: In Plain English | CoFeed | Differ\u003c/li\u003e\n\u003cli\u003eStackademic.comì—ì„œ ë” ë§ì€ ì½˜í…ì¸ ë¥¼ ë§Œë‚˜ë³´ì„¸ìš”\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-07-09-UsingCeleryRabbitMQWithFastAPI"},"buildId":"N1mNhRlQaHCliEGDvPEpG","assetPrefix":"/TIL","isFallback":false,"gsp":true,"scriptLoader":[{"async":true,"src":"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4877378276818686","strategy":"lazyOnload","crossOrigin":"anonymous"}]}</script></body></html>