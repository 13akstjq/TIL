<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>유튜브 영상을 요약하는 서버리스 API 배포하는 방법 | TIL</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://13akstjq.github.io/TIL//post/2024-07-12-HowtoDeployaServerlessAPIThatSummarizesYouTubeVideos" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="유튜브 영상을 요약하는 서버리스 API 배포하는 방법 | TIL" data-gatsby-head="true"/><meta property="og:title" content="유튜브 영상을 요약하는 서버리스 API 배포하는 방법 | TIL" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/TIL/assets/img/2024-07-12-HowtoDeployaServerlessAPIThatSummarizesYouTubeVideos_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://TIL.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://13akstjq.github.io/TIL//post/2024-07-12-HowtoDeployaServerlessAPIThatSummarizesYouTubeVideos" data-gatsby-head="true"/><meta name="twitter:title" content="유튜브 영상을 요약하는 서버리스 API 배포하는 방법 | TIL" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/TIL/assets/img/2024-07-12-HowtoDeployaServerlessAPIThatSummarizesYouTubeVideos_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | TIL" data-gatsby-head="true"/><meta name="article:published_time" content="2024-07-12 19:43" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/TIL/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/TIL/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/TIL/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/TIL/favicons/favicon-96x96.png"/><link rel="icon" href="/TIL/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/TIL/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/TIL/favicons/browserconfig.xml"/><link rel="preload" href="/TIL/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/TIL/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/TIL/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/TIL/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/TIL/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/TIL/_next/static/chunks/webpack-21ffe88bdca56cba.js" defer=""></script><script src="/TIL/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/TIL/_next/static/chunks/main-a5eeabb286676ce6.js" defer=""></script><script src="/TIL/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/TIL/_next/static/chunks/75fc9c18-ac4aa08aae62f90e.js" defer=""></script><script src="/TIL/_next/static/chunks/463-925361deb4cec4b1.js" defer=""></script><script src="/TIL/_next/static/chunks/pages/post/%5Bslug%5D-9d7ebbd29b9e08ce.js" defer=""></script><script src="/TIL/_next/static/QAkYP0lvl03W-5CKD69kb/_buildManifest.js" defer=""></script><script src="/TIL/_next/static/QAkYP0lvl03W-5CKD69kb/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/TIL">TIL</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/TIL/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">유튜브 영상을 요약하는 서버리스 API 배포하는 방법</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="유튜브 영상을 요약하는 서버리스 API 배포하는 방법" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/TIL/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">TIL</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On Jul 12, 2024</span><span class="posts_reading_time__f7YPP">17<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-07-12-HowtoDeployaServerlessAPIThatSummarizesYouTubeVideos&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<p>이 게시물에서는 Google Cloud의 서버리스 클라우드 함수를 자동화하는 방법을 배울 수 있습니다.</p>
<p>이 어플리케이션은 항상 프로토타입을 만들고 싶었던 것을 수행할 것입니다: YouTube 비디오를 요약하는 것 📹.</p>
<p>현재 사용 가능한 강력한 LLM(Large Language Models), 확장 가능한 클라우드 아키텍처 및 효율적인 개발자 도구를 활용하여 이 아이디어를 실현하는 것이 이제 가능합니다.</p>
<p>그래서 이 프로젝트를 구축하는 데 다룰 내용은 다음과 같습니다:</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<ul>
<li>클라우드 함수 간단 소개</li>
<li>로컬에서 클라우드 함수 개발 및 테스트하는 방법</li>
<li>GCP에서 인프라 설계하고 클라우드 함수 배포하는 방법</li>
</ul>
<p>마지막으로, Python 코드만 사용하여 인프라 프로비저닝 및 클라우드 함수 배포할 것입니다. GCP UI를 조작하거나 다른 구문이 필요한 인프라 코드(IaC) 도구를 사용하지 않을 것입니다.</p>
<p>한 번 살펴보세요.</p>
<p>ML 콘텐츠, 상세한 튜토리얼 및 산업에서 실용적인 팁에 관심이 있다면, 제 뉴스레터를 팔로우하세요. The Tech Buffet이라고 합니다.</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h1>클라우드 함수란 무엇인가요?</h1>
<p>클라우드 함수는 구글 클라우드 서비스로, 서버나 컨테이너를 관리할 필요가 없이 클라우드에서 코드를 실행할 수 있도록 하는 서비스입니다. 그리고 확장 가능하고 비용 효율적인 방식으로 작동합니다.</p>
<p>이것이 바로 클라우드 함수가 서버리스라고 불리는 이유입니다.</p>
<p>클라우드 함수를 사용하면 개발자 경험이 간단합니다. 로컬에서 코드를 작성하고 테스트한 후에 해당 코드를 구글 클라우드에 전송하여 배포하고 운영 인프라를 관리할 수 있습니다.</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>구름 함수의 두 번째 훌륭한 기능은 비용입니다: 사용한 만큼만 지불하게 됩니다. 구체적으로 말하면 함수의 실행 시간에 대한 비용을 청구하며, 100밀리초 단위로 측정됩니다. 그리고 함수가 유휴 상태인 경우에는 아무런 비용도 발생하지 않습니다!</p>
<p>구름 함수는 주로 다른 시스템(예: 구름 스토리지 또는 PubSub)에서 트리거되는 단기적 이벤트 기반 작업을 처리하는 데 설계되었습니다.</p>
<p>예를 들어, 버킷에 파일이 저장될 때나 BigQuery에 행이 삽입될 때 트리거되는 구름 함수를 만들 수 있습니다.</p>
<p>또한 알림을 보내거나 다른 시스템을 트리거하는 데 구름 함수가 사용되는 것을 자주 볼 수 있습니다.</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h1>로컬에서 클라우드 함수 개발 및 테스트하기</h1>
<p>이 작은 프로젝트에서 우리가 만들 클라우드 함수는 REST API로 작동합니다. YouTube URL로 구성된 사용자 입력을 받아 요약 내용을 반환할 것입니다.</p>
<p>GCP에 배포하기 전에 먼저 이 함수를 로컬에서 빌드하고 테스트해 봅시다.</p>
<p>YouTube 비디오를 요약하기 위해 다음 Python 라이브러리가 필요합니다:</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<ul>
<li>youtube-transcript-api: YouTube 비디오에서 자막을 추출하는 데 사용됩니다.</li>
<li>langchain 및 langchain-openai: OpenAI 언어 모델과 상호 작용하여 요약을 생성하는 데 사용됩니다.</li>
<li>python-dotenv: OpenAI 자격 증명을 환경 변수로로드하는 데 사용됩니다.</li>
<li>functions-framework: 이식 가능한 파이썬 함수를 작성하고 로컬에서 테스트하는 FaaS (Function as a Service) 프레임워크</li>
</ul>
<p>시작하기 가장 간단한 방법은 가상 환경을 만드는 것입니다:</p>
<pre><code class="hljs language-js">python -m venv ./venv
source venv/bin/activate
pip install -r <span class="hljs-keyword">function</span>/requirements.<span class="hljs-property">txt</span>
</code></pre>
<p>그런 다음, 함수의 코드는 function/main.py 파일에 정의됩니다:</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>비디오를 요약할 주요 기능을 여기에 소개합니다 (더 자세한 내용은 repo에서 나머지 코드를 확인하세요):</p>
<p>→ 먼저 비디오 대본과 제목을 추출하고 LLM을 초기화한 후, 프롬프트를 작성하여 LLM에 요약을 보냅니다.</p>
<pre><code class="hljs language-js">def <span class="hljs-title function_">summarize_youtube_video</span>(url, additional_instructions):
    transcript = <span class="hljs-title function_">get_youtube_video_transcript</span>(url)
    title = <span class="hljs-title function_">get_youtube_video_title</span>(url)
    llm = <span class="hljs-title class_">OpenAI</span>(api_key=os.<span class="hljs-property">environ</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">"OPENAI_API_KEY"</span>))
    prompt = <span class="hljs-title function_">get_prompt</span>(title, transcript, additional_instructions)
    summary = llm.<span class="hljs-title function_">predict</span>(prompt)
    data = {
        <span class="hljs-string">"url"</span>: url,
        <span class="hljs-string">"title"</span>: title,
        <span class="hljs-string">"summary"</span>: summary,
        <span class="hljs-string">"transcript"</span>: transcript,
    }
    <span class="hljs-keyword">return</span> data
</code></pre>
<p>이 논리를 REST API로 래핑하기 위해 functions_framework 패키지를 사용할 것입니다. 이를 통해 HTTP 요청이 전송되면 호출되는 Cloud Function 핸들러(또는 entry point)를 정의할 수 있습니다:</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-python"><span class="hljs-meta">@functions_framework.http</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>(<span class="hljs-params">request: flask.Request</span>):
    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">"POST"</span>:
        url = request.form.get(<span class="hljs-string">"url"</span>)
        additional_instructions = request.form.get(<span class="hljs-string">"instructions"</span>)
        data = summarize_youtube_video(url, additional_instructions)
        <span class="hljs-keyword">return</span> flask.jsonify(data)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Method Not Allowed"</span>, <span class="hljs-number">400</span>
</code></pre>
<p>전체 클라우드 함수 코드는 여기에서 확인할 수 있습니다.</p>
<p>클라우드 함수를 로컬에서 테스트하려면 다음 명령을 실행하세요:</p>
<pre><code class="hljs language-bash">functions-framework --target=main --<span class="hljs-built_in">source</span>=<span class="hljs-keyword">function</span>/main.py --debug
</code></pre>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>해당 명령어를 실행하면 로컬 웹 서버가 시작됩니다. 그래서 Postman을 열어 몇 가지 요청을 보내 봅시다:</p>
<p>Terraform과 Pulumi 간의 차이점에 대해 논의하는 비디오를 보내 봅시다:</p>
<p>URL을 입력하고 전송 버튼을 클릭하여 양식 데이터를 채우면 다음 결과를 얻을 수 있습니다: summary, title, transcript (전체 텍스트), URL.</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>여기서 요약을 자세히 살펴보겠습니다:</p>
<pre><code class="hljs language-js"><span class="hljs-title class_">Terraform</span>과 <span class="hljs-title class_">Pulumi</span>는 <span class="hljs-title class_">DevOps</span> 세계에서 자주 비교되는 두 가지 도구입니다. <span class="hljs-title class_">Terraform</span>은 상태를 정의하는 일관성으로 유명한 반면 <span class="hljs-title class_">Pulumi</span>는 <span class="hljs-title class_">Python</span> 및 C#과 같은 명령형 프로그래밍 언어를 사용하여 보다 유연한 접근 방식을 제공합니다. 그러나 이는 팀으로 작업하거나 조직을 변경할 때 잠재적인 문제를 야기할 수도 있습니다.\n\n반면 <span class="hljs-title class_">Terraform</span>은 <span class="hljs-variable constant_">HCL</span> (<span class="hljs-title class_">Hashicorp</span> <span class="hljs-title class_">Configuration</span> <span class="hljs-title class_">Language</span>)을 사용하여 상태를 더 제한적이고 일관된 방식으로 정의합니다. 이를 통해 더 쉬운 협업과 상태 파일을 보다 안전하게 관리할 수 있습니다. 게다가 <span class="hljs-title class_">Terraform</span>은 <span class="hljs-title class_">SaaS</span> 제품이 아니기 때문에 상태가 자동으로 원격 네트워크로 푸시되지 않습니다. 민감한 정보를 다룰 때 이는 고려할 사항일 수 있습니다.\n\n총론적으로 발표자는 단순성과 일관성을 이유로 <span class="hljs-title class_">Pulumi</span> 대신 <span class="hljs-title class_">Terraform</span>을 강력히 선호합니다. 또한 <span class="hljs-title class_">Terraform</span>은 지원을 제공하고 모든 질문에 답변할 수 있는 거의 <span class="hljs-number">2</span>,<span class="hljs-number">000</span>명의 커뮤니티를 갖고 있다고 언급합니다. 마지막으로 발표자는 시청자들에게 <span class="hljs-title class_">Terraform</span>을 가장 간단한 형태로 사용하고 복잡한 것을 피하라고 권장합니다.
</code></pre>
<p>이 튜토리얼을 재현하면 Postman 클라이언트와 함께 놀 수 있고, 다른 비디오를 시도하고 심지어 LLM에 사용자 정의 지침을 추가할 수 있습니다.</p>
<p>다음 예시에서 LLM에게 프랑스어로 대답하도록 요청할 수 있습니다.</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>클라우드 함수가 로컬에서 테스트되었습니다.</p>
<p>이제 배포할 준비가 되었어요 👇.</p>
<h1>클라우드 함수를 위한 인프라 프로비저닝</h1>
<p>몇 년 전에 클라우드 함수를 배포해 달라고 요청하면, 저는 기쁜 마음으로 GCP 콘솔에 로그인하고 소스 코드를 버킷에 넣은 다음 UI에서 클라우드 함수를 생성하고 Google Secret Manager에 비밀 정보를 추가하고 앱에 연결하고 배포 버튼을 눌렀을 거예요.</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>만약 우리가 소스 코드를 변경할 때마다 이러한 단계들을 수행한다면, 이것은:</p>
<ul>
<li>지루할 것이다</li>
<li>오류 발생 가능성이 높을 것이다</li>
<li>코드베이스 안에서 추적하기 어려울 것이다</li>
<li>협업하기 어려울 것이다</li>
</ul>
<h2>풀루미 🚀</h2>
<p>풀루미(Pulumi)는 이미 알고 있는 프로그래밍 언어를 사용하여 어떠한 아키텍처나 클라우드 공급자에도 인프라를 구축하고 배포하는 데 도움을 주는 SDK입니다(예: Python, TypeScript, Java 등).</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>Pulumi를 시작하려면 다음과 같이 설치하고 구성해야 합니다:</p>
<h2>👉 Pulumi 다운로드 및 구성 ⚙️</h2>
<ul>
<li>Mac을 사용 중이라면 Homebrew로 Pulumi를 설치할 수 있습니다</li>
</ul>
<pre><code class="hljs language-js">brew install pulumi/tap/pulumi
</code></pre>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<ul>
<li>다른 OS를 사용 중이라면 대안들을 확인해보세요.</li>
</ul>
<pre><code class="hljs language-js">gcloud config set project &#x3C;<span class="hljs-variable constant_">YOUR_GCP_PROJECT_ID</span>>
</code></pre>
<ul>
<li>Pulumi는 Google Cloud 리소스와 상호 작용하기 위해 기본 애플리케이션 자격 증명을 필요로 합니다. 따라서 인증 애플리케이션 기본 로그인 명령을 실행하여 해당 자격 증명을 얻어야 합니다.</li>
</ul>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js">gcloud auth application-<span class="hljs-keyword">default</span> login
</code></pre>
<ul>
<li>Pulumi이 GCP 계정으로 구성된 후 Pulumi 프로젝트를 만들 수 있습니다.
폴더의 루트에 Pulumi.yaml이라는 YAML 파일을 만들고 다음 라인을 붙여넣습니다:</li>
</ul>
<pre><code class="hljs language-js"><span class="hljs-attr">name</span>: youtube-summarizer
<span class="hljs-attr">runtime</span>:
  <span class="hljs-attr">name</span>: python
  <span class="hljs-attr">options</span>:
    <span class="hljs-attr">virtualenv</span>: venv
<span class="hljs-attr">backend</span>:
  <span class="hljs-attr">url</span>: <span class="hljs-attr">gs</span>:<span class="hljs-comment">//pulumi-gcp-state/main</span>
<span class="hljs-attr">description</span>: A minimal <span class="hljs-title class_">Google</span> <span class="hljs-title class_">Cloud</span> <span class="hljs-title class_">Python</span> <span class="hljs-title class_">Pulumi</span> program
<span class="hljs-attr">config</span>:
  <span class="hljs-attr">pulumi</span>:<span class="hljs-attr">tags</span>:
    <span class="hljs-attr">value</span>:
      <span class="hljs-attr">pulumi</span>:<span class="hljs-attr">template</span>: <span class="hljs-string">""</span>
</code></pre>
<p>이 파일은 런타임(Python)을 정의하고, virtualenv 폴더를 가리키며, Pulumi가 인프라의 상태를 저장하는 백엔드 URL을 설정합니다. Pulumi는 다른 백엔드를 사용할 수 있으며, 이 예시에서는 Google Cloud Storage를 사용합니다.</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>다음 명령을 실행하여 올바른 매개변수로 Pulumi를 구성하세요:</p>
<pre><code class="hljs language-js">pulumi config set <span class="hljs-attr">gcp</span>:region &#x3C;<span class="hljs-variable constant_">GCP</span>-<span class="hljs-variable constant_">REGION</span>>
pulumi config set <span class="hljs-attr">gcp</span>:project &#x3C;<span class="hljs-variable constant_">GCP</span>-<span class="hljs-variable constant_">PROJECT</span>-<span class="hljs-variable constant_">ID</span>>
</code></pre>
<p>첫 번째 명령을 실행하면 Pulumi가 스택의 이름을 선택하라는 메시지가 표시됩니다. 이 스택은 Pulumi 프로젝트가 배포될 환경입니다.</p>
<p>저는 방금 'dev'를 선택했어요.</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>구성이 완료되면 다음 내용이 포함된 Pulumi.dev.yaml 파일이 생성됩니다:</p>
<pre><code class="hljs language-js"><span class="hljs-attr">encryptionsalt</span>: <span class="hljs-attr">v1</span>:<span class="hljs-title class_">GJeieppLoAs</span>=:<span class="hljs-attr">v1</span>:tglu/3<span class="hljs-attr">T2fbOmQs59</span>:ahQNXFSYgfQsvRp1J4GB4e670KOffg==
<span class="hljs-attr">config</span>:
  <span class="hljs-attr">gcp</span>:<span class="hljs-attr">project</span>: playground-<span class="hljs-number">351113</span>
  <span class="hljs-attr">gcp</span>:<span class="hljs-attr">region</span>: europe-west1
</code></pre>
<h2>👉 Pulumi를 사용하여 인프라 정의하기</h2>
<p>Pulumi 코드로 인프라를 작성하기 전에 앱 아키텍처를 정의한 다음 보여드릴게요. 이것을 통해 필요한 서비스를 이해할 수 있을 거예요.</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>다수의 구성 요소가 함께 작동합니다:</p>
<ul>
<li>클라우드 함수의 코드를 저장하는 버킷</li>
<li>OpenAI API 키를 저장하는 시크릿 매니저</li>
<li>귀하를 대신하여 클라우드 함수 리소스 액세스를 부여하는 서비스 계정</li>
<li>서비스 계정이 시크릿 매니저에 액세스할 수 있도록 하는 IAM 정책</li>
<li>Cloud Run에서 Cloud 함수를 호출할 수 있게 하는 IAM 호출자 역할(Cloud Functions의 2세대는 Cloud Run에서 관리됩니다)</li>
</ul>
<p>모든 이 서비스들은 <strong>main</strong>.py 파일에서 명령적인 방식으로 정의될 것입니다:</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>한 번에 하나씩 살펴봐요:</p>
<ul>
<li>소스 코드가 담긴 버킷:</li>
</ul>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> pulumi <span class="hljs-keyword">import</span> asset, <span class="hljs-keyword">export</span>
<span class="hljs-keyword">import</span> pulumi_gcp <span class="hljs-keyword">as</span> gcp
<span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv

<span class="hljs-title function_">load_dotenv</span>()

#### 버킷 생성 및 코드 업로드

bucket = gcp.<span class="hljs-property">storage</span>.<span class="hljs-title class_">Bucket</span>(<span class="hljs-string">"bucket"</span>, location=<span class="hljs-string">"EU"</span>)

archive = gcp.<span class="hljs-property">storage</span>.<span class="hljs-title class_">BucketObject</span>(
    <span class="hljs-string">"python-zip"</span>,
    name=<span class="hljs-string">"python-code.zip"</span>,
    bucket=bucket.<span class="hljs-property">name</span>,
    source=asset.<span class="hljs-title class_">AssetArchive</span>({<span class="hljs-string">"."</span>: asset.<span class="hljs-title class_">FileArchive</span>(<span class="hljs-string">"./function"</span>)}),
)
</code></pre>
<ul>
<li>비밀값과 그 값</li>
</ul>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js">#### 비밀 생성

secret = gcp.<span class="hljs-property">secretmanager</span>.<span class="hljs-title class_">Secret</span>(
    <span class="hljs-string">"openai-api-key"</span>,
    replication=gcp.<span class="hljs-property">secretmanager</span>.<span class="hljs-title class_">SecretReplicationArgs</span>(
        auto=gcp.<span class="hljs-property">secretmanager</span>.<span class="hljs-title class_">SecretReplicationAutoArgs</span>(),
    ),
    secret_id=<span class="hljs-string">"openai-secret"</span>,
)
secret_version = gcp.<span class="hljs-property">secretmanager</span>.<span class="hljs-title class_">SecretVersion</span>(
    <span class="hljs-string">"1"</span>,
    secret=secret.<span class="hljs-property">name</span>,
    secret_data=os.<span class="hljs-property">environ</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">"OPENAI_API_KEY"</span>),
)
</code></pre>
<ul>
<li>서비스 계정</li>
</ul>
<pre><code class="hljs language-js">#### 서비스 계정 생성

service_account = gcp.<span class="hljs-property">serviceaccount</span>.<span class="hljs-title class_">Account</span>(
    <span class="hljs-string">"service-account"</span>,
    account_id=<span class="hljs-string">"service-account-id"</span>,
    display_name=<span class="hljs-string">"Summarizer Service Account"</span>,
)

service_account_email = service_account.<span class="hljs-property">email</span>.<span class="hljs-title function_">apply</span>(
    lambda <span class="hljs-attr">email</span>: f<span class="hljs-string">"serviceAccount:{email}"</span>
)
</code></pre>
<ul>
<li>서비스 계정에 대한 IAM 정책을 비밀에 액세스하도록 설정하기</li>
</ul>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js">secret_accessor = gcp.<span class="hljs-property">organizations</span>.<span class="hljs-title function_">get_iam_policy</span>(
    bindings=[
        gcp.<span class="hljs-property">organizations</span>.<span class="hljs-title class_">GetIAMPolicyBindingArgs</span>(
            role=<span class="hljs-string">"roles/secretmanager.secretAccessor"</span>,
            members=[service_account_email],
        )
    ]
)

secret_iam_policy = gcp.<span class="hljs-property">secretmanager</span>.<span class="hljs-title class_">SecretIamPolicy</span>(
    <span class="hljs-string">"my-secret-iam-policy"</span>,
    secret_id=secret.<span class="hljs-property">id</span>,
    project=gcp.<span class="hljs-property">config</span>.<span class="hljs-property">project</span>,
    policy_data=secret_accessor.<span class="hljs-property">policy_data</span>,
)
</code></pre>
<ul>
<li>클라우드 기능</li>
</ul>
<pre><code class="hljs language-js">#### 클라우드 기능 생성

cloud_function = gcp.<span class="hljs-property">cloudfunctionsv2</span>.<span class="hljs-title class_">Function</span>(
    resource_name=<span class="hljs-string">"cloud-function"</span>,
    location=<span class="hljs-string">"europe-west1"</span>,
    build_config=gcp.<span class="hljs-property">cloudfunctionsv2</span>.<span class="hljs-title class_">FunctionBuildConfigArgs</span>(
        entry_point=<span class="hljs-string">"main"</span>,
        runtime=<span class="hljs-string">"python39"</span>,
        source=gcp.<span class="hljs-property">cloudfunctionsv2</span>.<span class="hljs-title class_">FunctionBuildConfigSourceArgs</span>(
            storage_source=gcp.<span class="hljs-property">cloudfunctionsv2</span>.<span class="hljs-title class_">FunctionBuildConfigSourceStorageSourceArgs</span>(
                bucket=bucket.<span class="hljs-property">name</span>,
                object=archive.<span class="hljs-property">name</span>,
            )
        ),
    ),
    service_config=gcp.<span class="hljs-property">cloudfunctionsv2</span>.<span class="hljs-title class_">FunctionServiceConfigArgs</span>(
        available_memory=<span class="hljs-string">"256M"</span>,
        ingress_settings=<span class="hljs-string">"ALLOW_ALL"</span>,
        timeout_seconds=<span class="hljs-number">60</span>,
        service_account_email=service_account.<span class="hljs-property">email</span>,
        secret_environment_variables=[
            gcp.<span class="hljs-property">cloudfunctionsv2</span>.<span class="hljs-title class_">FunctionServiceConfigSecretEnvironmentVariableArgs</span>(
                key=<span class="hljs-string">"OPENAI_API_KEY"</span>,
                version=<span class="hljs-string">"1"</span>,
                project_id=gcp.<span class="hljs-property">config</span>.<span class="hljs-property">project</span>,
                secret=<span class="hljs-string">"openai-secret"</span>,
            )
        ],
    ),
)
</code></pre>
<ul>
<li>클라우드 런 IAM 바인딩</li>
</ul>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js">#### <span class="hljs-title class_">Cloud</span> <span class="hljs-title class_">Run</span>에 인보커 역할 추가

binding = gcp.<span class="hljs-property">cloudrun</span>.<span class="hljs-title class_">IamBinding</span>(
    <span class="hljs-string">"binding"</span>,
    location=cloud_function.<span class="hljs-property">location</span>,
    service=cloud_function.<span class="hljs-property">name</span>,
    role=<span class="hljs-string">"roles/run.invoker"</span>,
    members=[<span class="hljs-string">"allUsers"</span>],
)
</code></pre>
<ul>
<li>Pulumi의 출력: Cloud Function 엔드포인트 URL</li>
</ul>
<pre><code class="hljs language-js"><span class="hljs-title function_">export</span>(<span class="hljs-string">"python_endpoint"</span>, cloud_function.<span class="hljs-property">service_config</span>.<span class="hljs-title function_">apply</span>(lambda <span class="hljs-attr">sc</span>: sc.<span class="hljs-property">uri</span>))
</code></pre>
<p>이 변경 사항을 배포하려면, 아래 명령어를 실행하면 됩니다:</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js">pulumi up
</code></pre>
<p>업데이트를 하기 전에 Pulumi는 먼저 미리보기를 보여주고 사용자가 확인을 하면 리소스가 생성됩니다.</p>
<img src="/TIL/assets/img/2024-07-12-HowtoDeployaServerlessAPIThatSummarizesYouTubeVideos_1.png">
<p>이 엔드포인트를 Postman에서 시도함으로써 API가 작동하는지 확인할 수 있습니다.</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h2>👉 자원 정리하기</h2>
<p>클라우드 함수 프로토타입 작업이 완료되면 스택을 파괴하고 모든 리소스를 제거할 수 있어요.</p>
<pre><code class="hljs language-js">pulumi destroy
</code></pre>
<h1>결론</h1>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>GCP 서비스를 백엔드로 사용하는 서버리스 애플리케이션을 Pulumi와 같은 Infrastructure-as-code (IaC) 도구로 구축할 수 있어요.</p>
<p>이는 유연성을 제공하고 자동화를 높이며, 클라우드 리소스를 UI에서 조작할 때 발생하는 오류를 줄여줘요.</p>
<p>Pulumi는 다양한 기능을 제공하며, 다른 클라우드 서비스와 원활하게 통합돼요. 자세한 내용은 문서를 확인해보세요.</p>
<p>다음에 또 뵐게요! 👋</p>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"유튜브 영상을 요약하는 서버리스 API 배포하는 방법","description":"","date":"2024-07-12 19:43","slug":"2024-07-12-HowtoDeployaServerlessAPIThatSummarizesYouTubeVideos","content":"\n\n이 게시물에서는 Google Cloud의 서버리스 클라우드 함수를 자동화하는 방법을 배울 수 있습니다.\n\n이 어플리케이션은 항상 프로토타입을 만들고 싶었던 것을 수행할 것입니다: YouTube 비디오를 요약하는 것 📹.\n\n현재 사용 가능한 강력한 LLM(Large Language Models), 확장 가능한 클라우드 아키텍처 및 효율적인 개발자 도구를 활용하여 이 아이디어를 실현하는 것이 이제 가능합니다.\n\n그래서 이 프로젝트를 구축하는 데 다룰 내용은 다음과 같습니다:\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n- 클라우드 함수 간단 소개\n- 로컬에서 클라우드 함수 개발 및 테스트하는 방법\n- GCP에서 인프라 설계하고 클라우드 함수 배포하는 방법\n\n마지막으로, Python 코드만 사용하여 인프라 프로비저닝 및 클라우드 함수 배포할 것입니다. GCP UI를 조작하거나 다른 구문이 필요한 인프라 코드(IaC) 도구를 사용하지 않을 것입니다.\n\n한 번 살펴보세요.\n\nML 콘텐츠, 상세한 튜토리얼 및 산업에서 실용적인 팁에 관심이 있다면, 제 뉴스레터를 팔로우하세요. The Tech Buffet이라고 합니다.\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n# 클라우드 함수란 무엇인가요?\n\n클라우드 함수는 구글 클라우드 서비스로, 서버나 컨테이너를 관리할 필요가 없이 클라우드에서 코드를 실행할 수 있도록 하는 서비스입니다. 그리고 확장 가능하고 비용 효율적인 방식으로 작동합니다.\n\n이것이 바로 클라우드 함수가 서버리스라고 불리는 이유입니다.\n\n클라우드 함수를 사용하면 개발자 경험이 간단합니다. 로컬에서 코드를 작성하고 테스트한 후에 해당 코드를 구글 클라우드에 전송하여 배포하고 운영 인프라를 관리할 수 있습니다.\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n구름 함수의 두 번째 훌륭한 기능은 비용입니다: 사용한 만큼만 지불하게 됩니다. 구체적으로 말하면 함수의 실행 시간에 대한 비용을 청구하며, 100밀리초 단위로 측정됩니다. 그리고 함수가 유휴 상태인 경우에는 아무런 비용도 발생하지 않습니다!\n\n구름 함수는 주로 다른 시스템(예: 구름 스토리지 또는 PubSub)에서 트리거되는 단기적 이벤트 기반 작업을 처리하는 데 설계되었습니다.\n\n예를 들어, 버킷에 파일이 저장될 때나 BigQuery에 행이 삽입될 때 트리거되는 구름 함수를 만들 수 있습니다.\n\n또한 알림을 보내거나 다른 시스템을 트리거하는 데 구름 함수가 사용되는 것을 자주 볼 수 있습니다.\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n# 로컬에서 클라우드 함수 개발 및 테스트하기\n\n이 작은 프로젝트에서 우리가 만들 클라우드 함수는 REST API로 작동합니다. YouTube URL로 구성된 사용자 입력을 받아 요약 내용을 반환할 것입니다.\n\nGCP에 배포하기 전에 먼저 이 함수를 로컬에서 빌드하고 테스트해 봅시다.\n\nYouTube 비디오를 요약하기 위해 다음 Python 라이브러리가 필요합니다:\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n- youtube-transcript-api: YouTube 비디오에서 자막을 추출하는 데 사용됩니다.\n- langchain 및 langchain-openai: OpenAI 언어 모델과 상호 작용하여 요약을 생성하는 데 사용됩니다.\n- python-dotenv: OpenAI 자격 증명을 환경 변수로로드하는 데 사용됩니다.\n- functions-framework: 이식 가능한 파이썬 함수를 작성하고 로컬에서 테스트하는 FaaS (Function as a Service) 프레임워크\n\n시작하기 가장 간단한 방법은 가상 환경을 만드는 것입니다:\n\n```js\npython -m venv ./venv\nsource venv/bin/activate\npip install -r function/requirements.txt\n```\n\n그런 다음, 함수의 코드는 function/main.py 파일에 정의됩니다:\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n비디오를 요약할 주요 기능을 여기에 소개합니다 (더 자세한 내용은 repo에서 나머지 코드를 확인하세요):\n\n→ 먼저 비디오 대본과 제목을 추출하고 LLM을 초기화한 후, 프롬프트를 작성하여 LLM에 요약을 보냅니다.\n\n```js\ndef summarize_youtube_video(url, additional_instructions):\n    transcript = get_youtube_video_transcript(url)\n    title = get_youtube_video_title(url)\n    llm = OpenAI(api_key=os.environ.get(\"OPENAI_API_KEY\"))\n    prompt = get_prompt(title, transcript, additional_instructions)\n    summary = llm.predict(prompt)\n    data = {\n        \"url\": url,\n        \"title\": title,\n        \"summary\": summary,\n        \"transcript\": transcript,\n    }\n    return data\n```\n\n이 논리를 REST API로 래핑하기 위해 functions_framework 패키지를 사용할 것입니다. 이를 통해 HTTP 요청이 전송되면 호출되는 Cloud Function 핸들러(또는 entry point)를 정의할 수 있습니다:\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```python\n@functions_framework.http\ndef main(request: flask.Request):\n    if request.method == \"POST\":\n        url = request.form.get(\"url\")\n        additional_instructions = request.form.get(\"instructions\")\n        data = summarize_youtube_video(url, additional_instructions)\n        return flask.jsonify(data)\n    else:\n        return \"Method Not Allowed\", 400\n```\n\n전체 클라우드 함수 코드는 여기에서 확인할 수 있습니다.\n\n클라우드 함수를 로컬에서 테스트하려면 다음 명령을 실행하세요:\n\n```bash\nfunctions-framework --target=main --source=function/main.py --debug\n```\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n해당 명령어를 실행하면 로컬 웹 서버가 시작됩니다. 그래서 Postman을 열어 몇 가지 요청을 보내 봅시다:\n\nTerraform과 Pulumi 간의 차이점에 대해 논의하는 비디오를 보내 봅시다:\n\nURL을 입력하고 전송 버튼을 클릭하여 양식 데이터를 채우면 다음 결과를 얻을 수 있습니다: summary, title, transcript (전체 텍스트), URL.\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n여기서 요약을 자세히 살펴보겠습니다:\n\n```js\nTerraform과 Pulumi는 DevOps 세계에서 자주 비교되는 두 가지 도구입니다. Terraform은 상태를 정의하는 일관성으로 유명한 반면 Pulumi는 Python 및 C#과 같은 명령형 프로그래밍 언어를 사용하여 보다 유연한 접근 방식을 제공합니다. 그러나 이는 팀으로 작업하거나 조직을 변경할 때 잠재적인 문제를 야기할 수도 있습니다.\\n\\n반면 Terraform은 HCL (Hashicorp Configuration Language)을 사용하여 상태를 더 제한적이고 일관된 방식으로 정의합니다. 이를 통해 더 쉬운 협업과 상태 파일을 보다 안전하게 관리할 수 있습니다. 게다가 Terraform은 SaaS 제품이 아니기 때문에 상태가 자동으로 원격 네트워크로 푸시되지 않습니다. 민감한 정보를 다룰 때 이는 고려할 사항일 수 있습니다.\\n\\n총론적으로 발표자는 단순성과 일관성을 이유로 Pulumi 대신 Terraform을 강력히 선호합니다. 또한 Terraform은 지원을 제공하고 모든 질문에 답변할 수 있는 거의 2,000명의 커뮤니티를 갖고 있다고 언급합니다. 마지막으로 발표자는 시청자들에게 Terraform을 가장 간단한 형태로 사용하고 복잡한 것을 피하라고 권장합니다.\n```\n\n이 튜토리얼을 재현하면 Postman 클라이언트와 함께 놀 수 있고, 다른 비디오를 시도하고 심지어 LLM에 사용자 정의 지침을 추가할 수 있습니다.\n\n다음 예시에서 LLM에게 프랑스어로 대답하도록 요청할 수 있습니다.\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n클라우드 함수가 로컬에서 테스트되었습니다.\n\n이제 배포할 준비가 되었어요 👇.\n\n# 클라우드 함수를 위한 인프라 프로비저닝\n\n몇 년 전에 클라우드 함수를 배포해 달라고 요청하면, 저는 기쁜 마음으로 GCP 콘솔에 로그인하고 소스 코드를 버킷에 넣은 다음 UI에서 클라우드 함수를 생성하고 Google Secret Manager에 비밀 정보를 추가하고 앱에 연결하고 배포 버튼을 눌렀을 거예요.\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n만약 우리가 소스 코드를 변경할 때마다 이러한 단계들을 수행한다면, 이것은:\n\n- 지루할 것이다\n- 오류 발생 가능성이 높을 것이다\n- 코드베이스 안에서 추적하기 어려울 것이다\n- 협업하기 어려울 것이다\n\n## 풀루미 🚀\n\n풀루미(Pulumi)는 이미 알고 있는 프로그래밍 언어를 사용하여 어떠한 아키텍처나 클라우드 공급자에도 인프라를 구축하고 배포하는 데 도움을 주는 SDK입니다(예: Python, TypeScript, Java 등).\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\nPulumi를 시작하려면 다음과 같이 설치하고 구성해야 합니다:\n\n## 👉 Pulumi 다운로드 및 구성 ⚙️\n\n- Mac을 사용 중이라면 Homebrew로 Pulumi를 설치할 수 있습니다\n\n```js\nbrew install pulumi/tap/pulumi\n```\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n- 다른 OS를 사용 중이라면 대안들을 확인해보세요.\n\n```js\ngcloud config set project \u003cYOUR_GCP_PROJECT_ID\u003e\n```\n\n- Pulumi는 Google Cloud 리소스와 상호 작용하기 위해 기본 애플리케이션 자격 증명을 필요로 합니다. 따라서 인증 애플리케이션 기본 로그인 명령을 실행하여 해당 자격 증명을 얻어야 합니다.\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\ngcloud auth application-default login\n```\n\n- Pulumi이 GCP 계정으로 구성된 후 Pulumi 프로젝트를 만들 수 있습니다.\n폴더의 루트에 Pulumi.yaml이라는 YAML 파일을 만들고 다음 라인을 붙여넣습니다:\n\n```js\nname: youtube-summarizer\nruntime:\n  name: python\n  options:\n    virtualenv: venv\nbackend:\n  url: gs://pulumi-gcp-state/main\ndescription: A minimal Google Cloud Python Pulumi program\nconfig:\n  pulumi:tags:\n    value:\n      pulumi:template: \"\"\n```\n\n이 파일은 런타임(Python)을 정의하고, virtualenv 폴더를 가리키며, Pulumi가 인프라의 상태를 저장하는 백엔드 URL을 설정합니다. Pulumi는 다른 백엔드를 사용할 수 있으며, 이 예시에서는 Google Cloud Storage를 사용합니다.\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n다음 명령을 실행하여 올바른 매개변수로 Pulumi를 구성하세요:\n\n```js\npulumi config set gcp:region \u003cGCP-REGION\u003e\npulumi config set gcp:project \u003cGCP-PROJECT-ID\u003e\n```\n\n첫 번째 명령을 실행하면 Pulumi가 스택의 이름을 선택하라는 메시지가 표시됩니다. 이 스택은 Pulumi 프로젝트가 배포될 환경입니다.\n\n저는 방금 'dev'를 선택했어요.\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n구성이 완료되면 다음 내용이 포함된 Pulumi.dev.yaml 파일이 생성됩니다:\n\n```js\nencryptionsalt: v1:GJeieppLoAs=:v1:tglu/3T2fbOmQs59:ahQNXFSYgfQsvRp1J4GB4e670KOffg==\nconfig:\n  gcp:project: playground-351113\n  gcp:region: europe-west1\n```\n\n## 👉 Pulumi를 사용하여 인프라 정의하기\n\nPulumi 코드로 인프라를 작성하기 전에 앱 아키텍처를 정의한 다음 보여드릴게요. 이것을 통해 필요한 서비스를 이해할 수 있을 거예요.\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n다수의 구성 요소가 함께 작동합니다:\n\n- 클라우드 함수의 코드를 저장하는 버킷\n- OpenAI API 키를 저장하는 시크릿 매니저\n- 귀하를 대신하여 클라우드 함수 리소스 액세스를 부여하는 서비스 계정\n- 서비스 계정이 시크릿 매니저에 액세스할 수 있도록 하는 IAM 정책\n- Cloud Run에서 Cloud 함수를 호출할 수 있게 하는 IAM 호출자 역할(Cloud Functions의 2세대는 Cloud Run에서 관리됩니다)\n\n모든 이 서비스들은 __main__.py 파일에서 명령적인 방식으로 정의될 것입니다:\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n한 번에 하나씩 살펴봐요:\n\n- 소스 코드가 담긴 버킷:\n\n```js\nimport os\nfrom pulumi import asset, export\nimport pulumi_gcp as gcp\nfrom dotenv import load_dotenv\n\nload_dotenv()\n\n#### 버킷 생성 및 코드 업로드\n\nbucket = gcp.storage.Bucket(\"bucket\", location=\"EU\")\n\narchive = gcp.storage.BucketObject(\n    \"python-zip\",\n    name=\"python-code.zip\",\n    bucket=bucket.name,\n    source=asset.AssetArchive({\".\": asset.FileArchive(\"./function\")}),\n)\n```\n\n- 비밀값과 그 값\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\n#### 비밀 생성\n\nsecret = gcp.secretmanager.Secret(\n    \"openai-api-key\",\n    replication=gcp.secretmanager.SecretReplicationArgs(\n        auto=gcp.secretmanager.SecretReplicationAutoArgs(),\n    ),\n    secret_id=\"openai-secret\",\n)\nsecret_version = gcp.secretmanager.SecretVersion(\n    \"1\",\n    secret=secret.name,\n    secret_data=os.environ.get(\"OPENAI_API_KEY\"),\n)\n```\n\n- 서비스 계정\n\n```js\n#### 서비스 계정 생성\n\nservice_account = gcp.serviceaccount.Account(\n    \"service-account\",\n    account_id=\"service-account-id\",\n    display_name=\"Summarizer Service Account\",\n)\n\nservice_account_email = service_account.email.apply(\n    lambda email: f\"serviceAccount:{email}\"\n)\n```\n\n- 서비스 계정에 대한 IAM 정책을 비밀에 액세스하도록 설정하기\n\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\nsecret_accessor = gcp.organizations.get_iam_policy(\n    bindings=[\n        gcp.organizations.GetIAMPolicyBindingArgs(\n            role=\"roles/secretmanager.secretAccessor\",\n            members=[service_account_email],\n        )\n    ]\n)\n\nsecret_iam_policy = gcp.secretmanager.SecretIamPolicy(\n    \"my-secret-iam-policy\",\n    secret_id=secret.id,\n    project=gcp.config.project,\n    policy_data=secret_accessor.policy_data,\n)\n```\n\n- 클라우드 기능\n\n```js\n#### 클라우드 기능 생성\n\ncloud_function = gcp.cloudfunctionsv2.Function(\n    resource_name=\"cloud-function\",\n    location=\"europe-west1\",\n    build_config=gcp.cloudfunctionsv2.FunctionBuildConfigArgs(\n        entry_point=\"main\",\n        runtime=\"python39\",\n        source=gcp.cloudfunctionsv2.FunctionBuildConfigSourceArgs(\n            storage_source=gcp.cloudfunctionsv2.FunctionBuildConfigSourceStorageSourceArgs(\n                bucket=bucket.name,\n                object=archive.name,\n            )\n        ),\n    ),\n    service_config=gcp.cloudfunctionsv2.FunctionServiceConfigArgs(\n        available_memory=\"256M\",\n        ingress_settings=\"ALLOW_ALL\",\n        timeout_seconds=60,\n        service_account_email=service_account.email,\n        secret_environment_variables=[\n            gcp.cloudfunctionsv2.FunctionServiceConfigSecretEnvironmentVariableArgs(\n                key=\"OPENAI_API_KEY\",\n                version=\"1\",\n                project_id=gcp.config.project,\n                secret=\"openai-secret\",\n            )\n        ],\n    ),\n)\n```\n\n- 클라우드 런 IAM 바인딩  \n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\n#### Cloud Run에 인보커 역할 추가\n\nbinding = gcp.cloudrun.IamBinding(\n    \"binding\",\n    location=cloud_function.location,\n    service=cloud_function.name,\n    role=\"roles/run.invoker\",\n    members=[\"allUsers\"],\n)\n```\n\n- Pulumi의 출력: Cloud Function 엔드포인트 URL\n\n```js\nexport(\"python_endpoint\", cloud_function.service_config.apply(lambda sc: sc.uri))\n```\n\n이 변경 사항을 배포하려면, 아래 명령어를 실행하면 됩니다:\n\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\r\npulumi up\r\n```\r\n\r\n업데이트를 하기 전에 Pulumi는 먼저 미리보기를 보여주고 사용자가 확인을 하면 리소스가 생성됩니다.\n\n\u003cimg src=\"/TIL/assets/img/2024-07-12-HowtoDeployaServerlessAPIThatSummarizesYouTubeVideos_1.png\" /\u003e\n\n이 엔드포인트를 Postman에서 시도함으로써 API가 작동하는지 확인할 수 있습니다.\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n## 👉 자원 정리하기\n\n클라우드 함수 프로토타입 작업이 완료되면 스택을 파괴하고 모든 리소스를 제거할 수 있어요.\n\n```js\npulumi destroy\n```\n\n# 결론\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\nGCP 서비스를 백엔드로 사용하는 서버리스 애플리케이션을 Pulumi와 같은 Infrastructure-as-code (IaC) 도구로 구축할 수 있어요.\n\n이는 유연성을 제공하고 자동화를 높이며, 클라우드 리소스를 UI에서 조작할 때 발생하는 오류를 줄여줘요.\n\nPulumi는 다양한 기능을 제공하며, 다른 클라우드 서비스와 원활하게 통합돼요. 자세한 내용은 문서를 확인해보세요.\n\n다음에 또 뵐게요! 👋","ogImage":{"url":"/TIL/assets/img/2024-07-12-HowtoDeployaServerlessAPIThatSummarizesYouTubeVideos_0.png"},"coverImage":"/TIL/assets/img/2024-07-12-HowtoDeployaServerlessAPIThatSummarizesYouTubeVideos_0.png","tag":["Tech"],"readingTime":17},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cp\u003e이 게시물에서는 Google Cloud의 서버리스 클라우드 함수를 자동화하는 방법을 배울 수 있습니다.\u003c/p\u003e\n\u003cp\u003e이 어플리케이션은 항상 프로토타입을 만들고 싶었던 것을 수행할 것입니다: YouTube 비디오를 요약하는 것 📹.\u003c/p\u003e\n\u003cp\u003e현재 사용 가능한 강력한 LLM(Large Language Models), 확장 가능한 클라우드 아키텍처 및 효율적인 개발자 도구를 활용하여 이 아이디어를 실현하는 것이 이제 가능합니다.\u003c/p\u003e\n\u003cp\u003e그래서 이 프로젝트를 구축하는 데 다룰 내용은 다음과 같습니다:\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cul\u003e\n\u003cli\u003e클라우드 함수 간단 소개\u003c/li\u003e\n\u003cli\u003e로컬에서 클라우드 함수 개발 및 테스트하는 방법\u003c/li\u003e\n\u003cli\u003eGCP에서 인프라 설계하고 클라우드 함수 배포하는 방법\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e마지막으로, Python 코드만 사용하여 인프라 프로비저닝 및 클라우드 함수 배포할 것입니다. GCP UI를 조작하거나 다른 구문이 필요한 인프라 코드(IaC) 도구를 사용하지 않을 것입니다.\u003c/p\u003e\n\u003cp\u003e한 번 살펴보세요.\u003c/p\u003e\n\u003cp\u003eML 콘텐츠, 상세한 튜토리얼 및 산업에서 실용적인 팁에 관심이 있다면, 제 뉴스레터를 팔로우하세요. The Tech Buffet이라고 합니다.\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003ch1\u003e클라우드 함수란 무엇인가요?\u003c/h1\u003e\n\u003cp\u003e클라우드 함수는 구글 클라우드 서비스로, 서버나 컨테이너를 관리할 필요가 없이 클라우드에서 코드를 실행할 수 있도록 하는 서비스입니다. 그리고 확장 가능하고 비용 효율적인 방식으로 작동합니다.\u003c/p\u003e\n\u003cp\u003e이것이 바로 클라우드 함수가 서버리스라고 불리는 이유입니다.\u003c/p\u003e\n\u003cp\u003e클라우드 함수를 사용하면 개발자 경험이 간단합니다. 로컬에서 코드를 작성하고 테스트한 후에 해당 코드를 구글 클라우드에 전송하여 배포하고 운영 인프라를 관리할 수 있습니다.\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e구름 함수의 두 번째 훌륭한 기능은 비용입니다: 사용한 만큼만 지불하게 됩니다. 구체적으로 말하면 함수의 실행 시간에 대한 비용을 청구하며, 100밀리초 단위로 측정됩니다. 그리고 함수가 유휴 상태인 경우에는 아무런 비용도 발생하지 않습니다!\u003c/p\u003e\n\u003cp\u003e구름 함수는 주로 다른 시스템(예: 구름 스토리지 또는 PubSub)에서 트리거되는 단기적 이벤트 기반 작업을 처리하는 데 설계되었습니다.\u003c/p\u003e\n\u003cp\u003e예를 들어, 버킷에 파일이 저장될 때나 BigQuery에 행이 삽입될 때 트리거되는 구름 함수를 만들 수 있습니다.\u003c/p\u003e\n\u003cp\u003e또한 알림을 보내거나 다른 시스템을 트리거하는 데 구름 함수가 사용되는 것을 자주 볼 수 있습니다.\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003ch1\u003e로컬에서 클라우드 함수 개발 및 테스트하기\u003c/h1\u003e\n\u003cp\u003e이 작은 프로젝트에서 우리가 만들 클라우드 함수는 REST API로 작동합니다. YouTube URL로 구성된 사용자 입력을 받아 요약 내용을 반환할 것입니다.\u003c/p\u003e\n\u003cp\u003eGCP에 배포하기 전에 먼저 이 함수를 로컬에서 빌드하고 테스트해 봅시다.\u003c/p\u003e\n\u003cp\u003eYouTube 비디오를 요약하기 위해 다음 Python 라이브러리가 필요합니다:\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cul\u003e\n\u003cli\u003eyoutube-transcript-api: YouTube 비디오에서 자막을 추출하는 데 사용됩니다.\u003c/li\u003e\n\u003cli\u003elangchain 및 langchain-openai: OpenAI 언어 모델과 상호 작용하여 요약을 생성하는 데 사용됩니다.\u003c/li\u003e\n\u003cli\u003epython-dotenv: OpenAI 자격 증명을 환경 변수로로드하는 데 사용됩니다.\u003c/li\u003e\n\u003cli\u003efunctions-framework: 이식 가능한 파이썬 함수를 작성하고 로컬에서 테스트하는 FaaS (Function as a Service) 프레임워크\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e시작하기 가장 간단한 방법은 가상 환경을 만드는 것입니다:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003epython -m venv ./venv\nsource venv/bin/activate\npip install -r \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e/requirements.\u003cspan class=\"hljs-property\"\u003etxt\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e그런 다음, 함수의 코드는 function/main.py 파일에 정의됩니다:\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e비디오를 요약할 주요 기능을 여기에 소개합니다 (더 자세한 내용은 repo에서 나머지 코드를 확인하세요):\u003c/p\u003e\n\u003cp\u003e→ 먼저 비디오 대본과 제목을 추출하고 LLM을 초기화한 후, 프롬프트를 작성하여 LLM에 요약을 보냅니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003edef \u003cspan class=\"hljs-title function_\"\u003esummarize_youtube_video\u003c/span\u003e(url, additional_instructions):\n    transcript = \u003cspan class=\"hljs-title function_\"\u003eget_youtube_video_transcript\u003c/span\u003e(url)\n    title = \u003cspan class=\"hljs-title function_\"\u003eget_youtube_video_title\u003c/span\u003e(url)\n    llm = \u003cspan class=\"hljs-title class_\"\u003eOpenAI\u003c/span\u003e(api_key=os.\u003cspan class=\"hljs-property\"\u003eenviron\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"OPENAI_API_KEY\"\u003c/span\u003e))\n    prompt = \u003cspan class=\"hljs-title function_\"\u003eget_prompt\u003c/span\u003e(title, transcript, additional_instructions)\n    summary = llm.\u003cspan class=\"hljs-title function_\"\u003epredict\u003c/span\u003e(prompt)\n    data = {\n        \u003cspan class=\"hljs-string\"\u003e\"url\"\u003c/span\u003e: url,\n        \u003cspan class=\"hljs-string\"\u003e\"title\"\u003c/span\u003e: title,\n        \u003cspan class=\"hljs-string\"\u003e\"summary\"\u003c/span\u003e: summary,\n        \u003cspan class=\"hljs-string\"\u003e\"transcript\"\u003c/span\u003e: transcript,\n    }\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e data\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이 논리를 REST API로 래핑하기 위해 functions_framework 패키지를 사용할 것입니다. 이를 통해 HTTP 요청이 전송되면 호출되는 Cloud Function 핸들러(또는 entry point)를 정의할 수 있습니다:\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-meta\"\u003e@functions_framework.http\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003emain\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003erequest: flask.Request\u003c/span\u003e):\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e request.method == \u003cspan class=\"hljs-string\"\u003e\"POST\"\u003c/span\u003e:\n        url = request.form.get(\u003cspan class=\"hljs-string\"\u003e\"url\"\u003c/span\u003e)\n        additional_instructions = request.form.get(\u003cspan class=\"hljs-string\"\u003e\"instructions\"\u003c/span\u003e)\n        data = summarize_youtube_video(url, additional_instructions)\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e flask.jsonify(data)\n    \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e:\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"Method Not Allowed\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e400\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e전체 클라우드 함수 코드는 여기에서 확인할 수 있습니다.\u003c/p\u003e\n\u003cp\u003e클라우드 함수를 로컬에서 테스트하려면 다음 명령을 실행하세요:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003efunctions-framework --target=main --\u003cspan class=\"hljs-built_in\"\u003esource\u003c/span\u003e=\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e/main.py --debug\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e해당 명령어를 실행하면 로컬 웹 서버가 시작됩니다. 그래서 Postman을 열어 몇 가지 요청을 보내 봅시다:\u003c/p\u003e\n\u003cp\u003eTerraform과 Pulumi 간의 차이점에 대해 논의하는 비디오를 보내 봅시다:\u003c/p\u003e\n\u003cp\u003eURL을 입력하고 전송 버튼을 클릭하여 양식 데이터를 채우면 다음 결과를 얻을 수 있습니다: summary, title, transcript (전체 텍스트), URL.\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e여기서 요약을 자세히 살펴보겠습니다:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-title class_\"\u003eTerraform\u003c/span\u003e과 \u003cspan class=\"hljs-title class_\"\u003ePulumi\u003c/span\u003e는 \u003cspan class=\"hljs-title class_\"\u003eDevOps\u003c/span\u003e 세계에서 자주 비교되는 두 가지 도구입니다. \u003cspan class=\"hljs-title class_\"\u003eTerraform\u003c/span\u003e은 상태를 정의하는 일관성으로 유명한 반면 \u003cspan class=\"hljs-title class_\"\u003ePulumi\u003c/span\u003e는 \u003cspan class=\"hljs-title class_\"\u003ePython\u003c/span\u003e 및 C#과 같은 명령형 프로그래밍 언어를 사용하여 보다 유연한 접근 방식을 제공합니다. 그러나 이는 팀으로 작업하거나 조직을 변경할 때 잠재적인 문제를 야기할 수도 있습니다.\\n\\n반면 \u003cspan class=\"hljs-title class_\"\u003eTerraform\u003c/span\u003e은 \u003cspan class=\"hljs-variable constant_\"\u003eHCL\u003c/span\u003e (\u003cspan class=\"hljs-title class_\"\u003eHashicorp\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eConfiguration\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eLanguage\u003c/span\u003e)을 사용하여 상태를 더 제한적이고 일관된 방식으로 정의합니다. 이를 통해 더 쉬운 협업과 상태 파일을 보다 안전하게 관리할 수 있습니다. 게다가 \u003cspan class=\"hljs-title class_\"\u003eTerraform\u003c/span\u003e은 \u003cspan class=\"hljs-title class_\"\u003eSaaS\u003c/span\u003e 제품이 아니기 때문에 상태가 자동으로 원격 네트워크로 푸시되지 않습니다. 민감한 정보를 다룰 때 이는 고려할 사항일 수 있습니다.\\n\\n총론적으로 발표자는 단순성과 일관성을 이유로 \u003cspan class=\"hljs-title class_\"\u003ePulumi\u003c/span\u003e 대신 \u003cspan class=\"hljs-title class_\"\u003eTerraform\u003c/span\u003e을 강력히 선호합니다. 또한 \u003cspan class=\"hljs-title class_\"\u003eTerraform\u003c/span\u003e은 지원을 제공하고 모든 질문에 답변할 수 있는 거의 \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e,\u003cspan class=\"hljs-number\"\u003e000\u003c/span\u003e명의 커뮤니티를 갖고 있다고 언급합니다. 마지막으로 발표자는 시청자들에게 \u003cspan class=\"hljs-title class_\"\u003eTerraform\u003c/span\u003e을 가장 간단한 형태로 사용하고 복잡한 것을 피하라고 권장합니다.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이 튜토리얼을 재현하면 Postman 클라이언트와 함께 놀 수 있고, 다른 비디오를 시도하고 심지어 LLM에 사용자 정의 지침을 추가할 수 있습니다.\u003c/p\u003e\n\u003cp\u003e다음 예시에서 LLM에게 프랑스어로 대답하도록 요청할 수 있습니다.\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e클라우드 함수가 로컬에서 테스트되었습니다.\u003c/p\u003e\n\u003cp\u003e이제 배포할 준비가 되었어요 👇.\u003c/p\u003e\n\u003ch1\u003e클라우드 함수를 위한 인프라 프로비저닝\u003c/h1\u003e\n\u003cp\u003e몇 년 전에 클라우드 함수를 배포해 달라고 요청하면, 저는 기쁜 마음으로 GCP 콘솔에 로그인하고 소스 코드를 버킷에 넣은 다음 UI에서 클라우드 함수를 생성하고 Google Secret Manager에 비밀 정보를 추가하고 앱에 연결하고 배포 버튼을 눌렀을 거예요.\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e만약 우리가 소스 코드를 변경할 때마다 이러한 단계들을 수행한다면, 이것은:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e지루할 것이다\u003c/li\u003e\n\u003cli\u003e오류 발생 가능성이 높을 것이다\u003c/li\u003e\n\u003cli\u003e코드베이스 안에서 추적하기 어려울 것이다\u003c/li\u003e\n\u003cli\u003e협업하기 어려울 것이다\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e풀루미 🚀\u003c/h2\u003e\n\u003cp\u003e풀루미(Pulumi)는 이미 알고 있는 프로그래밍 언어를 사용하여 어떠한 아키텍처나 클라우드 공급자에도 인프라를 구축하고 배포하는 데 도움을 주는 SDK입니다(예: Python, TypeScript, Java 등).\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003ePulumi를 시작하려면 다음과 같이 설치하고 구성해야 합니다:\u003c/p\u003e\n\u003ch2\u003e👉 Pulumi 다운로드 및 구성 ⚙️\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eMac을 사용 중이라면 Homebrew로 Pulumi를 설치할 수 있습니다\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003ebrew install pulumi/tap/pulumi\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cul\u003e\n\u003cli\u003e다른 OS를 사용 중이라면 대안들을 확인해보세요.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003egcloud config set project \u0026#x3C;\u003cspan class=\"hljs-variable constant_\"\u003eYOUR_GCP_PROJECT_ID\u003c/span\u003e\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003ePulumi는 Google Cloud 리소스와 상호 작용하기 위해 기본 애플리케이션 자격 증명을 필요로 합니다. 따라서 인증 애플리케이션 기본 로그인 명령을 실행하여 해당 자격 증명을 얻어야 합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003egcloud auth application-\u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e login\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003ePulumi이 GCP 계정으로 구성된 후 Pulumi 프로젝트를 만들 수 있습니다.\n폴더의 루트에 Pulumi.yaml이라는 YAML 파일을 만들고 다음 라인을 붙여넣습니다:\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: youtube-summarizer\n\u003cspan class=\"hljs-attr\"\u003eruntime\u003c/span\u003e:\n  \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: python\n  \u003cspan class=\"hljs-attr\"\u003eoptions\u003c/span\u003e:\n    \u003cspan class=\"hljs-attr\"\u003evirtualenv\u003c/span\u003e: venv\n\u003cspan class=\"hljs-attr\"\u003ebackend\u003c/span\u003e:\n  \u003cspan class=\"hljs-attr\"\u003eurl\u003c/span\u003e: \u003cspan class=\"hljs-attr\"\u003egs\u003c/span\u003e:\u003cspan class=\"hljs-comment\"\u003e//pulumi-gcp-state/main\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003edescription\u003c/span\u003e: A minimal \u003cspan class=\"hljs-title class_\"\u003eGoogle\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eCloud\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003ePython\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003ePulumi\u003c/span\u003e program\n\u003cspan class=\"hljs-attr\"\u003econfig\u003c/span\u003e:\n  \u003cspan class=\"hljs-attr\"\u003epulumi\u003c/span\u003e:\u003cspan class=\"hljs-attr\"\u003etags\u003c/span\u003e:\n    \u003cspan class=\"hljs-attr\"\u003evalue\u003c/span\u003e:\n      \u003cspan class=\"hljs-attr\"\u003epulumi\u003c/span\u003e:\u003cspan class=\"hljs-attr\"\u003etemplate\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이 파일은 런타임(Python)을 정의하고, virtualenv 폴더를 가리키며, Pulumi가 인프라의 상태를 저장하는 백엔드 URL을 설정합니다. Pulumi는 다른 백엔드를 사용할 수 있으며, 이 예시에서는 Google Cloud Storage를 사용합니다.\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e다음 명령을 실행하여 올바른 매개변수로 Pulumi를 구성하세요:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003epulumi config set \u003cspan class=\"hljs-attr\"\u003egcp\u003c/span\u003e:region \u0026#x3C;\u003cspan class=\"hljs-variable constant_\"\u003eGCP\u003c/span\u003e-\u003cspan class=\"hljs-variable constant_\"\u003eREGION\u003c/span\u003e\u003e\npulumi config set \u003cspan class=\"hljs-attr\"\u003egcp\u003c/span\u003e:project \u0026#x3C;\u003cspan class=\"hljs-variable constant_\"\u003eGCP\u003c/span\u003e-\u003cspan class=\"hljs-variable constant_\"\u003ePROJECT\u003c/span\u003e-\u003cspan class=\"hljs-variable constant_\"\u003eID\u003c/span\u003e\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e첫 번째 명령을 실행하면 Pulumi가 스택의 이름을 선택하라는 메시지가 표시됩니다. 이 스택은 Pulumi 프로젝트가 배포될 환경입니다.\u003c/p\u003e\n\u003cp\u003e저는 방금 'dev'를 선택했어요.\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e구성이 완료되면 다음 내용이 포함된 Pulumi.dev.yaml 파일이 생성됩니다:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-attr\"\u003eencryptionsalt\u003c/span\u003e: \u003cspan class=\"hljs-attr\"\u003ev1\u003c/span\u003e:\u003cspan class=\"hljs-title class_\"\u003eGJeieppLoAs\u003c/span\u003e=:\u003cspan class=\"hljs-attr\"\u003ev1\u003c/span\u003e:tglu/3\u003cspan class=\"hljs-attr\"\u003eT2fbOmQs59\u003c/span\u003e:ahQNXFSYgfQsvRp1J4GB4e670KOffg==\n\u003cspan class=\"hljs-attr\"\u003econfig\u003c/span\u003e:\n  \u003cspan class=\"hljs-attr\"\u003egcp\u003c/span\u003e:\u003cspan class=\"hljs-attr\"\u003eproject\u003c/span\u003e: playground-\u003cspan class=\"hljs-number\"\u003e351113\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003egcp\u003c/span\u003e:\u003cspan class=\"hljs-attr\"\u003eregion\u003c/span\u003e: europe-west1\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e👉 Pulumi를 사용하여 인프라 정의하기\u003c/h2\u003e\n\u003cp\u003ePulumi 코드로 인프라를 작성하기 전에 앱 아키텍처를 정의한 다음 보여드릴게요. 이것을 통해 필요한 서비스를 이해할 수 있을 거예요.\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e다수의 구성 요소가 함께 작동합니다:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e클라우드 함수의 코드를 저장하는 버킷\u003c/li\u003e\n\u003cli\u003eOpenAI API 키를 저장하는 시크릿 매니저\u003c/li\u003e\n\u003cli\u003e귀하를 대신하여 클라우드 함수 리소스 액세스를 부여하는 서비스 계정\u003c/li\u003e\n\u003cli\u003e서비스 계정이 시크릿 매니저에 액세스할 수 있도록 하는 IAM 정책\u003c/li\u003e\n\u003cli\u003eCloud Run에서 Cloud 함수를 호출할 수 있게 하는 IAM 호출자 역할(Cloud Functions의 2세대는 Cloud Run에서 관리됩니다)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e모든 이 서비스들은 \u003cstrong\u003emain\u003c/strong\u003e.py 파일에서 명령적인 방식으로 정의될 것입니다:\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e한 번에 하나씩 살펴봐요:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e소스 코드가 담긴 버킷:\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e os\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pulumi \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e asset, \u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e pulumi_gcp \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e gcp\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e dotenv \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e load_dotenv\n\n\u003cspan class=\"hljs-title function_\"\u003eload_dotenv\u003c/span\u003e()\n\n#### 버킷 생성 및 코드 업로드\n\nbucket = gcp.\u003cspan class=\"hljs-property\"\u003estorage\u003c/span\u003e.\u003cspan class=\"hljs-title class_\"\u003eBucket\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"bucket\"\u003c/span\u003e, location=\u003cspan class=\"hljs-string\"\u003e\"EU\"\u003c/span\u003e)\n\narchive = gcp.\u003cspan class=\"hljs-property\"\u003estorage\u003c/span\u003e.\u003cspan class=\"hljs-title class_\"\u003eBucketObject\u003c/span\u003e(\n    \u003cspan class=\"hljs-string\"\u003e\"python-zip\"\u003c/span\u003e,\n    name=\u003cspan class=\"hljs-string\"\u003e\"python-code.zip\"\u003c/span\u003e,\n    bucket=bucket.\u003cspan class=\"hljs-property\"\u003ename\u003c/span\u003e,\n    source=asset.\u003cspan class=\"hljs-title class_\"\u003eAssetArchive\u003c/span\u003e({\u003cspan class=\"hljs-string\"\u003e\".\"\u003c/span\u003e: asset.\u003cspan class=\"hljs-title class_\"\u003eFileArchive\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"./function\"\u003c/span\u003e)}),\n)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e비밀값과 그 값\u003c/li\u003e\n\u003c/ul\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e#### 비밀 생성\n\nsecret = gcp.\u003cspan class=\"hljs-property\"\u003esecretmanager\u003c/span\u003e.\u003cspan class=\"hljs-title class_\"\u003eSecret\u003c/span\u003e(\n    \u003cspan class=\"hljs-string\"\u003e\"openai-api-key\"\u003c/span\u003e,\n    replication=gcp.\u003cspan class=\"hljs-property\"\u003esecretmanager\u003c/span\u003e.\u003cspan class=\"hljs-title class_\"\u003eSecretReplicationArgs\u003c/span\u003e(\n        auto=gcp.\u003cspan class=\"hljs-property\"\u003esecretmanager\u003c/span\u003e.\u003cspan class=\"hljs-title class_\"\u003eSecretReplicationAutoArgs\u003c/span\u003e(),\n    ),\n    secret_id=\u003cspan class=\"hljs-string\"\u003e\"openai-secret\"\u003c/span\u003e,\n)\nsecret_version = gcp.\u003cspan class=\"hljs-property\"\u003esecretmanager\u003c/span\u003e.\u003cspan class=\"hljs-title class_\"\u003eSecretVersion\u003c/span\u003e(\n    \u003cspan class=\"hljs-string\"\u003e\"1\"\u003c/span\u003e,\n    secret=secret.\u003cspan class=\"hljs-property\"\u003ename\u003c/span\u003e,\n    secret_data=os.\u003cspan class=\"hljs-property\"\u003eenviron\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"OPENAI_API_KEY\"\u003c/span\u003e),\n)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e서비스 계정\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e#### 서비스 계정 생성\n\nservice_account = gcp.\u003cspan class=\"hljs-property\"\u003eserviceaccount\u003c/span\u003e.\u003cspan class=\"hljs-title class_\"\u003eAccount\u003c/span\u003e(\n    \u003cspan class=\"hljs-string\"\u003e\"service-account\"\u003c/span\u003e,\n    account_id=\u003cspan class=\"hljs-string\"\u003e\"service-account-id\"\u003c/span\u003e,\n    display_name=\u003cspan class=\"hljs-string\"\u003e\"Summarizer Service Account\"\u003c/span\u003e,\n)\n\nservice_account_email = service_account.\u003cspan class=\"hljs-property\"\u003eemail\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eapply\u003c/span\u003e(\n    lambda \u003cspan class=\"hljs-attr\"\u003eemail\u003c/span\u003e: f\u003cspan class=\"hljs-string\"\u003e\"serviceAccount:{email}\"\u003c/span\u003e\n)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e서비스 계정에 대한 IAM 정책을 비밀에 액세스하도록 설정하기\u003c/li\u003e\n\u003c/ul\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003esecret_accessor = gcp.\u003cspan class=\"hljs-property\"\u003eorganizations\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eget_iam_policy\u003c/span\u003e(\n    bindings=[\n        gcp.\u003cspan class=\"hljs-property\"\u003eorganizations\u003c/span\u003e.\u003cspan class=\"hljs-title class_\"\u003eGetIAMPolicyBindingArgs\u003c/span\u003e(\n            role=\u003cspan class=\"hljs-string\"\u003e\"roles/secretmanager.secretAccessor\"\u003c/span\u003e,\n            members=[service_account_email],\n        )\n    ]\n)\n\nsecret_iam_policy = gcp.\u003cspan class=\"hljs-property\"\u003esecretmanager\u003c/span\u003e.\u003cspan class=\"hljs-title class_\"\u003eSecretIamPolicy\u003c/span\u003e(\n    \u003cspan class=\"hljs-string\"\u003e\"my-secret-iam-policy\"\u003c/span\u003e,\n    secret_id=secret.\u003cspan class=\"hljs-property\"\u003eid\u003c/span\u003e,\n    project=gcp.\u003cspan class=\"hljs-property\"\u003econfig\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eproject\u003c/span\u003e,\n    policy_data=secret_accessor.\u003cspan class=\"hljs-property\"\u003epolicy_data\u003c/span\u003e,\n)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e클라우드 기능\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e#### 클라우드 기능 생성\n\ncloud_function = gcp.\u003cspan class=\"hljs-property\"\u003ecloudfunctionsv2\u003c/span\u003e.\u003cspan class=\"hljs-title class_\"\u003eFunction\u003c/span\u003e(\n    resource_name=\u003cspan class=\"hljs-string\"\u003e\"cloud-function\"\u003c/span\u003e,\n    location=\u003cspan class=\"hljs-string\"\u003e\"europe-west1\"\u003c/span\u003e,\n    build_config=gcp.\u003cspan class=\"hljs-property\"\u003ecloudfunctionsv2\u003c/span\u003e.\u003cspan class=\"hljs-title class_\"\u003eFunctionBuildConfigArgs\u003c/span\u003e(\n        entry_point=\u003cspan class=\"hljs-string\"\u003e\"main\"\u003c/span\u003e,\n        runtime=\u003cspan class=\"hljs-string\"\u003e\"python39\"\u003c/span\u003e,\n        source=gcp.\u003cspan class=\"hljs-property\"\u003ecloudfunctionsv2\u003c/span\u003e.\u003cspan class=\"hljs-title class_\"\u003eFunctionBuildConfigSourceArgs\u003c/span\u003e(\n            storage_source=gcp.\u003cspan class=\"hljs-property\"\u003ecloudfunctionsv2\u003c/span\u003e.\u003cspan class=\"hljs-title class_\"\u003eFunctionBuildConfigSourceStorageSourceArgs\u003c/span\u003e(\n                bucket=bucket.\u003cspan class=\"hljs-property\"\u003ename\u003c/span\u003e,\n                object=archive.\u003cspan class=\"hljs-property\"\u003ename\u003c/span\u003e,\n            )\n        ),\n    ),\n    service_config=gcp.\u003cspan class=\"hljs-property\"\u003ecloudfunctionsv2\u003c/span\u003e.\u003cspan class=\"hljs-title class_\"\u003eFunctionServiceConfigArgs\u003c/span\u003e(\n        available_memory=\u003cspan class=\"hljs-string\"\u003e\"256M\"\u003c/span\u003e,\n        ingress_settings=\u003cspan class=\"hljs-string\"\u003e\"ALLOW_ALL\"\u003c/span\u003e,\n        timeout_seconds=\u003cspan class=\"hljs-number\"\u003e60\u003c/span\u003e,\n        service_account_email=service_account.\u003cspan class=\"hljs-property\"\u003eemail\u003c/span\u003e,\n        secret_environment_variables=[\n            gcp.\u003cspan class=\"hljs-property\"\u003ecloudfunctionsv2\u003c/span\u003e.\u003cspan class=\"hljs-title class_\"\u003eFunctionServiceConfigSecretEnvironmentVariableArgs\u003c/span\u003e(\n                key=\u003cspan class=\"hljs-string\"\u003e\"OPENAI_API_KEY\"\u003c/span\u003e,\n                version=\u003cspan class=\"hljs-string\"\u003e\"1\"\u003c/span\u003e,\n                project_id=gcp.\u003cspan class=\"hljs-property\"\u003econfig\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eproject\u003c/span\u003e,\n                secret=\u003cspan class=\"hljs-string\"\u003e\"openai-secret\"\u003c/span\u003e,\n            )\n        ],\n    ),\n)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e클라우드 런 IAM 바인딩\u003c/li\u003e\n\u003c/ul\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e#### \u003cspan class=\"hljs-title class_\"\u003eCloud\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eRun\u003c/span\u003e에 인보커 역할 추가\n\nbinding = gcp.\u003cspan class=\"hljs-property\"\u003ecloudrun\u003c/span\u003e.\u003cspan class=\"hljs-title class_\"\u003eIamBinding\u003c/span\u003e(\n    \u003cspan class=\"hljs-string\"\u003e\"binding\"\u003c/span\u003e,\n    location=cloud_function.\u003cspan class=\"hljs-property\"\u003elocation\u003c/span\u003e,\n    service=cloud_function.\u003cspan class=\"hljs-property\"\u003ename\u003c/span\u003e,\n    role=\u003cspan class=\"hljs-string\"\u003e\"roles/run.invoker\"\u003c/span\u003e,\n    members=[\u003cspan class=\"hljs-string\"\u003e\"allUsers\"\u003c/span\u003e],\n)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003ePulumi의 출력: Cloud Function 엔드포인트 URL\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-title function_\"\u003eexport\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"python_endpoint\"\u003c/span\u003e, cloud_function.\u003cspan class=\"hljs-property\"\u003eservice_config\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eapply\u003c/span\u003e(lambda \u003cspan class=\"hljs-attr\"\u003esc\u003c/span\u003e: sc.\u003cspan class=\"hljs-property\"\u003euri\u003c/span\u003e))\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이 변경 사항을 배포하려면, 아래 명령어를 실행하면 됩니다:\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003epulumi up\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e업데이트를 하기 전에 Pulumi는 먼저 미리보기를 보여주고 사용자가 확인을 하면 리소스가 생성됩니다.\u003c/p\u003e\n\u003cimg src=\"/TIL/assets/img/2024-07-12-HowtoDeployaServerlessAPIThatSummarizesYouTubeVideos_1.png\"\u003e\n\u003cp\u003e이 엔드포인트를 Postman에서 시도함으로써 API가 작동하는지 확인할 수 있습니다.\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003ch2\u003e👉 자원 정리하기\u003c/h2\u003e\n\u003cp\u003e클라우드 함수 프로토타입 작업이 완료되면 스택을 파괴하고 모든 리소스를 제거할 수 있어요.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003epulumi destroy\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003e결론\u003c/h1\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003eGCP 서비스를 백엔드로 사용하는 서버리스 애플리케이션을 Pulumi와 같은 Infrastructure-as-code (IaC) 도구로 구축할 수 있어요.\u003c/p\u003e\n\u003cp\u003e이는 유연성을 제공하고 자동화를 높이며, 클라우드 리소스를 UI에서 조작할 때 발생하는 오류를 줄여줘요.\u003c/p\u003e\n\u003cp\u003ePulumi는 다양한 기능을 제공하며, 다른 클라우드 서비스와 원활하게 통합돼요. 자세한 내용은 문서를 확인해보세요.\u003c/p\u003e\n\u003cp\u003e다음에 또 뵐게요! 👋\u003c/p\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-07-12-HowtoDeployaServerlessAPIThatSummarizesYouTubeVideos"},"buildId":"QAkYP0lvl03W-5CKD69kb","assetPrefix":"/TIL","isFallback":false,"gsp":true,"scriptLoader":[{"async":true,"src":"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4877378276818686","strategy":"lazyOnload","crossOrigin":"anonymous"}]}</script></body></html>