<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>스파크 최적화 집중 강좌 최고의 성능을 위한 단계별 가이드 | TIL</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://13akstjq.github.io/TIL//post/2024-07-09-IntensiveSparkOptimizationCourse" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="스파크 최적화 집중 강좌 최고의 성능을 위한 단계별 가이드 | TIL" data-gatsby-head="true"/><meta property="og:title" content="스파크 최적화 집중 강좌 최고의 성능을 위한 단계별 가이드 | TIL" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-07-09-IntensiveSparkOptimizationCourse_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://TIL.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://13akstjq.github.io/TIL//post/2024-07-09-IntensiveSparkOptimizationCourse" data-gatsby-head="true"/><meta name="twitter:title" content="스파크 최적화 집중 강좌 최고의 성능을 위한 단계별 가이드 | TIL" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-07-09-IntensiveSparkOptimizationCourse_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | TIL" data-gatsby-head="true"/><meta name="article:published_time" content="2024-07-09 20:14" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/TIL/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/TIL/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/TIL/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/TIL/favicons/favicon-96x96.png"/><link rel="icon" href="/TIL/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/TIL/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/TIL/favicons/browserconfig.xml"/><link rel="preload" href="/TIL/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/TIL/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/TIL/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/TIL/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/TIL/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/TIL/_next/static/chunks/webpack-21ffe88bdca56cba.js" defer=""></script><script src="/TIL/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/TIL/_next/static/chunks/main-a5eeabb286676ce6.js" defer=""></script><script src="/TIL/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/TIL/_next/static/chunks/75fc9c18-4a646156c659a948.js" defer=""></script><script src="/TIL/_next/static/chunks/348-02483b66b493dd81.js" defer=""></script><script src="/TIL/_next/static/chunks/pages/post/%5Bslug%5D-8ded8b979ba73586.js" defer=""></script><script src="/TIL/_next/static/X4OrKfmLtU3-3BijwfHe6/_buildManifest.js" defer=""></script><script src="/TIL/_next/static/X4OrKfmLtU3-3BijwfHe6/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/TIL">TIL</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/TIL/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">스파크 최적화 집중 강좌 최고의 성능을 위한 단계별 가이드</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="스파크 최적화 집중 강좌 최고의 성능을 위한 단계별 가이드" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/TIL/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">TIL</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On Jul 9, 2024</span><span class="posts_reading_time__f7YPP">43<!-- --> min read</span></span></div></div></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<p><img src="/TIL/assets/img/2024-07-09-IntensiveSparkOptimizationCourse_0.png" alt="Intensive Spark Optimization Course"></p>
<h1>로컬에서 플레이그라운드 설정하기</h1>
<ul>
<li>Docker Desktop을 설치합니다.</li>
<li><code>docker run -p 8888:8888 jupyter/pyspark-notebook</code>을 실행합니다.</li>
<li>다음 메시지가 표시되면 브라우저에서 주피터 랩을 열기 위해 URL 중 하나를 붙여넣습니다.</li>
</ul>
<pre><code class="hljs language-js">서버에 액세스하려면 브라우저에서 이 파일을 엽니다:
    <span class="hljs-attr">file</span>:<span class="hljs-comment">///home/jovyan/.local/share/jupyter/runtime/jpserver-7-open.html</span>
또는 다음 <span class="hljs-variable constant_">URL</span> 중 하나를 복사하여 붙여넣습니다:
    <span class="hljs-attr">http</span>:<span class="hljs-comment">//3c331b638888:8888/lab?token=a88888b6aa6620fc976588ba58817f3b14ea0674bdc77f72</span>
    <span class="hljs-attr">http</span>:<span class="hljs-comment">//127.0.0.1:8888/lab?token=a88888b6aa6620fc976588ba58817f3b14ea0674bdc77f72</span>
</code></pre>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h1>SparkSession 초기화하기</h1>
<pre><code class="hljs language-js"><span class="hljs-keyword">from</span> pyspark.<span class="hljs-property">sql</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">SparkSession</span>
spark = <span class="hljs-title class_">SparkSession</span>.<span class="hljs-property">builder</span>.<span class="hljs-title function_">appName</span>(<span class="hljs-string">"Spark Test"</span>).<span class="hljs-title function_">getOrCreate</span>()
</code></pre>
<h1>데이터프레임</h1>
<h2>1. 데이터프레임 생성하기</h2>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<ul>
<li>컬럼 사용</li>
</ul>
<pre><code class="hljs language-js"><span class="hljs-keyword">from</span> pyspark.<span class="hljs-property">sql</span>.<span class="hljs-property">types</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">StructType</span>, <span class="hljs-title class_">IntegerType</span>, <span class="hljs-title class_">StringType</span>

# 데이터를 튜플의 리스트로 정의
data = [(<span class="hljs-string">"James"</span>, <span class="hljs-number">34</span>), (<span class="hljs-string">"Anna"</span>, <span class="hljs-number">20</span>), (<span class="hljs-string">"Lee"</span>, <span class="hljs-number">30</span>)]

# 컬럼 사용
columns = [<span class="hljs-string">"Name"</span>, <span class="hljs-string">"Age"</span>]
df = spark.<span class="hljs-title function_">createDataFrame</span>(data, schema=columns)
</code></pre>
<ul>
<li>스키마 사용</li>
</ul>
<pre><code class="hljs language-js"><span class="hljs-keyword">from</span> pyspark.<span class="hljs-property">sql</span>.<span class="hljs-property">types</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">StructType</span>, <span class="hljs-title class_">IntegerType</span>, <span class="hljs-title class_">StringType</span>

# 데이터를 튜플의 리스트로 정의
data = [(<span class="hljs-string">"James"</span>, <span class="hljs-number">34</span>), (<span class="hljs-string">"Anna"</span>, <span class="hljs-number">20</span>), (<span class="hljs-string">"Lee"</span>, <span class="hljs-number">30</span>)]

# 스키마 사용
schema = <span class="hljs-title class_">StructType</span>([
    <span class="hljs-title class_">StructField</span>(<span class="hljs-string">"Name"</span>, <span class="hljs-title class_">StringType</span>(), <span class="hljs-title class_">True</span>),
    <span class="hljs-title class_">StructField</span>(<span class="hljs-string">"Age"</span>, <span class="hljs-title class_">IntegerType</span>(), <span class="hljs-title class_">True</span>)
])
df = spark.<span class="hljs-title function_">createDataFrame</span>(data, schema=schema)
</code></pre>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<ul>
<li>RDD 사용</li>
</ul>
<pre><code class="hljs language-js"><span class="hljs-keyword">from</span> pyspark.<span class="hljs-property">sql</span>.<span class="hljs-property">types</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">StructType</span>, <span class="hljs-title class_">IntegerType</span>, <span class="hljs-title class_">StringType</span>

# 데이터를 튜플의 리스트로 준비
data = [(<span class="hljs-string">"James"</span>, <span class="hljs-number">34</span>), (<span class="hljs-string">"Anna"</span>, <span class="hljs-number">20</span>), (<span class="hljs-string">"Lee"</span>, <span class="hljs-number">30</span>)]

# <span class="hljs-variable constant_">RDD</span> 사용
rdd = spark.<span class="hljs-property">sparkContext</span>.<span class="hljs-title function_">parallelize</span>(data)
schema = <span class="hljs-title class_">StructType</span>([
    <span class="hljs-title class_">StructField</span>(<span class="hljs-string">"이름"</span>, <span class="hljs-title class_">StringType</span>(), <span class="hljs-title class_">True</span>),
    <span class="hljs-title class_">StructField</span>(<span class="hljs-string">"나이"</span>, <span class="hljs-title class_">IntegerType</span>(), <span class="hljs-title class_">True</span>)
])
df = spark.<span class="hljs-title function_">createDataFrame</span>(rdd, schema=schema)
</code></pre>
<pre><code class="hljs language-js">df.<span class="hljs-title function_">show</span>()

# 출력
+-----+---+
| 이름|나이|
+-----+---+
|<span class="hljs-title class_">James</span>| <span class="hljs-number">34</span>|
| <span class="hljs-title class_">Anna</span>| <span class="hljs-number">20</span>|
|  <span class="hljs-title class_">Lee</span>| <span class="hljs-number">30</span>|
+-----+---+
</code></pre>
<h2>2. 데이터프레임 표시</h2>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js">df.<span class="hljs-title function_">printSchema</span>();
<span class="hljs-title function_">print</span>(df.<span class="hljs-property">schema</span>);
<span class="hljs-title function_">print</span>(df.<span class="hljs-property">columns</span>);
df.<span class="hljs-title function_">describe</span>().<span class="hljs-title function_">show</span>();
</code></pre>
<pre><code class="hljs language-js">#결과

## df.<span class="hljs-title function_">printSchema</span>()
root
 |-- <span class="hljs-title class_">Name</span>: string (nullable = <span class="hljs-literal">true</span>)
 |-- <span class="hljs-title class_">Age</span>: long (nullable = <span class="hljs-literal">true</span>)

## <span class="hljs-title function_">print</span>(df.<span class="hljs-property">schema</span>)
<span class="hljs-title class_">StructType</span>([
  <span class="hljs-title class_">StructField</span>(‘<span class="hljs-title class_">Name</span>’, <span class="hljs-title class_">StringType</span>(), <span class="hljs-title class_">True</span>),
  <span class="hljs-title class_">StructField</span>(‘<span class="hljs-title class_">Age</span>’, <span class="hljs-title class_">LongType</span>(), <span class="hljs-title class_">True</span>)
])

## <span class="hljs-title function_">print</span>(df.<span class="hljs-property">columns</span>)
[‘<span class="hljs-title class_">Name</span>’, ‘<span class="hljs-title class_">Age</span>’]

## df.<span class="hljs-title function_">describe</span>().<span class="hljs-title function_">show</span>()
+-------+----+-----------------+
|summary|<span class="hljs-title class_">Name</span>|              <span class="hljs-title class_">Age</span>|
+-------+----+-----------------+
|  count|   <span class="hljs-number">3</span>|                <span class="hljs-number">3</span>|
|   mean|<span class="hljs-variable constant_">NULL</span>|             <span class="hljs-number">28.0</span>|
| stddev|<span class="hljs-variable constant_">NULL</span>|<span class="hljs-number">7.211102550927978</span>|
|    min|<span class="hljs-title class_">Anna</span>|               <span class="hljs-number">20</span>|
|    max| <span class="hljs-title class_">Lee</span>|               <span class="hljs-number">34</span>|
+-------+----+-----------------+
</code></pre>
<h2>3. 컬럼 선택</h2>
<pre><code class="hljs language-js">df.<span class="hljs-title function_">select</span>(df[<span class="hljs-number">0</span>]).<span class="hljs-title function_">show</span>();
df.<span class="hljs-title function_">select</span>(df.<span class="hljs-property">Name</span>).<span class="hljs-title function_">show</span>();
df.<span class="hljs-title function_">select</span>(df[<span class="hljs-string">"Name"</span>]).<span class="hljs-title function_">show</span>();
df.<span class="hljs-title function_">select</span>(<span class="hljs-string">"Name"</span>).<span class="hljs-title function_">show</span>();
</code></pre>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js">#<span class="hljs-title class_">Output</span>
+-----+
| <span class="hljs-title class_">Name</span>|
+-----+
|<span class="hljs-title class_">James</span>|
| <span class="hljs-title class_">Anna</span>|
|  <span class="hljs-title class_">Lee</span>|
+-----+
</code></pre>
<h2>4. 데이터 필터링</h2>
<pre><code class="hljs language-js"># 데이터 필터링
df.<span class="hljs-title function_">filter</span>(df[<span class="hljs-number">1</span>] > <span class="hljs-number">25</span>).<span class="hljs-title function_">show</span>()
df.<span class="hljs-title function_">filter</span>(df.<span class="hljs-property">Age</span> > <span class="hljs-number">25</span>).<span class="hljs-title function_">show</span>()
df.<span class="hljs-title function_">filter</span>(df[<span class="hljs-string">"Age"</span>] > <span class="hljs-number">25</span>).<span class="hljs-title function_">show</span>()
</code></pre>
<pre><code class="hljs language-js">#<span class="hljs-title class_">Output</span>
+-----+---+
| <span class="hljs-title class_">Name</span>|<span class="hljs-title class_">Age</span>|
+-----+---+
|<span class="hljs-title class_">James</span>| <span class="hljs-number">34</span>|
|  <span class="hljs-title class_">Lee</span>| <span class="hljs-number">30</span>|
+-----+---+
</code></pre>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h2>5. 파일에 DataFrame 작성하기</h2>
<pre><code class="hljs language-js"># <span class="hljs-title class_">JSON</span> 파일 작성
df.<span class="hljs-property">write</span>.<span class="hljs-title function_">json</span>(<span class="hljs-string">"test123.json"</span>)

# <span class="hljs-title class_">Parquet</span> 파일 작성
df.<span class="hljs-property">write</span>.<span class="hljs-title function_">parquet</span>(<span class="hljs-string">"test123.parquet"</span>)
</code></pre>
<h2>6. 파일을 DataFrame으로 읽기</h2>
<pre><code class="hljs language-js"># <span class="hljs-title class_">JSON</span> 파일 읽기
df_json = spark.<span class="hljs-property">read</span>.<span class="hljs-title function_">json</span>(<span class="hljs-string">"test123.json"</span>)
# <span class="hljs-title class_">Parquet</span> 파일 읽기
df_parquet = spark.<span class="hljs-property">read</span>.<span class="hljs-title function_">parquet</span>(<span class="hljs-string">"test123.parquet"</span>)
</code></pre>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h2>7. 새로운 복합 데이터 유형을 포함한 새로운 열 추가</h2>
<pre><code class="hljs language-js"><span class="hljs-keyword">from</span> pyspark.<span class="hljs-property">sql</span>.<span class="hljs-property">functions</span> <span class="hljs-keyword">import</span> struct
df2 = df.<span class="hljs-title function_">withColumn</span>(<span class="hljs-string">"NameAndAge"</span>, <span class="hljs-title function_">struct</span>(df.<span class="hljs-property">Name</span>, df.<span class="hljs-property">Age</span>))
df2.<span class="hljs-title function_">show</span>()
df2.<span class="hljs-title function_">printSchema</span>()
</code></pre>
<pre><code class="hljs language-js"># 출력
+-----+---+-----------+
| <span class="hljs-title class_">Name</span>|<span class="hljs-title class_">Age</span>| <span class="hljs-title class_">NameAndAge</span>|
+-----+---+-----------+
|<span class="hljs-title class_">James</span>| <span class="hljs-number">34</span>|{<span class="hljs-title class_">James</span>, <span class="hljs-number">34</span>}|
| <span class="hljs-title class_">Anna</span>| <span class="hljs-number">20</span>| {<span class="hljs-title class_">Anna</span>, <span class="hljs-number">20</span>}|
|  <span class="hljs-title class_">Lee</span>| <span class="hljs-number">30</span>|  {<span class="hljs-title class_">Lee</span>, <span class="hljs-number">30</span>}|
+-----+---+-----------+

# 스키마 출력
root
 |-- <span class="hljs-title class_">Name</span>: string (nullable = <span class="hljs-literal">true</span>)
 |-- <span class="hljs-title class_">Age</span>: long (nullable = <span class="hljs-literal">true</span>)
 |-- <span class="hljs-title class_">NameAndAge</span>: struct (nullable = <span class="hljs-literal">false</span>)
 |    |-- <span class="hljs-title class_">Name</span>: string (nullable = <span class="hljs-literal">true</span>)
 |    |-- <span class="hljs-title class_">Age</span>: long (nullable = <span class="hljs-literal">true</span>)
</code></pre>
<h1>쿼리: 그룹화 및 집계</h1>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h2>1. count()</h2>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> pyspark.sql <span class="hljs-keyword">import</span> SparkSession
<span class="hljs-keyword">from</span> pyspark.sql.functions <span class="hljs-keyword">import</span> count

<span class="hljs-comment"># 스파크 세션 초기화</span>
spark = SparkSession.builder.appName(<span class="hljs-string">"그루핑 및 집계"</span>).getOrCreate()

<span class="hljs-comment"># 데이터프레임 생성</span>
data = [(<span class="hljs-string">"James"</span>, <span class="hljs-string">"Sales"</span>, <span class="hljs-number">3000</span>),
        (<span class="hljs-string">"Michael"</span>, <span class="hljs-string">"Sales"</span>, <span class="hljs-number">4600</span>),
        (<span class="hljs-string">"Robert"</span>, <span class="hljs-string">"Sales"</span>, <span class="hljs-number">4100</span>),
        (<span class="hljs-string">"Maria"</span>, <span class="hljs-string">"Finance"</span>, <span class="hljs-number">3000</span>),
        (<span class="hljs-string">"James"</span>, <span class="hljs-string">"Sales"</span>, <span class="hljs-number">3000</span>),
        (<span class="hljs-string">"Scott"</span>, <span class="hljs-string">"Finance"</span>, <span class="hljs-number">3300</span>),
        (<span class="hljs-string">"Jen"</span>, <span class="hljs-string">"Finance"</span>, <span class="hljs-number">3900</span>),
        (<span class="hljs-string">"Jeff"</span>, <span class="hljs-string">"Marketing"</span>, <span class="hljs-number">3000</span>),
        (<span class="hljs-string">"Kumar"</span>, <span class="hljs-string">"Marketing"</span>, <span class="hljs-number">2000</span>),
        (<span class="hljs-string">"Saif"</span>, <span class="hljs-string">"Sales"</span>, <span class="hljs-number">4100</span>)]
columns = [<span class="hljs-string">"employee_name"</span>, <span class="hljs-string">"department"</span>, <span class="hljs-string">"salary"</span>]
df = spark.createDataFrame(data, schema=columns)

<span class="hljs-comment"># 그룹화 및 count 수행</span>
grouped_df = df.groupBy(<span class="hljs-string">"department"</span>).count()
grouped_df.show()
</code></pre>
<pre><code class="hljs language-python"><span class="hljs-comment"># 결과</span>

+----------+-----+
|department|count|
+----------+-----+
|     Sales|    <span class="hljs-number">5</span>|
|   Finance|    <span class="hljs-number">3</span>|
| Marketing|    <span class="hljs-number">2</span>|
+----------+-----+
</code></pre>
<h2>2. max(), min(), avg(), sum()</h2>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js"># 그룹별로 그룹화 및 최댓값 찾기
max_df = df.<span class="hljs-title function_">groupBy</span>(<span class="hljs-string">"department"</span>).<span class="hljs-title function_">max</span>(<span class="hljs-string">"salary"</span>).<span class="hljs-title function_">alias</span>(<span class="hljs-string">"max_salary"</span>)
max_df.<span class="hljs-title function_">show</span>()
</code></pre>
<pre><code class="hljs language-js"># 결과

+----------+-----------+
|department|<span class="hljs-title function_">max</span>(salary)|
+----------+-----------+
|     <span class="hljs-title class_">Sales</span>|       <span class="hljs-number">4600</span>|
|   <span class="hljs-title class_">Finance</span>|       <span class="hljs-number">3900</span>|
| <span class="hljs-title class_">Marketing</span>|       <span class="hljs-number">3000</span>|
+----------+-----------+
</code></pre>
<h2>3. agg() + F.max(), F.count() 등…</h2>
<pre><code class="hljs language-js"><span class="hljs-keyword">from</span> pyspark.<span class="hljs-property">sql</span> <span class="hljs-keyword">import</span> functions <span class="hljs-keyword">as</span> F

# 여러 가지 집계 동작 수행
agg_df = df.<span class="hljs-title function_">groupBy</span>(<span class="hljs-string">"department"</span>).<span class="hljs-title function_">agg</span>(
    F.<span class="hljs-title function_">count</span>(<span class="hljs-string">"salary"</span>).<span class="hljs-title function_">alias</span>(<span class="hljs-string">"count"</span>),
    F.<span class="hljs-title function_">max</span>(<span class="hljs-string">"salary"</span>).<span class="hljs-title function_">alias</span>(<span class="hljs-string">"max_salary"</span>),
    F.<span class="hljs-title function_">min</span>(<span class="hljs-string">"salary"</span>).<span class="hljs-title function_">alias</span>(<span class="hljs-string">"min_salary"</span>),
    F.<span class="hljs-title function_">sum</span>(<span class="hljs-string">"salary"</span>).<span class="hljs-title function_">alias</span>(<span class="hljs-string">"total_salary"</span>),
    F.<span class="hljs-title function_">avg</span>(<span class="hljs-string">"salary"</span>).<span class="hljs-title function_">alias</span>(<span class="hljs-string">"average_salary"</span>)
)
agg_df.<span class="hljs-title function_">show</span>()
</code></pre>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js"># 결과
+----------+-----+----------+----------+------------+--------------+
|department|count|max_salary|min_salary|total_salary|average_salary|
+----------+-----+----------+----------+------------+--------------+
|     <span class="hljs-title class_">Sales</span>|    <span class="hljs-number">5</span>|      <span class="hljs-number">4600</span>|      <span class="hljs-number">3000</span>|       <span class="hljs-number">18800</span>|        <span class="hljs-number">3760.0</span>|
|   <span class="hljs-title class_">Finance</span>|    <span class="hljs-number">3</span>|      <span class="hljs-number">3900</span>|      <span class="hljs-number">3000</span>|       <span class="hljs-number">10200</span>|        <span class="hljs-number">3400.0</span>|
| <span class="hljs-title class_">Marketing</span>|    <span class="hljs-number">2</span>|      <span class="hljs-number">3000</span>|      <span class="hljs-number">2000</span>|        <span class="hljs-number">5000</span>|        <span class="hljs-number">2500.0</span>|
+----------+-----+----------+----------+------------+--------------+
</code></pre>
<h2>4. agg() + collect_list() 및 collect_set()</h2>
<pre><code class="hljs language-js"><span class="hljs-keyword">from</span> pyspark.<span class="hljs-property">sql</span>.<span class="hljs-property">functions</span> <span class="hljs-keyword">import</span> collect_list

# <span class="hljs-title class_">GroupBy</span> 및 리스트 수집 수행
collected_list_df = df.<span class="hljs-title function_">groupBy</span>(<span class="hljs-string">"department"</span>).<span class="hljs-title function_">agg</span>(
  <span class="hljs-title function_">collect_list</span>(<span class="hljs-string">"salary"</span>),
  <span class="hljs-title function_">collect_set</span>(<span class="hljs-string">"salary"</span>)
)
collected_list_df.<span class="hljs-title function_">show</span>(truncate=<span class="hljs-title class_">False</span>)
</code></pre>
<pre><code class="hljs language-js"># 결과
+----------+------------------------------+-------------------+
|department|<span class="hljs-title function_">collect_list</span>(salary)          |<span class="hljs-title function_">collect_set</span>(salary)|
+----------+------------------------------+-------------------+
|<span class="hljs-title class_">Sales</span>     |[<span class="hljs-number">3000</span>, <span class="hljs-number">4600</span>, <span class="hljs-number">4100</span>, <span class="hljs-number">3000</span>, <span class="hljs-number">4100</span>]|[<span class="hljs-number">4600</span>, <span class="hljs-number">3000</span>, <span class="hljs-number">4100</span>] |
|<span class="hljs-title class_">Finance</span>   |[<span class="hljs-number">3000</span>, <span class="hljs-number">3300</span>, <span class="hljs-number">3900</span>]            |[<span class="hljs-number">3900</span>, <span class="hljs-number">3000</span>, <span class="hljs-number">3300</span>] |
|<span class="hljs-title class_">Marketing</span> |[<span class="hljs-number">3000</span>, <span class="hljs-number">2000</span>]                  |[<span class="hljs-number">3000</span>, <span class="hljs-number">2000</span>]       |
+----------+------------------------------+-------------------+
</code></pre>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h2>5. agg() + 사용자 정의 집계 함수 (UDAF)</h2>
<ul>
<li>때로는 내장 함수만으로 복잡한 집계를 수행하기에 충분하지 않을 수 있습니다. Spark를 사용하면 사용자 정의 집계 함수를 만들 수 있습니다.</li>
</ul>
<pre><code class="hljs language-js"># 초기 데이터
|부서     |직원 이름        |급여    |
|----------|-------------|------|
|<span class="hljs-title class_">Sales</span>    |<span class="hljs-title class_">James</span>        |<span class="hljs-number">3000</span>  |
|<span class="hljs-title class_">Sales</span>    |<span class="hljs-title class_">Michael</span>      |<span class="hljs-number">4600</span>  |
|<span class="hljs-title class_">Sales</span>    |<span class="hljs-title class_">Robert</span>       |<span class="hljs-number">4100</span>  |
|<span class="hljs-title class_">Finance</span>  |<span class="hljs-title class_">Maria</span>        |<span class="hljs-number">3000</span>  |
|<span class="hljs-title class_">Sales</span>    |<span class="hljs-title class_">James</span>        |<span class="hljs-number">3000</span>  |
|<span class="hljs-title class_">Finance</span>  |<span class="hljs-title class_">Scott</span>        |<span class="hljs-number">3300</span>  |
|<span class="hljs-title class_">Finance</span>  |<span class="hljs-title class_">Jen</span>          |<span class="hljs-number">3900</span>  |
|<span class="hljs-title class_">Marketing</span>|<span class="hljs-title class_">Jeff</span>         |<span class="hljs-number">3000</span>  |
|<span class="hljs-title class_">Marketing</span>|<span class="hljs-title class_">Kumar</span>        |<span class="hljs-number">2000</span>  |
|<span class="hljs-title class_">Sales</span>    |<span class="hljs-title class_">Saif</span>         |<span class="hljs-number">4100</span>  |
</code></pre>
<pre><code class="hljs language-js"><span class="hljs-keyword">from</span> pyspark.<span class="hljs-property">sql</span>.<span class="hljs-property">functions</span> <span class="hljs-keyword">import</span> pandas_udf, <span class="hljs-title class_">PandasUDFType</span>
<span class="hljs-keyword">from</span> pandas <span class="hljs-keyword">import</span> <span class="hljs-title class_">DataFrame</span>

@<span class="hljs-title function_">pandas_udf</span>(<span class="hljs-string">"double"</span>)
def <span class="hljs-title function_">mean_salary</span>(<span class="hljs-attr">s</span>: pd.<span class="hljs-property">Series</span>) -> <span class="hljs-attr">float</span>:
 <span class="hljs-keyword">return</span> s.<span class="hljs-title function_">mean</span>()
udaf_df = df.<span class="hljs-title function_">groupBy</span>(<span class="hljs-string">"department"</span>).<span class="hljs-title function_">agg</span>(
  <span class="hljs-title function_">mean_salary</span>(df[<span class="hljs-string">"salary"</span>]).<span class="hljs-title function_">alias</span>(<span class="hljs-string">"average_salary"</span>)
)
udaf_df.<span class="hljs-title function_">show</span>()
</code></pre>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js"># 결과
+----------+--------------+
|department|average_salary|
+----------+--------------+
|   <span class="hljs-title class_">Finance</span>|        <span class="hljs-number">3400.0</span>|
| <span class="hljs-title class_">Marketing</span>|        <span class="hljs-number">2500.0</span>|
|     <span class="hljs-title class_">Sales</span>|        <span class="hljs-number">3760.0</span>|
+----------+--------------+

## <span class="hljs-number">6.</span> <span class="hljs-title function_">agg</span>() + 복잡한 조건: <span class="hljs-title function_">when</span>()

- 때로는 조건에 따른 합계나 평균과 같은 복잡한 조건이 집계 중에 필요할 수 있습니다.

# 초기 데이터
+----------+-------------+------+
|department|employee_name|salary|
+----------+-------------+------+
|     <span class="hljs-title class_">Sales</span>|        <span class="hljs-title class_">James</span>|  <span class="hljs-number">3000</span>|
|     <span class="hljs-title class_">Sales</span>|      <span class="hljs-title class_">Michael</span>|  <span class="hljs-number">4600</span>|
|     <span class="hljs-title class_">Sales</span>|       <span class="hljs-title class_">Robert</span>|  <span class="hljs-number">4100</span>|
|   <span class="hljs-title class_">Finance</span>|        <span class="hljs-title class_">Maria</span>|  <span class="hljs-number">3000</span>|
|     <span class="hljs-title class_">Sales</span>|        <span class="hljs-title class_">James</span>|  <span class="hljs-number">3000</span>|
|   <span class="hljs-title class_">Finance</span>|        <span class="hljs-title class_">Scott</span>|  <span class="hljs-number">3300</span>|
|   <span class="hljs-title class_">Finance</span>|          <span class="hljs-title class_">Jen</span>|  <span class="hljs-number">3900</span>|
| <span class="hljs-title class_">Marketing</span>|         <span class="hljs-title class_">Jeff</span>|  <span class="hljs-number">3000</span>|
| <span class="hljs-title class_">Marketing</span>|        <span class="hljs-title class_">Kumar</span>|  <span class="hljs-number">2000</span>|
|     <span class="hljs-title class_">Sales</span>|         <span class="hljs-title class_">Saif</span>|  <span class="hljs-number">4100</span>|
+----------+-------------+------+

&#x3C;!-- <span class="hljs-variable constant_">TIL</span> 수평 -->
<span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">ins</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"adsbygoogle"</span>
     <span class="hljs-attr">style</span>=<span class="hljs-string">"display:block"</span>
     <span class="hljs-attr">data-ad-client</span>=<span class="hljs-string">"ca-pub-4877378276818686"</span>
     <span class="hljs-attr">data-ad-slot</span>=<span class="hljs-string">"1549334788"</span>
     <span class="hljs-attr">data-ad-format</span>=<span class="hljs-string">"auto"</span>
     <span class="hljs-attr">data-full-width-responsive</span>=<span class="hljs-string">"true"</span>></span><span class="hljs-tag">&#x3C;/<span class="hljs-name">ins</span>></span></span>
<span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">script</span>></span><span class="javascript">
(adsbygoogle = <span class="hljs-variable language_">window</span>.<span class="hljs-property">adsbygoogle</span> || []).<span class="hljs-title function_">push</span>({});
</span><span class="hljs-tag">&#x3C;/<span class="hljs-name">script</span>></span></span>

<span class="hljs-keyword">from</span> pyspark.<span class="hljs-property">sql</span>.<span class="hljs-property">functions</span> <span class="hljs-keyword">import</span> when

# 조건부 집계
conditional_agg_df = df.<span class="hljs-title function_">groupBy</span>(<span class="hljs-string">"department"</span>).<span class="hljs-title function_">agg</span>(
    <span class="hljs-title function_">sum</span>(<span class="hljs-title function_">when</span>(df[<span class="hljs-string">"salary"</span>] > <span class="hljs-number">3000</span>, df[<span class="hljs-string">"salary"</span>])).<span class="hljs-title function_">alias</span>(<span class="hljs-string">"sum_high_salaries"</span>)
)
conditional_agg_df.<span class="hljs-title function_">show</span>()

# 결과

+----------+-----------------+
|department|sum_high_salaries|
+----------+-----------------+
|     <span class="hljs-title class_">Sales</span>|            <span class="hljs-number">12800</span>|
|   <span class="hljs-title class_">Finance</span>|             <span class="hljs-number">7200</span>|
| <span class="hljs-title class_">Marketing</span>|             <span class="hljs-variable constant_">NULL</span>|
+----------+-----------------+

## <span class="hljs-number">6.</span> <span class="hljs-title function_">agg</span>() 이후 <span class="hljs-title class_">GroupBy</span>에서 <span class="hljs-variable constant_">RDD</span> <span class="hljs-title class_">Map</span> 함수 사용하기

- 경우에 따라 매핑 함수를 <span class="hljs-title class_">GroupBy</span>와 결합하여 집단화된 데이터에 대한 직접적인 집계가 아닌 작업을 수행할 수 있습니다.

&#x3C;!-- <span class="hljs-variable constant_">TIL</span> 수평 -->
<span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">ins</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"adsbygoogle"</span>
     <span class="hljs-attr">style</span>=<span class="hljs-string">"display:block"</span>
     <span class="hljs-attr">data-ad-client</span>=<span class="hljs-string">"ca-pub-4877378276818686"</span>
     <span class="hljs-attr">data-ad-slot</span>=<span class="hljs-string">"1549334788"</span>
     <span class="hljs-attr">data-ad-format</span>=<span class="hljs-string">"auto"</span>
     <span class="hljs-attr">data-full-width-responsive</span>=<span class="hljs-string">"true"</span>></span><span class="hljs-tag">&#x3C;/<span class="hljs-name">ins</span>></span></span>
<span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">script</span>></span><span class="javascript">
(adsbygoogle = <span class="hljs-variable language_">window</span>.<span class="hljs-property">adsbygoogle</span> || []).<span class="hljs-title function_">push</span>({});
</span><span class="hljs-tag">&#x3C;/<span class="hljs-name">script</span>></span></span>

</code></pre>
<h1>데이터</h1>




























































<table><thead><tr><th>department</th><th>employee_name</th><th>salary</th></tr></thead><tbody><tr><td>Sales</td><td>James</td><td>3000</td></tr><tr><td>Sales</td><td>Michael</td><td>4600</td></tr><tr><td>Sales</td><td>Robert</td><td>4100</td></tr><tr><td>Finance</td><td>Maria</td><td>3000</td></tr><tr><td>Sales</td><td>James</td><td>3000</td></tr><tr><td>Finance</td><td>Scott</td><td>3300</td></tr><tr><td>Finance</td><td>Jen</td><td>3900</td></tr><tr><td>Marketing</td><td>Jeff</td><td>3000</td></tr><tr><td>Marketing</td><td>Kumar</td><td>2000</td></tr><tr><td>Sales</td><td>Saif</td><td>4100</td></tr></tbody></table>
<h1>GroupBy 후 map 작업 적용</h1>
<pre><code class="hljs language-python">result_rdd = df.groupBy(<span class="hljs-string">"department"</span>).agg(
  collect_list(<span class="hljs-string">"salary"</span>)
).rdd.<span class="hljs-built_in">map</span>(
  <span class="hljs-keyword">lambda</span> x: (x[<span class="hljs-number">0</span>], <span class="hljs-built_in">max</span>(x[<span class="hljs-number">1</span>]))
)

result_df = spark.createDataFrame(result_rdd, [<span class="hljs-string">"department"</span>, <span class="hljs-string">"max_salary"</span>])
result_df.show()
</code></pre>
<h1>결과</h1>





















<table><thead><tr><th>department</th><th>max_salary</th></tr></thead><tbody><tr><td>Sales</td><td>4600</td></tr><tr><td>Finance</td><td>3900</td></tr><tr><td>Marketing</td><td>3000</td></tr></tbody></table>
<h1>조회: 다른 것</h1>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h2>1. rollup()과 cube()</h2>
<ul>
<li>Rollup()은 다차원 집계를 생성하고 Excel의 소계와 유사한 계층적 요약을 제공합니다.</li>
</ul>
<pre><code class="hljs language-js"># 초기 데이터
|department|employee_name|salary|
|----------|-------------|------|
| <span class="hljs-title class_">Sales</span>    | <span class="hljs-title class_">James</span>       | <span class="hljs-number">3000</span> |
| <span class="hljs-title class_">Sales</span>    | <span class="hljs-title class_">Michael</span>     | <span class="hljs-number">4600</span> |
| <span class="hljs-title class_">Sales</span>    | <span class="hljs-title class_">Robert</span>      | <span class="hljs-number">4100</span> |
| <span class="hljs-title class_">Finance</span>  | <span class="hljs-title class_">Maria</span>       | <span class="hljs-number">3000</span> |
| <span class="hljs-title class_">Sales</span>    | <span class="hljs-title class_">James</span>       | <span class="hljs-number">3000</span> |
| <span class="hljs-title class_">Finance</span>  | <span class="hljs-title class_">Scott</span>       | <span class="hljs-number">3300</span> |
| <span class="hljs-title class_">Finance</span>  | <span class="hljs-title class_">Jen</span>         | <span class="hljs-number">3900</span> |
| <span class="hljs-title class_">Marketing</span>| <span class="hljs-title class_">Jeff</span>        | <span class="hljs-number">3000</span> |
| <span class="hljs-title class_">Marketing</span>| <span class="hljs-title class_">Kumar</span>       | <span class="hljs-number">2000</span> |
| <span class="hljs-title class_">Sales</span>    | <span class="hljs-title class_">Saif</span>        | <span class="hljs-number">4100</span> |
</code></pre>
<pre><code class="hljs language-js"><span class="hljs-keyword">from</span> pyspark.<span class="hljs-property">sql</span>.<span class="hljs-property">functions</span> <span class="hljs-keyword">import</span> sum

# <span class="hljs-title class_">Rollup</span> 예제
rollup_df = df.<span class="hljs-title function_">rollup</span>(<span class="hljs-string">"department"</span>, <span class="hljs-string">"employee_name"</span>).<span class="hljs-title function_">sum</span>(<span class="hljs-string">"salary"</span>)
rollup_df.<span class="hljs-title function_">show</span>()
</code></pre>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js"># 결과
+----------+-------------+-----------+
|department|employee_name|<span class="hljs-title function_">sum</span>(salary)|
+----------+-------------+-----------+
|     <span class="hljs-title class_">Sales</span>|        <span class="hljs-title class_">James</span>|       <span class="hljs-number">6000</span>|
|      <span class="hljs-variable constant_">NULL</span>|         <span class="hljs-variable constant_">NULL</span>|      <span class="hljs-number">34000</span>|
|     <span class="hljs-title class_">Sales</span>|         <span class="hljs-variable constant_">NULL</span>|      <span class="hljs-number">18800</span>|
|     <span class="hljs-title class_">Sales</span>|      <span class="hljs-title class_">Michael</span>|       <span class="hljs-number">4600</span>|
|     <span class="hljs-title class_">Sales</span>|       <span class="hljs-title class_">Robert</span>|       <span class="hljs-number">4100</span>|
|   <span class="hljs-title class_">Finance</span>|         <span class="hljs-variable constant_">NULL</span>|      <span class="hljs-number">10200</span>|
|   <span class="hljs-title class_">Finance</span>|        <span class="hljs-title class_">Maria</span>|       <span class="hljs-number">3000</span>|
|   <span class="hljs-title class_">Finance</span>|        <span class="hljs-title class_">Scott</span>|       <span class="hljs-number">3300</span>|
|   <span class="hljs-title class_">Finance</span>|          <span class="hljs-title class_">Jen</span>|       <span class="hljs-number">3900</span>|
| <span class="hljs-title class_">Marketing</span>|         <span class="hljs-variable constant_">NULL</span>|       <span class="hljs-number">5000</span>|
| <span class="hljs-title class_">Marketing</span>|         <span class="hljs-title class_">Jeff</span>|       <span class="hljs-number">3000</span>|
| <span class="hljs-title class_">Marketing</span>|        <span class="hljs-title class_">Kumar</span>|       <span class="hljs-number">2000</span>|
|     <span class="hljs-title class_">Sales</span>|         <span class="hljs-title class_">Saif</span>|       <span class="hljs-number">4100</span>|
+----------+-------------+-----------+
</code></pre>
<ul>
<li>Cube(): Cube는 다차원 집계를 생성하고 지정된 그룹화 열의 다중 조합을 통해 통찰을 제공합니다.</li>
</ul>
<pre><code class="hljs language-js"># 초기 데이터
+----------+-------------+------+
|department|employee_name|salary|
+----------+-------------+------+
|     <span class="hljs-title class_">Sales</span>|        <span class="hljs-title class_">James</span>|  <span class="hljs-number">3000</span>|
|     <span class="hljs-title class_">Sales</span>|      <span class="hljs-title class_">Michael</span>|  <span class="hljs-number">4600</span>|
|     <span class="hljs-title class_">Sales</span>|       <span class="hljs-title class_">Robert</span>|  <span class="hljs-number">4100</span>|
|   <span class="hljs-title class_">Finance</span>|        <span class="hljs-title class_">Maria</span>|  <span class="hljs-number">3000</span>|
|     <span class="hljs-title class_">Sales</span>|        <span class="hljs-title class_">James</span>|  <span class="hljs-number">3000</span>|
|   <span class="hljs-title class_">Finance</span>|        <span class="hljs-title class_">Scott</span>|  <span class="hljs-number">3300</span>|
|   <span class="hljs-title class_">Finance</span>|          <span class="hljs-title class_">Jen</span>|  <span class="hljs-number">3900</span>|
| <span class="hljs-title class_">Marketing</span>|         <span class="hljs-title class_">Jeff</span>|  <span class="hljs-number">3000</span>|
| <span class="hljs-title class_">Marketing</span>|        <span class="hljs-title class_">Kumar</span>|  <span class="hljs-number">2000</span>|
|     <span class="hljs-title class_">Sales</span>|         <span class="hljs-title class_">Saif</span>|  <span class="hljs-number">4100</span>|
+----------+-------------+------+
</code></pre>
<pre><code class="hljs language-js"><span class="hljs-keyword">from</span> pyspark.<span class="hljs-property">sql</span>.<span class="hljs-property">functions</span> <span class="hljs-keyword">import</span> sum

# <span class="hljs-title class_">Cube</span> 예시
cube_df = df.<span class="hljs-title function_">cube</span>(<span class="hljs-string">"department"</span>, <span class="hljs-string">"employee_name"</span>).<span class="hljs-title function_">sum</span>(<span class="hljs-string">"salary"</span>)
cube_df.<span class="hljs-title function_">show</span>()
</code></pre>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js"># 결과

+----------+-------------+-----------+
|부서      |직원명         |급여합계   |
+----------+-------------+-----------+
|      <span class="hljs-variable constant_">NULL</span>|        <span class="hljs-title class_">James</span>|       <span class="hljs-number">6000</span>|
|     판매 |        <span class="hljs-title class_">James</span>|       <span class="hljs-number">6000</span>|
|      <span class="hljs-variable constant_">NULL</span>|         <span class="hljs-variable constant_">NULL</span>|      <span class="hljs-number">34000</span>|
|     판매 |         <span class="hljs-variable constant_">NULL</span>|      <span class="hljs-number">18800</span>|
|      <span class="hljs-variable constant_">NULL</span>|      <span class="hljs-title class_">Michael</span>|       <span class="hljs-number">4600</span>|
|     판매 |      <span class="hljs-title class_">Michael</span>|       <span class="hljs-number">4600</span>|
|     판매 |       <span class="hljs-title class_">Robert</span>|       <span class="hljs-number">4100</span>|
|      <span class="hljs-variable constant_">NULL</span>|       <span class="hljs-title class_">Robert</span>|       <span class="hljs-number">4100</span>|
|   재무   |         <span class="hljs-variable constant_">NULL</span>|      <span class="hljs-number">10200</span>|
|   재무   |        <span class="hljs-title class_">Maria</span>|       <span class="hljs-number">3000</span>|
|      <span class="hljs-variable constant_">NULL</span>|        <span class="hljs-title class_">Maria</span>|       <span class="hljs-number">3000</span>|
|      <span class="hljs-variable constant_">NULL</span>|        <span class="hljs-title class_">Scott</span>|       <span class="hljs-number">3300</span>|
|   재무   |        <span class="hljs-title class_">Scott</span>|       <span class="hljs-number">3300</span>|
|      <span class="hljs-variable constant_">NULL</span>|          <span class="hljs-title class_">Jen</span>|       <span class="hljs-number">3900</span>|
|   재무   |          <span class="hljs-title class_">Jen</span>|       <span class="hljs-number">3900</span>|
| 마케팅  |         <span class="hljs-variable constant_">NULL</span>|       <span class="hljs-number">5000</span>|
| 마케팅  |         <span class="hljs-title class_">Jeff</span>|       <span class="hljs-number">3000</span>|
|      <span class="hljs-variable constant_">NULL</span>|         <span class="hljs-title class_">Jeff</span>|       <span class="hljs-number">3000</span>|
| 마케팅  |        <span class="hljs-title class_">Kumar</span>|       <span class="hljs-number">2000</span>|
|      <span class="hljs-variable constant_">NULL</span>|        <span class="hljs-title class_">Kumar</span>|       <span class="hljs-number">2000</span>|
+----------+-------------+-----------+
상위 <span class="hljs-number">20</span>개 행만 표시
</code></pre>
<h2>2. groupBy() + pivot()</h2>
<ul>
<li>Pivoting을 사용하면 행을 열로 변환하여 피벗 테이블과 유사한 방식으로 데이터를 요약할 수 있습니다. 종종 두 열 간의 관계를 이해하는 데 사용됩니다.</li>
</ul>
<pre><code class="hljs language-js"># 초기 데이터
+----------+-------------+------+
|부서     |직원명        |급여   |
+----------+-------------+------+
|     판매 |        <span class="hljs-title class_">James</span>|  <span class="hljs-number">3000</span>|
|     판매 |      <span class="hljs-title class_">Michael</span>|  <span class="hljs-number">4600</span>|
|     판매 |       <span class="hljs-title class_">Robert</span>|  <span class="hljs-number">4100</span>|
|   재무  |        <span class="hljs-title class_">Maria</span>|  <span class="hljs-number">3000</span>|
|     판매 |        <span class="hljs-title class_">James</span>|  <span class="hljs-number">3000</span>|
|   재무  |        <span class="hljs-title class_">Scott</span>|  <span class="hljs-number">3300</span>|
|   재무  |          <span class="hljs-title class_">Jen</span>|  <span class="hljs-number">3900</span>|
| 마케팅  |         <span class="hljs-title class_">Jeff</span>|  <span class="hljs-number">3000</span>|
| 마케팅  |        <span class="hljs-title class_">Kumar</span>|  <span class="hljs-number">2000</span>|
|     판매 |         <span class="hljs-title class_">Saif</span>|  <span class="hljs-number">4100</span>|
+----------+-------------+------+
</code></pre>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js"># <span class="hljs-title class_">Pivot</span> 예시
pivot_df = df.<span class="hljs-title function_">groupBy</span>(<span class="hljs-string">"department"</span>).<span class="hljs-title function_">pivot</span>(<span class="hljs-string">"employee_name"</span>).<span class="hljs-title function_">sum</span>(<span class="hljs-string">"salary"</span>)
pivot_df.<span class="hljs-title function_">show</span>()
</code></pre>
<pre><code class="hljs language-js"># 결과
+----------+-----+----+----+-----+-----+-------+------+----+-----+
|department|<span class="hljs-title class_">James</span>|<span class="hljs-title class_">Jeff</span>| <span class="hljs-title class_">Jen</span>|<span class="hljs-title class_">Kumar</span>|<span class="hljs-title class_">Maria</span>|<span class="hljs-title class_">Michael</span>|<span class="hljs-title class_">Robert</span>|<span class="hljs-title class_">Saif</span>|<span class="hljs-title class_">Scott</span>|
+----------+-----+----+----+-----+-----+-------+------+----+-----+
|     <span class="hljs-title class_">Sales</span>| <span class="hljs-number">6000</span>|<span class="hljs-variable constant_">NULL</span>|<span class="hljs-variable constant_">NULL</span>| <span class="hljs-variable constant_">NULL</span>| <span class="hljs-variable constant_">NULL</span>|   <span class="hljs-number">4600</span>|  <span class="hljs-number">4100</span>|<span class="hljs-number">4100</span>| <span class="hljs-variable constant_">NULL</span>|
|   <span class="hljs-title class_">Finance</span>| <span class="hljs-variable constant_">NULL</span>|<span class="hljs-variable constant_">NULL</span>|<span class="hljs-number">3900</span>| <span class="hljs-variable constant_">NULL</span>| <span class="hljs-number">3000</span>|   <span class="hljs-variable constant_">NULL</span>|  <span class="hljs-variable constant_">NULL</span>|<span class="hljs-variable constant_">NULL</span>| <span class="hljs-number">3300</span>|
| <span class="hljs-title class_">Marketing</span>| <span class="hljs-variable constant_">NULL</span>|<span class="hljs-number">3000</span>|<span class="hljs-variable constant_">NULL</span>| <span class="hljs-number">2000</span>| <span class="hljs-variable constant_">NULL</span>|   <span class="hljs-variable constant_">NULL</span>|  <span class="hljs-variable constant_">NULL</span>|<span class="hljs-variable constant_">NULL</span>| <span class="hljs-variable constant_">NULL</span>|
+----------+-----+----+----+-----+-----+-------+------+----+-----+
</code></pre>
<h2>3. 윈도우 함수: partitionBy() + row_number()/rank().over(w)</h2>
<ul>
<li>윈도우 함수는 현재 행과 관련된 "윈도우"에 대해 계산을 수행할 수 있어 전통적인 group-by 작업보다 더 유연성을 제공합니다. 이는 러닝 토탈, 이동 평균 또는 이전 및 다음 행에 액세스하는 데 특히 유용합니다.</li>
</ul>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js"># 초기 데이터
| 부서      | 직원 이름       | 급여  |
|----------|---------------|------|
| <span class="hljs-title class_">Sales</span>    | <span class="hljs-title class_">James</span>         | <span class="hljs-number">3000</span> |
| <span class="hljs-title class_">Sales</span>    | <span class="hljs-title class_">Michael</span>       | <span class="hljs-number">4600</span> |
| <span class="hljs-title class_">Sales</span>    | <span class="hljs-title class_">Robert</span>        | <span class="hljs-number">4100</span> |
| <span class="hljs-title class_">Finance</span>  | <span class="hljs-title class_">Maria</span>         | <span class="hljs-number">3000</span> |
| <span class="hljs-title class_">Sales</span>    | <span class="hljs-title class_">James</span>         | <span class="hljs-number">3000</span> |
| <span class="hljs-title class_">Finance</span>  | <span class="hljs-title class_">Scott</span>         | <span class="hljs-number">3300</span> |
| <span class="hljs-title class_">Finance</span>  | <span class="hljs-title class_">Jen</span>           | <span class="hljs-number">3900</span> |
| <span class="hljs-title class_">Marketing</span>| <span class="hljs-title class_">Jeff</span>          | <span class="hljs-number">3000</span> |
| <span class="hljs-title class_">Marketing</span>| <span class="hljs-title class_">Kumar</span>         | <span class="hljs-number">2000</span> |
| <span class="hljs-title class_">Sales</span>    | <span class="hljs-title class_">Saif</span>          | <span class="hljs-number">4100</span> |

</code></pre>
<pre><code class="hljs language-js"><span class="hljs-keyword">from</span> pyspark.<span class="hljs-property">sql</span>.<span class="hljs-property">window</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">Window</span>
<span class="hljs-keyword">from</span> pyspark.<span class="hljs-property">sql</span>.<span class="hljs-property">functions</span> <span class="hljs-keyword">import</span> col, row_number

windowSpec = <span class="hljs-title class_">Window</span>.<span class="hljs-title function_">partitionBy</span>(<span class="hljs-string">"department"</span>).<span class="hljs-title function_">orderBy</span>(<span class="hljs-title function_">col</span>(<span class="hljs-string">"salary"</span>).<span class="hljs-title function_">asc</span>())
df_with_row_number = df.<span class="hljs-title function_">withColumn</span>(<span class="hljs-string">"row_number"</span>, <span class="hljs-title function_">row_number</span>().<span class="hljs-title function_">over</span>(windowSpec))
df_with_row_number.<span class="hljs-title function_">show</span>()
</code></pre>
<pre><code class="hljs language-js"># 결과
| 직원 이름      | 부서        | 급여  | row_number |
|---------------|------------|------|------------|
| <span class="hljs-title class_">Maria</span>         | <span class="hljs-title class_">Finance</span>    | <span class="hljs-number">3000</span> |      <span class="hljs-number">1</span>     |
| <span class="hljs-title class_">Scott</span>         | <span class="hljs-title class_">Finance</span>    | <span class="hljs-number">3300</span> |      <span class="hljs-number">2</span>     |
| <span class="hljs-title class_">Jen</span>           | <span class="hljs-title class_">Finance</span>    | <span class="hljs-number">3900</span> |      <span class="hljs-number">3</span>     |
| <span class="hljs-title class_">Kumar</span>         | <span class="hljs-title class_">Marketing</span>  | <span class="hljs-number">2000</span> |      <span class="hljs-number">1</span>     |
| <span class="hljs-title class_">Jeff</span>          | <span class="hljs-title class_">Marketing</span>  | <span class="hljs-number">3000</span> |      <span class="hljs-number">2</span>     |
| <span class="hljs-title class_">James</span>         | <span class="hljs-title class_">Sales</span>      | <span class="hljs-number">3000</span> |      <span class="hljs-number">1</span>     |
| <span class="hljs-title class_">James</span>         | <span class="hljs-title class_">Sales</span>      | <span class="hljs-number">3000</span> |      <span class="hljs-number">2</span>     |
| <span class="hljs-title class_">Robert</span>        | <span class="hljs-title class_">Sales</span>      | <span class="hljs-number">4100</span> |      <span class="hljs-number">3</span>     |
| <span class="hljs-title class_">Saif</span>          | <span class="hljs-title class_">Sales</span>      | <span class="hljs-number">4100</span> |      <span class="hljs-number">4</span>     |
| <span class="hljs-title class_">Michael</span>       | <span class="hljs-title class_">Sales</span>      | <span class="hljs-number">4600</span> |      <span class="hljs-number">5</span>     |

</code></pre>
<ul>
<li>Rank() 함수를 위해</li>
</ul>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js"><span class="hljs-keyword">from</span> pyspark.<span class="hljs-property">sql</span>.<span class="hljs-property">window</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">Window</span>
<span class="hljs-keyword">from</span> pyspark.<span class="hljs-property">sql</span>.<span class="hljs-property">functions</span> <span class="hljs-keyword">import</span> rank, col

windowSpec = <span class="hljs-title class_">Window</span>.<span class="hljs-title function_">partitionBy</span>(<span class="hljs-string">"department"</span>).<span class="hljs-title function_">orderBy</span>(<span class="hljs-title function_">col</span>(<span class="hljs-string">"salary"</span>).<span class="hljs-title function_">desc</span>())
df_with_rank = df.<span class="hljs-title function_">withColumn</span>(<span class="hljs-string">"rank"</span>, <span class="hljs-title function_">rank</span>().<span class="hljs-title function_">over</span>(windowSpec))
df_with_rank.<span class="hljs-title function_">show</span>()
</code></pre>
<pre><code class="hljs language-js"># 출력
+-------------+----------+------+----------+
|employee_name|department|salary|      rank|
+-------------+----------+------+----------+
|          <span class="hljs-title class_">Jen</span>|   <span class="hljs-title class_">Finance</span>|  <span class="hljs-number">3900</span>|         <span class="hljs-number">1</span>|
|        <span class="hljs-title class_">Scott</span>|   <span class="hljs-title class_">Finance</span>|  <span class="hljs-number">3300</span>|         <span class="hljs-number">2</span>|
|        <span class="hljs-title class_">Maria</span>|   <span class="hljs-title class_">Finance</span>|  <span class="hljs-number">3000</span>|         <span class="hljs-number">3</span>|
|         <span class="hljs-title class_">Jeff</span>| <span class="hljs-title class_">Marketing</span>|  <span class="hljs-number">3000</span>|         <span class="hljs-number">1</span>|
|        <span class="hljs-title class_">Kumar</span>| <span class="hljs-title class_">Marketing</span>|  <span class="hljs-number">2000</span>|         <span class="hljs-number">2</span>|
|      <span class="hljs-title class_">Michael</span>|     <span class="hljs-title class_">Sales</span>|  <span class="hljs-number">4600</span>|         <span class="hljs-number">1</span>|
|       <span class="hljs-title class_">Robert</span>|     <span class="hljs-title class_">Sales</span>|  <span class="hljs-number">4100</span>|         <span class="hljs-number">2</span>|
|         <span class="hljs-title class_">Saif</span>|     <span class="hljs-title class_">Sales</span>|  <span class="hljs-number">4100</span>|         <span class="hljs-number">2</span>|
|        <span class="hljs-title class_">James</span>|     <span class="hljs-title class_">Sales</span>|  <span class="hljs-number">3000</span>|         <span class="hljs-number">3</span>|
|        <span class="hljs-title class_">James</span>|     <span class="hljs-title class_">Sales</span>|  <span class="hljs-number">3000</span>|         <span class="hljs-number">3</span>|
+-------------+----------+------+----------+
</code></pre>
<h1>최적화 I: 무게 감소</h1>
<h2>0. 불필요한 원시 데이터 제거</h2>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h2>1. DataFrame이 여러 번 액세스 될 때 캐시합니다.</h2>
<pre><code class="hljs language-js">df.<span class="hljs-title function_">cache</span>();
df.<span class="hljs-title function_">count</span>();
</code></pre>
<pre><code class="hljs language-js">#출력
<span class="hljs-number">3</span>
</code></pre>
<h2>2. 적절한 파일 형식 사용하기</h2>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<ul>
<li>압축 파일은 파일의 입출력 및 메모리를 절약할 수 있어요.</li>
<li>압축 해제된 파일은 CPU를 절약할 수 있어요.</li>
</ul>
<pre><code class="hljs language-js">df.<span class="hljs-property">write</span>.<span class="hljs-title function_">parquet</span>(<span class="hljs-string">"output.parquet"</span>);
</code></pre>
<h2>3. 스키마 수동 지정하기</h2>
<pre><code class="hljs language-js"><span class="hljs-keyword">from</span> pyspark.<span class="hljs-property">sql</span>.<span class="hljs-property">types</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">StructType</span>, <span class="hljs-title class_">StructField</span>, <span class="hljs-title class_">IntegerType</span>, <span class="hljs-title class_">StringType</span>
schema = <span class="hljs-title class_">StructType</span>([
    <span class="hljs-title class_">StructField</span>(<span class="hljs-string">"id"</span>, <span class="hljs-title class_">IntegerType</span>(), <span class="hljs-title class_">True</span>),
    <span class="hljs-title class_">StructField</span>(<span class="hljs-string">"name"</span>, <span class="hljs-title class_">StringType</span>(), <span class="hljs-title class_">True</span>),
    <span class="hljs-title class_">StructField</span>(<span class="hljs-string">"age"</span>, <span class="hljs-title class_">IntegerType</span>(), <span class="hljs-title class_">True</span>)
])
df = spark.<span class="hljs-property">read</span>.<span class="hljs-title function_">schema</span>(schema).<span class="hljs-title function_">csv</span>(<span class="hljs-string">"path/to/file.csv"</span>)
</code></pre>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h2>4. 조기에 필요한 열 선택하기</h2>
<p>데이터 처리 파이프라인에서 메모리 사용량을 줄이기 위해 필요한 열만 미리 선택하세요.</p>
<pre><code class="hljs language-js">df.<span class="hljs-title function_">select</span>(<span class="hljs-string">"dept_name"</span>, <span class="hljs-string">"name"</span>).<span class="hljs-title function_">filter</span>(<span class="hljs-string">"dept_id >= 102"</span>).<span class="hljs-title function_">show</span>();
df.<span class="hljs-title function_">select</span>(<span class="hljs-string">"dept_name"</span>, <span class="hljs-string">"name"</span>)
  .<span class="hljs-title function_">filter</span>(df.<span class="hljs-property">dept_id</span> >= <span class="hljs-number">102</span>)
  .<span class="hljs-title function_">show</span>();
</code></pre>
<pre><code class="hljs language-js">#출력
+---------+----+
|dept_name|name|
+---------+----+
|<span class="hljs-title class_">Marketing</span>|<span class="hljs-title class_">Jane</span>|
|  <span class="hljs-title class_">Finance</span>| <span class="hljs-title class_">Joe</span>|
+---------+----+
</code></pre>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h2>5. 필터를 조인이나 집계 전에 빠르게 적용하세요.</h2>
<pre><code class="hljs language-js">df.<span class="hljs-title function_">filter</span>(<span class="hljs-string">"age > 25"</span>).<span class="hljs-title function_">join</span>(df_other, <span class="hljs-string">"id"</span>).<span class="hljs-title function_">show</span>();
</code></pre>
<h2>6. 큰 데이터셋 수집 방지를 위해 limit() 사용하기</h2>
<ul>
<li>큰 데이터셋에 collect()를 사용하지 않도록 주의하여 메모리 부족 오류를 방지하세요.</li>
</ul>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js">df.<span class="hljs-title function_">filter</span>(<span class="hljs-string">"age > 30"</span>).<span class="hljs-title function_">limit</span>(<span class="hljs-number">100</span>).<span class="hljs-title function_">collect</span>();
</code></pre>
<h2>7. Using spark.sql(): Catalyst optimizer for Complex Queries</h2>
<ul>
<li>Leverage Spark SQL for complex queries, which might be more readable and can benefit from the Catalyst optimizer.</li>
</ul>
<pre><code class="hljs language-js">df.<span class="hljs-title function_">createOrReplaceTempView</span>(<span class="hljs-string">"table"</span>);
spark.<span class="hljs-title function_">sql</span>(<span class="hljs-string">"SELECT id, sum(value) FROM table GROUP BY id"</span>).<span class="hljs-title function_">show</span>();
</code></pre>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h2>8. RDD 사용: reduceByKey를 사용한 집계</h2>
<ul>
<li>집계 작업을 수행할 때 reduceByKey를 사용하는 것이 groupBy보다 더 효율적일 수 있습니다.</li>
</ul>
<pre><code class="hljs language-python">rdd = df.rdd.<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x: (x[<span class="hljs-number">0</span>], x[<span class="hljs-number">1</span>]))
reduced = rdd.reduceByKey(<span class="hljs-keyword">lambda</span> a, b: a + b)
reduced.toDF([<span class="hljs-string">"key"</span>, <span class="hljs-string">"value"</span>]).show()
</code></pre>
<h1>최적화 II: 파티션 없이 병렬화 없음</h1>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h2>1. 테이블 분할: partitionBy()</h2>
<ul>
<li>데이터프레임을 디스크에 저장할 때 빠른 후속 읽기를 위해 분할을 사용하세요.</li>
</ul>
<pre><code class="hljs language-js">df.<span class="hljs-property">write</span>.<span class="hljs-title function_">partitionBy</span>(<span class="hljs-string">"year"</span>, <span class="hljs-string">"month"</span>).<span class="hljs-title function_">parquet</span>(<span class="hljs-string">"path/to/output"</span>);
</code></pre>
<h2>2. 스튜 관리를 위한 Salting 키</h2>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<ul>
<li>조인 연산 중 데이터 스큐가 발생하는 경우, 하나 이상의 키 값이 다른 것들보다 훨씬 더 많은 데이터를 가지고 있을 때 발생합니다.</li>
<li>예를 들어 "customer_id"를 기준으로 조인을 수행하고, 대부분의 거래가 소수의 고객에 속해 있다면 이러한 소수의 키는 다른 키들에 비해 훨씬 많은 양의 데이터를 가지고 있을 것입니다. 이로 인해 일부 작업(큰 키를 처리하는 작업)이 훨씬 더 오랜 시간이 걸리고 병목 현상이 발생할 수 있습니다.</li>
<li>이 문제를 해결하는 방법은 skewed 데이터를 관리하기 위해 키에 임의의 접두사를 추가하는 것입니다.</li>
</ul>
<pre><code class="hljs language-js"><span class="hljs-keyword">from</span> pyspark.<span class="hljs-property">sql</span>.<span class="hljs-property">functions</span> <span class="hljs-keyword">import</span> monotonically_increasing_id, expr
df.<span class="hljs-title function_">withColumn</span>(<span class="hljs-string">"salted_key"</span>,
    <span class="hljs-title function_">expr</span>(<span class="hljs-string">"concat(name, '_', (monotonically_increasing_id() % 10))"</span>)
).<span class="hljs-title function_">groupBy</span>(<span class="hljs-string">"salted_key"</span>).<span class="hljs-title function_">count</span>().<span class="hljs-title function_">select</span>(<span class="hljs-title function_">sum</span>(<span class="hljs-string">"count"</span>)).<span class="hljs-title function_">show</span>()
</code></pre>
<pre><code class="hljs language-js"># 결과
+----------+
|<span class="hljs-title function_">sum</span>(count)|
+----------+
|         <span class="hljs-number">3</span>|
+----------+
</code></pre>
<ul>
<li>데이터 로딩의 균형을 어떻게 맞출까요?</li>
</ul>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js"><span class="hljs-keyword">from</span> pyspark.<span class="hljs-property">sql</span>.<span class="hljs-property">functions</span> <span class="hljs-keyword">import</span> monotonically_increasing_id, expr
df.<span class="hljs-title function_">withColumn</span>(<span class="hljs-string">"salted_key"</span>,
    <span class="hljs-title function_">expr</span>(<span class="hljs-string">"concat(name, '_', (monotonically_increasing_id() % 10))"</span>)
).<span class="hljs-title function_">groupBy</span>(<span class="hljs-string">"salted_key"</span>).<span class="hljs-title function_">count</span>().<span class="hljs-title function_">show</span>()
</code></pre>
<pre><code class="hljs language-js"># 결과
+----------+-----+
|salted_key|count|
+----------+-----+
|   <span class="hljs-title class_">James</span>_6|    <span class="hljs-number">1</span>|
|   <span class="hljs-title class_">James</span>_4|    <span class="hljs-number">1</span>|
|   <span class="hljs-title class_">James</span>_0|    <span class="hljs-number">1</span>|
+----------+-----+
</code></pre>
<h1>최적화 III: Shuffling을 최소화하는 전략</h1>
<pre><code class="hljs language-js">### <span class="hljs-title class_">Shuffling</span> 최소화 전략
- **<span class="hljs-title class_">Broadcast</span> 변수 사용**
  - 데이터셋이 작은 경우 <span class="hljs-title class_">Shuffling</span>을 피하기 위해 모든 노드에 브로드캐스트합니다.
- **파티션 튜닝**
  - 작업 및 데이터 규모에 맞게 파티션 수를 조정합니다.
- **변환 최적화**
  - <span class="hljs-title class_">Shuffling</span>을 필요로 하는 넓은 변환을 최소화하기 위해 작업을 계획합니다.
</code></pre>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h2>섞기</h2>
<ul>
<li>섞기는 데이터가 서로 다른 파티션에 재분배되는 과정입니다.</li>
<li>이는 데이터를 실행자 간이나 심지어 기계 간에 이동하는 것을 포함합니다.</li>
<li>네트워크 및 디스크 I/O 측면에서 가장 비용이 많이 드는 작업 중 하나입니다.</li>
</ul>
<h2>섞기의 목적</h2>
<ul>
<li>데이터 재분배: 조인, 그룹화, 집계 및 재분할과 같은 넓은 변환을 용이하게 합니다.</li>
<li>부하 분산: 클러스터 전체에 데이터와 작업 부담을 균등하게 분배합니다.</li>
<li>동시성: 병렬 처리를 강화하고 리소스 활용을 최적화합니다.</li>
<li>데이터 지역성 최적화: 데이터가 처리될 위치에 가까이 이동하도록 합니다. 네트워크 트래픽을 줄입니다.</li>
</ul>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h2>셔플링의 고민거리</h2>
<ul>
<li>자원 소모가 많음: 상당한 네트워크 대역폭과 디스크 I/O를 사용합니다.</li>
<li>지연 시간 증가: 특히 대량의 데이터셋인 경우 처리 시간이 상당히 증가합니다.</li>
<li>병목 현상 발생 가능성: 적절히 관리되지 않으면 전체 시스템 성능을 느리게 만들 수 있습니다.</li>
</ul>
<h2>1. 작은 DataFrame과 큰 DataFrame을 조인할 때 데이터 셔플링을 최소화하기 위해 브로드캐스트 조인을 사용합니다.</h2>
<pre><code class="hljs language-js"><span class="hljs-keyword">from</span> pyspark.<span class="hljs-property">sql</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">SparkSession</span>
<span class="hljs-keyword">from</span> pyspark.<span class="hljs-property">sql</span>.<span class="hljs-property">functions</span> <span class="hljs-keyword">import</span> broadcast

# 스파크 세션 초기화
spark = <span class="hljs-title class_">SparkSession</span>.<span class="hljs-property">builder</span>.<span class="hljs-title function_">appName</span>(<span class="hljs-string">"브로드캐스트 조인 예제"</span>).<span class="hljs-title function_">getOrCreate</span>()
# 직원용 큰 <span class="hljs-title class_">DataFrame</span> 생성
data_employees = [(<span class="hljs-number">1</span>, <span class="hljs-string">"John"</span>, <span class="hljs-number">101</span>),
                  (<span class="hljs-number">2</span>, <span class="hljs-string">"Jane"</span>, <span class="hljs-number">102</span>),
                  (<span class="hljs-number">3</span>, <span class="hljs-string">"Joe"</span>, <span class="hljs-number">103</span>),
                  (<span class="hljs-number">4</span>, <span class="hljs-string">"Jill"</span>, <span class="hljs-number">101</span>),
                  # 더 많은 레코드가 있다고 가정
                  ]
columns_employees = [<span class="hljs-string">"emp_id"</span>, <span class="hljs-string">"name"</span>, <span class="hljs-string">"dept_id"</span>]
df_employees = spark.<span class="hljs-title function_">createDataFrame</span>(data_employees, columns_employees)
# 부서용 작은 <span class="hljs-title class_">DataFrame</span> 생성
data_departments = [(<span class="hljs-number">101</span>, <span class="hljs-string">"인사"</span>),
                    (<span class="hljs-number">102</span>, <span class="hljs-string">"마케팅"</span>),
                    (<span class="hljs-number">103</span>, <span class="hljs-string">"금융"</span>),
                    (<span class="hljs-number">104</span>, <span class="hljs-string">"IT"</span>),
                    (<span class="hljs-number">105</span>, <span class="hljs-string">"지원"</span>)
                    ]
columns_departments = [<span class="hljs-string">"dept_id"</span>, <span class="hljs-string">"dept_name"</span>]
df_departments = spark.<span class="hljs-title function_">createDataFrame</span>(data_departments, columns_departments)
# 브로드캐스트 조인 수행
df_joined = df_employees.<span class="hljs-title function_">join</span>(<span class="hljs-title function_">broadcast</span>(df_departments), <span class="hljs-string">"dept_id"</span>)
df_joined.<span class="hljs-title function_">show</span>()
</code></pre>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js">#출력
+-------+------+----+---------+
|dept_id|emp_id|  이름|dept_name|
+-------+------+-----+--------+
|    <span class="hljs-number">101</span>|     <span class="hljs-number">1</span>| 존|       인사|
|    <span class="hljs-number">102</span>|     <span class="hljs-number">2</span>| 제인|     마케팅|
|    <span class="hljs-number">103</span>|     <span class="hljs-number">3</span>| 조|     금융|
|    <span class="hljs-number">101</span>|     <span class="hljs-number">4</span>| 질|       인사|
+-------+------+-----+--------+
</code></pre>
<ul>
<li>직원 — 직원 세부 정보를 담은 작은 데이터셋입니다.</li>
<li>부서 — 부서 세부 정보를 담은 큰 데이터셋입니다.</li>
</ul>
<p>두 데이터셋을 부서 ID를 기준으로 조인하되, 부서 데이터셋을 크게 섞지 않도록 하는 것이 목표입니다.</p>
<h2>2. 파티션 조정: 병렬성 증가를 위한 다시 분할</h2>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<ul>
<li>데이터 프레임의 파티션을 재분할하여 병렬성을 높이거나 셔플 비용을 줄일 수 있습니다.</li>
<li>그러나 여전히 전체 셔플을 유발할 수 있습니다.</li>
</ul>
<pre><code class="hljs language-js"># 병렬성을 높이기 위한 재분할 예제
df = spark.<span class="hljs-title function_">createDataFrame</span>([
  (<span class="hljs-number">1</span>, <span class="hljs-string">'foo'</span>), (<span class="hljs-number">2</span>, <span class="hljs-string">'bar'</span>), (<span class="hljs-number">3</span>, <span class="hljs-string">'baz'</span>), (<span class="hljs-number">4</span>, <span class="hljs-string">'qux'</span>)
], [<span class="hljs-string">"id"</span>, <span class="hljs-string">"value"</span>])
df_repartitioned = df.<span class="hljs-title function_">repartition</span>(<span class="hljs-number">10</span>)  # 파티션 수 증가
</code></pre>
<h2>3. 파티션 튜닝: 파티션 감소를 위한 Coalesce</h2>
<ul>
<li>전체 셔플 피하기: coalesce는 대규모 데이터 세트를 필터링한 후 파티션 수를 줄이고 싶을 때 셔플 비용을 피해야 할 때 최적입니다.</li>
<li>전형적인 사용 사례: 많은 파티션이 부분적으로 채워지거나 비어있는 상태로 남을 수 있는 대규모 DataFrame을 필터링한 후 사용됩니다. coalesce는 네트워크 오버헤드를 줄이고 비용 효율적으로 리소스를 관리하는 데 도움이 됩니다.</li>
</ul>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js"># 대규모 셔플링 없이 파티션 수를 줄이기 위한 코어스 예시
df_filtered = df.<span class="hljs-title function_">filter</span>(<span class="hljs-string">"id > 1"</span>)
df_coalesced = df_filtered.<span class="hljs-title function_">coalesce</span>(<span class="hljs-number">2</span>)  # 파티션 수 줄이기

</code></pre>
<h2>4. 변환 최적화를 통해 데이터 셔플링 최소화하기</h2>
<ul>
<li>최적화된 변환을 통해 Apache Spark에서 셔플링을 최소화하는 것은 Spark 애플리케이션의 성능을 향상시키는 중요한 측면입니다.</li>
<li>변환 최적화는 데이터 처리 작업을 구조화하여 클러스터 전체에서 불필요한 데이터 이동을 줄이는 것을 포함하며, 이는 리소스를 많이 사용하고 실행 속도를 늦출 수 있습니다.</li>
<li>이를 달성하는 방법을 보여주는 몇 가지 전략과 코드 예제는 다음과 같습니다:</li>
</ul>
<h2>4–1. 일찍 필터링하기</h2>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<ul>
<li>데이터 처리 파이프라인에서 조인 또는 집계와 같은 후속 작업에서 나중에 섞어야 하는 데이터 양을 줄이기 위해 필터를 가능한 한 빨리 적용하세요.</li>
</ul>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> pyspark.sql <span class="hljs-keyword">import</span> SparkSession

<span class="hljs-comment"># 스파크 세션 초기화</span>
spark = SparkSession.builder.appName(<span class="hljs-string">"Shuffling 최소화"</span>).getOrCreate()

<span class="hljs-comment"># DataFrame 생성</span>
data = [(<span class="hljs-string">"John"</span>, <span class="hljs-string">"금융"</span>, <span class="hljs-number">3000</span>), (<span class="hljs-string">"Jane"</span>, <span class="hljs-string">"마케팅"</span>, <span class="hljs-number">4000</span>), (<span class="hljs-string">"Joe"</span>, <span class="hljs-string">"마케팅"</span>, <span class="hljs-number">2800</span>), (<span class="hljs-string">"Jill"</span>, <span class="hljs-string">"금융"</span>, <span class="hljs-number">3900</span>)]
columns = [<span class="hljs-string">"이름"</span>, <span class="hljs-string">"부서"</span>, <span class="hljs-string">"연봉"</span>]
df = spark.createDataFrame(data, schema=columns)

<span class="hljs-comment"># 넓은 변환 전에 미리 필터링</span>
filtered_df = df.<span class="hljs-built_in">filter</span>(df[<span class="hljs-string">"연봉"</span>] > <span class="hljs-number">3000</span>)

<span class="hljs-comment"># 이제 집계 수행</span>
aggregated_df = filtered_df.groupBy(<span class="hljs-string">"부서"</span>).avg(<span class="hljs-string">"연봉"</span>)
aggregated_df.show()
</code></pre>
<pre><code class="hljs language-python"><span class="hljs-comment"># 출력</span>
+----------+-----------+
|부서      |avg(연봉)  |
+----------+-----------+
| 마케팅  |     <span class="hljs-number">4000.0</span>|
| 금융    |     <span class="hljs-number">3900.0</span>|
+----------+-----------+
</code></pre>
<h2>4-2. 가능한 경우 RDD/넓은 변환 사용하기</h2>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<ul>
<li>좁은 변환, 예를 들어 <code>map</code> 및 <code>filter</code>와 같은 작업은 개별 파티션에서 작동하며 데이터 셔플을 필요로하지 않습니다. 가능한 경우 이러한 작업을 넓은 변환 대신 사용하십시오.</li>
</ul>
<pre><code class="hljs language-js"># 셔플을 발생시키지 않고 새로운 열을 만들기 위해 map을 사용합니다
rdd = df.<span class="hljs-property">rdd</span>.<span class="hljs-title function_">map</span>(lambda <span class="hljs-attr">x</span>: (x.<span class="hljs-property">Name</span>, x.<span class="hljs-property">Salary</span> * <span class="hljs-number">1.1</span>))
updated_salaries_df = spark.<span class="hljs-title function_">createDataFrame</span>(
  rdd, schema=[<span class="hljs-string">"Name"</span>, <span class="hljs-string">"UpdatedSalary"</span>]
)
updated_salaries_df.<span class="hljs-title function_">show</span>()
</code></pre>
<pre><code class="hljs language-js"># 결과
+----+------------------+
|<span class="hljs-title class_">Name</span>|     <span class="hljs-title class_">UpdatedSalary</span>|
+----+------------------+
|<span class="hljs-title class_">John</span>|<span class="hljs-number">3300.0000000000005</span>|
|<span class="hljs-title class_">Jane</span>|            <span class="hljs-number">4400.0</span>|
| <span class="hljs-title class_">Joe</span>|<span class="hljs-number">3080.0000000000005</span>|
|<span class="hljs-title class_">Jill</span>|            <span class="hljs-number">4290.0</span>|
+----+------------------+
</code></pre>
<h2>4-3. Boardcasting join으로 불필요한 셔플을 피하세요</h2>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<ul>
<li>조인 작업시, 한 데이터셋이 다른 데이터셋보다 현저히 작을 때 브로드캐스트 조인을 사용하여 큰 데이터셋을 셔플링하지 않도록 합니다.</li>
</ul>
<pre><code class="hljs language-js"><span class="hljs-keyword">from</span> pyspark.<span class="hljs-property">sql</span>.<span class="hljs-property">functions</span> <span class="hljs-keyword">import</span> broadcast
# df_small이 df_large보다 훨씬 작다고 가정합니다
df_small = spark.<span class="hljs-title function_">createDataFrame</span>(
  [(<span class="hljs-number">1</span>, <span class="hljs-string">"HR"</span>), (<span class="hljs-number">2</span>, <span class="hljs-string">"마케팅"</span>)], [<span class="hljs-string">"id"</span>, <span class="hljs-string">"부서"</span>]
)
df_large = spark.<span class="hljs-title function_">createDataFrame</span>(
  [(<span class="hljs-number">1</span>, <span class="hljs-string">"존"</span>), (<span class="hljs-number">2</span>, <span class="hljs-string">"제인"</span>), (<span class="hljs-number">1</span>, <span class="hljs-string">"조"</span>), (<span class="hljs-number">2</span>, <span class="hljs-string">"질"</span>)],
  [<span class="hljs-string">"부서ID"</span>, <span class="hljs-string">"이름"</span>]
)
# 조인 최적화를 위해 작은 <span class="hljs-title class_">DataFrame</span>을 브로드캐스트합니다
optimized_join_df = df_large.<span class="hljs-title function_">join</span>(<span class="hljs-title function_">broadcast</span>(df_small), df_large.부서<span class="hljs-variable constant_">ID</span> == df_small.<span class="hljs-property">id</span>)
optimized_join_df.<span class="hljs-title function_">show</span>()
</code></pre>
<pre><code class="hljs language-js"># 결과

+------+----+---+------+
|부서<span class="hljs-variable constant_">ID</span>|이름| id|  부서|
+------+----+---+------+
|     <span class="hljs-number">1</span>| 존|  <span class="hljs-number">1</span>|   <span class="hljs-variable constant_">HR</span>|
|     <span class="hljs-number">2</span>|제인|  <span class="hljs-number">2</span>|마케팅|
|     <span class="hljs-number">1</span>| 조|  <span class="hljs-number">1</span>|   <span class="hljs-variable constant_">HR</span>|
|     <span class="hljs-number">2</span>| 질|  <span class="hljs-number">2</span>|마케팅|
+------+----+---+------+
</code></pre>
<h2>4-4. 전략적으로 파티션 나누기</h2>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<ul>
<li>만약 넓은 변환을 사용해야 한다면, 나중에 조인 또는 집계할 키를 기반으로 데이터를 파티션으로 나누세요. 이 전략을 사용하면 동일한 키를 가진 행을 동일한 파티션에 함께 두어 셔플링을 줄일 수 있습니다.</li>
</ul>
<pre><code class="hljs language-js"># 셔플링 최소화를 위해 집계 전에 파티션 재분배
repartitioned_df = df.<span class="hljs-title function_">repartition</span>(<span class="hljs-string">"Department"</span>)
aggregated_df = repartitioned_df.<span class="hljs-title function_">groupBy</span>(<span class="hljs-string">"Department"</span>).<span class="hljs-title function_">avg</span>(<span class="hljs-string">"Salary"</span>)
aggregated_df.<span class="hljs-title function_">show</span>()
</code></pre>
<pre><code class="hljs language-js"># 결과
+----------+-----------+
|<span class="hljs-title class_">Department</span>|<span class="hljs-title function_">avg</span>(<span class="hljs-title class_">Salary</span>)|
+----------+-----------+
|   <span class="hljs-title class_">Finance</span>|     <span class="hljs-number">3450.0</span>|
| <span class="hljs-title class_">Marketing</span>|     <span class="hljs-number">3400.0</span>|
+----------+-----------+
</code></pre>
<h1>성능 모니터링 및 세부 조정</h1>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h2>1. 메모리 관리</h2>
<pre><code class="hljs language-js">spark.<span class="hljs-property">conf</span>.<span class="hljs-title function_">set</span>(“spark.<span class="hljs-property">executor</span>.<span class="hljs-property">memory</span>”, “4g”)
spark.<span class="hljs-property">conf</span>.<span class="hljs-title function_">set</span>(“spark.<span class="hljs-property">driver</span>.<span class="hljs-property">memory</span>”, “2g”)
</code></pre>
<h2>2. 작업 및 스테이지 모니터링</h2>
<ul>
<li>Spark UI를 사용하여 응용 프로그램 내의 작업 및 스테이지의 성능을 모니터링합니다.</li>
<li>Spark UI에 액세스하려면 다음으로 이동하십시오: http://[your-spark-driver-host]:4040</li>
<li>Executor 메트릭 분석: 각 executor의 메트릭을 모니터링하여 메모리 사용, 디스크 스피릴 및 가비지 수집에 대한 통찰을 얻을 수 있습니다.</li>
</ul>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js"># 자세한 실행자 지표를 수집하도록 <span class="hljs-title class_">Spark</span>를 구성합니다
spark.<span class="hljs-property">conf</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">"spark.executor.metrics.pollingInterval"</span>, <span class="hljs-string">"5000"</span>)
</code></pre>
<h2>3. SQL 성능 튜닝</h2>
<ul>
<li>SQL 실행 계획을 이해하고 최적화하기 위해 <code>EXPLAIN</code> 계획을 활용하세요.</li>
</ul>
<pre><code class="hljs language-js">df.<span class="hljs-title function_">explain</span>(“formatted”)
</code></pre>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js">== 물리적인 계획 ==
* 기존 <span class="hljs-variable constant_">RDD</span> 스캔 (<span class="hljs-number">1</span>)


(<span class="hljs-number">1</span>) 기존 <span class="hljs-variable constant_">RDD</span> 스캔 [코드 생성 <span class="hljs-variable constant_">ID</span> : <span class="hljs-number">1</span>]
출력 [<span class="hljs-number">3</span>]: [이름 #<span class="hljs-number">4628</span>, 부서 #<span class="hljs-number">4629</span>, 급여 #4630L]
인수: [이름 #<span class="hljs-number">4628</span>, 부서 #<span class="hljs-number">4629</span>, 급여 #4630L],
 applySchemaToPythonRDD에 있는 <span class="hljs-title class_">MapPartitionsRDD</span>[<span class="hljs-number">693</span>]에서
                       at &#x3C;알 수 없음>:<span class="hljs-number">0</span>, <span class="hljs-title class_">ExistingRDD</span>, <span class="hljs-title class_">UnknownPartitioning</span>(<span class="hljs-number">0</span>)
</code></pre>
<h2>4. 동적 할당</h2>
<ul>
<li>워크로드에 따라 스파크가 실행자 수를 동적으로 조정할 수 있도록 동적 할당을 활성화합니다.</li>
</ul>
<pre><code class="hljs language-js">spark.<span class="hljs-property">conf</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">"spark.dynamicAllocation.enabled"</span>, <span class="hljs-string">"true"</span>);
spark.<span class="hljs-property">conf</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">"spark.dynamicAllocation.minExecutors"</span>, <span class="hljs-string">"1"</span>);
spark.<span class="hljs-property">conf</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">"spark.dynamicAllocation.maxExecutors"</span>, <span class="hljs-string">"20"</span>);
spark.<span class="hljs-property">conf</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">"spark.dynamicAllocation.executorIdleTimeout"</span>, <span class="hljs-string">"60s"</span>);
spark.<span class="hljs-property">conf</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">"spark.shuffle.service.enabled"</span>, <span class="hljs-string">"true"</span>);
</code></pre>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h2>5. 데이터 지역성</h2>
<ul>
<li>저장 및 처리 장치 간에 데이터가 이동해야 하는 거리를 최소화하여 데이터 지역성을 최적화합니다.</li>
</ul>
<pre><code class="hljs language-js">spark.<span class="hljs-property">conf</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">"spark.locality.wait"</span>, <span class="hljs-string">"300ms"</span>);
</code></pre>
<h2>6. Garbage Collection Tuning</h2>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js">- 가비지 컬렉터 설정을 조정하여 메모리 관리를 최적화하고 일시 중지 시간을 줄일 수 있습니다.

# 더 나은 지연 시간을 위해 <span class="hljs-variable constant_">G1GC</span> 사용
spark.<span class="hljs-property">conf</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">"spark.executor.extraJavaOptions"</span>, <span class="hljs-string">"-XX:+UseG1GC"</span>)
# 짧은 일시 중지를 위해 명시적인 <span class="hljs-variable constant_">GC</span> 설정 구성
spark.<span class="hljs-property">conf</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">"spark.executor.extraJavaOptions"</span>, <span class="hljs-string">"-XX:MaxGCPauseMillis=100"</span>)

## <span class="hljs-number">7.</span> 데이터 직렬화 세부 조정

- 데이터 직렬화는 분산 애플리케이션의 성능에 중요한 역할을 합니다. <span class="hljs-title class_">Spark</span>는 두 가지 직렬화 도구를 지원합니다:
</code></pre>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js"># 더 나은 성능과 효율성을 위해 <span class="hljs-title class_">Kryo</span> 직렬화 프로그램 사용
spark.<span class="hljs-property">conf</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">"spark.serializer"</span>, <span class="hljs-string">"org.apache.spark.serializer.KryoSerializer"</span>)
spark.<span class="hljs-property">conf</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">"spark.kryo.registrationRequired"</span>, <span class="hljs-string">"true"</span>)

# <span class="hljs-title class_">Kryo</span>와 사용자 정의 클래스 등록
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span>:
    def <span class="hljs-title function_">__init__</span>(self, name, id):
        self.<span class="hljs-property">name</span> = name
        self.<span class="hljs-property">id</span> = id
spark.<span class="hljs-property">sparkContext</span>.<span class="hljs-title function_">getConf</span>().<span class="hljs-title function_">registerKryoClasses</span>([<span class="hljs-title class_">MyClass</span>])
</code></pre>
<h2>8. 네트워크 구성 최적화</h2>
<ul>
<li>네트워크 설정은 특히 대규모 배포에서 성능에 중대한 영향을 미칠 수 있습니다:</li>
</ul>
<pre><code class="hljs language-js"># 네트워크 타임아웃 설정을 조정하여 대규모 클러스터에서 불필요한 작업 실패를 피하십시오
spark.<span class="hljs-property">conf</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">"spark.network.timeout"</span>, <span class="hljs-string">"800s"</span>)
spark.<span class="hljs-property">conf</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">"spark.core.connection.ack.wait.timeout"</span>, <span class="hljs-string">"600s"</span>)
</code></pre>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h2>9. 고급 Spark SQL 튜닝</h2>
<ul>
<li>Catalyst 옵티마이저 및 Tungsten 실행 엔진을 활용하면 Spark SQL의 성능을 향상시킬 수 있습니다:</li>
</ul>
<pre><code class="hljs language-js"># 직렬 처리를 위한 전체 단계 코드 생성 활성화
spark.<span class="hljs-property">conf</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">"spark.sql.codegen.wholeStage"</span>, <span class="hljs-string">"true"</span>)

# 조인 최적화에 유용한 테이블 브로드캐스트를 위한 최대 바이트 수 증가
spark.<span class="hljs-property">conf</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">"spark.sql.autoBroadcastJoinThreshold"</span>, <span class="hljs-string">"10485760"</span>)  # <span class="hljs-number">10</span> <span class="hljs-variable constant_">MB</span>
</code></pre>
<h2>10. 데이터 파티셔닝 최적화</h2>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>데이터 분배를 세밀하게 조정하여 쿼리 성능을 향상시키고 셔플 오버헤드를 줄일 수 있어요:</p>
<pre><code class="hljs language-js"># 데이터 크기 및 작업을 기준으로 수동으로 셔플 파티션 수 설정

spark.<span class="hljs-property">conf</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">"spark.sql.shuffle.partitions"</span>, <span class="hljs-string">"200"</span>)
# 클러스터 크기 및 데이터에 맞게 조정하세요
</code></pre>
<h2>11. 적응형 쿼리 실행 활성화</h2>
<ul>
<li>적응형 쿼리 실행 (AQE)는 실행 중에 쿼리 계획을 조정함으로써 Spark SQL 쿼리를 더 빠르고 데이터 스쿠 및 기타 이슈에 더 강건하게 만드는 기능이에요.</li>
</ul>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js"># 쿼리 실행을 적응적으로 조정하는 <span class="hljs-variable constant_">AQE</span>를 활성화합니다. 이는 구성을 간소화하고 성능을 향상시킬 수 있습니다.
spark.<span class="hljs-property">conf</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">"spark.sql.adaptive.enabled"</span>, <span class="hljs-string">"true"</span>)
</code></pre>
<ul>
<li>AQE는 실제 데이터에 적응해 셔플 파티셔닝을 조정하고, 불균형 조인을 처리하며, 정렬을 최적화할 수 있습니다.</li>
</ul>
<h2>12. 메모리 관리 지정</h2>
<ul>
<li>적절한 메모리 관리는 메모리 집약적인 작업에서 특히 효과적인 성능 개선을 위해 스파이지를 방지할 수 있습니다.</li>
</ul>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h1>RDD 저장소에 예약된 메모리 분수를 구성합니다.</h1>
<p>spark.conf.set(“spark.memory.fraction”, “0.6”)
spark.conf.set(“spark.memory.storageFraction”, “0.5”)</p>
<p>이러한 설정은 실행 메모리와 저장소 메모리 사이의 균형을 맞추어 셔플 및 캐싱 중 디스크 스파일을 줄이는 데 도움이 됩니다.</p>
<h1>읽어 주셔서 감사합니다</h1>
<p>이 글이 마음에 드시면:</p>
<!-- TIL 수평 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="1549334788" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<ul>
<li>👏 여러 번 박수로 지지를 보여주세요!</li>
<li>이 안내서를 친구들과 공유해도 좋아요.</li>
<li>여러분의 피드백은 소중합니다. 앞으로의 글에 영감을 주고 안내해 줍니다.</li>
<li>또는 메시지를 남겨주세요: <a href="https://www.linkedin.com/in/kevinchwong" rel="nofollow" target="_blank">https://www.linkedin.com/in/kevinchwong</a></li>
</ul>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"스파크 최적화 집중 강좌 최고의 성능을 위한 단계별 가이드","description":"","date":"2024-07-09 20:14","slug":"2024-07-09-IntensiveSparkOptimizationCourse","content":"\n![Intensive Spark Optimization Course](/TIL/assets/img/2024-07-09-IntensiveSparkOptimizationCourse_0.png)\n\n# 로컬에서 플레이그라운드 설정하기\n\n- Docker Desktop을 설치합니다.\n- `docker run -p 8888:8888 jupyter/pyspark-notebook`을 실행합니다.\n- 다음 메시지가 표시되면 브라우저에서 주피터 랩을 열기 위해 URL 중 하나를 붙여넣습니다.\n\n```js\n서버에 액세스하려면 브라우저에서 이 파일을 엽니다:\n    file:///home/jovyan/.local/share/jupyter/runtime/jpserver-7-open.html\n또는 다음 URL 중 하나를 복사하여 붙여넣습니다:\n    http://3c331b638888:8888/lab?token=a88888b6aa6620fc976588ba58817f3b14ea0674bdc77f72\n    http://127.0.0.1:8888/lab?token=a88888b6aa6620fc976588ba58817f3b14ea0674bdc77f72\n```\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n# SparkSession 초기화하기\n\n```js\nfrom pyspark.sql import SparkSession\nspark = SparkSession.builder.appName(\"Spark Test\").getOrCreate()\n```\n\n# 데이터프레임\n\n## 1. 데이터프레임 생성하기\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n- 컬럼 사용\n\n```js\nfrom pyspark.sql.types import StructType, IntegerType, StringType\n\n# 데이터를 튜플의 리스트로 정의\ndata = [(\"James\", 34), (\"Anna\", 20), (\"Lee\", 30)]\n\n# 컬럼 사용\ncolumns = [\"Name\", \"Age\"]\ndf = spark.createDataFrame(data, schema=columns)\n```\n\n- 스키마 사용\n\n```js\nfrom pyspark.sql.types import StructType, IntegerType, StringType\n\n# 데이터를 튜플의 리스트로 정의\ndata = [(\"James\", 34), (\"Anna\", 20), (\"Lee\", 30)]\n\n# 스키마 사용\nschema = StructType([\n    StructField(\"Name\", StringType(), True),\n    StructField(\"Age\", IntegerType(), True)\n])\ndf = spark.createDataFrame(data, schema=schema)\n```\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n- RDD 사용\n\n```js\nfrom pyspark.sql.types import StructType, IntegerType, StringType\n\n# 데이터를 튜플의 리스트로 준비\ndata = [(\"James\", 34), (\"Anna\", 20), (\"Lee\", 30)]\n\n# RDD 사용\nrdd = spark.sparkContext.parallelize(data)\nschema = StructType([\n    StructField(\"이름\", StringType(), True),\n    StructField(\"나이\", IntegerType(), True)\n])\ndf = spark.createDataFrame(rdd, schema=schema)\n```\n\n```js\ndf.show()\n\n# 출력\n+-----+---+\n| 이름|나이|\n+-----+---+\n|James| 34|\n| Anna| 20|\n|  Lee| 30|\n+-----+---+\n```\n\n## 2. 데이터프레임 표시\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\ndf.printSchema();\nprint(df.schema);\nprint(df.columns);\ndf.describe().show();\n```\n\n```js\n#결과\n\n## df.printSchema()\nroot\n |-- Name: string (nullable = true)\n |-- Age: long (nullable = true)\n\n## print(df.schema)\nStructType([\n  StructField(‘Name’, StringType(), True),\n  StructField(‘Age’, LongType(), True)\n])\n\n## print(df.columns)\n[‘Name’, ‘Age’]\n\n## df.describe().show()\n+-------+----+-----------------+\n|summary|Name|              Age|\n+-------+----+-----------------+\n|  count|   3|                3|\n|   mean|NULL|             28.0|\n| stddev|NULL|7.211102550927978|\n|    min|Anna|               20|\n|    max| Lee|               34|\n+-------+----+-----------------+\n```\n\n## 3. 컬럼 선택\n\n```js\ndf.select(df[0]).show();\ndf.select(df.Name).show();\ndf.select(df[\"Name\"]).show();\ndf.select(\"Name\").show();\n```\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\n#Output\n+-----+\n| Name|\n+-----+\n|James|\n| Anna|\n|  Lee|\n+-----+\n```\n\n## 4. 데이터 필터링\n\n```js\n# 데이터 필터링\ndf.filter(df[1] \u003e 25).show()\ndf.filter(df.Age \u003e 25).show()\ndf.filter(df[\"Age\"] \u003e 25).show()\n```\n\n```js\n#Output\n+-----+---+\n| Name|Age|\n+-----+---+\n|James| 34|\n|  Lee| 30|\n+-----+---+\n```\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n## 5. 파일에 DataFrame 작성하기\n\n```js\n# JSON 파일 작성\ndf.write.json(\"test123.json\")\n\n# Parquet 파일 작성\ndf.write.parquet(\"test123.parquet\")\n```\n\n## 6. 파일을 DataFrame으로 읽기\n\n```js\n# JSON 파일 읽기\ndf_json = spark.read.json(\"test123.json\")\n# Parquet 파일 읽기\ndf_parquet = spark.read.parquet(\"test123.parquet\")\n```\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n## 7. 새로운 복합 데이터 유형을 포함한 새로운 열 추가\n\n```js\nfrom pyspark.sql.functions import struct\ndf2 = df.withColumn(\"NameAndAge\", struct(df.Name, df.Age))\ndf2.show()\ndf2.printSchema()\n```\n\n```js\n# 출력\n+-----+---+-----------+\n| Name|Age| NameAndAge|\n+-----+---+-----------+\n|James| 34|{James, 34}|\n| Anna| 20| {Anna, 20}|\n|  Lee| 30|  {Lee, 30}|\n+-----+---+-----------+\n\n# 스키마 출력\nroot\n |-- Name: string (nullable = true)\n |-- Age: long (nullable = true)\n |-- NameAndAge: struct (nullable = false)\n |    |-- Name: string (nullable = true)\n |    |-- Age: long (nullable = true)\n```\n\n# 쿼리: 그룹화 및 집계\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n## 1. count()\n\n```python\nfrom pyspark.sql import SparkSession\nfrom pyspark.sql.functions import count\n\n# 스파크 세션 초기화\nspark = SparkSession.builder.appName(\"그루핑 및 집계\").getOrCreate()\n\n# 데이터프레임 생성\ndata = [(\"James\", \"Sales\", 3000),\n        (\"Michael\", \"Sales\", 4600),\n        (\"Robert\", \"Sales\", 4100),\n        (\"Maria\", \"Finance\", 3000),\n        (\"James\", \"Sales\", 3000),\n        (\"Scott\", \"Finance\", 3300),\n        (\"Jen\", \"Finance\", 3900),\n        (\"Jeff\", \"Marketing\", 3000),\n        (\"Kumar\", \"Marketing\", 2000),\n        (\"Saif\", \"Sales\", 4100)]\ncolumns = [\"employee_name\", \"department\", \"salary\"]\ndf = spark.createDataFrame(data, schema=columns)\n\n# 그룹화 및 count 수행\ngrouped_df = df.groupBy(\"department\").count()\ngrouped_df.show()\n```\n\n```python\n# 결과\n\n+----------+-----+\n|department|count|\n+----------+-----+\n|     Sales|    5|\n|   Finance|    3|\n| Marketing|    2|\n+----------+-----+\n```\n\n## 2. max(), min(), avg(), sum()\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\n# 그룹별로 그룹화 및 최댓값 찾기\nmax_df = df.groupBy(\"department\").max(\"salary\").alias(\"max_salary\")\nmax_df.show()\n```\n\n```js\n# 결과\n\n+----------+-----------+\n|department|max(salary)|\n+----------+-----------+\n|     Sales|       4600|\n|   Finance|       3900|\n| Marketing|       3000|\n+----------+-----------+\n```\n\n## 3. agg() + F.max(), F.count() 등…\n\n```js\nfrom pyspark.sql import functions as F\n\n# 여러 가지 집계 동작 수행\nagg_df = df.groupBy(\"department\").agg(\n    F.count(\"salary\").alias(\"count\"),\n    F.max(\"salary\").alias(\"max_salary\"),\n    F.min(\"salary\").alias(\"min_salary\"),\n    F.sum(\"salary\").alias(\"total_salary\"),\n    F.avg(\"salary\").alias(\"average_salary\")\n)\nagg_df.show()\n```\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\n# 결과\n+----------+-----+----------+----------+------------+--------------+\n|department|count|max_salary|min_salary|total_salary|average_salary|\n+----------+-----+----------+----------+------------+--------------+\n|     Sales|    5|      4600|      3000|       18800|        3760.0|\n|   Finance|    3|      3900|      3000|       10200|        3400.0|\n| Marketing|    2|      3000|      2000|        5000|        2500.0|\n+----------+-----+----------+----------+------------+--------------+\n```\n\n## 4. agg() + collect_list() 및 collect_set()\n\n```js\nfrom pyspark.sql.functions import collect_list\n\n# GroupBy 및 리스트 수집 수행\ncollected_list_df = df.groupBy(\"department\").agg(\n  collect_list(\"salary\"),\n  collect_set(\"salary\")\n)\ncollected_list_df.show(truncate=False)\n```\n\n```js\n# 결과\n+----------+------------------------------+-------------------+\n|department|collect_list(salary)          |collect_set(salary)|\n+----------+------------------------------+-------------------+\n|Sales     |[3000, 4600, 4100, 3000, 4100]|[4600, 3000, 4100] |\n|Finance   |[3000, 3300, 3900]            |[3900, 3000, 3300] |\n|Marketing |[3000, 2000]                  |[3000, 2000]       |\n+----------+------------------------------+-------------------+\n```\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n## 5. agg() + 사용자 정의 집계 함수 (UDAF)\n\n- 때로는 내장 함수만으로 복잡한 집계를 수행하기에 충분하지 않을 수 있습니다. Spark를 사용하면 사용자 정의 집계 함수를 만들 수 있습니다.\n\n```js\n# 초기 데이터\n|부서     |직원 이름        |급여    |\n|----------|-------------|------|\n|Sales    |James        |3000  |\n|Sales    |Michael      |4600  |\n|Sales    |Robert       |4100  |\n|Finance  |Maria        |3000  |\n|Sales    |James        |3000  |\n|Finance  |Scott        |3300  |\n|Finance  |Jen          |3900  |\n|Marketing|Jeff         |3000  |\n|Marketing|Kumar        |2000  |\n|Sales    |Saif         |4100  |\n```\n\n```js\nfrom pyspark.sql.functions import pandas_udf, PandasUDFType\nfrom pandas import DataFrame\n\n@pandas_udf(\"double\")\ndef mean_salary(s: pd.Series) -\u003e float:\n return s.mean()\nudaf_df = df.groupBy(\"department\").agg(\n  mean_salary(df[\"salary\"]).alias(\"average_salary\")\n)\nudaf_df.show()\n```\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\n# 결과\n+----------+--------------+\n|department|average_salary|\n+----------+--------------+\n|   Finance|        3400.0|\n| Marketing|        2500.0|\n|     Sales|        3760.0|\n+----------+--------------+\n\n## 6. agg() + 복잡한 조건: when()\n\n- 때로는 조건에 따른 합계나 평균과 같은 복잡한 조건이 집계 중에 필요할 수 있습니다.\n\n# 초기 데이터\n+----------+-------------+------+\n|department|employee_name|salary|\n+----------+-------------+------+\n|     Sales|        James|  3000|\n|     Sales|      Michael|  4600|\n|     Sales|       Robert|  4100|\n|   Finance|        Maria|  3000|\n|     Sales|        James|  3000|\n|   Finance|        Scott|  3300|\n|   Finance|          Jen|  3900|\n| Marketing|         Jeff|  3000|\n| Marketing|        Kumar|  2000|\n|     Sales|         Saif|  4100|\n+----------+-------------+------+\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\nfrom pyspark.sql.functions import when\n\n# 조건부 집계\nconditional_agg_df = df.groupBy(\"department\").agg(\n    sum(when(df[\"salary\"] \u003e 3000, df[\"salary\"])).alias(\"sum_high_salaries\")\n)\nconditional_agg_df.show()\n\n# 결과\n\n+----------+-----------------+\n|department|sum_high_salaries|\n+----------+-----------------+\n|     Sales|            12800|\n|   Finance|             7200|\n| Marketing|             NULL|\n+----------+-----------------+\n\n## 6. agg() 이후 GroupBy에서 RDD Map 함수 사용하기\n\n- 경우에 따라 매핑 함수를 GroupBy와 결합하여 집단화된 데이터에 대한 직접적인 집계가 아닌 작업을 수행할 수 있습니다.\n\n\u003c!-- TIL 수평 --\u003e\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```\n\n# 데이터\n\n| department | employee_name | salary |\n| ---------- | ------------- | ------ |\n| Sales      | James         | 3000   |\n| Sales      | Michael       | 4600   |\n| Sales      | Robert        | 4100   |\n| Finance    | Maria         | 3000   |\n| Sales      | James         | 3000   |\n| Finance    | Scott         | 3300   |\n| Finance    | Jen           | 3900   |\n| Marketing  | Jeff          | 3000   |\n| Marketing  | Kumar         | 2000   |\n| Sales      | Saif          | 4100   |\n\n# GroupBy 후 map 작업 적용\n\n```python\nresult_rdd = df.groupBy(\"department\").agg(\n  collect_list(\"salary\")\n).rdd.map(\n  lambda x: (x[0], max(x[1]))\n)\n\nresult_df = spark.createDataFrame(result_rdd, [\"department\", \"max_salary\"])\nresult_df.show()\n```\n\n# 결과\n\n| department | max_salary |\n| ---------- | ---------- |\n| Sales      | 4600       |\n| Finance    | 3900       |\n| Marketing  | 3000       |\n\n# 조회: 다른 것\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n## 1. rollup()과 cube()\n\n- Rollup()은 다차원 집계를 생성하고 Excel의 소계와 유사한 계층적 요약을 제공합니다.\n\n```js\n# 초기 데이터\n|department|employee_name|salary|\n|----------|-------------|------|\n| Sales    | James       | 3000 |\n| Sales    | Michael     | 4600 |\n| Sales    | Robert      | 4100 |\n| Finance  | Maria       | 3000 |\n| Sales    | James       | 3000 |\n| Finance  | Scott       | 3300 |\n| Finance  | Jen         | 3900 |\n| Marketing| Jeff        | 3000 |\n| Marketing| Kumar       | 2000 |\n| Sales    | Saif        | 4100 |\n```\n\n```js\nfrom pyspark.sql.functions import sum\n\n# Rollup 예제\nrollup_df = df.rollup(\"department\", \"employee_name\").sum(\"salary\")\nrollup_df.show()\n```\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\n# 결과\n+----------+-------------+-----------+\n|department|employee_name|sum(salary)|\n+----------+-------------+-----------+\n|     Sales|        James|       6000|\n|      NULL|         NULL|      34000|\n|     Sales|         NULL|      18800|\n|     Sales|      Michael|       4600|\n|     Sales|       Robert|       4100|\n|   Finance|         NULL|      10200|\n|   Finance|        Maria|       3000|\n|   Finance|        Scott|       3300|\n|   Finance|          Jen|       3900|\n| Marketing|         NULL|       5000|\n| Marketing|         Jeff|       3000|\n| Marketing|        Kumar|       2000|\n|     Sales|         Saif|       4100|\n+----------+-------------+-----------+\n```\n\n- Cube(): Cube는 다차원 집계를 생성하고 지정된 그룹화 열의 다중 조합을 통해 통찰을 제공합니다.\n\n```js\n# 초기 데이터\n+----------+-------------+------+\n|department|employee_name|salary|\n+----------+-------------+------+\n|     Sales|        James|  3000|\n|     Sales|      Michael|  4600|\n|     Sales|       Robert|  4100|\n|   Finance|        Maria|  3000|\n|     Sales|        James|  3000|\n|   Finance|        Scott|  3300|\n|   Finance|          Jen|  3900|\n| Marketing|         Jeff|  3000|\n| Marketing|        Kumar|  2000|\n|     Sales|         Saif|  4100|\n+----------+-------------+------+\n```\n\n```js\nfrom pyspark.sql.functions import sum\n\n# Cube 예시\ncube_df = df.cube(\"department\", \"employee_name\").sum(\"salary\")\ncube_df.show()\n```\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\n# 결과\n\n+----------+-------------+-----------+\n|부서      |직원명         |급여합계   |\n+----------+-------------+-----------+\n|      NULL|        James|       6000|\n|     판매 |        James|       6000|\n|      NULL|         NULL|      34000|\n|     판매 |         NULL|      18800|\n|      NULL|      Michael|       4600|\n|     판매 |      Michael|       4600|\n|     판매 |       Robert|       4100|\n|      NULL|       Robert|       4100|\n|   재무   |         NULL|      10200|\n|   재무   |        Maria|       3000|\n|      NULL|        Maria|       3000|\n|      NULL|        Scott|       3300|\n|   재무   |        Scott|       3300|\n|      NULL|          Jen|       3900|\n|   재무   |          Jen|       3900|\n| 마케팅  |         NULL|       5000|\n| 마케팅  |         Jeff|       3000|\n|      NULL|         Jeff|       3000|\n| 마케팅  |        Kumar|       2000|\n|      NULL|        Kumar|       2000|\n+----------+-------------+-----------+\n상위 20개 행만 표시\n```\n\n## 2. groupBy() + pivot()\n\n- Pivoting을 사용하면 행을 열로 변환하여 피벗 테이블과 유사한 방식으로 데이터를 요약할 수 있습니다. 종종 두 열 간의 관계를 이해하는 데 사용됩니다.\n\n```js\n# 초기 데이터\n+----------+-------------+------+\n|부서     |직원명        |급여   |\n+----------+-------------+------+\n|     판매 |        James|  3000|\n|     판매 |      Michael|  4600|\n|     판매 |       Robert|  4100|\n|   재무  |        Maria|  3000|\n|     판매 |        James|  3000|\n|   재무  |        Scott|  3300|\n|   재무  |          Jen|  3900|\n| 마케팅  |         Jeff|  3000|\n| 마케팅  |        Kumar|  2000|\n|     판매 |         Saif|  4100|\n+----------+-------------+------+\n```\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\n# Pivot 예시\npivot_df = df.groupBy(\"department\").pivot(\"employee_name\").sum(\"salary\")\npivot_df.show()\n```\n\n```js\n# 결과\n+----------+-----+----+----+-----+-----+-------+------+----+-----+\n|department|James|Jeff| Jen|Kumar|Maria|Michael|Robert|Saif|Scott|\n+----------+-----+----+----+-----+-----+-------+------+----+-----+\n|     Sales| 6000|NULL|NULL| NULL| NULL|   4600|  4100|4100| NULL|\n|   Finance| NULL|NULL|3900| NULL| 3000|   NULL|  NULL|NULL| 3300|\n| Marketing| NULL|3000|NULL| 2000| NULL|   NULL|  NULL|NULL| NULL|\n+----------+-----+----+----+-----+-----+-------+------+----+-----+\n```\n\n## 3. 윈도우 함수: partitionBy() + row_number()/rank().over(w)\n\n- 윈도우 함수는 현재 행과 관련된 \"윈도우\"에 대해 계산을 수행할 수 있어 전통적인 group-by 작업보다 더 유연성을 제공합니다. 이는 러닝 토탈, 이동 평균 또는 이전 및 다음 행에 액세스하는 데 특히 유용합니다.\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\n# 초기 데이터\n| 부서      | 직원 이름       | 급여  |\n|----------|---------------|------|\n| Sales    | James         | 3000 |\n| Sales    | Michael       | 4600 |\n| Sales    | Robert        | 4100 |\n| Finance  | Maria         | 3000 |\n| Sales    | James         | 3000 |\n| Finance  | Scott         | 3300 |\n| Finance  | Jen           | 3900 |\n| Marketing| Jeff          | 3000 |\n| Marketing| Kumar         | 2000 |\n| Sales    | Saif          | 4100 |\n\n```\n\n```js\nfrom pyspark.sql.window import Window\nfrom pyspark.sql.functions import col, row_number\n\nwindowSpec = Window.partitionBy(\"department\").orderBy(col(\"salary\").asc())\ndf_with_row_number = df.withColumn(\"row_number\", row_number().over(windowSpec))\ndf_with_row_number.show()\n```\n\n```js\n# 결과\n| 직원 이름      | 부서        | 급여  | row_number |\n|---------------|------------|------|------------|\n| Maria         | Finance    | 3000 |      1     |\n| Scott         | Finance    | 3300 |      2     |\n| Jen           | Finance    | 3900 |      3     |\n| Kumar         | Marketing  | 2000 |      1     |\n| Jeff          | Marketing  | 3000 |      2     |\n| James         | Sales      | 3000 |      1     |\n| James         | Sales      | 3000 |      2     |\n| Robert        | Sales      | 4100 |      3     |\n| Saif          | Sales      | 4100 |      4     |\n| Michael       | Sales      | 4600 |      5     |\n\n```\n\n- Rank() 함수를 위해\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\nfrom pyspark.sql.window import Window\nfrom pyspark.sql.functions import rank, col\n\nwindowSpec = Window.partitionBy(\"department\").orderBy(col(\"salary\").desc())\ndf_with_rank = df.withColumn(\"rank\", rank().over(windowSpec))\ndf_with_rank.show()\n```\n\n```js\n# 출력\n+-------------+----------+------+----------+\n|employee_name|department|salary|      rank|\n+-------------+----------+------+----------+\n|          Jen|   Finance|  3900|         1|\n|        Scott|   Finance|  3300|         2|\n|        Maria|   Finance|  3000|         3|\n|         Jeff| Marketing|  3000|         1|\n|        Kumar| Marketing|  2000|         2|\n|      Michael|     Sales|  4600|         1|\n|       Robert|     Sales|  4100|         2|\n|         Saif|     Sales|  4100|         2|\n|        James|     Sales|  3000|         3|\n|        James|     Sales|  3000|         3|\n+-------------+----------+------+----------+\n```\n\n# 최적화 I: 무게 감소\n\n## 0. 불필요한 원시 데이터 제거\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n## 1. DataFrame이 여러 번 액세스 될 때 캐시합니다.\n\n```js\ndf.cache();\ndf.count();\n```\n\n```js\n#출력\n3\n```\n\n## 2. 적절한 파일 형식 사용하기\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n- 압축 파일은 파일의 입출력 및 메모리를 절약할 수 있어요.\n- 압축 해제된 파일은 CPU를 절약할 수 있어요.\n\n```js\ndf.write.parquet(\"output.parquet\");\n```\n\n## 3. 스키마 수동 지정하기\n\n```js\nfrom pyspark.sql.types import StructType, StructField, IntegerType, StringType\nschema = StructType([\n    StructField(\"id\", IntegerType(), True),\n    StructField(\"name\", StringType(), True),\n    StructField(\"age\", IntegerType(), True)\n])\ndf = spark.read.schema(schema).csv(\"path/to/file.csv\")\n```\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n## 4. 조기에 필요한 열 선택하기\n\n데이터 처리 파이프라인에서 메모리 사용량을 줄이기 위해 필요한 열만 미리 선택하세요.\n\n```js\ndf.select(\"dept_name\", \"name\").filter(\"dept_id \u003e= 102\").show();\ndf.select(\"dept_name\", \"name\")\n  .filter(df.dept_id \u003e= 102)\n  .show();\n```\n\n```js\n#출력\n+---------+----+\n|dept_name|name|\n+---------+----+\n|Marketing|Jane|\n|  Finance| Joe|\n+---------+----+\n```\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n## 5. 필터를 조인이나 집계 전에 빠르게 적용하세요.\n\n```js\ndf.filter(\"age \u003e 25\").join(df_other, \"id\").show();\n```\n\n## 6. 큰 데이터셋 수집 방지를 위해 limit() 사용하기\n\n- 큰 데이터셋에 collect()를 사용하지 않도록 주의하여 메모리 부족 오류를 방지하세요.\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\ndf.filter(\"age \u003e 30\").limit(100).collect();\n```\n\n## 7. Using spark.sql(): Catalyst optimizer for Complex Queries\n\n- Leverage Spark SQL for complex queries, which might be more readable and can benefit from the Catalyst optimizer.\n\n```js\ndf.createOrReplaceTempView(\"table\");\nspark.sql(\"SELECT id, sum(value) FROM table GROUP BY id\").show();\n```\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n## 8. RDD 사용: reduceByKey를 사용한 집계\n\n- 집계 작업을 수행할 때 reduceByKey를 사용하는 것이 groupBy보다 더 효율적일 수 있습니다.\n\n```python\nrdd = df.rdd.map(lambda x: (x[0], x[1]))\nreduced = rdd.reduceByKey(lambda a, b: a + b)\nreduced.toDF([\"key\", \"value\"]).show()\n```\n\n# 최적화 II: 파티션 없이 병렬화 없음\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n## 1. 테이블 분할: partitionBy()\n\n- 데이터프레임을 디스크에 저장할 때 빠른 후속 읽기를 위해 분할을 사용하세요.\n\n```js\ndf.write.partitionBy(\"year\", \"month\").parquet(\"path/to/output\");\n```\n\n## 2. 스튜 관리를 위한 Salting 키\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n- 조인 연산 중 데이터 스큐가 발생하는 경우, 하나 이상의 키 값이 다른 것들보다 훨씬 더 많은 데이터를 가지고 있을 때 발생합니다.\n- 예를 들어 \"customer_id\"를 기준으로 조인을 수행하고, 대부분의 거래가 소수의 고객에 속해 있다면 이러한 소수의 키는 다른 키들에 비해 훨씬 많은 양의 데이터를 가지고 있을 것입니다. 이로 인해 일부 작업(큰 키를 처리하는 작업)이 훨씬 더 오랜 시간이 걸리고 병목 현상이 발생할 수 있습니다.\n- 이 문제를 해결하는 방법은 skewed 데이터를 관리하기 위해 키에 임의의 접두사를 추가하는 것입니다.\n\n```js\nfrom pyspark.sql.functions import monotonically_increasing_id, expr\ndf.withColumn(\"salted_key\",\n    expr(\"concat(name, '_', (monotonically_increasing_id() % 10))\")\n).groupBy(\"salted_key\").count().select(sum(\"count\")).show()\n```\n\n```js\n# 결과\n+----------+\n|sum(count)|\n+----------+\n|         3|\n+----------+\n```\n\n- 데이터 로딩의 균형을 어떻게 맞출까요?\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\nfrom pyspark.sql.functions import monotonically_increasing_id, expr\ndf.withColumn(\"salted_key\",\n    expr(\"concat(name, '_', (monotonically_increasing_id() % 10))\")\n).groupBy(\"salted_key\").count().show()\n```\n\n```js\n# 결과\n+----------+-----+\n|salted_key|count|\n+----------+-----+\n|   James_6|    1|\n|   James_4|    1|\n|   James_0|    1|\n+----------+-----+\n```\n\n# 최적화 III: Shuffling을 최소화하는 전략\n\n```js\n### Shuffling 최소화 전략\n- **Broadcast 변수 사용**\n  - 데이터셋이 작은 경우 Shuffling을 피하기 위해 모든 노드에 브로드캐스트합니다.\n- **파티션 튜닝**\n  - 작업 및 데이터 규모에 맞게 파티션 수를 조정합니다.\n- **변환 최적화**\n  - Shuffling을 필요로 하는 넓은 변환을 최소화하기 위해 작업을 계획합니다.\n```\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n## 섞기\n\n- 섞기는 데이터가 서로 다른 파티션에 재분배되는 과정입니다.\n- 이는 데이터를 실행자 간이나 심지어 기계 간에 이동하는 것을 포함합니다.\n- 네트워크 및 디스크 I/O 측면에서 가장 비용이 많이 드는 작업 중 하나입니다.\n\n## 섞기의 목적\n\n- 데이터 재분배: 조인, 그룹화, 집계 및 재분할과 같은 넓은 변환을 용이하게 합니다.\n- 부하 분산: 클러스터 전체에 데이터와 작업 부담을 균등하게 분배합니다.\n- 동시성: 병렬 처리를 강화하고 리소스 활용을 최적화합니다.\n- 데이터 지역성 최적화: 데이터가 처리될 위치에 가까이 이동하도록 합니다. 네트워크 트래픽을 줄입니다.\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n## 셔플링의 고민거리\n\n- 자원 소모가 많음: 상당한 네트워크 대역폭과 디스크 I/O를 사용합니다.\n- 지연 시간 증가: 특히 대량의 데이터셋인 경우 처리 시간이 상당히 증가합니다.\n- 병목 현상 발생 가능성: 적절히 관리되지 않으면 전체 시스템 성능을 느리게 만들 수 있습니다.\n\n## 1. 작은 DataFrame과 큰 DataFrame을 조인할 때 데이터 셔플링을 최소화하기 위해 브로드캐스트 조인을 사용합니다.\n\n```js\nfrom pyspark.sql import SparkSession\nfrom pyspark.sql.functions import broadcast\n\n# 스파크 세션 초기화\nspark = SparkSession.builder.appName(\"브로드캐스트 조인 예제\").getOrCreate()\n# 직원용 큰 DataFrame 생성\ndata_employees = [(1, \"John\", 101),\n                  (2, \"Jane\", 102),\n                  (3, \"Joe\", 103),\n                  (4, \"Jill\", 101),\n                  # 더 많은 레코드가 있다고 가정\n                  ]\ncolumns_employees = [\"emp_id\", \"name\", \"dept_id\"]\ndf_employees = spark.createDataFrame(data_employees, columns_employees)\n# 부서용 작은 DataFrame 생성\ndata_departments = [(101, \"인사\"),\n                    (102, \"마케팅\"),\n                    (103, \"금융\"),\n                    (104, \"IT\"),\n                    (105, \"지원\")\n                    ]\ncolumns_departments = [\"dept_id\", \"dept_name\"]\ndf_departments = spark.createDataFrame(data_departments, columns_departments)\n# 브로드캐스트 조인 수행\ndf_joined = df_employees.join(broadcast(df_departments), \"dept_id\")\ndf_joined.show()\n```\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\n#출력\n+-------+------+----+---------+\n|dept_id|emp_id|  이름|dept_name|\n+-------+------+-----+--------+\n|    101|     1| 존|       인사|\n|    102|     2| 제인|     마케팅|\n|    103|     3| 조|     금융|\n|    101|     4| 질|       인사|\n+-------+------+-----+--------+\n```\n\n- 직원 — 직원 세부 정보를 담은 작은 데이터셋입니다.\n- 부서 — 부서 세부 정보를 담은 큰 데이터셋입니다.\n\n두 데이터셋을 부서 ID를 기준으로 조인하되, 부서 데이터셋을 크게 섞지 않도록 하는 것이 목표입니다.\n\n## 2. 파티션 조정: 병렬성 증가를 위한 다시 분할\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n- 데이터 프레임의 파티션을 재분할하여 병렬성을 높이거나 셔플 비용을 줄일 수 있습니다.\n- 그러나 여전히 전체 셔플을 유발할 수 있습니다.\n\n```js\n# 병렬성을 높이기 위한 재분할 예제\ndf = spark.createDataFrame([\n  (1, 'foo'), (2, 'bar'), (3, 'baz'), (4, 'qux')\n], [\"id\", \"value\"])\ndf_repartitioned = df.repartition(10)  # 파티션 수 증가\n```\n\n## 3. 파티션 튜닝: 파티션 감소를 위한 Coalesce\n\n- 전체 셔플 피하기: coalesce는 대규모 데이터 세트를 필터링한 후 파티션 수를 줄이고 싶을 때 셔플 비용을 피해야 할 때 최적입니다.\n- 전형적인 사용 사례: 많은 파티션이 부분적으로 채워지거나 비어있는 상태로 남을 수 있는 대규모 DataFrame을 필터링한 후 사용됩니다. coalesce는 네트워크 오버헤드를 줄이고 비용 효율적으로 리소스를 관리하는 데 도움이 됩니다.\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\n# 대규모 셔플링 없이 파티션 수를 줄이기 위한 코어스 예시\ndf_filtered = df.filter(\"id \u003e 1\")\ndf_coalesced = df_filtered.coalesce(2)  # 파티션 수 줄이기\n\n```\n\n## 4. 변환 최적화를 통해 데이터 셔플링 최소화하기\n\n- 최적화된 변환을 통해 Apache Spark에서 셔플링을 최소화하는 것은 Spark 애플리케이션의 성능을 향상시키는 중요한 측면입니다.\n- 변환 최적화는 데이터 처리 작업을 구조화하여 클러스터 전체에서 불필요한 데이터 이동을 줄이는 것을 포함하며, 이는 리소스를 많이 사용하고 실행 속도를 늦출 수 있습니다.\n- 이를 달성하는 방법을 보여주는 몇 가지 전략과 코드 예제는 다음과 같습니다:\n\n## 4–1. 일찍 필터링하기\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n- 데이터 처리 파이프라인에서 조인 또는 집계와 같은 후속 작업에서 나중에 섞어야 하는 데이터 양을 줄이기 위해 필터를 가능한 한 빨리 적용하세요.\n\n```python\nfrom pyspark.sql import SparkSession\n\n# 스파크 세션 초기화\nspark = SparkSession.builder.appName(\"Shuffling 최소화\").getOrCreate()\n\n# DataFrame 생성\ndata = [(\"John\", \"금융\", 3000), (\"Jane\", \"마케팅\", 4000), (\"Joe\", \"마케팅\", 2800), (\"Jill\", \"금융\", 3900)]\ncolumns = [\"이름\", \"부서\", \"연봉\"]\ndf = spark.createDataFrame(data, schema=columns)\n\n# 넓은 변환 전에 미리 필터링\nfiltered_df = df.filter(df[\"연봉\"] \u003e 3000)\n\n# 이제 집계 수행\naggregated_df = filtered_df.groupBy(\"부서\").avg(\"연봉\")\naggregated_df.show()\n```\n\n```python\n# 출력\n+----------+-----------+\n|부서      |avg(연봉)  |\n+----------+-----------+\n| 마케팅  |     4000.0|\n| 금융    |     3900.0|\n+----------+-----------+\n```\n\n## 4-2. 가능한 경우 RDD/넓은 변환 사용하기\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n- 좁은 변환, 예를 들어 `map` 및 `filter`와 같은 작업은 개별 파티션에서 작동하며 데이터 셔플을 필요로하지 않습니다. 가능한 경우 이러한 작업을 넓은 변환 대신 사용하십시오.\n\n```js\n# 셔플을 발생시키지 않고 새로운 열을 만들기 위해 map을 사용합니다\nrdd = df.rdd.map(lambda x: (x.Name, x.Salary * 1.1))\nupdated_salaries_df = spark.createDataFrame(\n  rdd, schema=[\"Name\", \"UpdatedSalary\"]\n)\nupdated_salaries_df.show()\n```\n\n```js\n# 결과\n+----+------------------+\n|Name|     UpdatedSalary|\n+----+------------------+\n|John|3300.0000000000005|\n|Jane|            4400.0|\n| Joe|3080.0000000000005|\n|Jill|            4290.0|\n+----+------------------+\n```\n\n## 4-3. Boardcasting join으로 불필요한 셔플을 피하세요\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n- 조인 작업시, 한 데이터셋이 다른 데이터셋보다 현저히 작을 때 브로드캐스트 조인을 사용하여 큰 데이터셋을 셔플링하지 않도록 합니다.\n\n```js\nfrom pyspark.sql.functions import broadcast\n# df_small이 df_large보다 훨씬 작다고 가정합니다\ndf_small = spark.createDataFrame(\n  [(1, \"HR\"), (2, \"마케팅\")], [\"id\", \"부서\"]\n)\ndf_large = spark.createDataFrame(\n  [(1, \"존\"), (2, \"제인\"), (1, \"조\"), (2, \"질\")],\n  [\"부서ID\", \"이름\"]\n)\n# 조인 최적화를 위해 작은 DataFrame을 브로드캐스트합니다\noptimized_join_df = df_large.join(broadcast(df_small), df_large.부서ID == df_small.id)\noptimized_join_df.show()\n```\n\n```js\n# 결과\n\n+------+----+---+------+\n|부서ID|이름| id|  부서|\n+------+----+---+------+\n|     1| 존|  1|   HR|\n|     2|제인|  2|마케팅|\n|     1| 조|  1|   HR|\n|     2| 질|  2|마케팅|\n+------+----+---+------+\n```\n\n## 4-4. 전략적으로 파티션 나누기\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n- 만약 넓은 변환을 사용해야 한다면, 나중에 조인 또는 집계할 키를 기반으로 데이터를 파티션으로 나누세요. 이 전략을 사용하면 동일한 키를 가진 행을 동일한 파티션에 함께 두어 셔플링을 줄일 수 있습니다.\n\n```js\n# 셔플링 최소화를 위해 집계 전에 파티션 재분배\nrepartitioned_df = df.repartition(\"Department\")\naggregated_df = repartitioned_df.groupBy(\"Department\").avg(\"Salary\")\naggregated_df.show()\n```\n\n```js\n# 결과\n+----------+-----------+\n|Department|avg(Salary)|\n+----------+-----------+\n|   Finance|     3450.0|\n| Marketing|     3400.0|\n+----------+-----------+\n```\n\n# 성능 모니터링 및 세부 조정\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n## 1. 메모리 관리\n\n```js\nspark.conf.set(“spark.executor.memory”, “4g”)\nspark.conf.set(“spark.driver.memory”, “2g”)\n```\n\n## 2. 작업 및 스테이지 모니터링\n\n- Spark UI를 사용하여 응용 프로그램 내의 작업 및 스테이지의 성능을 모니터링합니다.\n- Spark UI에 액세스하려면 다음으로 이동하십시오: http://[your-spark-driver-host]:4040\n- Executor 메트릭 분석: 각 executor의 메트릭을 모니터링하여 메모리 사용, 디스크 스피릴 및 가비지 수집에 대한 통찰을 얻을 수 있습니다.\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\n# 자세한 실행자 지표를 수집하도록 Spark를 구성합니다\nspark.conf.set(\"spark.executor.metrics.pollingInterval\", \"5000\")\n```\n\n## 3. SQL 성능 튜닝\n\n- SQL 실행 계획을 이해하고 최적화하기 위해 `EXPLAIN` 계획을 활용하세요.\n\n```js\ndf.explain(“formatted”)\n```\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\n== 물리적인 계획 ==\n* 기존 RDD 스캔 (1)\n\n\n(1) 기존 RDD 스캔 [코드 생성 ID : 1]\n출력 [3]: [이름 #4628, 부서 #4629, 급여 #4630L]\n인수: [이름 #4628, 부서 #4629, 급여 #4630L],\n applySchemaToPythonRDD에 있는 MapPartitionsRDD[693]에서\n                       at \u003c알 수 없음\u003e:0, ExistingRDD, UnknownPartitioning(0)\n```\n\n## 4. 동적 할당\n\n- 워크로드에 따라 스파크가 실행자 수를 동적으로 조정할 수 있도록 동적 할당을 활성화합니다.\n\n```js\nspark.conf.set(\"spark.dynamicAllocation.enabled\", \"true\");\nspark.conf.set(\"spark.dynamicAllocation.minExecutors\", \"1\");\nspark.conf.set(\"spark.dynamicAllocation.maxExecutors\", \"20\");\nspark.conf.set(\"spark.dynamicAllocation.executorIdleTimeout\", \"60s\");\nspark.conf.set(\"spark.shuffle.service.enabled\", \"true\");\n```\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n## 5. 데이터 지역성\n\n- 저장 및 처리 장치 간에 데이터가 이동해야 하는 거리를 최소화하여 데이터 지역성을 최적화합니다.\n\n```js\nspark.conf.set(\"spark.locality.wait\", \"300ms\");\n```\n\n## 6. Garbage Collection Tuning\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\n- 가비지 컬렉터 설정을 조정하여 메모리 관리를 최적화하고 일시 중지 시간을 줄일 수 있습니다.\n\n# 더 나은 지연 시간을 위해 G1GC 사용\nspark.conf.set(\"spark.executor.extraJavaOptions\", \"-XX:+UseG1GC\")\n# 짧은 일시 중지를 위해 명시적인 GC 설정 구성\nspark.conf.set(\"spark.executor.extraJavaOptions\", \"-XX:MaxGCPauseMillis=100\")\n\n## 7. 데이터 직렬화 세부 조정\n\n- 데이터 직렬화는 분산 애플리케이션의 성능에 중요한 역할을 합니다. Spark는 두 가지 직렬화 도구를 지원합니다:\n```\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\n# 더 나은 성능과 효율성을 위해 Kryo 직렬화 프로그램 사용\nspark.conf.set(\"spark.serializer\", \"org.apache.spark.serializer.KryoSerializer\")\nspark.conf.set(\"spark.kryo.registrationRequired\", \"true\")\n\n# Kryo와 사용자 정의 클래스 등록\nclass MyClass:\n    def __init__(self, name, id):\n        self.name = name\n        self.id = id\nspark.sparkContext.getConf().registerKryoClasses([MyClass])\n```\n\n## 8. 네트워크 구성 최적화\n\n- 네트워크 설정은 특히 대규모 배포에서 성능에 중대한 영향을 미칠 수 있습니다:\n\n```js\n# 네트워크 타임아웃 설정을 조정하여 대규모 클러스터에서 불필요한 작업 실패를 피하십시오\nspark.conf.set(\"spark.network.timeout\", \"800s\")\nspark.conf.set(\"spark.core.connection.ack.wait.timeout\", \"600s\")\n```\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n## 9. 고급 Spark SQL 튜닝\n\n- Catalyst 옵티마이저 및 Tungsten 실행 엔진을 활용하면 Spark SQL의 성능을 향상시킬 수 있습니다:\n\n```js\n# 직렬 처리를 위한 전체 단계 코드 생성 활성화\nspark.conf.set(\"spark.sql.codegen.wholeStage\", \"true\")\n\n# 조인 최적화에 유용한 테이블 브로드캐스트를 위한 최대 바이트 수 증가\nspark.conf.set(\"spark.sql.autoBroadcastJoinThreshold\", \"10485760\")  # 10 MB\n```\n\n## 10. 데이터 파티셔닝 최적화\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n데이터 분배를 세밀하게 조정하여 쿼리 성능을 향상시키고 셔플 오버헤드를 줄일 수 있어요:\n\n```js\n# 데이터 크기 및 작업을 기준으로 수동으로 셔플 파티션 수 설정\n\nspark.conf.set(\"spark.sql.shuffle.partitions\", \"200\")\n# 클러스터 크기 및 데이터에 맞게 조정하세요\n```\n\n## 11. 적응형 쿼리 실행 활성화\n\n- 적응형 쿼리 실행 (AQE)는 실행 중에 쿼리 계획을 조정함으로써 Spark SQL 쿼리를 더 빠르고 데이터 스쿠 및 기타 이슈에 더 강건하게 만드는 기능이에요.\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\n# 쿼리 실행을 적응적으로 조정하는 AQE를 활성화합니다. 이는 구성을 간소화하고 성능을 향상시킬 수 있습니다.\nspark.conf.set(\"spark.sql.adaptive.enabled\", \"true\")\n```\n\n- AQE는 실제 데이터에 적응해 셔플 파티셔닝을 조정하고, 불균형 조인을 처리하며, 정렬을 최적화할 수 있습니다.\n\n## 12. 메모리 관리 지정\n\n- 적절한 메모리 관리는 메모리 집약적인 작업에서 특히 효과적인 성능 개선을 위해 스파이지를 방지할 수 있습니다.\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n# RDD 저장소에 예약된 메모리 분수를 구성합니다.\n\nspark.conf.set(“spark.memory.fraction”, “0.6”)\nspark.conf.set(“spark.memory.storageFraction”, “0.5”)\n\n이러한 설정은 실행 메모리와 저장소 메모리 사이의 균형을 맞추어 셔플 및 캐싱 중 디스크 스파일을 줄이는 데 도움이 됩니다.\n\n# 읽어 주셔서 감사합니다\n\n이 글이 마음에 드시면:\n\n\u003c!-- TIL 수평 --\u003e\n\n\u003cins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-4877378276818686\"\n     data-ad-slot=\"1549334788\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n- 👏 여러 번 박수로 지지를 보여주세요!\n- 이 안내서를 친구들과 공유해도 좋아요.\n- 여러분의 피드백은 소중합니다. 앞으로의 글에 영감을 주고 안내해 줍니다.\n- 또는 메시지를 남겨주세요: https://www.linkedin.com/in/kevinchwong\n","ogImage":{"url":"/assets/img/2024-07-09-IntensiveSparkOptimizationCourse_0.png"},"coverImage":"/TIL/assets/img/2024-07-09-IntensiveSparkOptimizationCourse_0.png","tag":["Tech"],"readingTime":43},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cp\u003e\u003cimg src=\"/TIL/assets/img/2024-07-09-IntensiveSparkOptimizationCourse_0.png\" alt=\"Intensive Spark Optimization Course\"\u003e\u003c/p\u003e\n\u003ch1\u003e로컬에서 플레이그라운드 설정하기\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eDocker Desktop을 설치합니다.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003edocker run -p 8888:8888 jupyter/pyspark-notebook\u003c/code\u003e을 실행합니다.\u003c/li\u003e\n\u003cli\u003e다음 메시지가 표시되면 브라우저에서 주피터 랩을 열기 위해 URL 중 하나를 붙여넣습니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e서버에 액세스하려면 브라우저에서 이 파일을 엽니다:\n    \u003cspan class=\"hljs-attr\"\u003efile\u003c/span\u003e:\u003cspan class=\"hljs-comment\"\u003e///home/jovyan/.local/share/jupyter/runtime/jpserver-7-open.html\u003c/span\u003e\n또는 다음 \u003cspan class=\"hljs-variable constant_\"\u003eURL\u003c/span\u003e 중 하나를 복사하여 붙여넣습니다:\n    \u003cspan class=\"hljs-attr\"\u003ehttp\u003c/span\u003e:\u003cspan class=\"hljs-comment\"\u003e//3c331b638888:8888/lab?token=a88888b6aa6620fc976588ba58817f3b14ea0674bdc77f72\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ehttp\u003c/span\u003e:\u003cspan class=\"hljs-comment\"\u003e//127.0.0.1:8888/lab?token=a88888b6aa6620fc976588ba58817f3b14ea0674bdc77f72\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003ch1\u003eSparkSession 초기화하기\u003c/h1\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pyspark.\u003cspan class=\"hljs-property\"\u003esql\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eSparkSession\u003c/span\u003e\nspark = \u003cspan class=\"hljs-title class_\"\u003eSparkSession\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ebuilder\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eappName\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"Spark Test\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003egetOrCreate\u003c/span\u003e()\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003e데이터프레임\u003c/h1\u003e\n\u003ch2\u003e1. 데이터프레임 생성하기\u003c/h2\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cul\u003e\n\u003cli\u003e컬럼 사용\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pyspark.\u003cspan class=\"hljs-property\"\u003esql\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003etypes\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eStructType\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eIntegerType\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eStringType\u003c/span\u003e\n\n# 데이터를 튜플의 리스트로 정의\ndata = [(\u003cspan class=\"hljs-string\"\u003e\"James\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e34\u003c/span\u003e), (\u003cspan class=\"hljs-string\"\u003e\"Anna\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e), (\u003cspan class=\"hljs-string\"\u003e\"Lee\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e)]\n\n# 컬럼 사용\ncolumns = [\u003cspan class=\"hljs-string\"\u003e\"Name\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"Age\"\u003c/span\u003e]\ndf = spark.\u003cspan class=\"hljs-title function_\"\u003ecreateDataFrame\u003c/span\u003e(data, schema=columns)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e스키마 사용\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pyspark.\u003cspan class=\"hljs-property\"\u003esql\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003etypes\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eStructType\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eIntegerType\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eStringType\u003c/span\u003e\n\n# 데이터를 튜플의 리스트로 정의\ndata = [(\u003cspan class=\"hljs-string\"\u003e\"James\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e34\u003c/span\u003e), (\u003cspan class=\"hljs-string\"\u003e\"Anna\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e), (\u003cspan class=\"hljs-string\"\u003e\"Lee\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e)]\n\n# 스키마 사용\nschema = \u003cspan class=\"hljs-title class_\"\u003eStructType\u003c/span\u003e([\n    \u003cspan class=\"hljs-title class_\"\u003eStructField\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"Name\"\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eStringType\u003c/span\u003e(), \u003cspan class=\"hljs-title class_\"\u003eTrue\u003c/span\u003e),\n    \u003cspan class=\"hljs-title class_\"\u003eStructField\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"Age\"\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eIntegerType\u003c/span\u003e(), \u003cspan class=\"hljs-title class_\"\u003eTrue\u003c/span\u003e)\n])\ndf = spark.\u003cspan class=\"hljs-title function_\"\u003ecreateDataFrame\u003c/span\u003e(data, schema=schema)\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cul\u003e\n\u003cli\u003eRDD 사용\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pyspark.\u003cspan class=\"hljs-property\"\u003esql\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003etypes\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eStructType\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eIntegerType\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eStringType\u003c/span\u003e\n\n# 데이터를 튜플의 리스트로 준비\ndata = [(\u003cspan class=\"hljs-string\"\u003e\"James\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e34\u003c/span\u003e), (\u003cspan class=\"hljs-string\"\u003e\"Anna\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e), (\u003cspan class=\"hljs-string\"\u003e\"Lee\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e)]\n\n# \u003cspan class=\"hljs-variable constant_\"\u003eRDD\u003c/span\u003e 사용\nrdd = spark.\u003cspan class=\"hljs-property\"\u003esparkContext\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eparallelize\u003c/span\u003e(data)\nschema = \u003cspan class=\"hljs-title class_\"\u003eStructType\u003c/span\u003e([\n    \u003cspan class=\"hljs-title class_\"\u003eStructField\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"이름\"\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eStringType\u003c/span\u003e(), \u003cspan class=\"hljs-title class_\"\u003eTrue\u003c/span\u003e),\n    \u003cspan class=\"hljs-title class_\"\u003eStructField\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"나이\"\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eIntegerType\u003c/span\u003e(), \u003cspan class=\"hljs-title class_\"\u003eTrue\u003c/span\u003e)\n])\ndf = spark.\u003cspan class=\"hljs-title function_\"\u003ecreateDataFrame\u003c/span\u003e(rdd, schema=schema)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003edf.\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e()\n\n# 출력\n+-----+---+\n| 이름|나이|\n+-----+---+\n|\u003cspan class=\"hljs-title class_\"\u003eJames\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e34\u003c/span\u003e|\n| \u003cspan class=\"hljs-title class_\"\u003eAnna\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e|\n|  \u003cspan class=\"hljs-title class_\"\u003eLee\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e|\n+-----+---+\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e2. 데이터프레임 표시\u003c/h2\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003edf.\u003cspan class=\"hljs-title function_\"\u003eprintSchema\u003c/span\u003e();\n\u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(df.\u003cspan class=\"hljs-property\"\u003eschema\u003c/span\u003e);\n\u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(df.\u003cspan class=\"hljs-property\"\u003ecolumns\u003c/span\u003e);\ndf.\u003cspan class=\"hljs-title function_\"\u003edescribe\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e();\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e#결과\n\n## df.\u003cspan class=\"hljs-title function_\"\u003eprintSchema\u003c/span\u003e()\nroot\n |-- \u003cspan class=\"hljs-title class_\"\u003eName\u003c/span\u003e: string (nullable = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e)\n |-- \u003cspan class=\"hljs-title class_\"\u003eAge\u003c/span\u003e: long (nullable = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e)\n\n## \u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(df.\u003cspan class=\"hljs-property\"\u003eschema\u003c/span\u003e)\n\u003cspan class=\"hljs-title class_\"\u003eStructType\u003c/span\u003e([\n  \u003cspan class=\"hljs-title class_\"\u003eStructField\u003c/span\u003e(‘\u003cspan class=\"hljs-title class_\"\u003eName\u003c/span\u003e’, \u003cspan class=\"hljs-title class_\"\u003eStringType\u003c/span\u003e(), \u003cspan class=\"hljs-title class_\"\u003eTrue\u003c/span\u003e),\n  \u003cspan class=\"hljs-title class_\"\u003eStructField\u003c/span\u003e(‘\u003cspan class=\"hljs-title class_\"\u003eAge\u003c/span\u003e’, \u003cspan class=\"hljs-title class_\"\u003eLongType\u003c/span\u003e(), \u003cspan class=\"hljs-title class_\"\u003eTrue\u003c/span\u003e)\n])\n\n## \u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(df.\u003cspan class=\"hljs-property\"\u003ecolumns\u003c/span\u003e)\n[‘\u003cspan class=\"hljs-title class_\"\u003eName\u003c/span\u003e’, ‘\u003cspan class=\"hljs-title class_\"\u003eAge\u003c/span\u003e’]\n\n## df.\u003cspan class=\"hljs-title function_\"\u003edescribe\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e()\n+-------+----+-----------------+\n|summary|\u003cspan class=\"hljs-title class_\"\u003eName\u003c/span\u003e|              \u003cspan class=\"hljs-title class_\"\u003eAge\u003c/span\u003e|\n+-------+----+-----------------+\n|  count|   \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e|                \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e|\n|   mean|\u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|             \u003cspan class=\"hljs-number\"\u003e28.0\u003c/span\u003e|\n| stddev|\u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e7.211102550927978\u003c/span\u003e|\n|    min|\u003cspan class=\"hljs-title class_\"\u003eAnna\u003c/span\u003e|               \u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e|\n|    max| \u003cspan class=\"hljs-title class_\"\u003eLee\u003c/span\u003e|               \u003cspan class=\"hljs-number\"\u003e34\u003c/span\u003e|\n+-------+----+-----------------+\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e3. 컬럼 선택\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003edf.\u003cspan class=\"hljs-title function_\"\u003eselect\u003c/span\u003e(df[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e]).\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e();\ndf.\u003cspan class=\"hljs-title function_\"\u003eselect\u003c/span\u003e(df.\u003cspan class=\"hljs-property\"\u003eName\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e();\ndf.\u003cspan class=\"hljs-title function_\"\u003eselect\u003c/span\u003e(df[\u003cspan class=\"hljs-string\"\u003e\"Name\"\u003c/span\u003e]).\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e();\ndf.\u003cspan class=\"hljs-title function_\"\u003eselect\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"Name\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e();\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e#\u003cspan class=\"hljs-title class_\"\u003eOutput\u003c/span\u003e\n+-----+\n| \u003cspan class=\"hljs-title class_\"\u003eName\u003c/span\u003e|\n+-----+\n|\u003cspan class=\"hljs-title class_\"\u003eJames\u003c/span\u003e|\n| \u003cspan class=\"hljs-title class_\"\u003eAnna\u003c/span\u003e|\n|  \u003cspan class=\"hljs-title class_\"\u003eLee\u003c/span\u003e|\n+-----+\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e4. 데이터 필터링\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 데이터 필터링\ndf.\u003cspan class=\"hljs-title function_\"\u003efilter\u003c/span\u003e(df[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e] \u003e \u003cspan class=\"hljs-number\"\u003e25\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e()\ndf.\u003cspan class=\"hljs-title function_\"\u003efilter\u003c/span\u003e(df.\u003cspan class=\"hljs-property\"\u003eAge\u003c/span\u003e \u003e \u003cspan class=\"hljs-number\"\u003e25\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e()\ndf.\u003cspan class=\"hljs-title function_\"\u003efilter\u003c/span\u003e(df[\u003cspan class=\"hljs-string\"\u003e\"Age\"\u003c/span\u003e] \u003e \u003cspan class=\"hljs-number\"\u003e25\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e#\u003cspan class=\"hljs-title class_\"\u003eOutput\u003c/span\u003e\n+-----+---+\n| \u003cspan class=\"hljs-title class_\"\u003eName\u003c/span\u003e|\u003cspan class=\"hljs-title class_\"\u003eAge\u003c/span\u003e|\n+-----+---+\n|\u003cspan class=\"hljs-title class_\"\u003eJames\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e34\u003c/span\u003e|\n|  \u003cspan class=\"hljs-title class_\"\u003eLee\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e|\n+-----+---+\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003ch2\u003e5. 파일에 DataFrame 작성하기\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# \u003cspan class=\"hljs-title class_\"\u003eJSON\u003c/span\u003e 파일 작성\ndf.\u003cspan class=\"hljs-property\"\u003ewrite\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"test123.json\"\u003c/span\u003e)\n\n# \u003cspan class=\"hljs-title class_\"\u003eParquet\u003c/span\u003e 파일 작성\ndf.\u003cspan class=\"hljs-property\"\u003ewrite\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eparquet\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"test123.parquet\"\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e6. 파일을 DataFrame으로 읽기\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# \u003cspan class=\"hljs-title class_\"\u003eJSON\u003c/span\u003e 파일 읽기\ndf_json = spark.\u003cspan class=\"hljs-property\"\u003eread\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"test123.json\"\u003c/span\u003e)\n# \u003cspan class=\"hljs-title class_\"\u003eParquet\u003c/span\u003e 파일 읽기\ndf_parquet = spark.\u003cspan class=\"hljs-property\"\u003eread\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eparquet\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"test123.parquet\"\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003ch2\u003e7. 새로운 복합 데이터 유형을 포함한 새로운 열 추가\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pyspark.\u003cspan class=\"hljs-property\"\u003esql\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003efunctions\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e struct\ndf2 = df.\u003cspan class=\"hljs-title function_\"\u003ewithColumn\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"NameAndAge\"\u003c/span\u003e, \u003cspan class=\"hljs-title function_\"\u003estruct\u003c/span\u003e(df.\u003cspan class=\"hljs-property\"\u003eName\u003c/span\u003e, df.\u003cspan class=\"hljs-property\"\u003eAge\u003c/span\u003e))\ndf2.\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e()\ndf2.\u003cspan class=\"hljs-title function_\"\u003eprintSchema\u003c/span\u003e()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 출력\n+-----+---+-----------+\n| \u003cspan class=\"hljs-title class_\"\u003eName\u003c/span\u003e|\u003cspan class=\"hljs-title class_\"\u003eAge\u003c/span\u003e| \u003cspan class=\"hljs-title class_\"\u003eNameAndAge\u003c/span\u003e|\n+-----+---+-----------+\n|\u003cspan class=\"hljs-title class_\"\u003eJames\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e34\u003c/span\u003e|{\u003cspan class=\"hljs-title class_\"\u003eJames\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e34\u003c/span\u003e}|\n| \u003cspan class=\"hljs-title class_\"\u003eAnna\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e| {\u003cspan class=\"hljs-title class_\"\u003eAnna\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e}|\n|  \u003cspan class=\"hljs-title class_\"\u003eLee\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e|  {\u003cspan class=\"hljs-title class_\"\u003eLee\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e}|\n+-----+---+-----------+\n\n# 스키마 출력\nroot\n |-- \u003cspan class=\"hljs-title class_\"\u003eName\u003c/span\u003e: string (nullable = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e)\n |-- \u003cspan class=\"hljs-title class_\"\u003eAge\u003c/span\u003e: long (nullable = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e)\n |-- \u003cspan class=\"hljs-title class_\"\u003eNameAndAge\u003c/span\u003e: struct (nullable = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e)\n |    |-- \u003cspan class=\"hljs-title class_\"\u003eName\u003c/span\u003e: string (nullable = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e)\n |    |-- \u003cspan class=\"hljs-title class_\"\u003eAge\u003c/span\u003e: long (nullable = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003e쿼리: 그룹화 및 집계\u003c/h1\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003ch2\u003e1. count()\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pyspark.sql \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e SparkSession\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pyspark.sql.functions \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e count\n\n\u003cspan class=\"hljs-comment\"\u003e# 스파크 세션 초기화\u003c/span\u003e\nspark = SparkSession.builder.appName(\u003cspan class=\"hljs-string\"\u003e\"그루핑 및 집계\"\u003c/span\u003e).getOrCreate()\n\n\u003cspan class=\"hljs-comment\"\u003e# 데이터프레임 생성\u003c/span\u003e\ndata = [(\u003cspan class=\"hljs-string\"\u003e\"James\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"Sales\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e),\n        (\u003cspan class=\"hljs-string\"\u003e\"Michael\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"Sales\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e4600\u003c/span\u003e),\n        (\u003cspan class=\"hljs-string\"\u003e\"Robert\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"Sales\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e4100\u003c/span\u003e),\n        (\u003cspan class=\"hljs-string\"\u003e\"Maria\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"Finance\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e),\n        (\u003cspan class=\"hljs-string\"\u003e\"James\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"Sales\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e),\n        (\u003cspan class=\"hljs-string\"\u003e\"Scott\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"Finance\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3300\u003c/span\u003e),\n        (\u003cspan class=\"hljs-string\"\u003e\"Jen\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"Finance\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3900\u003c/span\u003e),\n        (\u003cspan class=\"hljs-string\"\u003e\"Jeff\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"Marketing\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e),\n        (\u003cspan class=\"hljs-string\"\u003e\"Kumar\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"Marketing\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2000\u003c/span\u003e),\n        (\u003cspan class=\"hljs-string\"\u003e\"Saif\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"Sales\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e4100\u003c/span\u003e)]\ncolumns = [\u003cspan class=\"hljs-string\"\u003e\"employee_name\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"department\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"salary\"\u003c/span\u003e]\ndf = spark.createDataFrame(data, schema=columns)\n\n\u003cspan class=\"hljs-comment\"\u003e# 그룹화 및 count 수행\u003c/span\u003e\ngrouped_df = df.groupBy(\u003cspan class=\"hljs-string\"\u003e\"department\"\u003c/span\u003e).count()\ngrouped_df.show()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-comment\"\u003e# 결과\u003c/span\u003e\n\n+----------+-----+\n|department|count|\n+----------+-----+\n|     Sales|    \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e|\n|   Finance|    \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e|\n| Marketing|    \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e|\n+----------+-----+\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e2. max(), min(), avg(), sum()\u003c/h2\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 그룹별로 그룹화 및 최댓값 찾기\nmax_df = df.\u003cspan class=\"hljs-title function_\"\u003egroupBy\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"department\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003emax\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"salary\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ealias\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"max_salary\"\u003c/span\u003e)\nmax_df.\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 결과\n\n+----------+-----------+\n|department|\u003cspan class=\"hljs-title function_\"\u003emax\u003c/span\u003e(salary)|\n+----------+-----------+\n|     \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e4600\u003c/span\u003e|\n|   \u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e3900\u003c/span\u003e|\n| \u003cspan class=\"hljs-title class_\"\u003eMarketing\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e|\n+----------+-----------+\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e3. agg() + F.max(), F.count() 등…\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pyspark.\u003cspan class=\"hljs-property\"\u003esql\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e functions \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e F\n\n# 여러 가지 집계 동작 수행\nagg_df = df.\u003cspan class=\"hljs-title function_\"\u003egroupBy\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"department\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eagg\u003c/span\u003e(\n    F.\u003cspan class=\"hljs-title function_\"\u003ecount\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"salary\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ealias\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"count\"\u003c/span\u003e),\n    F.\u003cspan class=\"hljs-title function_\"\u003emax\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"salary\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ealias\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"max_salary\"\u003c/span\u003e),\n    F.\u003cspan class=\"hljs-title function_\"\u003emin\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"salary\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ealias\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"min_salary\"\u003c/span\u003e),\n    F.\u003cspan class=\"hljs-title function_\"\u003esum\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"salary\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ealias\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"total_salary\"\u003c/span\u003e),\n    F.\u003cspan class=\"hljs-title function_\"\u003eavg\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"salary\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ealias\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"average_salary\"\u003c/span\u003e)\n)\nagg_df.\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e()\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 결과\n+----------+-----+----------+----------+------------+--------------+\n|department|count|max_salary|min_salary|total_salary|average_salary|\n+----------+-----+----------+----------+------------+--------------+\n|     \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e|    \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e|      \u003cspan class=\"hljs-number\"\u003e4600\u003c/span\u003e|      \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e18800\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e3760.0\u003c/span\u003e|\n|   \u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e|    \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e|      \u003cspan class=\"hljs-number\"\u003e3900\u003c/span\u003e|      \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e10200\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e3400.0\u003c/span\u003e|\n| \u003cspan class=\"hljs-title class_\"\u003eMarketing\u003c/span\u003e|    \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e|      \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e|      \u003cspan class=\"hljs-number\"\u003e2000\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e5000\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e2500.0\u003c/span\u003e|\n+----------+-----+----------+----------+------------+--------------+\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e4. agg() + collect_list() 및 collect_set()\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pyspark.\u003cspan class=\"hljs-property\"\u003esql\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003efunctions\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e collect_list\n\n# \u003cspan class=\"hljs-title class_\"\u003eGroupBy\u003c/span\u003e 및 리스트 수집 수행\ncollected_list_df = df.\u003cspan class=\"hljs-title function_\"\u003egroupBy\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"department\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eagg\u003c/span\u003e(\n  \u003cspan class=\"hljs-title function_\"\u003ecollect_list\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"salary\"\u003c/span\u003e),\n  \u003cspan class=\"hljs-title function_\"\u003ecollect_set\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"salary\"\u003c/span\u003e)\n)\ncollected_list_df.\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e(truncate=\u003cspan class=\"hljs-title class_\"\u003eFalse\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 결과\n+----------+------------------------------+-------------------+\n|department|\u003cspan class=\"hljs-title function_\"\u003ecollect_list\u003c/span\u003e(salary)          |\u003cspan class=\"hljs-title function_\"\u003ecollect_set\u003c/span\u003e(salary)|\n+----------+------------------------------+-------------------+\n|\u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e     |[\u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e4600\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e4100\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e4100\u003c/span\u003e]|[\u003cspan class=\"hljs-number\"\u003e4600\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e4100\u003c/span\u003e] |\n|\u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e   |[\u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3300\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3900\u003c/span\u003e]            |[\u003cspan class=\"hljs-number\"\u003e3900\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3300\u003c/span\u003e] |\n|\u003cspan class=\"hljs-title class_\"\u003eMarketing\u003c/span\u003e |[\u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2000\u003c/span\u003e]                  |[\u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2000\u003c/span\u003e]       |\n+----------+------------------------------+-------------------+\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003ch2\u003e5. agg() + 사용자 정의 집계 함수 (UDAF)\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e때로는 내장 함수만으로 복잡한 집계를 수행하기에 충분하지 않을 수 있습니다. Spark를 사용하면 사용자 정의 집계 함수를 만들 수 있습니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 초기 데이터\n|부서     |직원 이름        |급여    |\n|----------|-------------|------|\n|\u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e    |\u003cspan class=\"hljs-title class_\"\u003eJames\u003c/span\u003e        |\u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e  |\n|\u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e    |\u003cspan class=\"hljs-title class_\"\u003eMichael\u003c/span\u003e      |\u003cspan class=\"hljs-number\"\u003e4600\u003c/span\u003e  |\n|\u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e    |\u003cspan class=\"hljs-title class_\"\u003eRobert\u003c/span\u003e       |\u003cspan class=\"hljs-number\"\u003e4100\u003c/span\u003e  |\n|\u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e  |\u003cspan class=\"hljs-title class_\"\u003eMaria\u003c/span\u003e        |\u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e  |\n|\u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e    |\u003cspan class=\"hljs-title class_\"\u003eJames\u003c/span\u003e        |\u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e  |\n|\u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e  |\u003cspan class=\"hljs-title class_\"\u003eScott\u003c/span\u003e        |\u003cspan class=\"hljs-number\"\u003e3300\u003c/span\u003e  |\n|\u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e  |\u003cspan class=\"hljs-title class_\"\u003eJen\u003c/span\u003e          |\u003cspan class=\"hljs-number\"\u003e3900\u003c/span\u003e  |\n|\u003cspan class=\"hljs-title class_\"\u003eMarketing\u003c/span\u003e|\u003cspan class=\"hljs-title class_\"\u003eJeff\u003c/span\u003e         |\u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e  |\n|\u003cspan class=\"hljs-title class_\"\u003eMarketing\u003c/span\u003e|\u003cspan class=\"hljs-title class_\"\u003eKumar\u003c/span\u003e        |\u003cspan class=\"hljs-number\"\u003e2000\u003c/span\u003e  |\n|\u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e    |\u003cspan class=\"hljs-title class_\"\u003eSaif\u003c/span\u003e         |\u003cspan class=\"hljs-number\"\u003e4100\u003c/span\u003e  |\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pyspark.\u003cspan class=\"hljs-property\"\u003esql\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003efunctions\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e pandas_udf, \u003cspan class=\"hljs-title class_\"\u003ePandasUDFType\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pandas \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDataFrame\u003c/span\u003e\n\n@\u003cspan class=\"hljs-title function_\"\u003epandas_udf\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"double\"\u003c/span\u003e)\ndef \u003cspan class=\"hljs-title function_\"\u003emean_salary\u003c/span\u003e(\u003cspan class=\"hljs-attr\"\u003es\u003c/span\u003e: pd.\u003cspan class=\"hljs-property\"\u003eSeries\u003c/span\u003e) -\u003e \u003cspan class=\"hljs-attr\"\u003efloat\u003c/span\u003e:\n \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e s.\u003cspan class=\"hljs-title function_\"\u003emean\u003c/span\u003e()\nudaf_df = df.\u003cspan class=\"hljs-title function_\"\u003egroupBy\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"department\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eagg\u003c/span\u003e(\n  \u003cspan class=\"hljs-title function_\"\u003emean_salary\u003c/span\u003e(df[\u003cspan class=\"hljs-string\"\u003e\"salary\"\u003c/span\u003e]).\u003cspan class=\"hljs-title function_\"\u003ealias\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"average_salary\"\u003c/span\u003e)\n)\nudaf_df.\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e()\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 결과\n+----------+--------------+\n|department|average_salary|\n+----------+--------------+\n|   \u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e3400.0\u003c/span\u003e|\n| \u003cspan class=\"hljs-title class_\"\u003eMarketing\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e2500.0\u003c/span\u003e|\n|     \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e|        \u003cspan class=\"hljs-number\"\u003e3760.0\u003c/span\u003e|\n+----------+--------------+\n\n## \u003cspan class=\"hljs-number\"\u003e6.\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eagg\u003c/span\u003e() + 복잡한 조건: \u003cspan class=\"hljs-title function_\"\u003ewhen\u003c/span\u003e()\n\n- 때로는 조건에 따른 합계나 평균과 같은 복잡한 조건이 집계 중에 필요할 수 있습니다.\n\n# 초기 데이터\n+----------+-------------+------+\n|department|employee_name|salary|\n+----------+-------------+------+\n|     \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e|        \u003cspan class=\"hljs-title class_\"\u003eJames\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e|\n|     \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e|      \u003cspan class=\"hljs-title class_\"\u003eMichael\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e4600\u003c/span\u003e|\n|     \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e|       \u003cspan class=\"hljs-title class_\"\u003eRobert\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e4100\u003c/span\u003e|\n|   \u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e|        \u003cspan class=\"hljs-title class_\"\u003eMaria\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e|\n|     \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e|        \u003cspan class=\"hljs-title class_\"\u003eJames\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e|\n|   \u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e|        \u003cspan class=\"hljs-title class_\"\u003eScott\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e3300\u003c/span\u003e|\n|   \u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e|          \u003cspan class=\"hljs-title class_\"\u003eJen\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e3900\u003c/span\u003e|\n| \u003cspan class=\"hljs-title class_\"\u003eMarketing\u003c/span\u003e|         \u003cspan class=\"hljs-title class_\"\u003eJeff\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e|\n| \u003cspan class=\"hljs-title class_\"\u003eMarketing\u003c/span\u003e|        \u003cspan class=\"hljs-title class_\"\u003eKumar\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e2000\u003c/span\u003e|\n|     \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e|         \u003cspan class=\"hljs-title class_\"\u003eSaif\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e4100\u003c/span\u003e|\n+----------+-------------+------+\n\n\u0026#x3C;!-- \u003cspan class=\"hljs-variable constant_\"\u003eTIL\u003c/span\u003e 수평 --\u003e\n\u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eins\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"adsbygoogle\"\u003c/span\u003e\n     \u003cspan class=\"hljs-attr\"\u003estyle\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"display:block\"\u003c/span\u003e\n     \u003cspan class=\"hljs-attr\"\u003edata-ad-client\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"ca-pub-4877378276818686\"\u003c/span\u003e\n     \u003cspan class=\"hljs-attr\"\u003edata-ad-slot\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"1549334788\"\u003c/span\u003e\n     \u003cspan class=\"hljs-attr\"\u003edata-ad-format\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"auto\"\u003c/span\u003e\n     \u003cspan class=\"hljs-attr\"\u003edata-full-width-responsive\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"true\"\u003c/span\u003e\u003e\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003eins\u003c/span\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u003e\u003c/span\u003e\u003cspan class=\"javascript\"\u003e\n(adsbygoogle = \u003cspan class=\"hljs-variable language_\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eadsbygoogle\u003c/span\u003e || []).\u003cspan class=\"hljs-title function_\"\u003epush\u003c/span\u003e({});\n\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pyspark.\u003cspan class=\"hljs-property\"\u003esql\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003efunctions\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e when\n\n# 조건부 집계\nconditional_agg_df = df.\u003cspan class=\"hljs-title function_\"\u003egroupBy\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"department\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eagg\u003c/span\u003e(\n    \u003cspan class=\"hljs-title function_\"\u003esum\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003ewhen\u003c/span\u003e(df[\u003cspan class=\"hljs-string\"\u003e\"salary\"\u003c/span\u003e] \u003e \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e, df[\u003cspan class=\"hljs-string\"\u003e\"salary\"\u003c/span\u003e])).\u003cspan class=\"hljs-title function_\"\u003ealias\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"sum_high_salaries\"\u003c/span\u003e)\n)\nconditional_agg_df.\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e()\n\n# 결과\n\n+----------+-----------------+\n|department|sum_high_salaries|\n+----------+-----------------+\n|     \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e|            \u003cspan class=\"hljs-number\"\u003e12800\u003c/span\u003e|\n|   \u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e|             \u003cspan class=\"hljs-number\"\u003e7200\u003c/span\u003e|\n| \u003cspan class=\"hljs-title class_\"\u003eMarketing\u003c/span\u003e|             \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|\n+----------+-----------------+\n\n## \u003cspan class=\"hljs-number\"\u003e6.\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eagg\u003c/span\u003e() 이후 \u003cspan class=\"hljs-title class_\"\u003eGroupBy\u003c/span\u003e에서 \u003cspan class=\"hljs-variable constant_\"\u003eRDD\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eMap\u003c/span\u003e 함수 사용하기\n\n- 경우에 따라 매핑 함수를 \u003cspan class=\"hljs-title class_\"\u003eGroupBy\u003c/span\u003e와 결합하여 집단화된 데이터에 대한 직접적인 집계가 아닌 작업을 수행할 수 있습니다.\n\n\u0026#x3C;!-- \u003cspan class=\"hljs-variable constant_\"\u003eTIL\u003c/span\u003e 수평 --\u003e\n\u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eins\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"adsbygoogle\"\u003c/span\u003e\n     \u003cspan class=\"hljs-attr\"\u003estyle\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"display:block\"\u003c/span\u003e\n     \u003cspan class=\"hljs-attr\"\u003edata-ad-client\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"ca-pub-4877378276818686\"\u003c/span\u003e\n     \u003cspan class=\"hljs-attr\"\u003edata-ad-slot\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"1549334788\"\u003c/span\u003e\n     \u003cspan class=\"hljs-attr\"\u003edata-ad-format\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"auto\"\u003c/span\u003e\n     \u003cspan class=\"hljs-attr\"\u003edata-full-width-responsive\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"true\"\u003c/span\u003e\u003e\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003eins\u003c/span\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u003e\u003c/span\u003e\u003cspan class=\"javascript\"\u003e\n(adsbygoogle = \u003cspan class=\"hljs-variable language_\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eadsbygoogle\u003c/span\u003e || []).\u003cspan class=\"hljs-title function_\"\u003epush\u003c/span\u003e({});\n\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003e데이터\u003c/h1\u003e\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003ctable\u003e\u003cthead\u003e\u003ctr\u003e\u003cth\u003edepartment\u003c/th\u003e\u003cth\u003eemployee_name\u003c/th\u003e\u003cth\u003esalary\u003c/th\u003e\u003c/tr\u003e\u003c/thead\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd\u003eSales\u003c/td\u003e\u003ctd\u003eJames\u003c/td\u003e\u003ctd\u003e3000\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003eSales\u003c/td\u003e\u003ctd\u003eMichael\u003c/td\u003e\u003ctd\u003e4600\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003eSales\u003c/td\u003e\u003ctd\u003eRobert\u003c/td\u003e\u003ctd\u003e4100\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003eFinance\u003c/td\u003e\u003ctd\u003eMaria\u003c/td\u003e\u003ctd\u003e3000\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003eSales\u003c/td\u003e\u003ctd\u003eJames\u003c/td\u003e\u003ctd\u003e3000\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003eFinance\u003c/td\u003e\u003ctd\u003eScott\u003c/td\u003e\u003ctd\u003e3300\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003eFinance\u003c/td\u003e\u003ctd\u003eJen\u003c/td\u003e\u003ctd\u003e3900\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003eMarketing\u003c/td\u003e\u003ctd\u003eJeff\u003c/td\u003e\u003ctd\u003e3000\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003eMarketing\u003c/td\u003e\u003ctd\u003eKumar\u003c/td\u003e\u003ctd\u003e2000\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003eSales\u003c/td\u003e\u003ctd\u003eSaif\u003c/td\u003e\u003ctd\u003e4100\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\n\u003ch1\u003eGroupBy 후 map 작업 적용\u003c/h1\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eresult_rdd = df.groupBy(\u003cspan class=\"hljs-string\"\u003e\"department\"\u003c/span\u003e).agg(\n  collect_list(\u003cspan class=\"hljs-string\"\u003e\"salary\"\u003c/span\u003e)\n).rdd.\u003cspan class=\"hljs-built_in\"\u003emap\u003c/span\u003e(\n  \u003cspan class=\"hljs-keyword\"\u003elambda\u003c/span\u003e x: (x[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e], \u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(x[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]))\n)\n\nresult_df = spark.createDataFrame(result_rdd, [\u003cspan class=\"hljs-string\"\u003e\"department\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"max_salary\"\u003c/span\u003e])\nresult_df.show()\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003e결과\u003c/h1\u003e\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003ctable\u003e\u003cthead\u003e\u003ctr\u003e\u003cth\u003edepartment\u003c/th\u003e\u003cth\u003emax_salary\u003c/th\u003e\u003c/tr\u003e\u003c/thead\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd\u003eSales\u003c/td\u003e\u003ctd\u003e4600\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003eFinance\u003c/td\u003e\u003ctd\u003e3900\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003eMarketing\u003c/td\u003e\u003ctd\u003e3000\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\n\u003ch1\u003e조회: 다른 것\u003c/h1\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003ch2\u003e1. rollup()과 cube()\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eRollup()은 다차원 집계를 생성하고 Excel의 소계와 유사한 계층적 요약을 제공합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 초기 데이터\n|department|employee_name|salary|\n|----------|-------------|------|\n| \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e    | \u003cspan class=\"hljs-title class_\"\u003eJames\u003c/span\u003e       | \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e |\n| \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e    | \u003cspan class=\"hljs-title class_\"\u003eMichael\u003c/span\u003e     | \u003cspan class=\"hljs-number\"\u003e4600\u003c/span\u003e |\n| \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e    | \u003cspan class=\"hljs-title class_\"\u003eRobert\u003c/span\u003e      | \u003cspan class=\"hljs-number\"\u003e4100\u003c/span\u003e |\n| \u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e  | \u003cspan class=\"hljs-title class_\"\u003eMaria\u003c/span\u003e       | \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e |\n| \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e    | \u003cspan class=\"hljs-title class_\"\u003eJames\u003c/span\u003e       | \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e |\n| \u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e  | \u003cspan class=\"hljs-title class_\"\u003eScott\u003c/span\u003e       | \u003cspan class=\"hljs-number\"\u003e3300\u003c/span\u003e |\n| \u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e  | \u003cspan class=\"hljs-title class_\"\u003eJen\u003c/span\u003e         | \u003cspan class=\"hljs-number\"\u003e3900\u003c/span\u003e |\n| \u003cspan class=\"hljs-title class_\"\u003eMarketing\u003c/span\u003e| \u003cspan class=\"hljs-title class_\"\u003eJeff\u003c/span\u003e        | \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e |\n| \u003cspan class=\"hljs-title class_\"\u003eMarketing\u003c/span\u003e| \u003cspan class=\"hljs-title class_\"\u003eKumar\u003c/span\u003e       | \u003cspan class=\"hljs-number\"\u003e2000\u003c/span\u003e |\n| \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e    | \u003cspan class=\"hljs-title class_\"\u003eSaif\u003c/span\u003e        | \u003cspan class=\"hljs-number\"\u003e4100\u003c/span\u003e |\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pyspark.\u003cspan class=\"hljs-property\"\u003esql\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003efunctions\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e sum\n\n# \u003cspan class=\"hljs-title class_\"\u003eRollup\u003c/span\u003e 예제\nrollup_df = df.\u003cspan class=\"hljs-title function_\"\u003erollup\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"department\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"employee_name\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003esum\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"salary\"\u003c/span\u003e)\nrollup_df.\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e()\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 결과\n+----------+-------------+-----------+\n|department|employee_name|\u003cspan class=\"hljs-title function_\"\u003esum\u003c/span\u003e(salary)|\n+----------+-------------+-----------+\n|     \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e|        \u003cspan class=\"hljs-title class_\"\u003eJames\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e6000\u003c/span\u003e|\n|      \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|         \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|      \u003cspan class=\"hljs-number\"\u003e34000\u003c/span\u003e|\n|     \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e|         \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|      \u003cspan class=\"hljs-number\"\u003e18800\u003c/span\u003e|\n|     \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e|      \u003cspan class=\"hljs-title class_\"\u003eMichael\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e4600\u003c/span\u003e|\n|     \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e|       \u003cspan class=\"hljs-title class_\"\u003eRobert\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e4100\u003c/span\u003e|\n|   \u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e|         \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|      \u003cspan class=\"hljs-number\"\u003e10200\u003c/span\u003e|\n|   \u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e|        \u003cspan class=\"hljs-title class_\"\u003eMaria\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e|\n|   \u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e|        \u003cspan class=\"hljs-title class_\"\u003eScott\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e3300\u003c/span\u003e|\n|   \u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e|          \u003cspan class=\"hljs-title class_\"\u003eJen\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e3900\u003c/span\u003e|\n| \u003cspan class=\"hljs-title class_\"\u003eMarketing\u003c/span\u003e|         \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e5000\u003c/span\u003e|\n| \u003cspan class=\"hljs-title class_\"\u003eMarketing\u003c/span\u003e|         \u003cspan class=\"hljs-title class_\"\u003eJeff\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e|\n| \u003cspan class=\"hljs-title class_\"\u003eMarketing\u003c/span\u003e|        \u003cspan class=\"hljs-title class_\"\u003eKumar\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e2000\u003c/span\u003e|\n|     \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e|         \u003cspan class=\"hljs-title class_\"\u003eSaif\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e4100\u003c/span\u003e|\n+----------+-------------+-----------+\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eCube(): Cube는 다차원 집계를 생성하고 지정된 그룹화 열의 다중 조합을 통해 통찰을 제공합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 초기 데이터\n+----------+-------------+------+\n|department|employee_name|salary|\n+----------+-------------+------+\n|     \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e|        \u003cspan class=\"hljs-title class_\"\u003eJames\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e|\n|     \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e|      \u003cspan class=\"hljs-title class_\"\u003eMichael\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e4600\u003c/span\u003e|\n|     \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e|       \u003cspan class=\"hljs-title class_\"\u003eRobert\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e4100\u003c/span\u003e|\n|   \u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e|        \u003cspan class=\"hljs-title class_\"\u003eMaria\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e|\n|     \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e|        \u003cspan class=\"hljs-title class_\"\u003eJames\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e|\n|   \u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e|        \u003cspan class=\"hljs-title class_\"\u003eScott\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e3300\u003c/span\u003e|\n|   \u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e|          \u003cspan class=\"hljs-title class_\"\u003eJen\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e3900\u003c/span\u003e|\n| \u003cspan class=\"hljs-title class_\"\u003eMarketing\u003c/span\u003e|         \u003cspan class=\"hljs-title class_\"\u003eJeff\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e|\n| \u003cspan class=\"hljs-title class_\"\u003eMarketing\u003c/span\u003e|        \u003cspan class=\"hljs-title class_\"\u003eKumar\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e2000\u003c/span\u003e|\n|     \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e|         \u003cspan class=\"hljs-title class_\"\u003eSaif\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e4100\u003c/span\u003e|\n+----------+-------------+------+\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pyspark.\u003cspan class=\"hljs-property\"\u003esql\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003efunctions\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e sum\n\n# \u003cspan class=\"hljs-title class_\"\u003eCube\u003c/span\u003e 예시\ncube_df = df.\u003cspan class=\"hljs-title function_\"\u003ecube\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"department\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"employee_name\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003esum\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"salary\"\u003c/span\u003e)\ncube_df.\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e()\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 결과\n\n+----------+-------------+-----------+\n|부서      |직원명         |급여합계   |\n+----------+-------------+-----------+\n|      \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|        \u003cspan class=\"hljs-title class_\"\u003eJames\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e6000\u003c/span\u003e|\n|     판매 |        \u003cspan class=\"hljs-title class_\"\u003eJames\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e6000\u003c/span\u003e|\n|      \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|         \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|      \u003cspan class=\"hljs-number\"\u003e34000\u003c/span\u003e|\n|     판매 |         \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|      \u003cspan class=\"hljs-number\"\u003e18800\u003c/span\u003e|\n|      \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|      \u003cspan class=\"hljs-title class_\"\u003eMichael\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e4600\u003c/span\u003e|\n|     판매 |      \u003cspan class=\"hljs-title class_\"\u003eMichael\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e4600\u003c/span\u003e|\n|     판매 |       \u003cspan class=\"hljs-title class_\"\u003eRobert\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e4100\u003c/span\u003e|\n|      \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|       \u003cspan class=\"hljs-title class_\"\u003eRobert\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e4100\u003c/span\u003e|\n|   재무   |         \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|      \u003cspan class=\"hljs-number\"\u003e10200\u003c/span\u003e|\n|   재무   |        \u003cspan class=\"hljs-title class_\"\u003eMaria\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e|\n|      \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|        \u003cspan class=\"hljs-title class_\"\u003eMaria\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e|\n|      \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|        \u003cspan class=\"hljs-title class_\"\u003eScott\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e3300\u003c/span\u003e|\n|   재무   |        \u003cspan class=\"hljs-title class_\"\u003eScott\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e3300\u003c/span\u003e|\n|      \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|          \u003cspan class=\"hljs-title class_\"\u003eJen\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e3900\u003c/span\u003e|\n|   재무   |          \u003cspan class=\"hljs-title class_\"\u003eJen\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e3900\u003c/span\u003e|\n| 마케팅  |         \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e5000\u003c/span\u003e|\n| 마케팅  |         \u003cspan class=\"hljs-title class_\"\u003eJeff\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e|\n|      \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|         \u003cspan class=\"hljs-title class_\"\u003eJeff\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e|\n| 마케팅  |        \u003cspan class=\"hljs-title class_\"\u003eKumar\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e2000\u003c/span\u003e|\n|      \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|        \u003cspan class=\"hljs-title class_\"\u003eKumar\u003c/span\u003e|       \u003cspan class=\"hljs-number\"\u003e2000\u003c/span\u003e|\n+----------+-------------+-----------+\n상위 \u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e개 행만 표시\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e2. groupBy() + pivot()\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ePivoting을 사용하면 행을 열로 변환하여 피벗 테이블과 유사한 방식으로 데이터를 요약할 수 있습니다. 종종 두 열 간의 관계를 이해하는 데 사용됩니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 초기 데이터\n+----------+-------------+------+\n|부서     |직원명        |급여   |\n+----------+-------------+------+\n|     판매 |        \u003cspan class=\"hljs-title class_\"\u003eJames\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e|\n|     판매 |      \u003cspan class=\"hljs-title class_\"\u003eMichael\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e4600\u003c/span\u003e|\n|     판매 |       \u003cspan class=\"hljs-title class_\"\u003eRobert\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e4100\u003c/span\u003e|\n|   재무  |        \u003cspan class=\"hljs-title class_\"\u003eMaria\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e|\n|     판매 |        \u003cspan class=\"hljs-title class_\"\u003eJames\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e|\n|   재무  |        \u003cspan class=\"hljs-title class_\"\u003eScott\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e3300\u003c/span\u003e|\n|   재무  |          \u003cspan class=\"hljs-title class_\"\u003eJen\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e3900\u003c/span\u003e|\n| 마케팅  |         \u003cspan class=\"hljs-title class_\"\u003eJeff\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e|\n| 마케팅  |        \u003cspan class=\"hljs-title class_\"\u003eKumar\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e2000\u003c/span\u003e|\n|     판매 |         \u003cspan class=\"hljs-title class_\"\u003eSaif\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e4100\u003c/span\u003e|\n+----------+-------------+------+\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# \u003cspan class=\"hljs-title class_\"\u003ePivot\u003c/span\u003e 예시\npivot_df = df.\u003cspan class=\"hljs-title function_\"\u003egroupBy\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"department\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003epivot\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"employee_name\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003esum\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"salary\"\u003c/span\u003e)\npivot_df.\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 결과\n+----------+-----+----+----+-----+-----+-------+------+----+-----+\n|department|\u003cspan class=\"hljs-title class_\"\u003eJames\u003c/span\u003e|\u003cspan class=\"hljs-title class_\"\u003eJeff\u003c/span\u003e| \u003cspan class=\"hljs-title class_\"\u003eJen\u003c/span\u003e|\u003cspan class=\"hljs-title class_\"\u003eKumar\u003c/span\u003e|\u003cspan class=\"hljs-title class_\"\u003eMaria\u003c/span\u003e|\u003cspan class=\"hljs-title class_\"\u003eMichael\u003c/span\u003e|\u003cspan class=\"hljs-title class_\"\u003eRobert\u003c/span\u003e|\u003cspan class=\"hljs-title class_\"\u003eSaif\u003c/span\u003e|\u003cspan class=\"hljs-title class_\"\u003eScott\u003c/span\u003e|\n+----------+-----+----+----+-----+-----+-------+------+----+-----+\n|     \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e6000\u003c/span\u003e|\u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|\u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e| \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e| \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|   \u003cspan class=\"hljs-number\"\u003e4600\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e4100\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e4100\u003c/span\u003e| \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|\n|   \u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e| \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|\u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e3900\u003c/span\u003e| \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e|   \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|  \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|\u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e3300\u003c/span\u003e|\n| \u003cspan class=\"hljs-title class_\"\u003eMarketing\u003c/span\u003e| \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e|\u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e| \u003cspan class=\"hljs-number\"\u003e2000\u003c/span\u003e| \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|   \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|  \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|\u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e| \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e|\n+----------+-----+----+----+-----+-----+-------+------+----+-----+\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e3. 윈도우 함수: partitionBy() + row_number()/rank().over(w)\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e윈도우 함수는 현재 행과 관련된 \"윈도우\"에 대해 계산을 수행할 수 있어 전통적인 group-by 작업보다 더 유연성을 제공합니다. 이는 러닝 토탈, 이동 평균 또는 이전 및 다음 행에 액세스하는 데 특히 유용합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 초기 데이터\n| 부서      | 직원 이름       | 급여  |\n|----------|---------------|------|\n| \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e    | \u003cspan class=\"hljs-title class_\"\u003eJames\u003c/span\u003e         | \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e |\n| \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e    | \u003cspan class=\"hljs-title class_\"\u003eMichael\u003c/span\u003e       | \u003cspan class=\"hljs-number\"\u003e4600\u003c/span\u003e |\n| \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e    | \u003cspan class=\"hljs-title class_\"\u003eRobert\u003c/span\u003e        | \u003cspan class=\"hljs-number\"\u003e4100\u003c/span\u003e |\n| \u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e  | \u003cspan class=\"hljs-title class_\"\u003eMaria\u003c/span\u003e         | \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e |\n| \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e    | \u003cspan class=\"hljs-title class_\"\u003eJames\u003c/span\u003e         | \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e |\n| \u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e  | \u003cspan class=\"hljs-title class_\"\u003eScott\u003c/span\u003e         | \u003cspan class=\"hljs-number\"\u003e3300\u003c/span\u003e |\n| \u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e  | \u003cspan class=\"hljs-title class_\"\u003eJen\u003c/span\u003e           | \u003cspan class=\"hljs-number\"\u003e3900\u003c/span\u003e |\n| \u003cspan class=\"hljs-title class_\"\u003eMarketing\u003c/span\u003e| \u003cspan class=\"hljs-title class_\"\u003eJeff\u003c/span\u003e          | \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e |\n| \u003cspan class=\"hljs-title class_\"\u003eMarketing\u003c/span\u003e| \u003cspan class=\"hljs-title class_\"\u003eKumar\u003c/span\u003e         | \u003cspan class=\"hljs-number\"\u003e2000\u003c/span\u003e |\n| \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e    | \u003cspan class=\"hljs-title class_\"\u003eSaif\u003c/span\u003e          | \u003cspan class=\"hljs-number\"\u003e4100\u003c/span\u003e |\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pyspark.\u003cspan class=\"hljs-property\"\u003esql\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ewindow\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eWindow\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pyspark.\u003cspan class=\"hljs-property\"\u003esql\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003efunctions\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e col, row_number\n\nwindowSpec = \u003cspan class=\"hljs-title class_\"\u003eWindow\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003epartitionBy\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"department\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eorderBy\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003ecol\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"salary\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003easc\u003c/span\u003e())\ndf_with_row_number = df.\u003cspan class=\"hljs-title function_\"\u003ewithColumn\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"row_number\"\u003c/span\u003e, \u003cspan class=\"hljs-title function_\"\u003erow_number\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003eover\u003c/span\u003e(windowSpec))\ndf_with_row_number.\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 결과\n| 직원 이름      | 부서        | 급여  | row_number |\n|---------------|------------|------|------------|\n| \u003cspan class=\"hljs-title class_\"\u003eMaria\u003c/span\u003e         | \u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e    | \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e |      \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e     |\n| \u003cspan class=\"hljs-title class_\"\u003eScott\u003c/span\u003e         | \u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e    | \u003cspan class=\"hljs-number\"\u003e3300\u003c/span\u003e |      \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e     |\n| \u003cspan class=\"hljs-title class_\"\u003eJen\u003c/span\u003e           | \u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e    | \u003cspan class=\"hljs-number\"\u003e3900\u003c/span\u003e |      \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e     |\n| \u003cspan class=\"hljs-title class_\"\u003eKumar\u003c/span\u003e         | \u003cspan class=\"hljs-title class_\"\u003eMarketing\u003c/span\u003e  | \u003cspan class=\"hljs-number\"\u003e2000\u003c/span\u003e |      \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e     |\n| \u003cspan class=\"hljs-title class_\"\u003eJeff\u003c/span\u003e          | \u003cspan class=\"hljs-title class_\"\u003eMarketing\u003c/span\u003e  | \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e |      \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e     |\n| \u003cspan class=\"hljs-title class_\"\u003eJames\u003c/span\u003e         | \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e      | \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e |      \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e     |\n| \u003cspan class=\"hljs-title class_\"\u003eJames\u003c/span\u003e         | \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e      | \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e |      \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e     |\n| \u003cspan class=\"hljs-title class_\"\u003eRobert\u003c/span\u003e        | \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e      | \u003cspan class=\"hljs-number\"\u003e4100\u003c/span\u003e |      \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e     |\n| \u003cspan class=\"hljs-title class_\"\u003eSaif\u003c/span\u003e          | \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e      | \u003cspan class=\"hljs-number\"\u003e4100\u003c/span\u003e |      \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e     |\n| \u003cspan class=\"hljs-title class_\"\u003eMichael\u003c/span\u003e       | \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e      | \u003cspan class=\"hljs-number\"\u003e4600\u003c/span\u003e |      \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e     |\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eRank() 함수를 위해\u003c/li\u003e\n\u003c/ul\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pyspark.\u003cspan class=\"hljs-property\"\u003esql\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ewindow\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eWindow\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pyspark.\u003cspan class=\"hljs-property\"\u003esql\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003efunctions\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e rank, col\n\nwindowSpec = \u003cspan class=\"hljs-title class_\"\u003eWindow\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003epartitionBy\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"department\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eorderBy\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003ecol\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"salary\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003edesc\u003c/span\u003e())\ndf_with_rank = df.\u003cspan class=\"hljs-title function_\"\u003ewithColumn\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"rank\"\u003c/span\u003e, \u003cspan class=\"hljs-title function_\"\u003erank\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003eover\u003c/span\u003e(windowSpec))\ndf_with_rank.\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 출력\n+-------------+----------+------+----------+\n|employee_name|department|salary|      rank|\n+-------------+----------+------+----------+\n|          \u003cspan class=\"hljs-title class_\"\u003eJen\u003c/span\u003e|   \u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e3900\u003c/span\u003e|         \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\n|        \u003cspan class=\"hljs-title class_\"\u003eScott\u003c/span\u003e|   \u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e3300\u003c/span\u003e|         \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e|\n|        \u003cspan class=\"hljs-title class_\"\u003eMaria\u003c/span\u003e|   \u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e|         \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e|\n|         \u003cspan class=\"hljs-title class_\"\u003eJeff\u003c/span\u003e| \u003cspan class=\"hljs-title class_\"\u003eMarketing\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e|         \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\n|        \u003cspan class=\"hljs-title class_\"\u003eKumar\u003c/span\u003e| \u003cspan class=\"hljs-title class_\"\u003eMarketing\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e2000\u003c/span\u003e|         \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e|\n|      \u003cspan class=\"hljs-title class_\"\u003eMichael\u003c/span\u003e|     \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e4600\u003c/span\u003e|         \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\n|       \u003cspan class=\"hljs-title class_\"\u003eRobert\u003c/span\u003e|     \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e4100\u003c/span\u003e|         \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e|\n|         \u003cspan class=\"hljs-title class_\"\u003eSaif\u003c/span\u003e|     \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e4100\u003c/span\u003e|         \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e|\n|        \u003cspan class=\"hljs-title class_\"\u003eJames\u003c/span\u003e|     \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e|         \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e|\n|        \u003cspan class=\"hljs-title class_\"\u003eJames\u003c/span\u003e|     \u003cspan class=\"hljs-title class_\"\u003eSales\u003c/span\u003e|  \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e|         \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e|\n+-------------+----------+------+----------+\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003e최적화 I: 무게 감소\u003c/h1\u003e\n\u003ch2\u003e0. 불필요한 원시 데이터 제거\u003c/h2\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003ch2\u003e1. DataFrame이 여러 번 액세스 될 때 캐시합니다.\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003edf.\u003cspan class=\"hljs-title function_\"\u003ecache\u003c/span\u003e();\ndf.\u003cspan class=\"hljs-title function_\"\u003ecount\u003c/span\u003e();\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e#출력\n\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e2. 적절한 파일 형식 사용하기\u003c/h2\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cul\u003e\n\u003cli\u003e압축 파일은 파일의 입출력 및 메모리를 절약할 수 있어요.\u003c/li\u003e\n\u003cli\u003e압축 해제된 파일은 CPU를 절약할 수 있어요.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003edf.\u003cspan class=\"hljs-property\"\u003ewrite\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eparquet\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"output.parquet\"\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e3. 스키마 수동 지정하기\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pyspark.\u003cspan class=\"hljs-property\"\u003esql\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003etypes\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eStructType\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eStructField\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eIntegerType\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eStringType\u003c/span\u003e\nschema = \u003cspan class=\"hljs-title class_\"\u003eStructType\u003c/span\u003e([\n    \u003cspan class=\"hljs-title class_\"\u003eStructField\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"id\"\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eIntegerType\u003c/span\u003e(), \u003cspan class=\"hljs-title class_\"\u003eTrue\u003c/span\u003e),\n    \u003cspan class=\"hljs-title class_\"\u003eStructField\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"name\"\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eStringType\u003c/span\u003e(), \u003cspan class=\"hljs-title class_\"\u003eTrue\u003c/span\u003e),\n    \u003cspan class=\"hljs-title class_\"\u003eStructField\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"age\"\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eIntegerType\u003c/span\u003e(), \u003cspan class=\"hljs-title class_\"\u003eTrue\u003c/span\u003e)\n])\ndf = spark.\u003cspan class=\"hljs-property\"\u003eread\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eschema\u003c/span\u003e(schema).\u003cspan class=\"hljs-title function_\"\u003ecsv\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"path/to/file.csv\"\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003ch2\u003e4. 조기에 필요한 열 선택하기\u003c/h2\u003e\n\u003cp\u003e데이터 처리 파이프라인에서 메모리 사용량을 줄이기 위해 필요한 열만 미리 선택하세요.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003edf.\u003cspan class=\"hljs-title function_\"\u003eselect\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"dept_name\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"name\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003efilter\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"dept_id \u003e= 102\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e();\ndf.\u003cspan class=\"hljs-title function_\"\u003eselect\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"dept_name\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"name\"\u003c/span\u003e)\n  .\u003cspan class=\"hljs-title function_\"\u003efilter\u003c/span\u003e(df.\u003cspan class=\"hljs-property\"\u003edept_id\u003c/span\u003e \u003e= \u003cspan class=\"hljs-number\"\u003e102\u003c/span\u003e)\n  .\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e();\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e#출력\n+---------+----+\n|dept_name|name|\n+---------+----+\n|\u003cspan class=\"hljs-title class_\"\u003eMarketing\u003c/span\u003e|\u003cspan class=\"hljs-title class_\"\u003eJane\u003c/span\u003e|\n|  \u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e| \u003cspan class=\"hljs-title class_\"\u003eJoe\u003c/span\u003e|\n+---------+----+\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003ch2\u003e5. 필터를 조인이나 집계 전에 빠르게 적용하세요.\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003edf.\u003cspan class=\"hljs-title function_\"\u003efilter\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"age \u003e 25\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ejoin\u003c/span\u003e(df_other, \u003cspan class=\"hljs-string\"\u003e\"id\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e();\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e6. 큰 데이터셋 수집 방지를 위해 limit() 사용하기\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e큰 데이터셋에 collect()를 사용하지 않도록 주의하여 메모리 부족 오류를 방지하세요.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003edf.\u003cspan class=\"hljs-title function_\"\u003efilter\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"age \u003e 30\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003elimit\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ecollect\u003c/span\u003e();\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e7. Using spark.sql(): Catalyst optimizer for Complex Queries\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eLeverage Spark SQL for complex queries, which might be more readable and can benefit from the Catalyst optimizer.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003edf.\u003cspan class=\"hljs-title function_\"\u003ecreateOrReplaceTempView\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"table\"\u003c/span\u003e);\nspark.\u003cspan class=\"hljs-title function_\"\u003esql\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"SELECT id, sum(value) FROM table GROUP BY id\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e();\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003ch2\u003e8. RDD 사용: reduceByKey를 사용한 집계\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e집계 작업을 수행할 때 reduceByKey를 사용하는 것이 groupBy보다 더 효율적일 수 있습니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003erdd = df.rdd.\u003cspan class=\"hljs-built_in\"\u003emap\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003elambda\u003c/span\u003e x: (x[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e], x[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]))\nreduced = rdd.reduceByKey(\u003cspan class=\"hljs-keyword\"\u003elambda\u003c/span\u003e a, b: a + b)\nreduced.toDF([\u003cspan class=\"hljs-string\"\u003e\"key\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"value\"\u003c/span\u003e]).show()\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003e최적화 II: 파티션 없이 병렬화 없음\u003c/h1\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003ch2\u003e1. 테이블 분할: partitionBy()\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e데이터프레임을 디스크에 저장할 때 빠른 후속 읽기를 위해 분할을 사용하세요.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003edf.\u003cspan class=\"hljs-property\"\u003ewrite\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003epartitionBy\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"year\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"month\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eparquet\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"path/to/output\"\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e2. 스튜 관리를 위한 Salting 키\u003c/h2\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cul\u003e\n\u003cli\u003e조인 연산 중 데이터 스큐가 발생하는 경우, 하나 이상의 키 값이 다른 것들보다 훨씬 더 많은 데이터를 가지고 있을 때 발생합니다.\u003c/li\u003e\n\u003cli\u003e예를 들어 \"customer_id\"를 기준으로 조인을 수행하고, 대부분의 거래가 소수의 고객에 속해 있다면 이러한 소수의 키는 다른 키들에 비해 훨씬 많은 양의 데이터를 가지고 있을 것입니다. 이로 인해 일부 작업(큰 키를 처리하는 작업)이 훨씬 더 오랜 시간이 걸리고 병목 현상이 발생할 수 있습니다.\u003c/li\u003e\n\u003cli\u003e이 문제를 해결하는 방법은 skewed 데이터를 관리하기 위해 키에 임의의 접두사를 추가하는 것입니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pyspark.\u003cspan class=\"hljs-property\"\u003esql\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003efunctions\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e monotonically_increasing_id, expr\ndf.\u003cspan class=\"hljs-title function_\"\u003ewithColumn\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"salted_key\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-title function_\"\u003eexpr\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"concat(name, '_', (monotonically_increasing_id() % 10))\"\u003c/span\u003e)\n).\u003cspan class=\"hljs-title function_\"\u003egroupBy\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"salted_key\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ecount\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003eselect\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003esum\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"count\"\u003c/span\u003e)).\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 결과\n+----------+\n|\u003cspan class=\"hljs-title function_\"\u003esum\u003c/span\u003e(count)|\n+----------+\n|         \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e|\n+----------+\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e데이터 로딩의 균형을 어떻게 맞출까요?\u003c/li\u003e\n\u003c/ul\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pyspark.\u003cspan class=\"hljs-property\"\u003esql\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003efunctions\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e monotonically_increasing_id, expr\ndf.\u003cspan class=\"hljs-title function_\"\u003ewithColumn\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"salted_key\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-title function_\"\u003eexpr\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"concat(name, '_', (monotonically_increasing_id() % 10))\"\u003c/span\u003e)\n).\u003cspan class=\"hljs-title function_\"\u003egroupBy\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"salted_key\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ecount\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 결과\n+----------+-----+\n|salted_key|count|\n+----------+-----+\n|   \u003cspan class=\"hljs-title class_\"\u003eJames\u003c/span\u003e_6|    \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\n|   \u003cspan class=\"hljs-title class_\"\u003eJames\u003c/span\u003e_4|    \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\n|   \u003cspan class=\"hljs-title class_\"\u003eJames\u003c/span\u003e_0|    \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\n+----------+-----+\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003e최적화 III: Shuffling을 최소화하는 전략\u003c/h1\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e### \u003cspan class=\"hljs-title class_\"\u003eShuffling\u003c/span\u003e 최소화 전략\n- **\u003cspan class=\"hljs-title class_\"\u003eBroadcast\u003c/span\u003e 변수 사용**\n  - 데이터셋이 작은 경우 \u003cspan class=\"hljs-title class_\"\u003eShuffling\u003c/span\u003e을 피하기 위해 모든 노드에 브로드캐스트합니다.\n- **파티션 튜닝**\n  - 작업 및 데이터 규모에 맞게 파티션 수를 조정합니다.\n- **변환 최적화**\n  - \u003cspan class=\"hljs-title class_\"\u003eShuffling\u003c/span\u003e을 필요로 하는 넓은 변환을 최소화하기 위해 작업을 계획합니다.\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003ch2\u003e섞기\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e섞기는 데이터가 서로 다른 파티션에 재분배되는 과정입니다.\u003c/li\u003e\n\u003cli\u003e이는 데이터를 실행자 간이나 심지어 기계 간에 이동하는 것을 포함합니다.\u003c/li\u003e\n\u003cli\u003e네트워크 및 디스크 I/O 측면에서 가장 비용이 많이 드는 작업 중 하나입니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e섞기의 목적\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e데이터 재분배: 조인, 그룹화, 집계 및 재분할과 같은 넓은 변환을 용이하게 합니다.\u003c/li\u003e\n\u003cli\u003e부하 분산: 클러스터 전체에 데이터와 작업 부담을 균등하게 분배합니다.\u003c/li\u003e\n\u003cli\u003e동시성: 병렬 처리를 강화하고 리소스 활용을 최적화합니다.\u003c/li\u003e\n\u003cli\u003e데이터 지역성 최적화: 데이터가 처리될 위치에 가까이 이동하도록 합니다. 네트워크 트래픽을 줄입니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003ch2\u003e셔플링의 고민거리\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e자원 소모가 많음: 상당한 네트워크 대역폭과 디스크 I/O를 사용합니다.\u003c/li\u003e\n\u003cli\u003e지연 시간 증가: 특히 대량의 데이터셋인 경우 처리 시간이 상당히 증가합니다.\u003c/li\u003e\n\u003cli\u003e병목 현상 발생 가능성: 적절히 관리되지 않으면 전체 시스템 성능을 느리게 만들 수 있습니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e1. 작은 DataFrame과 큰 DataFrame을 조인할 때 데이터 셔플링을 최소화하기 위해 브로드캐스트 조인을 사용합니다.\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pyspark.\u003cspan class=\"hljs-property\"\u003esql\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eSparkSession\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pyspark.\u003cspan class=\"hljs-property\"\u003esql\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003efunctions\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e broadcast\n\n# 스파크 세션 초기화\nspark = \u003cspan class=\"hljs-title class_\"\u003eSparkSession\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ebuilder\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eappName\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"브로드캐스트 조인 예제\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003egetOrCreate\u003c/span\u003e()\n# 직원용 큰 \u003cspan class=\"hljs-title class_\"\u003eDataFrame\u003c/span\u003e 생성\ndata_employees = [(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"John\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e101\u003c/span\u003e),\n                  (\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"Jane\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e102\u003c/span\u003e),\n                  (\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"Joe\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e103\u003c/span\u003e),\n                  (\u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"Jill\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e101\u003c/span\u003e),\n                  # 더 많은 레코드가 있다고 가정\n                  ]\ncolumns_employees = [\u003cspan class=\"hljs-string\"\u003e\"emp_id\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"name\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"dept_id\"\u003c/span\u003e]\ndf_employees = spark.\u003cspan class=\"hljs-title function_\"\u003ecreateDataFrame\u003c/span\u003e(data_employees, columns_employees)\n# 부서용 작은 \u003cspan class=\"hljs-title class_\"\u003eDataFrame\u003c/span\u003e 생성\ndata_departments = [(\u003cspan class=\"hljs-number\"\u003e101\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"인사\"\u003c/span\u003e),\n                    (\u003cspan class=\"hljs-number\"\u003e102\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"마케팅\"\u003c/span\u003e),\n                    (\u003cspan class=\"hljs-number\"\u003e103\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"금융\"\u003c/span\u003e),\n                    (\u003cspan class=\"hljs-number\"\u003e104\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"IT\"\u003c/span\u003e),\n                    (\u003cspan class=\"hljs-number\"\u003e105\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"지원\"\u003c/span\u003e)\n                    ]\ncolumns_departments = [\u003cspan class=\"hljs-string\"\u003e\"dept_id\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"dept_name\"\u003c/span\u003e]\ndf_departments = spark.\u003cspan class=\"hljs-title function_\"\u003ecreateDataFrame\u003c/span\u003e(data_departments, columns_departments)\n# 브로드캐스트 조인 수행\ndf_joined = df_employees.\u003cspan class=\"hljs-title function_\"\u003ejoin\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003ebroadcast\u003c/span\u003e(df_departments), \u003cspan class=\"hljs-string\"\u003e\"dept_id\"\u003c/span\u003e)\ndf_joined.\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e()\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e#출력\n+-------+------+----+---------+\n|dept_id|emp_id|  이름|dept_name|\n+-------+------+-----+--------+\n|    \u003cspan class=\"hljs-number\"\u003e101\u003c/span\u003e|     \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e| 존|       인사|\n|    \u003cspan class=\"hljs-number\"\u003e102\u003c/span\u003e|     \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e| 제인|     마케팅|\n|    \u003cspan class=\"hljs-number\"\u003e103\u003c/span\u003e|     \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e| 조|     금융|\n|    \u003cspan class=\"hljs-number\"\u003e101\u003c/span\u003e|     \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e| 질|       인사|\n+-------+------+-----+--------+\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e직원 — 직원 세부 정보를 담은 작은 데이터셋입니다.\u003c/li\u003e\n\u003cli\u003e부서 — 부서 세부 정보를 담은 큰 데이터셋입니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e두 데이터셋을 부서 ID를 기준으로 조인하되, 부서 데이터셋을 크게 섞지 않도록 하는 것이 목표입니다.\u003c/p\u003e\n\u003ch2\u003e2. 파티션 조정: 병렬성 증가를 위한 다시 분할\u003c/h2\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cul\u003e\n\u003cli\u003e데이터 프레임의 파티션을 재분할하여 병렬성을 높이거나 셔플 비용을 줄일 수 있습니다.\u003c/li\u003e\n\u003cli\u003e그러나 여전히 전체 셔플을 유발할 수 있습니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 병렬성을 높이기 위한 재분할 예제\ndf = spark.\u003cspan class=\"hljs-title function_\"\u003ecreateDataFrame\u003c/span\u003e([\n  (\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'foo'\u003c/span\u003e), (\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'bar'\u003c/span\u003e), (\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'baz'\u003c/span\u003e), (\u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'qux'\u003c/span\u003e)\n], [\u003cspan class=\"hljs-string\"\u003e\"id\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"value\"\u003c/span\u003e])\ndf_repartitioned = df.\u003cspan class=\"hljs-title function_\"\u003erepartition\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e)  # 파티션 수 증가\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e3. 파티션 튜닝: 파티션 감소를 위한 Coalesce\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e전체 셔플 피하기: coalesce는 대규모 데이터 세트를 필터링한 후 파티션 수를 줄이고 싶을 때 셔플 비용을 피해야 할 때 최적입니다.\u003c/li\u003e\n\u003cli\u003e전형적인 사용 사례: 많은 파티션이 부분적으로 채워지거나 비어있는 상태로 남을 수 있는 대규모 DataFrame을 필터링한 후 사용됩니다. coalesce는 네트워크 오버헤드를 줄이고 비용 효율적으로 리소스를 관리하는 데 도움이 됩니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 대규모 셔플링 없이 파티션 수를 줄이기 위한 코어스 예시\ndf_filtered = df.\u003cspan class=\"hljs-title function_\"\u003efilter\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"id \u003e 1\"\u003c/span\u003e)\ndf_coalesced = df_filtered.\u003cspan class=\"hljs-title function_\"\u003ecoalesce\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e)  # 파티션 수 줄이기\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e4. 변환 최적화를 통해 데이터 셔플링 최소화하기\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e최적화된 변환을 통해 Apache Spark에서 셔플링을 최소화하는 것은 Spark 애플리케이션의 성능을 향상시키는 중요한 측면입니다.\u003c/li\u003e\n\u003cli\u003e변환 최적화는 데이터 처리 작업을 구조화하여 클러스터 전체에서 불필요한 데이터 이동을 줄이는 것을 포함하며, 이는 리소스를 많이 사용하고 실행 속도를 늦출 수 있습니다.\u003c/li\u003e\n\u003cli\u003e이를 달성하는 방법을 보여주는 몇 가지 전략과 코드 예제는 다음과 같습니다:\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e4–1. 일찍 필터링하기\u003c/h2\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cul\u003e\n\u003cli\u003e데이터 처리 파이프라인에서 조인 또는 집계와 같은 후속 작업에서 나중에 섞어야 하는 데이터 양을 줄이기 위해 필터를 가능한 한 빨리 적용하세요.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pyspark.sql \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e SparkSession\n\n\u003cspan class=\"hljs-comment\"\u003e# 스파크 세션 초기화\u003c/span\u003e\nspark = SparkSession.builder.appName(\u003cspan class=\"hljs-string\"\u003e\"Shuffling 최소화\"\u003c/span\u003e).getOrCreate()\n\n\u003cspan class=\"hljs-comment\"\u003e# DataFrame 생성\u003c/span\u003e\ndata = [(\u003cspan class=\"hljs-string\"\u003e\"John\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"금융\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e), (\u003cspan class=\"hljs-string\"\u003e\"Jane\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"마케팅\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e4000\u003c/span\u003e), (\u003cspan class=\"hljs-string\"\u003e\"Joe\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"마케팅\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2800\u003c/span\u003e), (\u003cspan class=\"hljs-string\"\u003e\"Jill\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"금융\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3900\u003c/span\u003e)]\ncolumns = [\u003cspan class=\"hljs-string\"\u003e\"이름\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"부서\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"연봉\"\u003c/span\u003e]\ndf = spark.createDataFrame(data, schema=columns)\n\n\u003cspan class=\"hljs-comment\"\u003e# 넓은 변환 전에 미리 필터링\u003c/span\u003e\nfiltered_df = df.\u003cspan class=\"hljs-built_in\"\u003efilter\u003c/span\u003e(df[\u003cspan class=\"hljs-string\"\u003e\"연봉\"\u003c/span\u003e] \u003e \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e)\n\n\u003cspan class=\"hljs-comment\"\u003e# 이제 집계 수행\u003c/span\u003e\naggregated_df = filtered_df.groupBy(\u003cspan class=\"hljs-string\"\u003e\"부서\"\u003c/span\u003e).avg(\u003cspan class=\"hljs-string\"\u003e\"연봉\"\u003c/span\u003e)\naggregated_df.show()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-comment\"\u003e# 출력\u003c/span\u003e\n+----------+-----------+\n|부서      |avg(연봉)  |\n+----------+-----------+\n| 마케팅  |     \u003cspan class=\"hljs-number\"\u003e4000.0\u003c/span\u003e|\n| 금융    |     \u003cspan class=\"hljs-number\"\u003e3900.0\u003c/span\u003e|\n+----------+-----------+\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e4-2. 가능한 경우 RDD/넓은 변환 사용하기\u003c/h2\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cul\u003e\n\u003cli\u003e좁은 변환, 예를 들어 \u003ccode\u003emap\u003c/code\u003e 및 \u003ccode\u003efilter\u003c/code\u003e와 같은 작업은 개별 파티션에서 작동하며 데이터 셔플을 필요로하지 않습니다. 가능한 경우 이러한 작업을 넓은 변환 대신 사용하십시오.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 셔플을 발생시키지 않고 새로운 열을 만들기 위해 map을 사용합니다\nrdd = df.\u003cspan class=\"hljs-property\"\u003erdd\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003emap\u003c/span\u003e(lambda \u003cspan class=\"hljs-attr\"\u003ex\u003c/span\u003e: (x.\u003cspan class=\"hljs-property\"\u003eName\u003c/span\u003e, x.\u003cspan class=\"hljs-property\"\u003eSalary\u003c/span\u003e * \u003cspan class=\"hljs-number\"\u003e1.1\u003c/span\u003e))\nupdated_salaries_df = spark.\u003cspan class=\"hljs-title function_\"\u003ecreateDataFrame\u003c/span\u003e(\n  rdd, schema=[\u003cspan class=\"hljs-string\"\u003e\"Name\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"UpdatedSalary\"\u003c/span\u003e]\n)\nupdated_salaries_df.\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 결과\n+----+------------------+\n|\u003cspan class=\"hljs-title class_\"\u003eName\u003c/span\u003e|     \u003cspan class=\"hljs-title class_\"\u003eUpdatedSalary\u003c/span\u003e|\n+----+------------------+\n|\u003cspan class=\"hljs-title class_\"\u003eJohn\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e3300.0000000000005\u003c/span\u003e|\n|\u003cspan class=\"hljs-title class_\"\u003eJane\u003c/span\u003e|            \u003cspan class=\"hljs-number\"\u003e4400.0\u003c/span\u003e|\n| \u003cspan class=\"hljs-title class_\"\u003eJoe\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e3080.0000000000005\u003c/span\u003e|\n|\u003cspan class=\"hljs-title class_\"\u003eJill\u003c/span\u003e|            \u003cspan class=\"hljs-number\"\u003e4290.0\u003c/span\u003e|\n+----+------------------+\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e4-3. Boardcasting join으로 불필요한 셔플을 피하세요\u003c/h2\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cul\u003e\n\u003cli\u003e조인 작업시, 한 데이터셋이 다른 데이터셋보다 현저히 작을 때 브로드캐스트 조인을 사용하여 큰 데이터셋을 셔플링하지 않도록 합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pyspark.\u003cspan class=\"hljs-property\"\u003esql\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003efunctions\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e broadcast\n# df_small이 df_large보다 훨씬 작다고 가정합니다\ndf_small = spark.\u003cspan class=\"hljs-title function_\"\u003ecreateDataFrame\u003c/span\u003e(\n  [(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"HR\"\u003c/span\u003e), (\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"마케팅\"\u003c/span\u003e)], [\u003cspan class=\"hljs-string\"\u003e\"id\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"부서\"\u003c/span\u003e]\n)\ndf_large = spark.\u003cspan class=\"hljs-title function_\"\u003ecreateDataFrame\u003c/span\u003e(\n  [(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"존\"\u003c/span\u003e), (\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"제인\"\u003c/span\u003e), (\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"조\"\u003c/span\u003e), (\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"질\"\u003c/span\u003e)],\n  [\u003cspan class=\"hljs-string\"\u003e\"부서ID\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"이름\"\u003c/span\u003e]\n)\n# 조인 최적화를 위해 작은 \u003cspan class=\"hljs-title class_\"\u003eDataFrame\u003c/span\u003e을 브로드캐스트합니다\noptimized_join_df = df_large.\u003cspan class=\"hljs-title function_\"\u003ejoin\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003ebroadcast\u003c/span\u003e(df_small), df_large.부서\u003cspan class=\"hljs-variable constant_\"\u003eID\u003c/span\u003e == df_small.\u003cspan class=\"hljs-property\"\u003eid\u003c/span\u003e)\noptimized_join_df.\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 결과\n\n+------+----+---+------+\n|부서\u003cspan class=\"hljs-variable constant_\"\u003eID\u003c/span\u003e|이름| id|  부서|\n+------+----+---+------+\n|     \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e| 존|  \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|   \u003cspan class=\"hljs-variable constant_\"\u003eHR\u003c/span\u003e|\n|     \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e|제인|  \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e|마케팅|\n|     \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e| 조|  \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|   \u003cspan class=\"hljs-variable constant_\"\u003eHR\u003c/span\u003e|\n|     \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e| 질|  \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e|마케팅|\n+------+----+---+------+\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e4-4. 전략적으로 파티션 나누기\u003c/h2\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cul\u003e\n\u003cli\u003e만약 넓은 변환을 사용해야 한다면, 나중에 조인 또는 집계할 키를 기반으로 데이터를 파티션으로 나누세요. 이 전략을 사용하면 동일한 키를 가진 행을 동일한 파티션에 함께 두어 셔플링을 줄일 수 있습니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 셔플링 최소화를 위해 집계 전에 파티션 재분배\nrepartitioned_df = df.\u003cspan class=\"hljs-title function_\"\u003erepartition\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"Department\"\u003c/span\u003e)\naggregated_df = repartitioned_df.\u003cspan class=\"hljs-title function_\"\u003egroupBy\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"Department\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eavg\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"Salary\"\u003c/span\u003e)\naggregated_df.\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 결과\n+----------+-----------+\n|\u003cspan class=\"hljs-title class_\"\u003eDepartment\u003c/span\u003e|\u003cspan class=\"hljs-title function_\"\u003eavg\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eSalary\u003c/span\u003e)|\n+----------+-----------+\n|   \u003cspan class=\"hljs-title class_\"\u003eFinance\u003c/span\u003e|     \u003cspan class=\"hljs-number\"\u003e3450.0\u003c/span\u003e|\n| \u003cspan class=\"hljs-title class_\"\u003eMarketing\u003c/span\u003e|     \u003cspan class=\"hljs-number\"\u003e3400.0\u003c/span\u003e|\n+----------+-----------+\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003e성능 모니터링 및 세부 조정\u003c/h1\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003ch2\u003e1. 메모리 관리\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003espark.\u003cspan class=\"hljs-property\"\u003econf\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eset\u003c/span\u003e(“spark.\u003cspan class=\"hljs-property\"\u003eexecutor\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ememory\u003c/span\u003e”, “4g”)\nspark.\u003cspan class=\"hljs-property\"\u003econf\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eset\u003c/span\u003e(“spark.\u003cspan class=\"hljs-property\"\u003edriver\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ememory\u003c/span\u003e”, “2g”)\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e2. 작업 및 스테이지 모니터링\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eSpark UI를 사용하여 응용 프로그램 내의 작업 및 스테이지의 성능을 모니터링합니다.\u003c/li\u003e\n\u003cli\u003eSpark UI에 액세스하려면 다음으로 이동하십시오: http://[your-spark-driver-host]:4040\u003c/li\u003e\n\u003cli\u003eExecutor 메트릭 분석: 각 executor의 메트릭을 모니터링하여 메모리 사용, 디스크 스피릴 및 가비지 수집에 대한 통찰을 얻을 수 있습니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 자세한 실행자 지표를 수집하도록 \u003cspan class=\"hljs-title class_\"\u003eSpark\u003c/span\u003e를 구성합니다\nspark.\u003cspan class=\"hljs-property\"\u003econf\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eset\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"spark.executor.metrics.pollingInterval\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"5000\"\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e3. SQL 성능 튜닝\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eSQL 실행 계획을 이해하고 최적화하기 위해 \u003ccode\u003eEXPLAIN\u003c/code\u003e 계획을 활용하세요.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003edf.\u003cspan class=\"hljs-title function_\"\u003eexplain\u003c/span\u003e(“formatted”)\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e== 물리적인 계획 ==\n* 기존 \u003cspan class=\"hljs-variable constant_\"\u003eRDD\u003c/span\u003e 스캔 (\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\n\n\n(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) 기존 \u003cspan class=\"hljs-variable constant_\"\u003eRDD\u003c/span\u003e 스캔 [코드 생성 \u003cspan class=\"hljs-variable constant_\"\u003eID\u003c/span\u003e : \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]\n출력 [\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e]: [이름 #\u003cspan class=\"hljs-number\"\u003e4628\u003c/span\u003e, 부서 #\u003cspan class=\"hljs-number\"\u003e4629\u003c/span\u003e, 급여 #4630L]\n인수: [이름 #\u003cspan class=\"hljs-number\"\u003e4628\u003c/span\u003e, 부서 #\u003cspan class=\"hljs-number\"\u003e4629\u003c/span\u003e, 급여 #4630L],\n applySchemaToPythonRDD에 있는 \u003cspan class=\"hljs-title class_\"\u003eMapPartitionsRDD\u003c/span\u003e[\u003cspan class=\"hljs-number\"\u003e693\u003c/span\u003e]에서\n                       at \u0026#x3C;알 수 없음\u003e:\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eExistingRDD\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eUnknownPartitioning\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e4. 동적 할당\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e워크로드에 따라 스파크가 실행자 수를 동적으로 조정할 수 있도록 동적 할당을 활성화합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003espark.\u003cspan class=\"hljs-property\"\u003econf\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eset\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"spark.dynamicAllocation.enabled\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"true\"\u003c/span\u003e);\nspark.\u003cspan class=\"hljs-property\"\u003econf\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eset\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"spark.dynamicAllocation.minExecutors\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"1\"\u003c/span\u003e);\nspark.\u003cspan class=\"hljs-property\"\u003econf\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eset\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"spark.dynamicAllocation.maxExecutors\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"20\"\u003c/span\u003e);\nspark.\u003cspan class=\"hljs-property\"\u003econf\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eset\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"spark.dynamicAllocation.executorIdleTimeout\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"60s\"\u003c/span\u003e);\nspark.\u003cspan class=\"hljs-property\"\u003econf\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eset\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"spark.shuffle.service.enabled\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"true\"\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003ch2\u003e5. 데이터 지역성\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e저장 및 처리 장치 간에 데이터가 이동해야 하는 거리를 최소화하여 데이터 지역성을 최적화합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003espark.\u003cspan class=\"hljs-property\"\u003econf\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eset\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"spark.locality.wait\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"300ms\"\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e6. Garbage Collection Tuning\u003c/h2\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e- 가비지 컬렉터 설정을 조정하여 메모리 관리를 최적화하고 일시 중지 시간을 줄일 수 있습니다.\n\n# 더 나은 지연 시간을 위해 \u003cspan class=\"hljs-variable constant_\"\u003eG1GC\u003c/span\u003e 사용\nspark.\u003cspan class=\"hljs-property\"\u003econf\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eset\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"spark.executor.extraJavaOptions\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"-XX:+UseG1GC\"\u003c/span\u003e)\n# 짧은 일시 중지를 위해 명시적인 \u003cspan class=\"hljs-variable constant_\"\u003eGC\u003c/span\u003e 설정 구성\nspark.\u003cspan class=\"hljs-property\"\u003econf\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eset\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"spark.executor.extraJavaOptions\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"-XX:MaxGCPauseMillis=100\"\u003c/span\u003e)\n\n## \u003cspan class=\"hljs-number\"\u003e7.\u003c/span\u003e 데이터 직렬화 세부 조정\n\n- 데이터 직렬화는 분산 애플리케이션의 성능에 중요한 역할을 합니다. \u003cspan class=\"hljs-title class_\"\u003eSpark\u003c/span\u003e는 두 가지 직렬화 도구를 지원합니다:\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 더 나은 성능과 효율성을 위해 \u003cspan class=\"hljs-title class_\"\u003eKryo\u003c/span\u003e 직렬화 프로그램 사용\nspark.\u003cspan class=\"hljs-property\"\u003econf\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eset\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"spark.serializer\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"org.apache.spark.serializer.KryoSerializer\"\u003c/span\u003e)\nspark.\u003cspan class=\"hljs-property\"\u003econf\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eset\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"spark.kryo.registrationRequired\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"true\"\u003c/span\u003e)\n\n# \u003cspan class=\"hljs-title class_\"\u003eKryo\u003c/span\u003e와 사용자 정의 클래스 등록\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eMyClass\u003c/span\u003e:\n    def \u003cspan class=\"hljs-title function_\"\u003e__init__\u003c/span\u003e(self, name, id):\n        self.\u003cspan class=\"hljs-property\"\u003ename\u003c/span\u003e = name\n        self.\u003cspan class=\"hljs-property\"\u003eid\u003c/span\u003e = id\nspark.\u003cspan class=\"hljs-property\"\u003esparkContext\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003egetConf\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003eregisterKryoClasses\u003c/span\u003e([\u003cspan class=\"hljs-title class_\"\u003eMyClass\u003c/span\u003e])\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e8. 네트워크 구성 최적화\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e네트워크 설정은 특히 대규모 배포에서 성능에 중대한 영향을 미칠 수 있습니다:\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 네트워크 타임아웃 설정을 조정하여 대규모 클러스터에서 불필요한 작업 실패를 피하십시오\nspark.\u003cspan class=\"hljs-property\"\u003econf\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eset\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"spark.network.timeout\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"800s\"\u003c/span\u003e)\nspark.\u003cspan class=\"hljs-property\"\u003econf\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eset\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"spark.core.connection.ack.wait.timeout\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"600s\"\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003ch2\u003e9. 고급 Spark SQL 튜닝\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eCatalyst 옵티마이저 및 Tungsten 실행 엔진을 활용하면 Spark SQL의 성능을 향상시킬 수 있습니다:\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 직렬 처리를 위한 전체 단계 코드 생성 활성화\nspark.\u003cspan class=\"hljs-property\"\u003econf\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eset\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"spark.sql.codegen.wholeStage\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"true\"\u003c/span\u003e)\n\n# 조인 최적화에 유용한 테이블 브로드캐스트를 위한 최대 바이트 수 증가\nspark.\u003cspan class=\"hljs-property\"\u003econf\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eset\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"spark.sql.autoBroadcastJoinThreshold\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"10485760\"\u003c/span\u003e)  # \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eMB\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e10. 데이터 파티셔닝 최적화\u003c/h2\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e데이터 분배를 세밀하게 조정하여 쿼리 성능을 향상시키고 셔플 오버헤드를 줄일 수 있어요:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 데이터 크기 및 작업을 기준으로 수동으로 셔플 파티션 수 설정\n\nspark.\u003cspan class=\"hljs-property\"\u003econf\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eset\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"spark.sql.shuffle.partitions\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"200\"\u003c/span\u003e)\n# 클러스터 크기 및 데이터에 맞게 조정하세요\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e11. 적응형 쿼리 실행 활성화\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e적응형 쿼리 실행 (AQE)는 실행 중에 쿼리 계획을 조정함으로써 Spark SQL 쿼리를 더 빠르고 데이터 스쿠 및 기타 이슈에 더 강건하게 만드는 기능이에요.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 쿼리 실행을 적응적으로 조정하는 \u003cspan class=\"hljs-variable constant_\"\u003eAQE\u003c/span\u003e를 활성화합니다. 이는 구성을 간소화하고 성능을 향상시킬 수 있습니다.\nspark.\u003cspan class=\"hljs-property\"\u003econf\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eset\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"spark.sql.adaptive.enabled\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"true\"\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eAQE는 실제 데이터에 적응해 셔플 파티셔닝을 조정하고, 불균형 조인을 처리하며, 정렬을 최적화할 수 있습니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e12. 메모리 관리 지정\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e적절한 메모리 관리는 메모리 집약적인 작업에서 특히 효과적인 성능 개선을 위해 스파이지를 방지할 수 있습니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003ch1\u003eRDD 저장소에 예약된 메모리 분수를 구성합니다.\u003c/h1\u003e\n\u003cp\u003espark.conf.set(“spark.memory.fraction”, “0.6”)\nspark.conf.set(“spark.memory.storageFraction”, “0.5”)\u003c/p\u003e\n\u003cp\u003e이러한 설정은 실행 메모리와 저장소 메모리 사이의 균형을 맞추어 셔플 및 캐싱 중 디스크 스파일을 줄이는 데 도움이 됩니다.\u003c/p\u003e\n\u003ch1\u003e읽어 주셔서 감사합니다\u003c/h1\u003e\n\u003cp\u003e이 글이 마음에 드시면:\u003c/p\u003e\n\u003c!-- TIL 수평 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"1549334788\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cul\u003e\n\u003cli\u003e👏 여러 번 박수로 지지를 보여주세요!\u003c/li\u003e\n\u003cli\u003e이 안내서를 친구들과 공유해도 좋아요.\u003c/li\u003e\n\u003cli\u003e여러분의 피드백은 소중합니다. 앞으로의 글에 영감을 주고 안내해 줍니다.\u003c/li\u003e\n\u003cli\u003e또는 메시지를 남겨주세요: \u003ca href=\"https://www.linkedin.com/in/kevinchwong\" rel=\"nofollow\" target=\"_blank\"\u003ehttps://www.linkedin.com/in/kevinchwong\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-07-09-IntensiveSparkOptimizationCourse"},"buildId":"X4OrKfmLtU3-3BijwfHe6","assetPrefix":"/TIL","isFallback":false,"gsp":true,"scriptLoader":[{"async":true,"src":"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4877378276818686","strategy":"lazyOnload","crossOrigin":"anonymous"}]}</script></body></html>